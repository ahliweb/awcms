#!/bin/bash

# Array of missing migration IDs from the error log
# These exist on Remote but not Locally, so we mark them as 'reverted' (deleted)
# to stop Supabase from conflciting.
MIGRATIONS=(
  "20251213101136" "20251213101345" "20251213101404" "20251213101600" "20251213101827"
  "20251215154849" "20251215162044" "20251215183520" "20251216092536" "20251216101955"
  "20251216102341" "20251216102412" "20251216103335" "20251216103602" "20251216103656"
  "20251216103858" "20251217212733" "20251217212820" "20251217213621" "20251217215123"
  "20251217221047" "20251218001330" "20251218003251" "20251218003948" "20251218004104"
  "20251218004152" "20251218004317" "20251218004423" "20251218004524" "20251218182745"
  "20251218185206" "20251218190118" "20251218233950" "20251218234005" "20251219021953"
  "20251219022010" "20251219022143" "20251219022224" "20251219034609" "20251219034635"
  "20251219034825" "20251219034828" "20251219035213" "20251219035455" "20251219084750"
  "20251219090036" "20251219090843" "20251219090913" "20251219092136" "20251219103436"
  "20251219103543" "20251219104842" "20251219104906" "20251220014930" "20251220015142"
  "20251220030936" "20251220050136" "20251220052628" "20251220055634" "20251220063023"
  "20251220063216" "20251220063252" "20251220122847" "20251220162330" "20251220221159"
  "20251228004944" "20251228004957" "20251228005026" "20251228010114" "20251228010130"
  "20251228010442" "20251228010509" "20251228010533" "20251228010617" "20251228010618"
  "20251228010647" "20251228010715" "20251228010740" "20251228104636" "20251228105624"
  "20251228110115" "20251228125333" "20251228125510"
)

echo "Starting migration repair..."

for id in "${MIGRATIONS[@]}"
do
   echo "Reverting info for $id ..."
   npx supabase migration repair --status reverted "$id"
done

echo "Repair complete. You can now try 'npx supabase db push'."
