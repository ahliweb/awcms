[{"filePath":"/home/data/dev_react/awcms-dev/awcms/empty.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/scripts/check_secrets.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":30,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\nconst rootDir = path.resolve(__dirname, '..');\n\nconst SECRETS_META_PATH = path.join(rootDir, '.secrets_meta.json');\nconst ROTATION_INTERVAL_DAYS = 7;\n\nfunction checkSecrets() {\n  if (!fs.existsSync(SECRETS_META_PATH)) {\n    console.warn('\\x1b[33m%s\\x1b[0m', 'WARN: Secret rotation metadata not found. Consider running \"npm run secrets:rotate\" to initialize secure rotation.');\n    return;\n  }\n\n  try {\n    const meta = JSON.parse(fs.readFileSync(SECRETS_META_PATH, 'utf8'));\n    if (meta.lastRotation) {\n      const lastRotation = new Date(meta.lastRotation);\n      const now = new Date();\n      const diffDays = (now - lastRotation) / (1000 * 60 * 60 * 24);\n\n      if (diffDays > ROTATION_INTERVAL_DAYS) {\n        console.warn('\\x1b[31m%s\\x1b[0m', `CRITICAL: Database password is older than ${ROTATION_INTERVAL_DAYS} days (${diffDays.toFixed(1)} days).`);\n        console.warn('\\x1b[31m%s\\x1b[0m', 'Please run \"npm run secrets:rotate\" immediately to secure your environment.');\n      }\n    }\n  } catch (e) {\n    console.warn('Could not read secrets metadata.');\n  }\n}\n\ncheckSecrets();\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/scripts/fix_broken_migration.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/scripts/fix_email_sidebar.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'path' is defined but never used.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[90,100],"text":""},"desc":"Remove unused variable 'path'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@supabase/supabase-js';\nimport dotenv from 'dotenv';\nimport path from 'path';\n\n// Load .env from current directory\ndotenv.config();\n\nconst supabaseUrl = process.env.SUPABASE_URL || process.env.VITE_SUPABASE_URL;\nconst supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseKey) {\n    console.error('Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY');\n    console.error('URL:', supabaseUrl);\n    console.error('KEY:', supabaseKey ? 'Found' : 'Missing');\n    process.exit(1);\n}\n\nconst supabase = createClient(supabaseUrl, supabaseKey);\n\nasync function run() {\n    console.log('Inserting email sidebar menu items...');\n\n    // Check if table exists (simple select)\n    const { error: checkError } = await supabase.from('admin_menus').select('key').limit(1);\n    if (checkError) {\n        console.error('Error accessing admin_menus table:', checkError);\n        process.exit(1);\n    }\n\n    const items = [\n        {\n            key: 'email_settings',\n            label: 'Email Settings',\n            path: 'email-settings',\n            icon: 'Mail',\n            permission: 'tenant.setting.update',\n            group_label: 'CONFIGURATION',\n            group_order: 70,\n            order: 30,\n            is_visible: true\n        },\n        {\n            key: 'email_logs',\n            label: 'Email Logs',\n            path: 'email-logs',\n            icon: 'MailOpen',\n            permission: 'tenant.setting.read',\n            group_label: 'CONFIGURATION',\n            group_order: 70,\n            order: 40,\n            is_visible: true\n        }\n    ];\n\n    const { data, error } = await supabase\n        .from('admin_menus')\n        .upsert(items, { onConflict: 'key' })\n        .select();\n\n    if (error) {\n        console.error('Error inserting items:', error);\n        process.exit(1);\n    }\n\n    console.log('Successfully inserted/updated items:', data);\n}\n\nrun();\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/scripts/repair_migrations.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/scripts/rotate_db_password.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":58,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\nimport path from 'path';\nimport crypto from 'crypto';\nimport pg from 'pg';\nimport dotenv from 'dotenv';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\nconst rootDir = path.resolve(__dirname, '..');\n\n// Load environment variables\ndotenv.config({ path: path.join(rootDir, '.env') });\n\nconst SECRETS_META_PATH = path.join(rootDir, '.secrets_meta.json');\nconst ROTATION_INTERVAL_DAYS = 7;\n\n// Function to generate a strong password\nfunction generatePassword(length = 32) {\n    return crypto.randomBytes(length).toString('hex');\n}\n\n// Function to parse args\nfunction getArg(flag) {\n    const index = process.argv.indexOf(flag);\n    return (index > -1 && index + 1 < process.argv.length) ? process.argv[index + 1] : null;\n}\n\n// Function to update .env file\nfunction updateEnvFile(filePath, key, value) {\n    if (!fs.existsSync(filePath)) return;\n\n    let content = fs.readFileSync(filePath, 'utf8');\n    // Regex to match key=value, handling quotes and lack thereof\n    const regex = new RegExp(`^${key}=.*`, 'm');\n\n    // Basic replacement - usually simple key=value in .env\n    if (regex.test(content)) {\n        content = content.replace(regex, `${key}=${value}`);\n    } else {\n        content += `\\n${key}=${value}`;\n    }\n\n    fs.writeFileSync(filePath, content, 'utf8');\n    console.log(`Updated ${key} in ${path.basename(filePath)}`);\n}\n\nasync function rotatePassword() {\n    console.log('Starting Supabase database password rotation...');\n\n    const force = process.argv.includes('--force');\n    const manualPassword = getArg('--password');\n\n    let meta = {};\n    if (fs.existsSync(SECRETS_META_PATH)) {\n        try {\n            meta = JSON.parse(fs.readFileSync(SECRETS_META_PATH, 'utf8'));\n        } catch (e) {\n            console.warn('Could not parse .secrets_meta.json, starting fresh.');\n        }\n    }\n\n    // Check rotation interval unless forced or setting specific password\n    if (!force && !manualPassword && meta.lastRotation) {\n        const lastRotation = new Date(meta.lastRotation);\n        const now = new Date();\n        const diffDays = (now - lastRotation) / (1000 * 60 * 60 * 24);\n\n        if (diffDays < ROTATION_INTERVAL_DAYS) {\n            console.log(`Password is recent (${diffDays.toFixed(1)} days old). Use --force to rotate anyway.`);\n            return;\n        }\n    }\n\n    // Determine new password\n    const newPassword = manualPassword || generatePassword();\n\n    // Connect to DB using CURRENT credentials\n    // Try loading from .env.local first as it overrides .env\n    const localEnvPath = path.join(rootDir, '.env.local');\n    if (fs.existsSync(localEnvPath)) {\n        dotenv.config({ path: localEnvPath, override: true });\n    }\n\n    const currentDbUrl = process.env.DATABASE_URL;\n    if (!currentDbUrl) {\n        console.error('Error: DATABASE_URL not found in environment variables. Cannot connect to database.');\n        process.exit(1);\n    }\n\n    const client = new pg.Client({\n        connectionString: currentDbUrl,\n    });\n\n    try {\n        await client.connect();\n        console.log('Connected to database.');\n\n        // Update the postgres user password\n        await client.query(`ALTER USER postgres WITH PASSWORD '${newPassword}'`);\n        console.log('Successfully updated database password for user postgres.');\n\n    } catch (err) {\n        console.error('Failed to update database password:', err);\n        console.error('Ensure your current DATABASE_URL in .env/.env.local is correct and the database is running.');\n        process.exit(1);\n    } finally {\n        await client.end();\n    }\n\n    // Update local .env files\n    try {\n        // Robustly replace password in connection string\n        // URL format: postgres://user:password@host:port/db\n        const url = new URL(currentDbUrl);\n        url.password = newPassword;\n        const newDbUrl = url.toString();\n\n        updateEnvFile(path.join(rootDir, '.env'), 'DATABASE_URL', newDbUrl);\n        if (fs.existsSync(localEnvPath)) {\n            updateEnvFile(localEnvPath, 'DATABASE_URL', newDbUrl);\n        }\n\n    } catch (e) {\n        console.error(\"Failed to construct new DATABASE_URL.\", e);\n        console.error(`CRITICAL: Database password changed, but .env update failed. Please check your database dashboard for the new password or reset it manually.`);\n        process.exit(1);\n    }\n\n    // Update metadata\n    meta.lastRotation = new Date().toISOString();\n    fs.writeFileSync(SECRETS_META_PATH, JSON.stringify(meta, null, 2));\n    console.log(`Rotation complete. Metadata saved to ${path.basename(SECRETS_META_PATH)}`);\n    console.log('NOTE: You may need to restart your dev server for changes to take effect.');\n}\n\nrotatePassword();\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/scripts/verify_rls_and_puck.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'supabaseAdmin' is assigned a value but never used.","line":21,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"supabaseAdmin"},"fix":{"range":[722,826],"text":""},"desc":"Remove unused variable 'supabaseAdmin'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { createClient } from '@supabase/supabase-js';\nimport dotenv from 'dotenv';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\n// Load env vars\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\ndotenv.config({ path: path.resolve(__dirname, '../.env') });\n\nconst supabaseUrl = process.env.VITE_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.VITE_SUPABASE_ANON_KEY;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.VITE_SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n    console.error('Missing Supabase credentials');\n    process.exit(1);\n}\n\nconst supabase = createClient(supabaseUrl, supabaseAnonKey);\nconst supabaseAdmin = supabaseServiceRoleKey ? createClient(supabaseUrl, supabaseServiceRoleKey) : null;\n\nasync function verifyGuestOrder() {\n    console.log('--- Verifying Guest Order Creation (RLS Check) ---');\n\n    const orderData = {\n        user_id: null, // Guest\n        tenant_id: '00000000-0000-0000-0000-000000000000',\n        subtotal: 1000,\n        total_amount: 1000,\n        status: 'pending',\n        payment_status: 'unpaid',\n        shipping_address: 'Test Address',\n        order_number: `TEST-${Date.now()}`\n    };\n\n    const { data, error } = await supabase\n        .from('orders')\n        .insert(orderData)\n        .select()\n        .single();\n\n    if (error) {\n        console.log('Guest Order Insert Result: FAILED (Confirmed RLS restriction)');\n        console.log('Error:', error.message);\n    } else {\n        console.log('Guest Order Insert Result: SUCCESS');\n        await supabase.from('orders').delete().eq('id', data.id);\n    }\n}\n\nasync function verifyLatestBlogs() {\n    console.log('\\n--- Verifying LatestBlogsBlock Data Resolution (Anon/Public) ---');\n\n    // 1. Test generic syntax\n    console.log(`Testing query: .select('*, categories(title, slug)')`);\n    const { data, error } = await supabase\n        .from('blogs')\n        .select('*, categories(title, slug)')\n        .eq('status', 'published')\n        .order('published_at', { ascending: false })\n        .limit(3);\n\n    if (error) {\n        console.error('Anon Query FAILED:', error.message);\n    } else {\n        console.log('Anon Query SUCCEEDED');\n        console.log(`Fetched ${data.length} blogs.`);\n        if (data.length > 0) {\n            console.log('Sample Blog:', data[0].title);\n            console.log('Category:', data[0].categories?.title);\n        } else {\n            console.log('No blogs found (but query worked).');\n        }\n    }\n}\n\nasync function main() {\n    await verifyGuestOrder();\n    await verifyLatestBlogs();\n}\n\nmain();\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/App.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { AuthProvider } from '@/contexts/SupabaseAuthContext';\nimport { PermissionProvider } from '@/contexts/PermissionContext';\nimport { ThemeProvider } from '@/contexts/ThemeContext';\nimport { DarkModeProvider } from '@/contexts/DarkModeContext';\nimport { PluginProvider } from '@/contexts/PluginContext';\nimport { Toaster } from '@/components/ui/toaster';\nimport MainRouter from '@/components/MainRouter';\nimport { Helmet, HelmetProvider } from 'react-helmet-async';\nimport GlobalErrorBoundary from '@/components/ui/GlobalErrorBoundary';\n\nimport { TenantProvider } from '@/contexts/TenantContext';\n\nimport { useTenantTheme } from '@/hooks/useTenantTheme';\n\n\n\n// Wrapper to apply tenant theme\nconst ThemeWrapper = ({ children }) => {\n  useTenantTheme();\n  return children;\n};\n\nfunction App() {\n\n\n  return (\n    <HelmetProvider>\n      <GlobalErrorBoundary>\n        <DarkModeProvider>\n          <TenantProvider>\n            <AuthProvider>\n              <PermissionProvider>\n                <ThemeProvider>\n                  <PluginProvider>\n                    <Helmet>\n                      <title>CMS & Public Portal</title>\n                      <meta name=\"description\" content=\"Content Management System and Public Portal\" />\n                    </Helmet>\n                    <ThemeWrapper>\n                      <MainRouter />\n                      <Toaster />\n                    </ThemeWrapper>\n                  </PluginProvider>\n                </ThemeProvider>\n              </PermissionProvider>\n            </AuthProvider>\n          </TenantProvider>\n        </DarkModeProvider>\n      </GlobalErrorBoundary>\n    </HelmetProvider>\n  );\n}\n\nexport default App;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/CMSRouter.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport LoginPage from '@/pages/LoginPage';\nimport Dashboard from '@/pages/Dashboard';\n\nfunction CMSRouter() {\n  const { user, loading } = useAuth();\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-800\">\n        <div className=\"text-white text-xl\">Loading...</div>\n      </div>\n    );\n  }\n\n  return user ? <Dashboard /> : <LoginPage />;\n}\n\nexport default CMSRouter;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/CallToAction.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { motion } from 'framer-motion';\n\nconst CallToAction = () => {\n  return (\n    <motion.h1\n      className='text-xl font-bold text-white leading-8 w-full'\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ duration: 0.5, delay: 0.5 }}\n    >\n      Let&apos;s turn your ideas into reality\n    </motion.h1>\n  );\n};\n\nexport default CallToAction;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/HeroImage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\n\nconst HeroImage = () => {\n  return (\n    <div className=\"relative w-8 h-8 shrink-0\" data-name=\"ic-sparkles\">\n      <svg \n        width=\"32\" \n        height=\"32\" \n        viewBox=\"0 0 32 32\" \n        fill=\"none\" \n        xmlns=\"http://www.w3.org/2000/svg\"\n        className=\"w-full h-full\"\n      >\n        <path \n          d=\"M11.787 9.5356C11.5053 8.82147 10.4947 8.82147 10.213 9.5356L8.742 13.2654C8.65601 13.4834 8.48343 13.656 8.2654 13.742L4.5356 15.213C3.82147 15.4947 3.82147 16.5053 4.5356 16.787L8.2654 18.258C8.48343 18.344 8.65601 18.5166 8.742 18.7346L10.213 22.4644C10.4947 23.1785 11.5053 23.1785 11.787 22.4644L13.258 18.7346C13.344 18.5166 13.5166 18.344 13.7346 18.258L17.4644 16.787C18.1785 16.5053 18.1785 15.4947 17.4644 15.213L13.7346 13.742C13.5166 13.656 13.344 13.4834 13.258 13.2654L11.787 9.5356Z\" \n          fill=\"white\"\n        />\n        <path \n          d=\"M23.5621 2.38257C23.361 1.87248 22.639 1.87248 22.4379 2.38257L21.3871 5.04671C21.3257 5.20245 21.2024 5.32572 21.0467 5.38714L18.3826 6.43787C17.8725 6.63904 17.8725 7.36096 18.3826 7.56214L21.0467 8.61286C21.2024 8.67428 21.3257 8.79755 21.3871 8.95329L22.4379 11.6174C22.639 12.1275 23.361 12.1275 23.5621 11.6174L24.6129 8.95329C24.6743 8.79755 24.7976 8.67428 24.9533 8.61286L27.6174 7.56214C28.1275 7.36096 28.1275 6.63904 27.6174 6.43787L24.9533 5.38714C24.7976 5.32572 24.6743 5.20245 24.6129 5.04671L23.5621 2.38257Z\" \n          fill=\"white\"\n        />\n        <path \n          d=\"M23.3373 22.2295C23.2166 21.9235 22.7834 21.9235 22.6627 22.2295L22.0323 23.828C21.9954 23.9215 21.9215 23.9954 21.828 24.0323L20.2295 24.6627C19.9235 24.7834 19.9235 25.2166 20.2295 25.3373L21.828 25.9677C21.9215 26.0046 21.9954 26.0785 22.0323 26.172L22.6627 27.7705C22.7834 28.0765 23.2166 28.0765 23.3373 27.7705L23.9677 26.172C24.0046 26.0785 24.0785 26.0046 24.172 25.9677L25.7705 25.3373C26.0765 25.2166 26.0765 24.7834 25.7705 24.6627L24.172 24.0323C24.0785 23.9954 24.0046 23.9215 23.9677 23.828L23.3373 22.2295Z\" \n          fill=\"white\"\n        />\n      </svg>\n    </div>\n  );\n};\n\nexport default HeroImage;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/MainRouter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/WelcomeMessage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { motion } from 'framer-motion';\n\nconst WelcomeMessage = () => {\n  return (\n    <motion.p\n      className='text-sm text-white leading-5 w-full'\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ duration: 0.5, delay: 0.8 }}\n    >\n      Write in the chat what you want to create.\n    </motion.p>\n  );\n};\n\nexport default WelcomeMessage;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/auth/AuthShell.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/auth/TenantGuard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Button } from '@/components/ui/button';\n\nconst TenantGuard = ({ children }) => {\n    const { currentTenant, loading, error } = useTenant();\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    if (error || !currentTenant) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4\">\n                <div className=\"w-full max-w-md p-8 space-y-4 text-center bg-white rounded-lg shadow\">\n                    <h1 className=\"text-2xl font-bold text-red-600\">Access Denied</h1>\n                    <p className=\"text-gray-600\">\n                        {error || \"We couldn't identify the workspace you're trying to access.\"}\n                    </p>\n                    <div className=\"border-t pt-4 mt-4\">\n                        <p className=\"text-sm text-gray-500 mb-4\">\n                            If you believe this is an error, please contact support.\n                        </p>\n                        <Button variant=\"outline\" onClick={() => window.location.reload()}>\n                            Retry Connection\n                        </Button>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    // Double check status just in case context didn't catch it or for extra safety\n    if (currentTenant.status !== 'active') {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4\">\n                <div className=\"w-full max-w-md p-8 space-y-4 text-center bg-white rounded-lg shadow\">\n                    <h1 className=\"text-2xl font-bold text-amber-600\">Workspace Suspended</h1>\n                    <p className=\"text-gray-600\">\n                        This workspace ({currentTenant.name}) is currently suspended.\n                    </p>\n                    <Button className=\"mt-4\" onClick={() => window.location.href = 'mailto:support@awcms.com'}>\n                        Contact Support\n                    </Button>\n                </div>\n            </div>\n        );\n    }\n\n    return children;\n};\n\nexport default TenantGuard;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/common/MinCharSearchInput.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Search, Loader2, X } from 'lucide-react';\nimport { Input } from '@/components/ui/input';\nimport { cn } from '@/lib/utils';\n\n/**\n * Standardized Search Input with Minimum Character Enforcement\n * \n * @param {string} value - Current query value\n * @param {function} onChange - Handler for query changes (e.target.value)\n * @param {function} onClear - Handler for clearing search\n * @param {boolean} loading - Loading state\n * @param {boolean} isValid - Whether the query meets min length (or is empty)\n * @param {string} message - Validation message (optional)\n * @param {number} minLength - Minimum characters required (default: 5)\n * @param {string} placeholder - Placeholder text\n * @param {string} className - Additional classes\n */\nconst MinCharSearchInput = ({\n    value,\n    onChange,\n    onClear,\n    loading,\n    isValid = true,\n    message,\n    minLength = 5,\n    placeholder = \"Search...\",\n    className\n}) => {\n    return (\n        <div className={cn(\"relative w-full\", className)}>\n            <Search className=\"absolute left-3 top-3 h-4 w-4 text-slate-400\" />\n            <Input\n                placeholder={`${placeholder} (${minLength}+ chars)`}\n                value={value}\n                onChange={onChange}\n                className={cn(\n                    \"h-11 rounded-xl border-slate-200/70 bg-white/90 pl-9 pr-24 text-sm shadow-sm transition-colors focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\",\n                    !isValid && value.length > 0\n                        ? \"border-destructive/50 focus-visible:ring-destructive/30 bg-destructive/5\"\n                        : \"\"\n                )}\n            />\n\n            <div className=\"absolute right-3 top-3 flex items-center gap-2\">\n                {loading && <Loader2 className=\"h-4 w-4 animate-spin text-slate-400\" />}\n\n                {value && (\n                    <button\n                        onClick={onClear}\n                        className=\"text-muted-foreground hover:text-foreground transition-colors\"\n                        type=\"button\"\n                        aria-label=\"Clear search\"\n                    >\n                        <X className=\"h-4 w-4\" />\n                    </button>\n                )}\n\n                <span className={cn(\n                    \"text-xs font-mono transition-colors min-w-[3ch] text-right\",\n                    !isValid && value.length > 0 ? \"text-destructive font-bold\" : \"text-muted-foreground\"\n                )}>\n                    {value.length}/{minLength}\n                </span>\n            </div>\n\n            {message && !isValid && value.length > 0 && (\n                <div className=\"absolute top-full left-0 mt-1 text-xs text-destructive font-medium animate-in slide-in-from-top-1 px-1\">\n                    {message}\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default MinCharSearchInput;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/AdminDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { RefreshCw, LayoutGrid, Calendar } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useDashboardData } from '@/hooks/useDashboardData';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { StatCards } from './widgets/StatCards';\nimport { ActivityFeed } from './widgets/ActivityFeed';\nimport { ContentDistribution } from './widgets/ContentDistribution';\nimport { SystemHealth } from './widgets/SystemHealth';\nimport { PluginAction } from '@/contexts/PluginContext';\nimport { PlatformOverview } from './widgets/PlatformOverview';\nimport { MyApprovals } from './widgets/MyApprovals';\nimport { UsageWidget } from './widgets/UsageWidget';\nimport { TopBlogsWidget } from './widgets/TopBlogsWidget';\nimport PluginWidgets from './widgets/PluginWidgets';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\nimport { cn } from '@/lib/utils';\n\nfunction AdminDashboard() {\n    const perms = usePermissions() || {};\n    const { isTenantAdmin, isPlatformAdmin, userRole } = perms;\n    const { data, loading, error, lastUpdated, refresh } = useDashboardData();\n    const spacingClass = isTenantAdmin ? 'space-y-10' : 'space-y-8';\n    const layoutClass = cn('w-full', spacingClass);\n\n    const getGreeting = () => {\n        const hour = new Date().getHours();\n        if (hour < 5) return 'Good Night';\n        if (hour < 12) return 'Good Morning';\n        if (hour < 18) return 'Good Afternoon';\n        return 'Good Evening';\n    };\n\n    const headerActions = (\n        <Button\n            onClick={refresh}\n            variant=\"outline\"\n            className={loading ? 'opacity-70' : 'bg-white/70 dark:bg-slate-900/60 backdrop-blur-sm border-slate-200/70 dark:border-slate-700/60 hover:bg-white dark:hover:bg-slate-800 hover:border-indigo-300/80 dark:hover:border-indigo-500/60 transition-all shadow-sm'}\n        >\n            <RefreshCw className=\"mr-2 h-4 w-4\" />\n            Refresh Data\n        </Button>\n    );\n\n    if (error) {\n        return (\n            <AdminPageLayout>\n                <div className=\"p-8 text-center bg-red-50/50 backdrop-blur-md text-red-600 rounded-2xl border border-red-100 shadow-sm max-w-2xl mx-auto mt-20\">\n                    <p className=\"text-lg font-semibold mb-2\">Something went wrong</p>\n                    <p className=\"opacity-80 mb-6\">{error}</p>\n                    <Button onClick={refresh} variant=\"outline\" className=\"border-red-200 hover:bg-red-50 text-red-600\">\n                        Try Again\n                    </Button>\n                </div>\n            </AdminPageLayout>\n        );\n    }\n\n    return (\n        <AdminPageLayout className={layoutClass}>\n            <PageHeader\n                title={`${getGreeting()}, ${userRole?.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase()) || 'User'}`}\n                description={`Here's your performance overview for ${new Date().toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' })}.`}\n                icon={LayoutGrid}\n                actions={headerActions}\n            >\n                <div className=\"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 bg-white/40 dark:bg-slate-800/40 px-3 py-1.5 rounded-full border border-white/40 dark:border-slate-700/40 w-fit backdrop-blur-sm\">\n                    <Calendar className=\"w-3 h-3\" />\n                    <span>Last updated: {lastUpdated.toLocaleTimeString()}</span>\n                </div>\n            </PageHeader>\n\n            {/* Platform Overview for platform admins */}\n            {isPlatformAdmin && (\n                <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-700 delay-100\">\n                    <PlatformOverview />\n                </div>\n            )}\n\n            {/* Main Stats Grid */}\n            <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-700 delay-200\">\n                <StatCards\n                    data={data.overview}\n                    loading={loading}\n                    className={isTenantAdmin ? 'gap-8 xl:gap-10' : ''}\n                />\n            </div>\n\n            {/* Plugin Hook: Dashboard Top */}\n            <div className=\"w-full\">\n                <PluginAction name=\"dashboard_top\" args={[userRole]} />\n            </div>\n\n            <PluginWidgets\n                position=\"main\"\n                layout=\"grid\"\n                className={`animate-in fade-in slide-in-from-bottom-4 duration-700 delay-250 grid-cols-1 md:grid-cols-2 ${isTenantAdmin ? 'gap-10' : 'gap-8'}`}\n            />\n\n            {/* Content & Activity Grid */}\n            <div className={`grid grid-cols-1 xl:grid-cols-3 animate-in fade-in slide-in-from-bottom-4 duration-700 delay-300 ${isTenantAdmin ? 'gap-10' : 'gap-8'}`}>\n                {/* Left Column (2/3 width on XL) */}\n                <div className={`xl:col-span-2 min-w-0 ${isTenantAdmin ? 'space-y-10' : 'space-y-8'}`}>\n                    <div className={`grid grid-cols-1 md:grid-cols-2 ${isTenantAdmin ? 'gap-10' : 'gap-8'}`}>\n                        <ContentDistribution data={data.overview} />\n                        <SystemHealth health={data.systemHealth} />\n                    </div>\n\n                    {/* Quick Links / Top Content - Neo-Glass style */}\n                    <div className=\"min-w-0\">\n                        <TopBlogsWidget data={data.topContent} loading={loading} />\n                    </div>\n                </div>\n\n                {/* Right Column (1/3 width on XL) - Activity Feed */}\n                <div className={`min-w-0 ${isTenantAdmin ? 'space-y-10' : 'space-y-8'}`}>\n                    <PluginWidgets position=\"sidebar\" />\n                    <UsageWidget />\n                    <MyApprovals />\n                    <ActivityFeed activities={data.activity} />\n                </div>\n            </div>\n        </AdminPageLayout>\n    );\n}\n\nexport default AdminDashboard;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/AdminLayout.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { Outlet } from 'react-router-dom';\nimport Header from './Header';\nimport Sidebar from '@/templates/flowbite-admin/components/Sidebar';\nimport Footer from '@/templates/flowbite-admin/components/Footer';\n\nconst AdminLayout = () => {\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n\n  return (\n    <div className=\"antialiased bg-gray-50 dark:bg-gray-900 min-h-screen\">\n      <Header toggleSidebar={() => setSidebarOpen(!sidebarOpen)} />\n\n      <Sidebar isOpen={sidebarOpen} onClose={() => setSidebarOpen(false)} />\n\n      <main className=\"p-4 md:ml-64 h-auto pt-20 min-h-screen flex flex-col\">\n        <div className=\"flex-1\">\n          <Outlet />\n        </div>\n        <Footer />\n      </main>\n    </div>\n  );\n};\n\nexport default AdminLayout;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/AnnouncementsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Megaphone } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction AnnouncementsManager() {\n    const columns = [\n        { key: 'title', label: 'Title' },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'published' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'draft' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n                        value === 'expired' ? 'bg-muted text-muted-foreground' :\n                            'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'draft'}\n                </span>\n            )\n        },\n        {\n            key: 'priority',\n            label: 'Priority',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'urgent' ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' :\n                    value === 'high' ? 'bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400' :\n                        'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400'\n                    }`}>\n                    {value || 'normal'}\n                </span>\n            )\n        },\n        {\n            key: 'published_at',\n            label: 'Publish Date',\n            type: 'date',\n            render: (value) => value ? new Date(value).toLocaleDateString() : '-'\n        }\n    ];\n\n    const formFields = [\n        { key: 'title', label: 'Title', required: true },\n        { key: 'content', label: 'Content', type: 'richtext', required: true },\n        { key: 'category_id', label: 'Category', type: 'relation', table: 'categories', filter: { type: 'announcement' } },\n        {\n            key: 'status', label: 'Status', type: 'select', options: [\n                { value: 'draft', label: 'Draft' },\n                { value: 'published', label: 'Published' },\n                { value: 'expired', label: 'Expired' }\n            ]\n        },\n        {\n            key: 'priority', label: 'Priority', type: 'select', options: [\n                { value: 'normal', label: 'Normal' },\n                { value: 'high', label: 'High' },\n                { value: 'urgent', label: 'Urgent' }\n            ]\n        },\n        { key: 'published_at', label: 'Publish Date', type: 'datetime' },\n        { key: 'expires_at', label: 'Expires At', type: 'datetime' }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.announcements.read\">\n            <PageHeader\n                title=\"Announcements\"\n                description=\"Create and manage system-wide announcements.\"\n                icon={Megaphone}\n                breadcrumbs={[{ label: 'Announcements', icon: Megaphone }]}\n            />\n\n            <GenericContentManager\n                tableName=\"announcements\"\n                resourceName=\"Announcement\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"announcements\"\n                showBreadcrumbs={false}\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default AnnouncementsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/AuditLogsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchLogs'. Either include it or remove the dependency array.","line":70,"column":8,"nodeType":"ArrayExpression","endLine":70,"endColumn":84,"suggestions":[{"desc":"Update the dependencies array to be: [tenantId, page, limit, searchQuery, canView, isPlatformAdmin, isFullAccess, fetchLogs]","fix":{"range":[2615,2691],"text":"[tenantId, page, limit, searchQuery, canView, isPlatformAdmin, isFullAccess, fetchLogs]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { format } from 'date-fns';\nimport { Search, Eye, Smartphone, Globe, Server, RefreshCw } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Helmet } from 'react-helmet-async';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\nimport { ClipboardList } from 'lucide-react';\nimport { useTranslation } from 'react-i18next';\n\nfunction AuditLogsManager() {\n    const { t } = useTranslation();\n    const { tenantId, hasPermission, isPlatformAdmin, isFullAccess } = usePermissions();\n    const [logs, setLogs] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [searchQuery, setSearchQuery] = useState('');\n    const [selectedLog, setSelectedLog] = useState(null);\n\n    // Pagination\n    const [page, setPage] = useState(1);\n    const [limit, setLimit] = useState(50);\n    const [totalCount, setTotalCount] = useState(0);\n\n    const canView = hasPermission('tenant.audit.read')\n        || hasPermission('platform.reporting.read')\n        || isPlatformAdmin\n        || isFullAccess;\n\n    const fetchLogs = async () => {\n        if (!canView) return;\n\n        setLoading(true);\n        try {\n            const from = (page - 1) * limit;\n            const to = from + limit - 1;\n\n            let query = supabase\n                .from('audit_logs')\n                .select('*, user:users(email, full_name)', { count: 'exact' })\n                .order('created_at', { ascending: false })\n                .range(from, to);\n\n            if (searchQuery) {\n                query = query.or(`action.ilike.%${searchQuery}%,resource.ilike.%${searchQuery}%`);\n            }\n\n            const { data, count, error } = await query;\n\n            if (error) throw error;\n\n            setLogs(data || []);\n            setTotalCount(count || 0);\n        } catch (err) {\n            console.error('Error fetching audit logs:', err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    useEffect(() => {\n        if (canView && (tenantId || isPlatformAdmin || isFullAccess)) {\n            fetchLogs();\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [tenantId, page, limit, searchQuery, canView, isPlatformAdmin, isFullAccess]);\n\n    const getChannelIcon = (channel) => {\n        switch (channel) {\n            case 'mobile': return <Smartphone className=\"w-3 h-3\" />;\n            case 'api': return <Server className=\"w-3 h-3\" />;\n            default: return <Globe className=\"w-3 h-3\" />;\n        }\n    };\n\n    const getActionBadge = (action) => {\n        const colors = {\n            create: 'bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300',\n            update: 'bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300',\n            delete: 'bg-destructive/10 text-destructive border-destructive/20',\n            publish: 'bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-300',\n            login: 'bg-cyan-100 text-cyan-800 border-cyan-200 dark:bg-cyan-900/30 dark:text-cyan-300'\n        };\n\n        const type = action?.split('.')[1] || action;\n        const colorClass = colors[type] || 'bg-muted text-muted-foreground border-border';\n\n        return (\n            <Badge variant=\"outline\" className={`${colorClass} font-mono text-[10px] uppercase`}>\n                {action}\n            </Badge>\n        );\n    };\n\n    if (!canView) {\n        return (\n            <div className=\"p-8 text-center\">\n                <p className=\"text-muted-foreground\">{t('audit.permission_denied')}</p>\n            </div>\n        );\n    }\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.audit.read\">\n            <Helmet>\n                <title>{t('audit.page_title')}</title>\n            </Helmet>\n\n            <PageHeader\n                title={t('audit.header_title')}\n                description={t('audit.header_desc')}\n                icon={ClipboardList}\n                breadcrumbs={[{ label: t('audit.header_title'), icon: ClipboardList }]}\n                actions={\n                    <Button variant=\"outline\" onClick={fetchLogs} disabled={loading}>\n                        <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n                        {t('audit.refresh')}\n                    </Button>\n                }\n            />\n\n            <div className=\"bg-card rounded-lg border border-border shadow-sm p-4 flex items-center gap-4\">\n                <div className=\"relative flex-1 max-w-md\">\n                    <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                        placeholder={t('audit.search_placeholder')}\n                        className=\"pl-9 bg-background border-input\"\n                        value={searchQuery}\n                        onChange={(e) => setSearchQuery(e.target.value)}\n                    />\n                </div>\n            </div>\n\n            <Card className=\"border-border\">\n                <CardHeader>\n                    <CardTitle>{t('audit.activity_history')}</CardTitle>\n                    <CardDescription>\n                        {t('audit.activity_desc')}\n                    </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-sm\">\n                            <thead className=\"bg-muted/50 border-b border-border\">\n                                <tr>\n                                    <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">{t('audit.table.timestamp')}</th>\n                                    <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">{t('audit.table.user')}</th>\n                                    <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">{t('audit.table.ip_address')}</th>\n                                    <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">{t('audit.table.action')}</th>\n                                    <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">{t('audit.table.resource')}</th>\n                                    <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">{t('audit.table.changes')}</th>\n                                    <th className=\"px-4 py-3 text-center font-medium text-muted-foreground\">{t('audit.table.channel')}</th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-border\">\n                                {loading ? (\n                                    <tr>\n                                        <td colSpan=\"7\" className=\"p-8 text-center text-muted-foreground\">\n                                            {t('audit.table.loading')}\n                                        </td>\n                                    </tr>\n                                ) : logs.length === 0 ? (\n                                    <tr>\n                                        <td colSpan=\"7\" className=\"p-8 text-center text-muted-foreground\">\n                                            {t('audit.table.no_logs')}\n                                        </td>\n                                    </tr>\n                                ) : (\n                                    logs.map((log) => (\n                                        <tr key={log.id} className=\"hover:bg-muted/50 transition-colors\">\n                                            <td className=\"px-4 py-3 text-muted-foreground whitespace-nowrap\">\n                                                {format(new Date(log.created_at), 'MMM dd, yyyy HH:mm:ss')}\n                                            </td>\n                                            <td className=\"px-4 py-3\">\n                                                <div className=\"font-medium text-foreground\">\n                                                    {log.user?.full_name || t('audit.table.unknown_user')}\n                                                </div>\n                                                <div className=\"text-xs text-muted-foreground\">{log.user?.email}</div>\n                                            </td>\n                                            <td className=\"px-4 py-3\">\n                                                <span className=\"font-mono text-xs text-muted-foreground\">{log.ip_address || '-'}</span>\n                                            </td>\n                                            <td className=\"px-4 py-3\">{getActionBadge(log.action)}</td>\n                                            <td className=\"px-4 py-3 text-muted-foreground\">\n                                                <div className=\"font-medium text-foreground\">{log.resource}</div>\n                                                {log.resource_id && (\n                                                    <div className=\"text-xs text-muted-foreground\">#{log.resource_id}</div>\n                                                )}\n                                            </td>\n                                            <td className=\"px-4 py-3\">\n                                                {log.old_value || log.new_value ? (\n                                                    <Button\n                                                        variant=\"ghost\"\n                                                        size=\"sm\"\n                                                        onClick={() => setSelectedLog(log)}\n                                                        className=\"h-7 px-2 text-xs text-primary hover:text-primary/80\"\n                                                    >\n                                                        <Eye className=\"w-3 h-3 mr-1\" /> {t('audit.table.view_diff')}\n                                                    </Button>\n                                                ) : (\n                                                    <span className=\"text-muted-foreground text-xs italic\">{t('audit.table.no_modifications')}</span>\n                                                )}\n                                            </td>\n                                            <td className=\"px-4 py-3\">\n                                                <div\n                                                    className=\"flex items-center justify-center gap-1 text-muted-foreground text-xs uppercase font-semibold\"\n                                                    title={log.user_agent}\n                                                >\n                                                    {getChannelIcon(log.channel)}\n                                                    <span>{log.channel || 'web'}</span>\n                                                </div>\n                                            </td>\n                                        </tr>\n                                    ))\n                                )}\n                            </tbody>\n                        </table>\n                    </div>\n\n                    {/* Pagination */}\n                    {totalCount > 0 && (\n                        <div className=\"flex flex-col sm:flex-row justify-between items-center gap-4 mt-4 pt-4 border-t border-border\">\n                            <div className=\"text-sm text-muted-foreground\">\n                                {t('audit.pagination.showing', {\n                                    from: (page - 1) * limit + 1,\n                                    to: Math.min(page * limit, totalCount),\n                                    total: totalCount\n                                })}\n                            </div>\n                            <div className=\"flex items-center gap-4\">\n                                <select\n                                    value={limit}\n                                    onChange={(e) => {\n                                        setLimit(Number(e.target.value));\n                                        setPage(1);\n                                    }}\n                                    className=\"border border-input rounded px-3 py-1.5 text-sm bg-white text-slate-900 dark:bg-slate-800 dark:text-slate-100 dark:border-slate-600\"\n                                >\n                                    <option value={25}>25 {t('audit.pagination.per_page')}</option>\n                                    <option value={50}>50 {t('audit.pagination.per_page')}</option>\n                                    <option value={100}>100 {t('audit.pagination.per_page')}</option>\n                                </select>\n                                <div className=\"flex gap-1\">\n                                    <Button\n                                        variant=\"outline\"\n                                        size=\"sm\"\n                                        onClick={() => setPage(p => Math.max(1, p - 1))}\n                                        disabled={page === 1}\n                                    >\n                                        {t('audit.pagination.previous')}\n                                    </Button>\n                                    <Button\n                                        variant=\"outline\"\n                                        size=\"sm\"\n                                        onClick={() => setPage(p => p + 1)}\n                                        disabled={page * limit >= totalCount}\n                                    >\n                                        {t('audit.pagination.next')}\n                                    </Button>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n\n            {/* Diff Viewer Dialog */}\n            <Dialog open={!!selectedLog} onOpenChange={() => setSelectedLog(null)}>\n                <DialogContent className=\"max-w-3xl max-h-[80vh] overflow-hidden flex flex-col\">\n                    <DialogHeader>\n                        <DialogTitle>{t('audit.diff.title')}</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"overflow-y-auto space-y-4 p-1\">\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <h4 className=\"text-xs font-bold text-destructive uppercase tracking-wider\">\n                                    {t('audit.diff.old_value')}\n                                </h4>\n                                <pre className=\"bg-destructive/10 border border-destructive/20 p-3 rounded text-xs overflow-x-auto text-destructive min-h-[150px]\">\n                                    {selectedLog?.old_value\n                                        ? JSON.stringify(JSON.parse(selectedLog.old_value), null, 2)\n                                        : 'null'}\n                                </pre>\n                            </div>\n                            <div className=\"space-y-2\">\n                                <h4 className=\"text-xs font-bold text-green-600 dark:text-green-400 uppercase tracking-wider\">\n                                    {t('audit.diff.new_value')}\n                                </h4>\n                                <pre className=\"bg-green-100 dark:bg-green-900/30 border border-green-200 dark:border-green-800 p-3 rounded text-xs overflow-x-auto text-green-800 dark:text-green-300 min-h-[150px]\">\n                                    {selectedLog?.new_value\n                                        ? JSON.stringify(JSON.parse(selectedLog.new_value), null, 2)\n                                        : 'null'}\n                                </pre>\n                            </div>\n                        </div>\n                        <div className=\"pt-4 border-t border-border space-y-2 text-sm\">\n                            <div className=\"flex justify-between\">\n                                <span className=\"text-muted-foreground\">{t('audit.diff.action')}:</span>\n                                <span className=\"font-medium text-foreground\">{selectedLog?.action}</span>\n                            </div>\n                            <div className=\"flex justify-between\">\n                                <span className=\"text-muted-foreground\">{t('audit.diff.resource')}:</span>\n                                <span className=\"font-medium text-foreground\">{selectedLog?.resource}</span>\n                            </div>\n                            <div className=\"flex justify-between\">\n                                <span className=\"text-muted-foreground\">{t('audit.diff.ip_address')}:</span>\n                                <span className=\"font-mono text-xs text-foreground\">{selectedLog?.ip_address || 'N/A'}</span>\n                            </div>\n                        </div>\n                    </div>\n                </DialogContent>\n            </Dialog>\n        </AdminPageLayout>\n    );\n}\n\nexport default AuditLogsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/BlogEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCategories'. Either include it or remove the dependency array.","line":113,"column":8,"nodeType":"ArrayExpression","endLine":113,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCategories]","fix":{"range":[4388,4390],"text":"[fetchCategories]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { createPortal } from 'react-dom';\nimport { motion } from 'framer-motion';\nimport {\n    Save, X, Globe, Layout, Share2, FolderOpen,\n    ChevronLeft, Eye, Send, Image as ImageIcon, MoreVertical\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { ImageUpload } from '@/components/ui/ImageUpload';\nimport RichTextEditor from '@/components/ui/RichTextEditor';\nimport VisualPageBuilder from '@/components/visual-builder/VisualPageBuilder';\nimport TagInput from '@/components/ui/TagInput';\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n    Tooltip,\n    TooltipContent,\n    TooltipProvider,\n    TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n    Select, SelectContent, SelectItem, SelectTrigger, SelectValue\n} from \"@/components/ui/select\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nfunction BlogEditor({ item, onClose, onSuccess }) {\n    const { toast } = useToast();\n    const { user } = useAuth();\n    const { currentTenant } = useTenant();\n    const { hasPermission } = usePermissions();\n    const [loading, setLoading] = useState(false);\n    const [categories, setCategories] = useState([]);\n    const [currentState, setCurrentState] = useState(item?.workflow_state || 'draft');\n\n    // Detect Visual Builder Mode\n    // Check strict editor_type first, then fallback to content shape inspection\n    const isVisualContent = item?.editor_type === 'visual' ||\n        (item?.content && typeof item.content === 'object' && !Array.isArray(item.content) && item.content.root);\n\n    const [useVisualBuilder, setUseVisualBuilder] = useState(isVisualContent);\n\n    // Mobile Settings Toggle\n    const [showMobileSettings, setShowMobileSettings] = useState(false);\n    const [visualSwitchOpen, setVisualSwitchOpen] = useState(false);\n\n    // Initial Form Data State\n    const [formData, setFormData] = useState({\n        title: item?.title || '',\n        slug: item?.slug || '',\n        content: item?.content || '',\n        excerpt: item?.excerpt || '',\n        featured_image: item?.featured_image || '',\n        status: item?.status || 'draft',\n        workflow_state: item?.workflow_state || 'draft',\n        is_active: item?.is_active ?? true,\n        is_public: item?.is_public ?? false,\n        editor_type: item?.editor_type || (isVisualContent ? 'visual' : 'richtext'),\n        category_id: item?.category_id || '',\n        tags: item?.tags || [],\n\n        // SEO\n        meta_title: item?.meta_title || '',\n        meta_description: item?.meta_description || '',\n        meta_keywords: item?.meta_keywords || '',\n        canonical_url: item?.canonical_url || '',\n        robots: item?.robots || 'index, follow',\n\n        // Social\n        og_title: item?.og_title || '',\n        og_description: item?.og_description || '',\n        og_image: item?.og_image || '',\n        twitter_card_type: item?.twitter_card_type || 'summary',\n        twitter_image: item?.twitter_image || '',\n\n        published_at: item?.published_at ? new Date(item.published_at).toISOString().slice(0, 16) : ''\n    });\n\n    const isEditMode = !!item;\n    const WORKFLOW_STATES = {\n        DRAFT: 'draft',\n        REVIEWED: 'reviewed',\n        APPROVED: 'approved',\n        PUBLISHED: 'published',\n        ARCHIVED: 'archived'\n    };\n\n    // Permissions\n    const canEdit = hasPermission('tenant.blog.update') || (user?.id === item?.author_id);\n    const canPublish = hasPermission('tenant.blog.publish');\n\n    useEffect(() => {\n        fetchCategories();\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    const fetchCategories = async () => {\n        try {\n            let q = supabase\n                .from('categories')\n                .select('id, name')\n                .eq('type', 'blog');\n\n            if (currentTenant?.id) {\n                q = q.eq('tenant_id', currentTenant.id);\n            }\n\n            const { data, error } = await q;\n            if (error) throw error;\n            setCategories(data || []);\n        } catch (error) {\n            console.error('Error fetching categories:', error);\n        }\n    };\n\n    const handleWorkflowAction = async (newState) => {\n        await saveItem(newState);\n    };\n\n    const generateSlug = (text) => {\n        return text\n            .toLowerCase()\n            .replace(/[^a-z0-9]+/g, '-')\n            .replace(/(^-|-$)/g, '');\n    };\n\n    const saveItem = async (workflowStateOverride = null) => {\n        if (!canEdit) {\n            toast({ variant: 'destructive', title: 'Permission Denied', description: 'You cannot save this blog.' });\n            return;\n        }\n\n        if (!currentTenant?.id) {\n            toast({ variant: 'destructive', title: 'System Error', description: 'No active tenant context found.' });\n            return;\n        }\n\n        const finalWorkflowState = workflowStateOverride || currentState;\n        let finalStatus = formData.status;\n\n        // Workflow side-effects\n        if (workflowStateOverride === WORKFLOW_STATES.PUBLISHED) {\n            finalStatus = 'published';\n        } else if (workflowStateOverride === WORKFLOW_STATES.DRAFT) {\n            finalStatus = 'draft';\n        }\n\n        if (finalStatus === 'published' && !canPublish) {\n            toast({ variant: 'destructive', title: 'Publishing Restricted', description: 'You do not have permission to publish. Saved as draft.' });\n            finalStatus = 'draft';\n        }\n\n        setLoading(true);\n\n        try {\n            const dataToSave = {\n                tenant_id: currentTenant.id,\n                title: formData.title,\n                slug: formData.slug || generateSlug(formData.title),\n                content: formData.content,\n                excerpt: formData.excerpt,\n                featured_image: formData.featured_image,\n                status: finalStatus,\n                workflow_state: finalWorkflowState,\n                is_active: formData.is_active,\n                is_public: formData.is_public,\n                category_id: formData.category_id || null,\n                // SEO\n                meta_title: formData.meta_title,\n                meta_description: formData.meta_description,\n                meta_keywords: formData.meta_keywords,\n                canonical_url: formData.canonical_url,\n                robots: formData.robots,\n                // Social\n                og_title: formData.og_title,\n                og_description: formData.og_description,\n                og_image: formData.og_image,\n                twitter_card_type: formData.twitter_card_type,\n                twitter_image: formData.twitter_image,\n                published_at: formData.published_at || null,\n                updated_at: new Date().toISOString()\n            };\n\n            if (!isEditMode) {\n                dataToSave.created_by = user.id;\n                dataToSave.author_id = user.id;\n            }\n\n            let savedItemId = item?.id;\n\n            if (item) {\n                delete dataToSave.tenant_id; // Don't update tenant_id\n                const { error } = await supabase\n                    .from('blogs')\n                    .update(dataToSave)\n                    .eq('id', item.id);\n\n                if (error) throw error;\n                toast({ title: \"Success\", description: `Blog saved as ${finalWorkflowState}` });\n            } else {\n                const { data, error } = await supabase\n                    .from('blogs')\n                    .insert([dataToSave])\n                    .select('id')\n                    .single();\n\n                if (error) throw error;\n                savedItemId = data.id;\n                toast({ title: \"Success\", description: \"Blog created successfully\" });\n            }\n\n            // Sync Tags\n            if (savedItemId) {\n                await supabase.rpc('sync_resource_tags', {\n                    p_resource_id: savedItemId,\n                    p_resource_type: 'blogs',\n                    p_tags: formData.tags,\n                    p_tenant_id: currentTenant.id\n                });\n            }\n\n            if (workflowStateOverride) {\n                setCurrentState(workflowStateOverride);\n            }\n            if (finalStatus !== formData.status) {\n                setFormData(prev => ({ ...prev, status: finalStatus }));\n            }\n\n            if (!isEditMode && onSuccess) {\n                onSuccess();\n                onClose();\n            } else if (onSuccess) {\n                // onSuccess(); // Refresh parent if needed\n            }\n\n        } catch (error) {\n            console.error(error);\n            toast({\n                variant: \"destructive\",\n                title: \"Error\",\n                description: error.message || \"Failed to save blog\"\n            });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    // State Colors Helper\n    const getStateColor = (state) => {\n        switch (state) {\n            case 'published': return 'bg-emerald-500/10 text-emerald-600 border-emerald-500/20';\n            case 'approved': return 'bg-blue-500/10 text-blue-600 border-blue-500/20';\n            case 'reviewed': return 'bg-amber-500/10 text-amber-600 border-amber-500/20';\n            default: return 'bg-slate-500/10 text-slate-600 border-slate-500/20';\n        }\n    };\n\n    if (useVisualBuilder) {\n        return createPortal(\n            <VisualPageBuilder\n                page={item}\n                onClose={onClose}\n                onSuccess={onSuccess}\n                mode=\"blog\" // Custom prop we added support for\n                pageId={item?.id} // Helper for mode='blog' logic\n            />,\n            document.body\n        );\n    }\n\n    // ... (rest of component logic)\n\n    // Helper to render in portal\n    const renderEditor = () => (\n        <motion.div\n            initial={{ opacity: 0, scale: 0.98 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.98 }}\n            transition={{ duration: 0.2 }}\n            className=\"fixed inset-0 z-[100] flex flex-col bg-slate-50/50 backdrop-blur-sm\"\n        >\n            {/* 1. Blur Overlay Background - Optional visual depth */}\n            <div className=\"absolute inset-0 bg-gradient-to-br from-indigo-50/50 via-white/50 to-blue-50/50 -z-10\" />\n\n            {/* 2. Top Navigation / Header */}\n            <div className=\"h-16 px-6 border-b border-white/60 bg-white/80 backdrop-blur-xl flex items-center justify-between shadow-sm z-50\">\n                <div className=\"flex items-center gap-4\">\n                    <Button variant=\"ghost\" onClick={onClose} className=\"hover:bg-slate-100/50 gap-2 pr-4 text-slate-600 rounded-full\">\n                        <ChevronLeft className=\"w-5 h-5\" />\n                        <span className=\"font-medium hidden sm:inline-block\">Back</span>\n                    </Button>\n                    <Separator orientation=\"vertical\" className=\"h-6\" />\n                    <div>\n                        <div className=\"flex items-center gap-2\">\n                            <Input\n                                value={formData.title}\n                                onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value, slug: !item ? generateSlug(e.target.value) : prev.slug }))}\n                                className=\"border-none shadow-none bg-transparent text-lg font-bold px-0 h-auto focus-visible:ring-0 placeholder:text-slate-400 min-w-[300px]\"\n                                placeholder=\"Untitled Blog\"\n                            />\n                        </div>\n                        <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                            <Badge variant=\"outline\" className={`${getStateColor(currentState)} border px-1.5 py-0 rounded-sm font-normal uppercase tracking-wider text-[10px]`}>\n                                {currentState}\n                            </Badge>\n                            <span></span>\n                            <span>{formData.slug ? formData.slug : 'slug-placeholder'}</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                    <TooltipProvider>\n                        <Tooltip>\n                            <TooltipTrigger asChild>\n                                <Button variant=\"ghost\" size=\"icon\" className=\"text-slate-500\">\n                                    <Eye className=\"w-4 h-4\" />\n                                </Button>\n                            </TooltipTrigger>\n                            <TooltipContent>Preview</TooltipContent>\n                        </Tooltip>\n                    </TooltipProvider>\n\n                    <TooltipProvider>\n                        <Tooltip>\n                            <TooltipTrigger asChild>\n                                <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => setVisualSwitchOpen(true)}\n                                    className=\"text-slate-500 hover:text-indigo-600 hidden sm:flex gap-2\"\n                                >\n                                    <Layout className=\"w-4 h-4\" />\n                                    <span className=\"hidden lg:inline\">Visual Builder</span>\n                                </Button>\n                            </TooltipTrigger>\n                            <TooltipContent>Switch to Visual Editor</TooltipContent>\n                        </Tooltip>\n                    </TooltipProvider>\n\n                    <Separator orientation=\"vertical\" className=\"h-6\" />\n\n                    <Button variant=\"ghost\" onClick={onClose} className=\"hidden sm:flex text-slate-500 hover:text-slate-700 hover:bg-slate-100 ring-0 focus:ring-0\">\n                        Cancel\n                    </Button>\n\n                    {/* Mobile Settings Toggle */}\n                    <Button variant=\"ghost\" size=\"icon\" className=\"lg:hidden text-slate-500\" onClick={() => setShowMobileSettings(true)}>\n                        <MoreVertical className=\"w-5 h-5\" />\n                    </Button>\n\n                    {/* Workflow Actions */}\n                    {currentState === WORKFLOW_STATES.DRAFT && (\n                        <Button onClick={() => handleWorkflowAction(WORKFLOW_STATES.REVIEWED)} variant=\"secondary\" className=\"hidden sm:flex\" size=\"sm\">\n                            Request Review\n                        </Button>\n                    )}\n                    {currentState === WORKFLOW_STATES.REVIEWED && (\n                        <Button onClick={() => handleWorkflowAction(WORKFLOW_STATES.APPROVED)} className=\"bg-blue-600 hover:bg-blue-700 text-white hidden sm:flex\" size=\"sm\">\n                            Approve\n                        </Button>\n                    )}\n\n                    <Button\n                        onClick={() => saveItem(currentState === WORKFLOW_STATES.PUBLISHED ? null : WORKFLOW_STATES.PUBLISHED)}\n                        className={`${currentState === WORKFLOW_STATES.PUBLISHED ? 'bg-slate-900' : 'bg-emerald-600 hover:bg-emerald-700'} text-white shadow-lg shadow-emerald-500/20`}\n                        disabled={loading}\n                    >\n                        {loading ? <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2\" /> : (currentState === WORKFLOW_STATES.PUBLISHED ? <Save className=\"w-4 h-4 mr-2\" /> : <Send className=\"w-4 h-4 mr-2\" />)}\n                        {currentState === WORKFLOW_STATES.PUBLISHED ? 'Save Changes' : 'Publish'}\n                    </Button>\n                </div>\n            </div>\n\n            {/* 3. Main Workspace - 2 Columns */}\n            <div className=\"flex-1 overflow-hidden\">\n                <div className=\"h-full flex flex-col lg:flex-row max-w-[1600px] mx-auto\">\n\n                    {/* Left: Main Content (Scrollable) */}\n                    <ScrollArea className=\"flex-1 h-full\">\n                        <div className=\"p-8 lg:p-12 max-w-4xl mx-auto space-y-8 pb-32\">\n\n                            {/* Featured Image - Banner Style */}\n                            <div className=\"group relative rounded-2xl overflow-hidden bg-slate-100 border border-slate-200 aspect-video max-h-[300px] hover:shadow-md transition-all\">\n                                {formData.featured_image ? (\n                                    <img src={formData.featured_image} alt=\"Cover\" className=\"w-full h-full object-cover\" />\n                                ) : (\n                                    <div className=\"flex flex-col items-center justify-center h-full text-slate-400\">\n                                        <ImageIcon className=\"w-10 h-10 mb-2 opacity-50\" />\n                                        <span className=\"text-sm font-medium\">Add Cover Image</span>\n                                    </div>\n                                )}\n                                <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100\">\n                                    <ImageUpload\n                                        value={formData.featured_image}\n                                        onChange={(url) => setFormData(prev => ({ ...prev, featured_image: url }))}\n                                        className=\"h-full w-full opacity-0 absolute inset-0 cursor-pointer\" // Invisible overlay trigger\n                                    />\n                                    <Button variant=\"secondary\" className=\"pointer-events-none\">Change Cover</Button>\n                                </div>\n                            </div>\n\n                            {/* Excerpt */}\n                            <div className=\"space-y-2\">\n                                <Label className=\"text-slate-500 uppercase tracking-widest text-[11px] font-semibold pl-1\">Introduction / Excerpt</Label>\n                                <Textarea\n                                    value={formData.excerpt}\n                                    onChange={(e) => setFormData(p => ({ ...p, excerpt: e.target.value }))}\n                                    className=\"bg-transparent border-none focus-visible:ring-0 px-0 text-lg text-slate-600 resize-none min-h-[80px] placeholder:text-slate-300\"\n                                    placeholder=\"Add a short introduction...\"\n                                />\n                            </div>\n\n                            <Separator className=\"bg-slate-100\" />\n\n                            {/* Rich Editor */}\n                            <div className=\"min-h-[500px]\">\n                                <RichTextEditor\n                                    value={formData.content}\n                                    onChange={(val) => setFormData(p => ({ ...p, content: val }))}\n                                    placeholder=\"Tell your story...\"\n                                    className=\"prose-lg max-w-none\"\n                                />\n                            </div>\n                        </div>\n                    </ScrollArea>\n\n                    {/* Right: Sidebar (Settings) - Glassy */}\n                    <div className={`w-full lg:w-[380px] border-l border-white/60 bg-white/60 backdrop-blur-md h-full overflow-y-auto ${showMobileSettings ? 'fixed inset-0 z-[110] bg-white' : 'hidden lg:block'}`}>\n                        {/* Mobile Sidebar Header */}\n                        {showMobileSettings && (\n                            <div className=\"flex items-center justify-between p-4 border-b lg:hidden\">\n                                <span className=\"font-semibold\">Blog Settings</span>\n                                <Button variant=\"ghost\" size=\"icon\" onClick={() => setShowMobileSettings(false)}>\n                                    <X className=\"w-5 h-5\" />\n                                </Button>\n                            </div>\n                        )}\n                        <div className=\"p-6 space-y-8\">\n\n\n\n                            {/* Organization */}\n                            <div className=\"space-y-4\">\n                                <h4 className=\"flex items-center gap-2 font-semibold text-slate-800 text-sm\">\n                                    <FolderOpen className=\"w-4 h-4 text-indigo-500\" /> Organization\n                                </h4>\n                                <div className=\"space-y-4 bg-white/50 p-4 rounded-xl border border-white/60 shadow-sm\">\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-slate-500 uppercase tracking-widest text-[11px] font-semibold pl-1\">Category</Label>\n                                        <Select\n                                            value={formData.category_id}\n                                            onValueChange={(val) => setFormData({ ...formData, category_id: val })}\n                                        >\n                                            <SelectTrigger className=\"w-full bg-white/80 border-slate-200\">\n                                                <SelectValue placeholder=\"Select Category...\" />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                {categories.map(cat => <SelectItem key={cat.id} value={cat.id}>{cat.name}</SelectItem>)}\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-slate-500 uppercase tracking-widest text-[11px] font-semibold pl-1\">Tags</Label>\n                                        <TagInput\n                                            value={formData.tags}\n                                            onChange={(tags) => setFormData(p => ({ ...p, tags: tags }))}\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Visibility & SEO */}\n                            <div className=\"space-y-4\">\n                                <h4 className=\"flex items-center gap-2 font-semibold text-slate-800 text-sm\">\n                                    <Globe className=\"w-4 h-4 text-emerald-500\" /> Visibility\n                                </h4>\n                                <div className=\"space-y-4 bg-white/50 p-4 rounded-xl border border-white/60 shadow-sm\">\n                                    <div className=\"flex items-center justify-between\">\n                                        <div className=\"space-y-0.5\">\n                                            <Label className=\"text-sm\">Publicly Visible</Label>\n                                            <p className=\"text-[10px] text-slate-500\">Visible to all visitors</p>\n                                        </div>\n                                        <Switch\n                                            checked={formData.is_public}\n                                            onCheckedChange={(c) => setFormData(p => ({ ...p, is_public: c }))}\n                                        />\n                                    </div>\n                                    <Separator className=\"bg-slate-100\" />\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs text-slate-500\">Meta Title</Label>\n                                        <Input\n                                            value={formData.meta_title}\n                                            onChange={(e) => setFormData(p => ({ ...p, meta_title: e.target.value }))}\n                                            className=\"h-8 text-xs\"\n                                            placeholder=\"SEO Title\"\n                                        />\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs text-slate-500\">Meta Description</Label>\n                                        <Textarea\n                                            value={formData.meta_description}\n                                            onChange={(e) => setFormData(p => ({ ...p, meta_description: e.target.value }))}\n                                            className=\"min-h-[60px] text-xs resize-none\"\n                                            placeholder=\"SEO Description\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Social */}\n                            <div className=\"space-y-4\">\n                                <h4 className=\"flex items-center gap-2 font-semibold text-slate-800 text-sm\">\n                                    <Share2 className=\"w-4 h-4 text-sky-500\" /> Social\n                                </h4>\n                                <div className=\"bg-white/50 p-4 rounded-xl border border-white/60 shadow-sm space-y-4\">\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs text-slate-500\">OG Title</Label>\n                                        <Input\n                                            value={formData.og_title}\n                                            onChange={(e) => setFormData(p => ({ ...p, og_title: e.target.value }))}\n                                            className=\"h-8 text-xs\"\n                                            placeholder=\"Social Title\"\n                                        />\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs text-slate-500\">OG Description</Label>\n                                        <Textarea\n                                            value={formData.og_description}\n                                            onChange={(e) => setFormData(p => ({ ...p, og_description: e.target.value }))}\n                                            className=\"min-h-[60px] text-xs resize-none\"\n                                            placeholder=\"Social Description\"\n                                        />\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs text-slate-500\">OG Image</Label>\n                                        <ImageUpload\n                                            value={formData.og_image}\n                                            onChange={(url) => setFormData(p => ({ ...p, og_image: url }))}\n                                            className=\"h-24 w-full\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div className=\"text-xs text-slate-400 pt-8 text-center\">\n                                Last saved: {new Date().toLocaleTimeString()}\n                            </div>\n\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <AlertDialog open={visualSwitchOpen} onOpenChange={setVisualSwitchOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Switch to Visual Builder?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Switching to the Visual Builder might affect existing content formatting.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction\n                            onClick={() => {\n                                setUseVisualBuilder(true);\n                                setVisualSwitchOpen(false);\n                            }}\n                            className=\"bg-indigo-600 hover:bg-indigo-700\"\n                        >\n                            Switch\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </motion.div>\n    );\n\n    return createPortal(renderEditor(), document.body);\n}\n\nexport default BlogEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/BlogsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport BlogEditor from '@/components/dashboard/BlogEditor';\nimport { AdminPageLayout, PageHeader, PageTabs, TabsContent } from '@/templates/flowbite-admin';\nimport { FileText, FolderOpen, Tag, Layout, Sparkles } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\n/**\n * BlogsManager - Manages blogs, categories, and tags.\n * Refactored to use awadmintemplate01 components for consistent UI.\n */\nfunction BlogsManager() {\n  const { t } = useTranslation();\n  const [activeTab, setActiveTab] = useState('blogs');\n\n  // Tab definitions\n  // Tab definitions\n  // Tab definitions\n  const tabs = [\n    { value: 'blogs', label: t('menu.blogs'), icon: FileText, color: 'blue' },\n    { value: 'categories', label: t('menu.categories'), icon: FolderOpen, color: 'purple' },\n    { value: 'tags', label: t('menu.tags'), icon: Tag, color: 'emerald' },\n  ];\n\n  // Dynamic breadcrumb based on active tab\n  const breadcrumbs = [\n    { label: t('menu.blogs'), href: activeTab !== 'blogs' ? '/cmspanel/blogs' : undefined, icon: FileText },\n    ...(activeTab !== 'blogs' ? [{ label: activeTab === 'categories' ? t('menu.categories') : t('menu.tags') }] : []),\n  ];\n\n  // Blog columns and fields\n  const blogColumns = [\n    { key: 'title', label: t('common.title'), className: 'font-medium' },\n    {\n      key: 'workflow_state',\n      label: t('blogs.workflow'),\n      render: (value) => {\n        const colors = {\n          published: 'bg-green-100 text-green-700 border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800',\n          approved: 'bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800',\n          reviewed: 'bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-400 dark:border-yellow-800',\n          draft: 'bg-slate-100 text-slate-700 border-slate-200 dark:bg-muted dark:text-muted-foreground dark:border-border'\n        };\n        return (\n          <span className={`px-2 py-0.5 rounded-full text-xs font-medium border ${colors[value] || colors.draft} capitalize`}>\n            {value}\n          </span>\n        );\n      }\n    },\n    { key: 'status', label: t('blogs.visibility'), className: 'capitalize' },\n    { key: 'published_at', label: t('common.published'), type: 'date' },\n    { key: 'views', label: t('blogs.views'), type: 'number' },\n    {\n      key: 'editor_type',\n      label: t('blogs.type'),\n      render: (value) => (\n        value === 'visual' ?\n          <span title={t('blogs.visual_builder')} className=\"inline-flex items-center justify-center w-6 h-6 rounded bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400\"><Layout className=\"w-3.5 h-3.5\" /></span> :\n          <span title={t('blogs.standard_editor')} className=\"inline-flex items-center justify-center w-6 h-6 rounded bg-slate-50 text-slate-500 dark:bg-muted dark:text-muted-foreground\"><FileText className=\"w-3.5 h-3.5\" /></span>\n      )\n    }\n  ];\n\n  // Custom Actions\n  const customRowActions = (item, { openEditor }) => (\n    <Button\n      size=\"icon\"\n      variant=\"ghost\"\n      className=\"text-indigo-600 hover:bg-indigo-50 h-8 w-8\"\n      title=\"Edit in Visual Builder\"\n      onClick={(e) => {\n        e.stopPropagation();\n        openEditor({ ...item, editor_type: 'visual' });\n      }}\n    >\n      <Layout className=\"w-4 h-4\" />\n    </Button>\n  );\n\n  const customToolbarActions = ({ openEditor }) => (\n    <Button\n      onClick={() => openEditor({ editor_type: 'visual', title: '', status: 'draft' })}\n      className=\"bg-indigo-600 hover:bg-indigo-700 text-white\"\n    >\n      <Sparkles className=\"w-4 h-4 mr-2\" />\n      Create Visual\n    </Button>\n  );\n\n  const blogFormFields = [\n    { key: 'title', label: t('blogs.form.title'), required: true },\n    { key: 'slug', label: t('common.slug') },\n    {\n      key: 'status', label: t('common.status'), type: 'select', options: [\n        { value: 'draft', label: t('common.draft') },\n        { value: 'published', label: t('common.published') },\n        { value: 'archived', label: t('common.archived') }\n      ]\n    },\n    { key: 'category_id', label: t('common.category'), type: 'resource_select', resourceTable: 'categories' },\n    { key: 'excerpt', label: t('blogs.form.excerpt'), type: 'textarea' },\n    { key: 'content', label: t('blogs.form.content'), type: 'richtext', description: t('blogs.form.content_desc') || \"Main blog content with WYSIWYG editor\" },\n    { key: 'featured_image', label: t('blogs.form.featured_image'), type: 'image', description: t('blogs.form.image_desc') || \"Upload or select from Media Library\" },\n    { key: 'tags', label: t('common.tags'), type: 'tags' },\n    { key: 'is_public', label: t('blogs.form.is_public'), type: 'boolean' }\n  ];\n\n  // Category columns and fields\n  const categoryColumns = [\n    { key: 'name', label: t('common.name'), className: 'font-medium' },\n    { key: 'slug', label: t('common.slug') },\n    { key: 'description', label: t('common.description') },\n    { key: 'created_at', label: t('common.created_at'), type: 'date' }\n  ];\n\n  const categoryFormFields = [\n    { key: 'name', label: t('common.name'), required: true },\n    { key: 'slug', label: t('common.slug') },\n    { key: 'description', label: t('common.description'), type: 'textarea' },\n    {\n      key: 'type', label: t('blogs.type'), type: 'select', options: [\n        { value: 'blog', label: t('menu.blogs') },\n        { value: 'product', label: t('menu.products') },\n        { value: 'portfolio', label: t('menu.portfolio') }\n      ], defaultValue: 'blog'\n    }\n  ];\n\n  // Tag columns and fields\n  const tagColumns = [\n    { key: 'name', label: t('common.name'), className: 'font-medium' },\n    { key: 'slug', label: t('common.slug') },\n    { key: 'created_at', label: t('common.created_at'), type: 'date' }\n  ];\n\n  const tagFormFields = [\n    { key: 'name', label: t('common.name'), required: true },\n    { key: 'slug', label: t('common.slug') }\n  ];\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.blog.read\">\n      {/* Page Header with Breadcrumbs */}\n      <PageHeader\n        title={t('blogs.title')}\n        description={t('blogs.subtitle')}\n        icon={FileText}\n        breadcrumbs={breadcrumbs}\n      />\n\n      {/* Tabs Navigation */}\n      <PageTabs\n        value={activeTab}\n        onValueChange={setActiveTab}\n        tabs={tabs}\n      >\n        <TabsContent value=\"blogs\" className=\"mt-0\">\n          <GenericContentManager\n            tableName=\"blogs\"\n            resourceName={t('blogs.type')}\n            columns={blogColumns}\n            formFields={blogFormFields}\n            permissionPrefix=\"blog\"\n            showBreadcrumbs={false}\n            EditorComponent={BlogEditor}\n            customRowActions={customRowActions}\n            customToolbarActions={customToolbarActions}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"categories\" className=\"mt-0\">\n          <GenericContentManager\n            tableName=\"categories\"\n            resourceName={t('common.category')}\n            columns={categoryColumns}\n            formFields={categoryFormFields}\n            permissionPrefix=\"categories\"\n            showBreadcrumbs={false}\n            customSelect=\"*, owner:users!created_by(email, full_name), tenant:tenants(name)\"\n            defaultFilters={{ type: 'blog' }}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"tags\" className=\"mt-0\">\n          <GenericContentManager\n            tableName=\"tags\"\n            resourceName=\"Tag\"\n            columns={tagColumns}\n            formFields={tagFormFields}\n            permissionPrefix=\"tags\"\n            showBreadcrumbs={false}\n          />\n        </TabsContent>\n      </PageTabs>\n    </AdminPageLayout>\n  );\n}\n\nexport default BlogsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/CategoriesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { FolderTree } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction CategoriesManager() {\n  const columns = [\n    { key: 'name', label: 'Name', className: 'font-medium' },\n    { key: 'slug', label: 'Slug' },\n    { key: 'type', label: 'Type' }\n  ];\n\n  const formFields = [\n    { key: 'name', label: 'Category Name', required: true },\n    { key: 'slug', label: 'Slug' },\n    { key: 'description', label: 'Description', type: 'textarea' },\n    {\n      key: 'type', label: 'Type', type: 'select', options: [\n        { value: 'content', label: 'Content (Pages & Blogs)' },\n        { value: 'blog', label: 'Blog Category' },\n        { value: 'page', label: 'Page Category' },\n        { value: 'product', label: 'Product Category' },\n        { value: 'portfolio', label: 'Portfolio Category' },\n        { value: 'testimony', label: 'Testimony Category' },\n        { value: 'announcement', label: 'Announcement Category' },\n        { value: 'promotion', label: 'Promotion Category' },\n        { value: 'photo_gallery', label: 'Photo Gallery Category' },\n        { value: 'video_gallery', label: 'Video Gallery Category' },\n        { value: 'gallery', label: 'General Gallery' }\n      ]\n    }\n  ];\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.categories.read\">\n      <PageHeader\n        title=\"Categories\"\n        description=\"Organize content with categories and taxonomies.\"\n        icon={FolderTree}\n        breadcrumbs={[{ label: 'Categories', icon: FolderTree }]}\n      />\n\n      <GenericContentManager\n        tableName=\"categories\"\n        resourceName=\"Category\"\n        columns={columns}\n        formFields={formFields}\n        permissionPrefix=\"categories\"\n        showBreadcrumbs={false}\n      />\n    </AdminPageLayout>\n  );\n}\n\nexport default CategoriesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ContactMessagesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Mail } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction ContactMessagesManager() {\n    const columns = [\n        { key: 'name', label: 'Sender' },\n        { key: 'subject', label: 'Subject' },\n        { key: 'created_at', label: 'Date', type: 'date' },\n        { key: 'ip_address', label: 'IP Address' },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'new' ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' :\n                    value === 'replied' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                        'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'new'}\n                </span>\n            )\n        }\n    ];\n\n    const formFields = [\n        { key: 'name', label: 'Name', type: 'text', required: true },\n        { key: 'email', label: 'Email', type: 'email', required: true },\n        { key: 'subject', label: 'Subject', type: 'text', required: true },\n        { key: 'message', label: 'Message', type: 'textarea', required: true, rows: 4 },\n        { key: 'status', label: 'Status', type: 'select', options: [{ value: 'new', label: 'New' }, { value: 'read', label: 'Read' }, { value: 'replied', label: 'Replied' }] }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.contact_messages.read\">\n            <PageHeader\n                title=\"Contact Messages\"\n                description=\"View and manage incoming contact form submissions.\"\n                icon={Mail}\n                breadcrumbs={[{ label: 'Messages', icon: Mail }]}\n            />\n\n            <GenericContentManager\n                tableName=\"contact_messages\"\n                resourceName=\"Message\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"contact_messages\"\n                showBreadcrumbs={false}\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default ContactMessagesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ContactsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { MapPin } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction ContactsManager() {\n  const [provinces, setProvinces] = useState([]);\n\n  useEffect(() => {\n    const fetchProvinces = async () => {\n      const { data } = await supabase.from('provinces').select('id, name').order('name');\n      if (data) setProvinces(data);\n    };\n    fetchProvinces();\n  }, []);\n\n  const columns = [\n    { key: 'name', label: 'Location Name' },\n    { key: 'city', label: 'City' },\n    { key: 'phone', label: 'Phone' },\n    { key: 'email', label: 'Email' }\n  ];\n\n  const formFields = [\n    { key: 'name', label: 'Location Name', required: true, description: 'e.g. Head Office' },\n    { key: 'address', label: 'Address', type: 'textarea', required: true },\n    { key: 'city', label: 'City', required: true },\n    {\n      key: 'province',\n      label: 'Province',\n      type: 'select',\n      options: provinces.map(p => ({ value: p.name, label: p.name })),\n      required: true\n    },\n    { key: 'postal_code', label: 'Postal Code' },\n    { key: 'country', label: 'Country', defaultValue: 'Indonesia' },\n    { key: 'phone', label: 'Phone Number' },\n    { key: 'email', label: 'Email Address' },\n    { key: 'latitude', label: 'Latitude', type: 'number', description: 'e.g. -6.2088' },\n    { key: 'longitude', label: 'Longitude', type: 'number', description: 'e.g. 106.8456' },\n    { key: 'website', label: 'Website URL' },\n    { key: 'description', label: 'Description/Notes', type: 'textarea' },\n    { key: 'category_id', label: 'Category', type: 'relation', table: 'categories', filter: { type: 'contact' } }\n  ];\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.contacts.read\">\n      <PageHeader\n        title=\"Locations\"\n        description=\"Manage office locations and contact information.\"\n        icon={MapPin}\n        breadcrumbs={[{ label: 'Locations', icon: MapPin }]}\n      />\n\n      <GenericContentManager\n        tableName=\"contacts\"\n        resourceName=\"Location\"\n        columns={columns}\n        formFields={formFields}\n        permissionPrefix=\"contacts\"\n        showBreadcrumbs={false}\n      />\n    </AdminPageLayout>\n  );\n}\n\nexport default ContactsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ContentTable.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Button } from '@/components/ui/button';\nimport { Edit, Trash2, Eye } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { Pagination } from '@/components/ui/pagination';\n\nconst ContentTable = ({\n  data = [],\n  columns = [],\n  loading = false,\n  onEdit,\n  onDelete,\n  onView,\n  extraActions,\n  pagination\n}) => {\n\n  if (loading) {\n    return (\n      <div className=\"dashboard-surface overflow-hidden\">\n        <Table>\n          <TableHeader className=\"bg-muted/50\">\n            <TableRow>\n              {columns.map((col, i) => (\n                <TableHead key={i} className={col.className}>\n                  <Skeleton className=\"h-4 w-24 bg-muted\" />\n                </TableHead>\n              ))}\n              <TableHead className=\"text-right\"><Skeleton className=\"h-4 w-16 ml-auto bg-muted\" /></TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {[...Array(5)].map((_, i) => (\n              <TableRow key={i}>\n                {columns.map((col, j) => (\n                  <TableCell key={j} className={col.className}>\n                    <Skeleton className=\"h-4 w-full bg-muted/50\" />\n                  </TableCell>\n                ))}\n                <TableCell className=\"text-right\">\n                  <div className=\"flex justify-end gap-2\">\n                    <Skeleton className=\"h-8 w-8 rounded-md bg-muted/50\" />\n                    <Skeleton className=\"h-8 w-8 rounded-md bg-muted/50\" />\n                  </div>\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n    );\n  }\n\n  if (!data || data.length === 0) {\n    return (\n      <div className=\"dashboard-surface p-12 flex flex-col items-center justify-center text-slate-500\">\n        <p className=\"text-lg font-semibold text-slate-700\">No items found</p>\n        <p className=\"text-sm text-slate-500\">Try adjusting your search or filters.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"dashboard-surface overflow-hidden\">\n        <Table>\n          <TableHeader className=\"bg-muted/50\">\n            <TableRow className=\"hover:bg-transparent\">\n              {columns.map((col) => (\n                <TableHead key={col.key} className={`${col.className} text-muted-foreground`}>\n                  {col.label}\n                </TableHead>\n              ))}\n              {(onEdit || onDelete || onView || extraActions) && (\n                <TableHead className=\"text-right text-muted-foreground\">Actions</TableHead>\n              )}\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {data.map((item, index) => (\n              <TableRow key={item.id || index} className=\"hover:bg-muted/50 data-[state=selected]:bg-muted\">\n                {columns.map((col) => (\n                  <TableCell key={`${item.id}-${col.key}`} className={col.className}>\n                    {col.render ? (\n                      col.render(item[col.key], item)\n                    ) : col.type === 'date' ? (\n                      item[col.key] ? format(new Date(item[col.key]), 'MMM d, yyyy') : '-'\n                    ) : col.type === 'boolean' ? (\n                      item[col.key] ? <span className=\"text-green-600\">Yes</span> : <span className=\"text-destructive\">No</span>\n                    ) : (\n                      <span className=\"text-foreground\">{item[col.key]}</span>\n                    )}\n                  </TableCell>\n                ))}\n                {(onEdit || onDelete || onView || extraActions) && (\n                  <TableCell className=\"text-right\">\n                    <div className=\"flex justify-end gap-2\">\n                      {extraActions && extraActions(item)}\n                      {onView && (\n                        <Button variant=\"ghost\" size=\"icon\" onClick={() => onView(item)} className=\"h-8 w-8 text-muted-foreground hover:text-primary hover:bg-primary/10\">\n                          <Eye className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                      {onEdit && (\n                        <Button variant=\"ghost\" size=\"icon\" onClick={() => onEdit(item)} className=\"h-8 w-8 text-muted-foreground hover:text-primary hover:bg-primary/10\">\n                          <Edit className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                      {onDelete && (\n                        <Button variant=\"ghost\" size=\"icon\" onClick={() => onDelete(item)} className=\"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/10\">\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                    </div>\n                  </TableCell>\n                )}\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n\n      {pagination && (\n        <div className=\"flex flex-col sm:flex-row justify-between items-center gap-4 px-2\">\n          <div className=\"text-sm text-slate-500\">\n            Showing {((pagination.currentPage - 1) * pagination.itemsPerPage) + 1} to {Math.min(pagination.currentPage * pagination.itemsPerPage, pagination.totalItems)} of {pagination.totalItems} entries\n          </div>\n          <div className=\"flex items-center gap-4\">\n            <Select\n              value={String(pagination.itemsPerPage)}\n              onValueChange={(value) => pagination.onLimitChange(Number(value))}\n            >\n              <SelectTrigger className=\"h-9 w-[110px] rounded-xl border gap-2 border-slate-200/70 bg-white/90 px-3 text-xs font-medium text-slate-700 shadow-sm focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60 dark:text-slate-200\">\n                <span className=\"truncate\">Page Size</span>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"10\">10 / page</SelectItem>\n                <SelectItem value=\"20\">20 / page</SelectItem>\n                <SelectItem value=\"50\">50 / page</SelectItem>\n              </SelectContent>\n            </Select>\n            <Pagination\n              currentPage={pagination.currentPage}\n              totalPages={pagination.totalPages}\n              onPageChange={pagination.onPageChange}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ContentTable;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/DashboardHome.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ExtensionABACIntegration.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Shield, Check, Save } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useToast } from '@/components/ui/use-toast';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { useTranslation } from 'react-i18next';\n\nfunction ExtensionABACIntegration({ extensionId }) {\n   const { toast } = useToast();\n   const { t } = useTranslation();\n   const [roles, setRoles] = useState([]);\n   const [extensionPermissions, setExtensionPermissions] = useState([]);\n   const [activeMatrix, setActiveMatrix] = useState({}); // { roleId: Set(permNames) }\n   const [loading, setLoading] = useState(true);\n\n   const fetchData = useCallback(async () => {\n      setLoading(true);\n      try {\n         // 1. Fetch Extension Config to get defined Permissions + tenant scope\n         const { data: extData } = await supabase\n            .from('extensions')\n            .select('config, tenant_id')\n            .eq('id', extensionId)\n            .single();\n         const definedPermNames = extData?.config?.permissions || [];\n         const extensionTenantId = extData?.tenant_id || null;\n\n         // 2. Fetch Roles scoped to the extension's tenant\n         let rolesQuery = supabase\n            .from('roles')\n            .select('id, name, tenant_id')\n            .is('deleted_at', null);\n\n         if (extensionTenantId) {\n            rolesQuery = rolesQuery.eq('tenant_id', extensionTenantId);\n         } else {\n            rolesQuery = rolesQuery.is('tenant_id', null);\n         }\n\n         const { data: rolesData } = await rolesQuery;\n         setRoles(rolesData || []);\n\n         setExtensionPermissions(definedPermNames);\n\n         // 3. Fetch current mappings from REAL permissions table interactions\n         if (definedPermNames.length > 0 && rolesData?.length > 0) {\n            // Get permission IDs from core table\n            const { data: corePerms } = await supabase\n               .from('permissions')\n               .select('id, name')\n               .in('name', definedPermNames)\n               .is('deleted_at', null);\n\n            if (corePerms) {\n               const permIdMap = {};\n               corePerms.forEach(p => permIdMap[p.id] = p.name);\n               const roleIds = rolesData.map(r => r.id);\n\n               const { data: rolePerms } = await supabase\n                  .from('role_permissions')\n                  .select('role_id, permission_id')\n                  .in('permission_id', corePerms.map(p => p.id))\n                  .in('role_id', roleIds)\n                  .is('deleted_at', null);\n\n               const matrix = {};\n               if (rolePerms) {\n                  rolePerms.forEach(rp => {\n                     if (!matrix[rp.role_id]) matrix[rp.role_id] = new Set();\n                     const pName = permIdMap[rp.permission_id];\n                     if (pName) matrix[rp.role_id].add(pName);\n                  });\n               }\n               setActiveMatrix(matrix);\n            }\n         }\n\n      } catch (error) {\n         console.error(error);\n      } finally {\n         setLoading(false);\n      }\n   }, [extensionId]);\n\n   useEffect(() => {\n      fetchData();\n   }, [fetchData]);\n\n   const togglePermission = (roleId, permName) => {\n      setActiveMatrix(prev => {\n         const currentRolePerms = new Set(prev[roleId] || []);\n         if (currentRolePerms.has(permName)) {\n            currentRolePerms.delete(permName);\n         } else {\n            currentRolePerms.add(permName);\n         }\n         return { ...prev, [roleId]: currentRolePerms };\n      });\n   };\n\n   const handleSave = async () => {\n      try {\n         setLoading(true);\n         // 1. Get Core Permission IDs again to be safe\n         const { data: corePerms } = await supabase\n            .from('permissions')\n            .select('id, name')\n            .in('name', extensionPermissions)\n            .is('deleted_at', null);\n\n         if (!corePerms || corePerms.length === 0) {\n            toast({ title: \"No permissions to map\", variant: \"warning\" });\n            setLoading(false);\n            return;\n         }\n\n         const nameToId = {};\n         corePerms.forEach(p => nameToId[p.name] = p.id);\n         const targetPermIds = corePerms.map(p => p.id);\n\n         const roleIds = roles.map(r => r.id);\n         if (roleIds.length === 0) {\n            toast({ title: \"No roles available\", variant: \"warning\" });\n            setLoading(false);\n            return;\n         }\n\n         // 2. Clear existing mappings for these specific permissions scoped to the current tenant roles\n         // We delete from role_permissions where permission_id and role_id match our target list\n         await supabase\n            .from('role_permissions')\n            .update({ deleted_at: new Date().toISOString() })\n            .in('permission_id', targetPermIds)\n            .in('role_id', roleIds)\n            .is('deleted_at', null);\n\n         // 3. Insert new mappings\n         const inserts = [];\n         Object.entries(activeMatrix).forEach(([roleId, permSet]) => {\n            permSet.forEach(permName => {\n               if (nameToId[permName]) {\n                  inserts.push({\n                     role_id: roleId,\n                     permission_id: nameToId[permName]\n                  });\n               }\n            });\n         });\n\n         if (inserts.length > 0) {\n            const payload = inserts.map(item => ({ ...item, deleted_at: null }));\n            const { error } = await supabase\n               .from('role_permissions')\n               .upsert(payload, { onConflict: 'role_id, permission_id' });\n            if (error) throw error;\n         }\n\n         toast({ title: t('common.success'), description: \"Extension permissions updated for roles.\" });\n\n      } catch (error) {\n         console.error(error);\n         toast({ variant: \"destructive\", title: t('common.error'), description: error.message });\n      } finally {\n         setLoading(false);\n      }\n   };\n\n   if (loading) return <div>{t('common.loading')}</div>;\n\n   return (\n      <Card>\n         <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n               <Shield className=\"w-5 h-5 text-purple-600\" />\n               {t('extensions.abac')}\n            </CardTitle>\n            <CardDescription>Map extension permissions to system roles.</CardDescription>\n         </CardHeader>\n         <CardContent>\n            {extensionPermissions.length === 0 ? (\n               <div className=\"text-center py-8 text-slate-500\">\n                  This extension does not define any custom permissions.\n               </div>\n            ) : (\n               <div className=\"overflow-x-auto\">\n                  <table className=\"w-full border-collapse text-sm\">\n                     <thead>\n                        <tr>\n                           <th className=\"text-left p-3 border-b font-medium text-slate-500\">Permission</th>\n                           {roles.map(role => (\n                              <th key={role.id} className=\"text-center p-3 border-b font-medium text-slate-800 bg-slate-50\">\n                                 {role.name}\n                              </th>\n                           ))}\n                        </tr>\n                     </thead>\n                     <tbody>\n                        {extensionPermissions.map(permName => (\n                           <tr key={permName} className=\"border-b last:border-0 hover:bg-slate-50/50\">\n                              <td className=\"p-3 font-mono text-xs text-slate-600\">{permName}</td>\n                              {roles.map(role => {\n                                 const isChecked = activeMatrix[role.id]?.has(permName);\n                                 return (\n                                    <td key={`${role.id}-${permName}`} className=\"p-3 text-center\">\n                                       <button\n                                          onClick={() => togglePermission(role.id, permName)}\n                                          className={`w-6 h-6 rounded border flex items-center justify-center transition-colors ${isChecked\n                                             ? 'bg-blue-600 border-blue-600 text-white'\n                                             : 'bg-white border-slate-200 text-transparent hover:border-slate-300'\n                                             }`}\n                                       >\n                                          <Check className=\"w-4 h-4\" />\n                                       </button>\n                                    </td>\n                                 );\n                              })}\n                           </tr>\n                        ))}\n                     </tbody>\n                  </table>\n                  <div className=\"mt-4 flex justify-end\">\n                     <Button onClick={handleSave} disabled={loading}>\n                        <Save className=\"w-4 h-4 mr-2\" />\n                        {t('common.save')}\n                     </Button>\n                  </div>\n               </div>\n            )}\n         </CardContent>\n      </Card>\n   );\n}\n\nexport default ExtensionABACIntegration;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ExtensionEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":54,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { ArrowLeft, Save, Code, ShieldAlert } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useTranslation } from 'react-i18next';\nimport { syncExtensionToRegistry } from '@/utils/extensionLifecycle';\n\nfunction ExtensionEditor({ extension = {}, onClose, onSave }) {\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const { user } = useAuth();\n  const { isPlatformAdmin, isFullAccess } = usePermissions();\n  const { currentTenant } = useTenant();\n  const [loading, setLoading] = useState(false);\n\n  // Ownership check\n  const isOwner = user?.id === extension.created_by;\n  const isSuperAdmin = isPlatformAdmin || isFullAccess;\n  const canEdit = !extension.id || isOwner || isSuperAdmin;\n\n  const [formData, setFormData] = useState({\n    name: extension.name || '',\n    slug: extension.slug || '',\n    version: extension.version || '1.0.0',\n    description: extension.description || '',\n    author: extension.author || user?.user_metadata?.full_name || 'Admin',\n    icon: extension.icon || '',\n    config: extension.config ? JSON.stringify(extension.config, null, 2) : '{\\n  \"routes\": [],\\n  \"permissions\": []\\n}'\n  });\n\n  const handleSave = async (e) => {\n    e.preventDefault();\n\n    if (!canEdit) {\n      toast({ variant: \"destructive\", title: t('common.access_denied'), description: \"You cannot edit extensions you do not own.\" });\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      // Validate JSON config\n      let parsedConfig;\n      try {\n        parsedConfig = JSON.parse(formData.config);\n      } catch (err) {\n        throw new Error(\"Invalid JSON configuration. Please check format.\");\n      }\n\n      const payload = {\n        name: formData.name,\n        slug: formData.slug.toLowerCase().replace(/\\s+/g, '-'),\n        version: formData.version,\n        description: formData.description,\n        author: formData.author,\n        icon: formData.icon,\n        config: parsedConfig,\n        updated_at: new Date().toISOString()\n      };\n\n      let extensionId;\n\n      if (extension.id) {\n        // Update existing\n        const { error: updateError } = await supabase\n          .from('extensions')\n          .update(payload)\n          .eq('id', extension.id);\n\n        if (updateError) throw updateError;\n        extensionId = extension.id;\n\n      } else {\n        // Create new\n        payload.created_by = user.id;\n        payload.is_active = true; // Default active on creation\n        payload.tenant_id = currentTenant?.id || null;\n        const { data, error: insertError } = await supabase\n          .from('extensions')\n          .insert([payload])\n          .select()\n          .single();\n\n        if (insertError) throw insertError;\n        extensionId = data.id;\n      }\n\n      // Sync lifecycle\n      await syncExtensionToRegistry(extensionId, parsedConfig);\n\n      toast({\n        title: t('common.success'),\n        description: extension.id ? \"Extension updated successfully.\" : \"Extension created successfully.\"\n      });\n\n      onSave();\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: t('common.error'),\n        description: error.message\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!canEdit) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n            <ArrowLeft className=\"w-5 h-5\" />\n          </Button>\n          <h2 className=\"text-2xl font-bold text-slate-800\">Extension Details</h2>\n        </div>\n        <div className=\"bg-red-50 p-6 rounded-lg border border-red-200 text-center\">\n          <ShieldAlert className=\"w-12 h-12 text-red-500 mx-auto mb-3\" />\n          <h3 className=\"text-lg font-bold text-red-700\">Read Only Mode</h3>\n          <p className=\"text-red-600\">You do not have permission to edit this extension.</p>\n        </div>\n        <div className=\"bg-white p-6 rounded-lg border border-slate-200\">\n          <pre className=\"text-xs text-slate-500 overflow-auto\">{JSON.stringify(extension, null, 2)}</pre>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n          <ArrowLeft className=\"w-5 h-5\" />\n        </Button>\n        <div>\n          <h2 className=\"text-2xl font-bold text-slate-800\">\n            {extension.id ? `Edit ${extension.name}` : 'New Extension'}\n          </h2>\n          <p className=\"text-slate-500\">Configure extension metadata and settings</p>\n        </div>\n      </div>\n\n      <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden\">\n        <form onSubmit={handleSave} className=\"p-6 space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"space-y-2\">\n              <Label>Extension Name</Label>\n              <Input\n                value={formData.name}\n                onChange={e => setFormData({ ...formData, name: e.target.value })}\n                placeholder=\"My Awesome Plugin\"\n                required\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Slug (Unique ID)</Label>\n              <Input\n                value={formData.slug}\n                onChange={e => setFormData({ ...formData, slug: e.target.value })}\n                placeholder=\"my-awesome-plugin\"\n                required\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Version</Label>\n              <Input\n                value={formData.version}\n                onChange={e => setFormData({ ...formData, version: e.target.value })}\n                placeholder=\"1.0.0\"\n                required\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Author</Label>\n              <Input\n                value={formData.author}\n                onChange={e => setFormData({ ...formData, author: e.target.value })}\n                placeholder=\"Developer Name\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Icon Emoji</Label>\n              <div className=\"flex gap-2\">\n                <div className=\"w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center text-xl border border-slate-200\">\n                  {formData.icon || ''}\n                </div>\n                <Input\n                  value={formData.icon}\n                  onChange={e => setFormData({ ...formData, icon: e.target.value })}\n                  placeholder=\"\"\n                  maxLength={2}\n                  className=\"w-20\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label>Description</Label>\n            <Textarea\n              value={formData.description}\n              onChange={e => setFormData({ ...formData, description: e.target.value })}\n              placeholder=\"What does this extension do?\"\n              className=\"h-20\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between items-center\">\n              <Label className=\"flex items-center gap-2\">\n                <Code className=\"w-4 h-4 text-slate-500\" />\n                Configuration (JSON)\n              </Label>\n              <span className=\"text-xs text-slate-400\">Define routes, menus, and permissions</span>\n            </div>\n            <Textarea\n              value={formData.config}\n              onChange={e => setFormData({ ...formData, config: e.target.value })}\n              className=\"font-mono text-sm h-64 bg-slate-50\"\n              spellCheck=\"false\"\n            />\n          </div>\n\n          <div className=\"pt-4 flex justify-end border-t border-slate-100\">\n            <Button type=\"submit\" disabled={loading} className=\"bg-blue-600 hover:bg-blue-700\">\n              {loading ? t('common.saving') : (\n                <>\n                  <Save className=\"w-4 h-4 mr-2\" />\n                  {t('common.save')}\n                </>\n              )}\n            </Button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n\nexport default ExtensionEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ExtensionGuide.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { ArrowLeft, Code, Book, Shield, Zap, Database } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n\nfunction ExtensionGuide({ onBack }) {\n   return (\n      <div className=\"max-w-5xl mx-auto space-y-8 py-6\">\n         <div className=\"flex items-center gap-4 mb-6\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={onBack}>\n               <ArrowLeft className=\"w-5 h-5\" />\n            </Button>\n            <div>\n               <h2 className=\"text-3xl font-bold text-slate-800\">Developer Guide</h2>\n               <p className=\"text-slate-600\">How to build and integrate extensions</p>\n            </div>\n         </div>\n\n         <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <Card>\n               <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                     <Book className=\"w-5 h-5 text-blue-600\" />\n                     Overview\n                  </CardTitle>\n               </CardHeader>\n               <CardContent className=\"text-slate-600 text-sm leading-relaxed\">\n                  <p className=\"mb-4\">\n                     Extensions allow you to add new features, pages, and logic to the CMS without modifying core code.\n                     They are stored in the database and loaded dynamically.\n                  </p>\n                  <ul className=\"list-disc pl-5 space-y-2\">\n                     <li>Add custom pages to the dashboard sidebar</li>\n                     <li>Register new permissions for ABAC</li>\n                     <li>Store custom configuration via JSON</li>\n                     <li>Hook into system events (lifecycle hooks)</li>\n                  </ul>\n               </CardContent>\n            </Card>\n\n            <Card>\n               <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                     <Code className=\"w-5 h-5 text-green-600\" />\n                     Configuration Format\n                  </CardTitle>\n               </CardHeader>\n               <CardContent>\n                  <pre className=\"bg-slate-900 text-slate-50 p-4 rounded-lg text-xs font-mono overflow-x-auto\">\n                     {`{\n  \"routes\": [\n    {\n      \"path\": \"/my-plugin\",\n      \"name\": \"My Plugin\",\n      \"component\": \"MyPluginMain\",\n      \"icon\": \"Puzzle\" \n    }\n  ],\n  \"permissions\": [\n    \"view_my_plugin\",\n    \"manage_my_plugin\"\n  ],\n  \"settings\": {\n    \"apiKey\": \"...\"\n  }\n}`}\n                  </pre>\n               </CardContent>\n            </Card>\n\n            <Card>\n               <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                     <Shield className=\"w-5 h-5 text-purple-600\" />\n                     ABAC Integration\n                  </CardTitle>\n               </CardHeader>\n               <CardContent className=\"text-slate-600 text-sm\">\n                  <p className=\"mb-3\">\n                     Extensions fully integrate with the Attribute-Based Access Control system.\n                  </p>\n                  <div className=\"space-y-2\">\n                     <div className=\"p-3 bg-slate-50 rounded border border-slate-100\">\n                        <strong className=\"text-slate-800 block mb-1\">Defining Permissions</strong>\n                        <p>Add permission keys to your config. Admin can then assign these to Roles.</p>\n                     </div>\n                     <div className=\"p-3 bg-slate-50 rounded border border-slate-100\">\n                        <strong className=\"text-slate-800 block mb-1\">Checking Access</strong>\n                        <p>Use the <code>useExtension</code> hook or standard <code>usePermissions</code> context to check access in your components.</p>\n                     </div>\n                  </div>\n               </CardContent>\n            </Card>\n\n            <Card>\n               <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                     <Database className=\"w-5 h-5 text-orange-600\" />\n                     Data Persistence\n                  </CardTitle>\n               </CardHeader>\n               <CardContent className=\"text-slate-600 text-sm\">\n                  <p className=\"mb-4\">\n                     Extensions typically need to store data. You have two options:\n                  </p>\n                  <ol className=\"list-decimal pl-5 space-y-2\">\n                     <li>\n                        <strong>Extension Config:</strong> Ideal for small settings, API keys, or preferences. Stored in the <code>config</code> JSONB column.\n                     </li>\n                     <li>\n                        <strong>Custom Tables:</strong> For large datasets, create new tables in Supabase prefixed with your extension slug (e.g., <code>ext_analytics_events</code>).\n                     </li>\n                  </ol>\n               </CardContent>\n            </Card>\n         </div>\n\n         <div className=\"bg-slate-900 rounded-xl p-8 text-white\">\n            <div className=\"flex items-center gap-3 mb-4\">\n               <Zap className=\"w-6 h-6 text-yellow-400\" />\n               <h3 className=\"text-xl font-bold\">Pro Tip: Extension Hooks</h3>\n            </div>\n            <p className=\"text-slate-300 mb-6 max-w-3xl\">\n               Use standard React hooks to interact with the CMS core. The <code>useExtension</code> hook provides\n               a safe sandbox to access user details, toast notifications, and navigation without breaking the app.\n            </p>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n               <div className=\"bg-slate-800 p-4 rounded-lg border border-slate-700\">\n                  <code className=\"text-yellow-400 block mb-2\">onActivate()</code>\n                  <p className=\"text-xs text-slate-400\">Triggered when admin enables the extension. Use this to initialize data or check dependencies.</p>\n               </div>\n               <div className=\"bg-slate-800 p-4 rounded-lg border border-slate-700\">\n                  <code className=\"text-yellow-400 block mb-2\">onDeactivate()</code>\n                  <p className=\"text-xs text-slate-400\">Triggered on disable. Cleanup resources, stop listeners, or clear temporary state.</p>\n               </div>\n            </div>\n         </div>\n      </div>\n   );\n}\n\nexport default ExtensionGuide;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ExtensionHealthCheck.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":2,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":49,"suggestions":[{"messageId":"removeVar","data":{"varName":"useCallback"},"fix":{"range":[36,49],"text":""},"desc":"Remove unused variable 'useCallback'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'runDiagnosis'. Either include it or remove the dependency array.","line":74,"column":7,"nodeType":"ArrayExpression","endLine":74,"endColumn":9,"suggestions":[{"desc":"Update the dependencies array to be: [runDiagnosis]","fix":{"range":[2638,2640],"text":"[runDiagnosis]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Activity, CheckCircle, XCircle, ShieldCheck } from 'lucide-react';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Progress } from '@/components/ui/progress';\nimport { Button } from '@/components/ui/button';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext';\n\nconst initialChecks = [\n   { name: 'Database Connection', status: 'pending' },\n   { name: 'Extension Registry', status: 'pending' },\n   { name: 'Route Conflicts', status: 'pending' },\n   { name: 'Permission Integrity', status: 'pending' },\n];\n\nfunction ExtensionHealthCheck() {\n   const { isPlatformAdmin } = usePermissions();\n   const { currentTenant } = useTenant();\n   const [checking, setChecking] = useState(false);\n   const [healthScore, setHealthScore] = useState(100);\n   const [checks, setChecks] = useState(() => initialChecks.map(check => ({ ...check })));\n\n   const runDiagnosis = async () => {\n      setChecking(true);\n      setHealthScore(100);\n\n      // Simulate checks sequence\n      const newChecks = initialChecks.map(check => ({ ...check }));\n\n      // Check 1: DB\n      newChecks[0].status = 'running';\n      setChecks([...newChecks]);\n      await new Promise(r => setTimeout(r, 800));\n      let query = supabase.from('extensions').select('count').single();\n      if (currentTenant?.id) {\n         query = query.eq('tenant_id', currentTenant.id);\n      } else if (!isPlatformAdmin) {\n         query = query.eq('tenant_id', null);\n      }\n      const { error } = await query;\n      newChecks[0].status = error ? 'error' : 'ok';\n      setChecks([...newChecks]);\n\n      // Check 2: Registry\n      newChecks[1].status = 'running';\n      setChecks([...newChecks]);\n      await new Promise(r => setTimeout(r, 600));\n      newChecks[1].status = 'ok';\n      setChecks([...newChecks]);\n\n      // Check 3: Conflicts\n      newChecks[2].status = 'running';\n      setChecks([...newChecks]);\n      await new Promise(r => setTimeout(r, 1000));\n      newChecks[2].status = 'ok'; // Simulate OK\n      setChecks([...newChecks]);\n\n      // Check 4: Permissions\n      newChecks[3].status = 'running';\n      setChecks([...newChecks]);\n      await new Promise(r => setTimeout(r, 500));\n      newChecks[3].status = 'ok';\n      setChecks([...newChecks]);\n\n      setChecking(false);\n   };\n\n   useEffect(() => {\n      // Run once on mount\n      runDiagnosis();\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n   }, []);\n\n   return (\n      <div className=\"space-y-6\">\n         <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <Card className=\"md:col-span-2\">\n               <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                     <Activity className=\"w-5 h-5 text-blue-600\" />\n                     System Health Diagnosis\n                  </CardTitle>\n                  <CardDescription>Run self-diagnostics to ensure extension system integrity.</CardDescription>\n               </CardHeader>\n               <CardContent>\n                  <div className=\"space-y-6\">\n                     {checks.map((check, idx) => (\n                        <div key={idx} className=\"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100\">\n                           <div className=\"flex items-center gap-3\">\n                              {check.status === 'pending' && <div className=\"w-4 h-4 rounded-full bg-slate-300\" />}\n                              {check.status === 'running' && <div className=\"w-4 h-4 rounded-full border-2 border-blue-500 border-t-transparent animate-spin\" />}\n                              {check.status === 'ok' && <CheckCircle className=\"w-5 h-5 text-green-500\" />}\n                              {check.status === 'error' && <XCircle className=\"w-5 h-5 text-red-500\" />}\n                              <span className=\"font-medium text-slate-700\">{check.name}</span>\n                           </div>\n                           <span className=\"text-xs uppercase font-bold text-slate-400\">{check.status}</span>\n                        </div>\n                     ))}\n\n                     <Button onClick={runDiagnosis} disabled={checking} className=\"w-full\">\n                        {checking ? 'Running Diagnostics...' : 'Re-run Diagnostics'}\n                     </Button>\n                  </div>\n               </CardContent>\n            </Card>\n\n            <Card className=\"bg-gradient-to-br from-slate-900 to-slate-800 text-white border-none\">\n               <CardContent className=\"flex flex-col items-center justify-center h-full p-6 text-center\">\n                  <ShieldCheck className=\"w-16 h-16 text-green-400 mb-4\" />\n                  <div className=\"text-4xl font-bold mb-2\">{healthScore}%</div>\n                  <div className=\"text-slate-300 mb-6\">System Operational</div>\n                  <div className=\"w-full bg-slate-700 h-2 rounded-full overflow-hidden\">\n                     <Progress value={healthScore} className=\"h-full bg-slate-900 [&>div]:bg-green-500\" />\n                  </div>\n               </CardContent>\n            </Card>\n         </div>\n      </div>\n   );\n}\n\nexport default ExtensionHealthCheck;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ExtensionInstaller.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":61,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":61,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { Upload, FileJson } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { syncExtensionToRegistry } from '@/utils/extensionLifecycle';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext';\n\nfunction ExtensionInstaller({ onInstallComplete }) {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { hasPermission, isPlatformAdmin, isFullAccess } = usePermissions();\n  const { currentTenant } = useTenant();\n  const [dragActive, setDragActive] = useState(false);\n  const [preview, setPreview] = useState(null);\n  const [installing, setInstalling] = useState(false);\n\n  // Permission check - only platform admins or platform.module.create can install\n  const isSuperAdmin = isPlatformAdmin || isFullAccess;\n  const canInstall = isSuperAdmin || hasPermission('platform.module.create') || hasPermission('ext.manage');\n\n  const handleDrag = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === \"dragenter\" || e.type === \"dragover\") {\n      setDragActive(true);\n    } else if (e.type === \"dragleave\") {\n      setDragActive(false);\n    }\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      processFile(e.dataTransfer.files[0]);\n    }\n  };\n\n  const handleFileChange = (e) => {\n    if (e.target.files && e.target.files[0]) {\n      processFile(e.target.files[0]);\n    }\n  };\n\n  const processFile = (file) => {\n    if (file.type !== \"application/json\" && !file.name.endsWith('.json')) {\n      toast({ variant: \"destructive\", title: \"Invalid File\", description: \"Please upload a valid JSON configuration file.\" });\n      return;\n    }\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const json = JSON.parse(e.target.result);\n        setPreview(json);\n      } catch (err) {\n        toast({ variant: \"destructive\", title: \"Parse Error\", description: \"Could not parse JSON.\" });\n        setPreview(null);\n      }\n    };\n    reader.readAsText(file);\n  };\n\n  const handleInstall = async () => {\n    if (!canInstall) {\n      toast({ variant: \"destructive\", title: \"Access Denied\", description: \"You do not have permission to install extensions.\" });\n      return;\n    }\n    if (!preview) return;\n    setInstalling(true);\n\n    try {\n      // 1. Create Extension Record\n      const payload = {\n        name: preview.name || 'Untitled Extension',\n        slug: preview.slug || `ext-${Date.now()}`,\n        description: preview.description,\n        version: preview.version || '1.0.0',\n        author: preview.author || user.email,\n        icon: preview.icon || '',\n        is_active: true,\n        config: preview,\n        created_by: user.id,\n        tenant_id: currentTenant?.id || null\n      };\n\n      const { data, error } = await supabase.from('extensions').insert([payload]).select().single();\n      if (error) throw error;\n\n      // 2. Run Lifecycle Sync\n      await syncExtensionToRegistry(data.id, preview);\n\n      toast({\n        title: \"Extension Installed\",\n        description: `${payload.name} has been successfully added to the system.`\n      });\n\n      setPreview(null);\n      if (onInstallComplete) onInstallComplete();\n\n    } catch (error) {\n      console.error(error);\n      toast({ variant: \"destructive\", title: \"Installation Failed\", description: error.message });\n    } finally {\n      setInstalling(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div\n        className={`border-2 border-dashed rounded-xl p-10 text-center transition-colors ${dragActive ? 'border-blue-500 bg-blue-50' : 'border-slate-200 hover:bg-slate-50'}`}\n        onDragEnter={handleDrag}\n        onDragLeave={handleDrag}\n        onDragOver={handleDrag}\n        onDrop={handleDrop}\n      >\n        <input type=\"file\" id=\"ext-file\" className=\"hidden\" accept=\".json\" onChange={handleFileChange} />\n        <label htmlFor=\"ext-file\" className=\"cursor-pointer flex flex-col items-center\">\n          <div className=\"w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-4\">\n            <Upload className=\"w-8 h-8\" />\n          </div>\n          <h3 className=\"text-lg font-bold text-slate-700\">Upload Extension Config</h3>\n          <p className=\"text-slate-500 mb-4\">Drag & drop a .json file here, or click to select</p>\n          <Button variant=\"outline\" onClick={() => document.getElementById('ext-file').click()}>Select File</Button>\n        </label>\n      </div>\n\n      {preview && (\n        <Card className=\"border-blue-200 bg-blue-50/30\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileJson className=\"w-5 h-5 text-blue-600\" />\n              {preview.name || 'Unknown Name'}\n            </CardTitle>\n            <CardDescription>Version {preview.version}  by {preview.author}</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-slate-600 mb-4\">{preview.description}</p>\n            <div className=\"space-y-2\">\n              <div className=\"flex gap-2 text-xs font-mono\">\n                <span className=\"bg-white px-2 py-1 rounded border\">Routes: {preview.routes?.length || 0}</span>\n                <span className=\"bg-white px-2 py-1 rounded border\">Menus: {preview.menus?.length || 0}</span>\n                <span className=\"bg-white px-2 py-1 rounded border\">Permissions: {preview.permissions?.length || 0}</span>\n              </div>\n            </div>\n            <div className=\"mt-6 flex justify-end\">\n              <Button onClick={handleInstall} disabled={installing} className=\"bg-blue-600 hover:bg-blue-700\">\n                {installing ? 'Installing...' : 'Confirm Installation'}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n\nexport default ExtensionInstaller;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ExtensionLogs.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Terminal } from 'lucide-react';\n\n// Mock logs for demonstration as we don't have a real log stream\nconst MOCK_LOGS = [\n  { id: 1, timestamp: new Date(Date.now() - 1000 * 60 * 5).toISOString(), level: 'info', message: 'System initialized' },\n  { id: 2, timestamp: new Date(Date.now() - 1000 * 60 * 2).toISOString(), level: 'success', message: 'Extension \"SEO Pro\" loaded successfully' },\n  { id: 3, timestamp: new Date(Date.now() - 1000 * 30).toISOString(), level: 'warning', message: 'High memory usage detected in background job' },\n  { id: 4, timestamp: new Date().toISOString(), level: 'info', message: 'Checking for extension updates...' },\n];\n\nfunction ExtensionLogs() {\n  const [logs] = useState(MOCK_LOGS);\n\n  return (\n    <Card className=\"h-full\">\n      <CardHeader className=\"pb-3 border-b\">\n        <CardTitle className=\"flex items-center gap-2 text-lg\">\n          <Terminal className=\"w-5 h-5\" />\n          System Logs\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        <ScrollArea className=\"h-[400px] p-4\">\n          <div className=\"space-y-2 font-mono text-sm\">\n            {logs.map(log => (\n              <div key={log.id} className=\"flex gap-3 items-start\">\n                <span className=\"text-slate-400 whitespace-nowrap text-xs mt-0.5\">\n                  {new Date(log.timestamp).toLocaleTimeString()}\n                </span>\n                <div className=\"flex-1 break-all\">\n                  <span className={`\n                        mr-2 uppercase text-[10px] font-bold px-1.5 py-0.5 rounded\n                        ${log.level === 'info' ? 'bg-blue-100 text-blue-700' : ''}\n                        ${log.level === 'success' ? 'bg-green-100 text-green-700' : ''}\n                        ${log.level === 'warning' ? 'bg-yellow-100 text-yellow-700' : ''}\n                        ${log.level === 'error' ? 'bg-red-100 text-red-700' : ''}\n                     `}>\n                    {log.level}\n                  </span>\n                  <span className=\"text-slate-700\">{log.message}</span>\n                </div>\n              </div>\n            ))}\n            <div className=\"text-xs text-slate-400 pt-2 border-t border-dashed border-slate-200 mt-4\">\n              End of recent logs\n            </div>\n          </div>\n        </ScrollArea>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default ExtensionLogs;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ExtensionMarketplace.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { Download, Star, ShieldCheck } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\n\n// Mock Data for Marketplace\nconst MARKETPLACE_EXTENSIONS = [\n  {\n    id: 'ext-analytics',\n    name: 'Advanced Analytics',\n    slug: 'advanced-analytics',\n    description: 'Detailed dashboard analytics with charts, user journey tracking, and export capabilities.',\n    version: '2.1.0',\n    author: 'CMS Team',\n    icon: '',\n    rating: 4.8,\n    downloads: '1.2k',\n    verified: true\n  },\n  {\n    id: 'ext-newsletter',\n    name: 'Newsletter Manager',\n    slug: 'newsletter-manager',\n    description: 'Create, schedule, and send newsletters directly from your CMS. Includes templates.',\n    version: '1.0.5',\n    author: 'EmailPro',\n    icon: '',\n    rating: 4.5,\n    downloads: '850',\n    verified: true\n  },\n  {\n    id: 'ext-backup',\n    name: 'Auto Backup',\n    slug: 'auto-backup',\n    description: 'Automated daily backups of your content to secure storage. Restore with one click.',\n    version: '1.2.0',\n    author: 'SysAdmin',\n    icon: '',\n    rating: 4.9,\n    downloads: '2k',\n    verified: true\n  },\n  {\n    id: 'ext-seo-pro',\n    name: 'SEO Pro',\n    slug: 'seo-pro',\n    description: 'Advanced SEO tools, meta tag generator, sitemap management, and keyword analysis.',\n    version: '3.0.1',\n    author: 'SEO Master',\n    icon: '',\n    rating: 4.7,\n    downloads: '3.5k',\n    verified: true\n  }\n];\n\nfunction ExtensionMarketplace({ onInstall }) {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { currentTenant } = useTenant();\n  const [installing, setInstalling] = useState(null);\n\n  const handleInstall = async (ext) => {\n    setInstalling(ext.id);\n\n    // Simulate network delay\n    await new Promise(resolve => setTimeout(resolve, 1500));\n\n    try {\n      const payload = {\n        name: ext.name,\n        slug: ext.slug,\n        description: ext.description,\n        version: ext.version,\n        author: ext.author,\n        icon: ext.icon,\n        is_active: true,\n        created_by: user.id,\n        config: { installed_from: 'marketplace', original_id: ext.id },\n        tenant_id: currentTenant?.id || null\n      };\n\n      const { error } = await supabase\n        .from('extensions')\n        .insert([payload]);\n\n      if (error) {\n        if (error.code === '23505') { // Unique violation\n          throw new Error(\"This extension is already installed.\");\n        }\n        throw error;\n      }\n\n      toast({\n        title: \"Installation Complete\",\n        description: `${ext.name} has been successfully installed and activated.`\n      });\n\n      if (onInstall) onInstall();\n\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Installation Failed\",\n        description: error.message\n      });\n    } finally {\n      setInstalling(null);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"bg-primary/5 border border-primary/20 rounded-xl p-8 py-10 shadow-sm mb-8 relative overflow-hidden\">\n        <div className=\"absolute top-0 right-0 p-12 opacity-5\">\n          <div className=\"w-64 h-64 rounded-full bg-primary blur-3xl\"></div>\n        </div>\n        <h2 className=\"text-3xl font-bold mb-2 text-foreground\">Extension Marketplace</h2>\n        <p className=\"text-muted-foreground max-w-2xl text-lg\">\n          Discover and install plugins to supercharge your CMS. From analytics to SEO,\n          find the tools you need to grow.\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6\">\n        {MARKETPLACE_EXTENSIONS.map((ext) => (\n          <div key={ext.id} className=\"bg-card rounded-xl border border-border shadow-sm hover:shadow-md transition-shadow flex flex-col group\">\n            <div className=\"p-6 flex-1\">\n              <div className=\"flex justify-between items-start mb-4\">\n                <div className=\"w-12 h-12 bg-muted border border-border rounded-xl flex items-center justify-center text-2xl shadow-sm text-foreground\">\n                  {ext.icon}\n                </div>\n                {ext.verified && (\n                  <Badge variant=\"secondary\" className=\"bg-primary/10 text-primary border-primary/20 flex gap-1\">\n                    <ShieldCheck className=\"w-3 h-3\" /> Verified\n                  </Badge>\n                )}\n              </div>\n\n              <h3 className=\"text-lg font-bold text-foreground mb-2 group-hover:text-primary transition-colors\">{ext.name}</h3>\n              <p className=\"text-muted-foreground text-sm mb-4 leading-relaxed\">\n                {ext.description}\n              </p>\n\n              <div className=\"flex items-center gap-4 text-xs text-muted-foreground font-medium\">\n                <div className=\"flex items-center gap-1 text-amber-500\">\n                  <Star className=\"w-3 h-3 fill-current\" />\n                  <span>{ext.rating}</span>\n                </div>\n                <span>{ext.downloads} installs</span>\n                <span>v{ext.version}</span>\n              </div>\n            </div>\n\n            <div className=\"p-4 bg-muted/30 border-t border-border rounded-b-xl\">\n              <Button\n                className=\"w-full\"\n                onClick={() => handleInstall(ext)}\n                disabled={!!installing}\n              >\n                {installing === ext.id ? (\n                  'Installing...'\n                ) : (\n                  <>\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Install Extension\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport default ExtensionMarketplace;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ExtensionSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":125,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":125,"endColumn":33}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchActiveExtensions'. Either include it or remove the dependency array.","line":25,"column":6,"nodeType":"ArrayExpression","endLine":25,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant.id, fetchActiveExtensions, isPlatformAdmin]","fix":{"range":[1110,1146],"text":"[currentTenant.id, fetchActiveExtensions, isPlatformAdmin]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { Save, RefreshCw } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext';\n\nfunction ExtensionSettings() {\n  const { toast } = useToast();\n  const { isPlatformAdmin } = usePermissions();\n  const { currentTenant } = useTenant();\n  const [extensions, setExtensions] = useState([]);\n  const [selectedExtension, setSelectedExtension] = useState(null);\n  const [settings, setSettings] = useState({});\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    fetchActiveExtensions();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentTenant?.id, isPlatformAdmin]);\n\n  const fetchActiveExtensions = async () => {\n    try {\n      let query = supabase\n        .from('extensions')\n        .select('id, name, config')\n        .eq('is_active', true)\n        .is('deleted_at', null);\n\n      if (currentTenant?.id) {\n        query = query.eq('tenant_id', currentTenant.id);\n      } else if (!isPlatformAdmin) {\n        query = query.eq('tenant_id', null);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setExtensions(data || []);\n      if (data && data.length > 0) {\n        setSelectedExtension(data[0].id);\n        setSettings(data[0].config || {});\n      }\n    } catch (error) {\n      console.error('Error fetching extensions:', error);\n    }\n  };\n\n  const handleExtensionChange = (id) => {\n    const ext = extensions.find(e => e.id === id);\n    setSelectedExtension(id);\n    setSettings(ext?.config || {});\n  };\n\n  const handleSave = async () => {\n    if (!selectedExtension) return;\n    setLoading(true);\n    try {\n      const { error } = await supabase\n        .from('extensions')\n        .update({ config: settings, updated_at: new Date().toISOString() })\n        .eq('id', selectedExtension);\n\n      if (error) throw error;\n\n      toast({\n        title: \"Settings Saved\",\n        description: \"Extension configuration updated successfully.\"\n      });\n\n      // Update local state\n      setExtensions(prev => prev.map(e => e.id === selectedExtension ? { ...e, config: settings } : e));\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Save Failed\",\n        description: error.message\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Extension Configuration</CardTitle>\n          <CardDescription>Manage individual settings for active extensions.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label>Select Extension</Label>\n            <Select value={selectedExtension || \"\"} onValueChange={handleExtensionChange}>\n              <SelectTrigger className=\"w-full md:w-[300px]\">\n                <SelectValue placeholder=\"Select extension to configure\" />\n              </SelectTrigger>\n              <SelectContent>\n                {extensions.map(ext => (\n                  <SelectItem key={ext.id} value={ext.id}>{ext.name}</SelectItem>\n                ))}\n                {extensions.length === 0 && <SelectItem value=\"none\" disabled>No active extensions</SelectItem>}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {selectedExtension ? (\n            <div className=\"border-t pt-4 space-y-4\">\n              <div className=\"bg-slate-50 p-4 rounded-md border border-slate-100 font-mono text-sm\">\n                <div className=\"flex justify-between items-center mb-2\">\n                  <Label>Raw Configuration (JSON)</Label>\n                  <span className=\"text-xs text-slate-500\">Editable</span>\n                </div>\n                <textarea\n                  className=\"w-full h-64 p-2 bg-white border border-slate-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  value={JSON.stringify(settings, null, 2)}\n                  onChange={(e) => {\n                    try {\n                      setSettings(JSON.parse(e.target.value));\n                    } catch (err) {\n                      // Allow typing, validate on save/blur or show error\n                    }\n                  }}\n                />\n              </div>\n              <Button onClick={handleSave} disabled={loading}>\n                {loading ? <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" /> : <Save className=\"w-4 h-4 mr-2\" />}\n                Save Configuration\n              </Button>\n            </div>\n          ) : (\n            <div className=\"py-12 text-center text-slate-500\">\n              Select an extension to view its settings.\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default ExtensionSettings;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ExtensionsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport {\n  Puzzle, Power, Trash2, Settings,\n  Upload, BookOpen, AlertCircle,\n  Search, Shield\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Badge } from '@/components/ui/badge';\nimport { useTranslation } from 'react-i18next';\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\nimport { activateExtensionRegistry, deactivateExtensionRegistry, syncExtensionToRegistry } from '@/utils/extensionLifecycle';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\n// Extension Modules\nimport ExtensionEditor from './ExtensionEditor';\nimport ExtensionMarketplace from './ExtensionMarketplace';\nimport ExtensionGuide from './ExtensionGuide';\nimport ExtensionSettings from './ExtensionSettings';\nimport ExtensionLogs from './ExtensionLogs';\nimport ExtensionHealthCheck from './ExtensionHealthCheck';\nimport ExtensionABACIntegration from './ExtensionABACIntegration';\nimport ExtensionInstaller from './ExtensionInstaller';\n\nfunction ExtensionsManager() {\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const { user } = useAuth();\n  const { hasPermission, hasAnyPermission, isPlatformAdmin, isFullAccess } = usePermissions();\n  const { currentTenant } = useTenant();\n\n  const [extensions, setExtensions] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [activeTab, setActiveTab] = useState('installed');\n  const [editingExtension, setEditingExtension] = useState(null);\n  const [selectedForRBAC, setSelectedForRBAC] = useState(null);\n  const [showGuide, setShowGuide] = useState(false);\n\n  // RBAC & Permissions Logic\n  const isSuperAdmin = isPlatformAdmin || isFullAccess;\n  const canCreate = isSuperAdmin || hasPermission('platform.extensions.create');\n  const canManageGlobal = isSuperAdmin || hasPermission('platform.extensions.update');\n  const canView = isSuperAdmin || hasAnyPermission(['platform.extensions.read', 'platform.extensions.update', 'platform.extensions.create']);\n\n  const fetchExtensions = useCallback(async () => {\n    try {\n      setLoading(true);\n      let query = supabase\n        .from('extensions')\n        .select('*')\n        .is('deleted_at', null)\n        .order('created_at', { ascending: false });\n\n      if (!isPlatformAdmin && currentTenant?.id) {\n        query = query.eq('tenant_id', currentTenant.id);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setExtensions(data || []);\n    } catch (error) {\n      console.error('Error fetching extensions:', error);\n      toast({ variant: \"destructive\", title: t('common.error'), description: \"Failed to load extensions\" });\n    } finally {\n      setLoading(false);\n    }\n  }, [currentTenant?.id, isPlatformAdmin, t, toast]);\n\n  useEffect(() => {\n    if (canView) {\n      fetchExtensions();\n    } else {\n      setLoading(false);\n    }\n  }, [canView, fetchExtensions]);\n\n  const handleToggleStatus = async (ext) => {\n    // Only platform admins should toggle activation state to prevent system breaking\n    if (!isSuperAdmin) {\n      toast({ variant: \"destructive\", title: t('common.access_denied'), description: \"Only platform admins can activate/deactivate extensions.\" });\n      return;\n    }\n\n    try {\n      const newStatus = !ext.is_active;\n\n      const { error } = await supabase.from('extensions').update({ is_active: newStatus, updated_at: new Date().toISOString() }).eq('id', ext.id);\n      if (error) throw error;\n\n      if (newStatus) {\n        await activateExtensionRegistry(ext.id);\n        await syncExtensionToRegistry(ext.id, ext.config);\n      } else {\n        await deactivateExtensionRegistry(ext.id);\n      }\n\n      toast({ title: newStatus ? t('extensions.activate') : t('extensions.deactivate'), description: `${ext.name} is now ${newStatus ? 'active' : 'inactive'}.` });\n      setExtensions(extensions.map(e => e.id === ext.id ? { ...e, is_active: newStatus } : e));\n\n    } catch (error) {\n      toast({ variant: \"destructive\", title: t('common.error'), description: error.message });\n    }\n  };\n\n  const handleDelete = async (ext) => {\n    // Allow platform admin or the specific Owner to delete\n    const isOwner = user?.id === ext.created_by;\n\n    if (!isSuperAdmin && !isOwner) {\n      toast({ variant: \"destructive\", title: t('common.access_denied'), description: \"You can only delete extensions you created.\" });\n      return;\n    }\n\n    if (!window.confirm(t('extensions.delete_confirm'))) return;\n\n    try {\n      // Soft delete\n      await supabase.from('extensions').update({ deleted_at: new Date().toISOString() }).eq('id', ext.id);\n      await deactivateExtensionRegistry(ext.id);\n\n      toast({ title: t('common.success'), description: \"Extension deleted\" });\n      fetchExtensions();\n    } catch (e) {\n      toast({ variant: \"destructive\", title: t('common.error'), description: e.message });\n    }\n  };\n\n  const filteredExtensions = extensions.filter(ext =>\n    ext.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    ext.description?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  if (!canView) return (\n    <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-card rounded-xl border border-border p-12 text-center\">\n      <div className=\"p-4 bg-destructive/10 rounded-full mb-4\">\n        <AlertCircle className=\"w-12 h-12 text-destructive\" />\n      </div>\n      <h3 className=\"text-xl font-bold text-foreground\">{t('common.access_denied')}</h3>\n      <p className=\"text-muted-foreground mt-2\">{t('common.permission_required')}</p>\n    </div>\n  );\n\n  if (showGuide) return <ExtensionGuide onBack={() => setShowGuide(false)} />;\n  if (editingExtension) return <ExtensionEditor extension={editingExtension} onClose={() => setEditingExtension(null)} onSave={() => { setEditingExtension(null); fetchExtensions(); }} />;\n\n  const breadcrumbs = [\n    { label: t('extensions.title'), icon: Puzzle }\n  ];\n\n  const headerActions = (\n    <div className=\"flex gap-2\">\n      <Button variant=\"outline\" onClick={() => setShowGuide(true)}>\n        <BookOpen className=\"w-4 h-4 mr-2\" />\n        {t('extensions.guide')}\n      </Button>\n      {canCreate && (\n        <Button onClick={() => setActiveTab('install')}>\n          <Upload className=\"w-4 h-4 mr-2\" />\n          {t('extensions.install')}\n        </Button>\n      )}\n    </div>\n  );\n\n  return (\n    <AdminPageLayout>\n      <PageHeader\n        title={t('extensions.title')}\n        description={t('extensions.subtitle')}\n        breadcrumbs={breadcrumbs}\n        actions={headerActions}\n      />\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"bg-muted p-1 rounded-lg overflow-x-auto flex-wrap h-auto w-full justify-start\">\n          <TabsTrigger value=\"installed\">{t('extensions.installed')} ({extensions.length})</TabsTrigger>\n          {canCreate && <TabsTrigger value=\"install\">{t('extensions.install')}</TabsTrigger>}\n          <TabsTrigger value=\"marketplace\">{t('extensions.marketplace')}</TabsTrigger>\n          {canManageGlobal && <TabsTrigger value=\"settings\">{t('extensions.settings')}</TabsTrigger>}\n          {canManageGlobal && <TabsTrigger value=\"health\">{t('extensions.health')}</TabsTrigger>}\n          {canManageGlobal && <TabsTrigger value=\"logs\">{t('extensions.logs')}</TabsTrigger>}\n          {canManageGlobal && <TabsTrigger value=\"rbac\" className=\"flex gap-2\"><Shield className=\"w-4 h-4\" /> {t('extensions.abac')}</TabsTrigger>}\n        </TabsList>\n\n        <TabsContent value=\"installed\" className=\"space-y-4 mt-4\">\n          <div className=\"bg-card p-4 rounded-xl border border-border shadow-sm\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\n              <Input placeholder={t('common.search')} value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className=\"pl-9 bg-background border-input\" />\n            </div>\n          </div>\n\n          {loading ? (\n            <div className=\"text-center py-12 text-muted-foreground\">{t('common.loading')}</div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6\">\n              {filteredExtensions.map((ext) => {\n                const isOwner = user?.id === ext.created_by;\n                const canManageThis = isSuperAdmin || isOwner;\n\n                return (\n                  <div key={ext.id} className={`bg-card rounded-xl border shadow-sm flex flex-col ${ext.is_active ? 'border-primary/20 ring-1 ring-primary/10' : 'border-border'}`}>\n                    <div className=\"p-5 flex-1\">\n                      <div className=\"flex justify-between items-start mb-4\">\n                        <div className=\"w-10 h-10 bg-muted rounded-lg flex items-center justify-center text-xl text-foreground\">{ext.icon || <Puzzle />}</div>\n                        <Badge variant={ext.is_active ? \"default\" : \"secondary\"}>{ext.is_active ? t('extensions.status_active') : t('extensions.status_inactive')}</Badge>\n                      </div>\n                      <h3 className=\"text-lg font-bold text-foreground mb-1\">{ext.name}</h3>\n                      <p className=\"text-sm text-muted-foreground line-clamp-2 mb-3\">{ext.description}</p>\n                      <div className=\"flex flex-wrap gap-1\">\n                        {ext.config?.routes?.length > 0 && <span className=\"text-[10px] bg-muted px-1 rounded text-muted-foreground\">{ext.config.routes.length} Routes</span>}\n                        {ext.config?.menus?.length > 0 && <span className=\"text-[10px] bg-muted px-1 rounded text-muted-foreground\">{ext.config.menus.length} Menus</span>}\n                      </div>\n                      {isOwner && <span className=\"mt-2 inline-block text-[10px] text-primary bg-primary/10 px-2 py-0.5 rounded-full font-medium border border-primary/20\">Your Extension</span>}\n                    </div>\n\n                    <div className=\"p-4 border-t border-border bg-muted/20 rounded-b-xl flex justify-between items-center\">\n                      <div className=\"flex gap-1\">\n                        {canManageThis && (\n                          <Button variant=\"ghost\" size=\"sm\" onClick={() => setEditingExtension(ext)} title={t('extensions.configure')} className=\"text-muted-foreground hover:text-foreground\"><Settings className=\"w-4 h-4\" /></Button>\n                        )}\n                        {canManageGlobal && (\n                          <Button variant=\"ghost\" size=\"sm\" onClick={() => { setSelectedForRBAC(ext); setActiveTab('rbac'); }} title={t('extensions.permissions')} className=\"text-muted-foreground hover:text-foreground\"><Shield className=\"w-4 h-4\" /></Button>\n                        )}\n                        {canManageThis && (\n                          <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDelete(ext)} className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"><Trash2 className=\"w-4 h-4\" /></Button>\n                        )}\n                      </div>\n\n                      {isSuperAdmin && (\n                        <Button size=\"sm\" variant={ext.is_active ? \"outline\" : \"default\"} onClick={() => handleToggleStatus(ext)}>\n                          <Power className=\"w-3 h-3 mr-2\" /> {ext.is_active ? t('extensions.deactivate') : t('extensions.activate')}\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </TabsContent>\n\n        {canCreate && (\n          <TabsContent value=\"install\">\n            <div className=\"mt-8\">\n              <ExtensionInstaller onInstallComplete={() => { setActiveTab('installed'); fetchExtensions(); }} />\n            </div>\n          </TabsContent>\n        )}\n\n        <TabsContent value=\"marketplace\"><ExtensionMarketplace onInstall={() => { setActiveTab('installed'); fetchExtensions(); }} /></TabsContent>\n\n        {canManageGlobal && (\n          <>\n            <TabsContent value=\"settings\"><ExtensionSettings /></TabsContent>\n            <TabsContent value=\"health\"><ExtensionHealthCheck /></TabsContent>\n            <TabsContent value=\"logs\"><ExtensionLogs /></TabsContent>\n            <TabsContent value=\"rbac\">\n              {selectedForRBAC ? (\n                <div className=\"space-y-4\">\n                  <Button variant=\"outline\" onClick={() => setSelectedForRBAC(null)} className=\"mb-4\">{t('common.back')}</Button>\n                  <h3 className=\"text-xl font-bold\">Managing RBAC for {selectedForRBAC.name}</h3>\n                  <ExtensionABACIntegration extensionId={selectedForRBAC.id} />\n                </div>\n              ) : (\n                <div className=\"text-center py-12 border border-dashed border-border rounded-xl\">\n                  <Shield className=\"w-12 h-12 mx-auto text-muted-foreground mb-3\" />\n                  <h3 className=\"text-lg font-medium text-foreground\">{t('extensions.select_extension')}</h3>\n                  <p className=\"text-muted-foreground\">Go to the &quot;Installed&quot; tab and click the Shield icon on an extension card.</p>\n                </div>\n              )}\n            </TabsContent>\n          </>\n        )}\n      </Tabs>\n    </AdminPageLayout>\n  );\n}\n\nexport default ExtensionsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/FilesManager.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/FunFactsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Trophy } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction FunFactsManager() {\n    const columns = [\n        { key: 'title', label: 'Title' },\n        { key: 'count', label: 'Count' },\n        {\n            key: 'icon',\n            label: 'Icon',\n            render: (value) => value ? <i className={value}></i> : '-'\n        },\n        { key: 'order', label: 'Order', type: 'number' },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'published' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'draft' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n                        'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'draft'}\n                </span>\n            )\n        }\n    ];\n\n    const formFields = [\n        { key: 'title', label: 'Title', required: true },\n        { key: 'count', label: 'Count Display (e.g. 500+)', required: true },\n        { key: 'icon', label: 'Icon Class (e.g. ti-user)', description: 'Themify icon class' },\n        { key: 'order', label: 'Sort Order', type: 'number', defaultValue: 0 },\n        {\n            key: 'status',\n            label: 'Status',\n            type: 'select',\n            options: [\n                { value: 'draft', label: 'Draft' },\n                { value: 'published', label: 'Published' },\n                { value: 'archived', label: 'Archived' }\n            ]\n        }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.funfacts.read\">\n            <PageHeader\n                title=\"Fun Facts\"\n                description=\"Manage statistics and key numbers displayed on your site.\"\n                icon={Trophy}\n                breadcrumbs={[{ label: 'Fun Facts', icon: Trophy }]}\n            />\n\n            <GenericContentManager\n                tableName=\"funfacts\"\n                resourceName=\"Fun Fact\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"funfacts\"\n                showBreadcrumbs={false}\n                defaultSortColumn=\"order\"\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default FunFactsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/GenericContentManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchItems'. Either include it or remove the dependency array.","line":165,"column":8,"nodeType":"ArrayExpression","endLine":165,"endColumn":101,"suggestions":[{"desc":"Update the dependencies array to be: [currentPage, itemsPerPage, debouncedQuery, canView, showTrash, tableName, currentTenant.id, fetchItems]","fix":{"range":[6264,6357],"text":"[currentPage, itemsPerPage, debouncedQuery, canView, showTrash, tableName, currentTenant.id, fetchItems]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport ContentTable from '@/components/dashboard/ContentTable';\nimport GenericResourceEditor from '@/components/dashboard/GenericResourceEditor';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useToast } from '@/components/ui/use-toast';\nimport { udm } from '@/lib/data/UnifiedDataManager'; // Changed from supabase\nimport { Button } from '@/components/ui/button';\nimport { Plus, Trash2, RefreshCw, RotateCcw, ShieldAlert, User, Home, ChevronRight } from 'lucide-react';\nimport MinCharSearchInput from '@/components/common/MinCharSearchInput';\nimport { useSearch } from '@/hooks/useSearch';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { Link } from 'react-router-dom';\nimport { useTenant } from '@/contexts/TenantContext';\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\n\nconst GenericContentManager = ({\n    tableName,\n    resourceName,\n    columns,\n    formFields,\n    permissionPrefix,\n    customSelect, // Allow overriding the default select query\n    defaultFilters = {}, // Allow filtering by default (e.g., { type: 'blogs' })\n    customRowActions, // Allow injecting custom action buttons\n    viewPermission,\n    createPermission,\n    restorePermission,\n    showBreadcrumbs = true,\n    defaultSortColumn = 'created_at',\n    EditorComponent, // Optional custom editor component\n    customToolbarActions, // ({ openEditor }) => ReactNode\n    omitCreatedBy = false\n}) => {\n    const { t } = useTranslation();\n    const { toast } = useToast();\n    const { user } = useAuth();\n    const { hasPermission, checkAccess, isPlatformAdmin } = usePermissions();\n    const { currentTenant } = useTenant();\n\n    const [items, setItems] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [showEditor, setShowEditor] = useState(false);\n    const [selectedItem, setSelectedItem] = useState(null);\n    const [showTrash, setShowTrash] = useState(false);\n\n    // Integrated useSearch hook\n    const {\n        query,\n        setQuery,\n        debouncedQuery,\n        isValid: isSearchValid,\n        message: searchMessage,\n        loading: searchLoading,\n        minLength,\n        clearSearch\n    } = useSearch({\n        minLength: 5, // Standardized 5 char limit\n        initialQuery: ''\n    });\n\n    const [totalItems, setTotalItems] = useState(0);\n    const [currentPage, setCurrentPage] = useState(1);\n    const [itemsPerPage, setItemsPerPage] = useState(10);\n\n    // Delete confirmation state\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n    const [itemToDelete, setItemToDelete] = useState(null);\n\n    // Permanent Delete state\n    const [permDeleteDialogOpen, setPermDeleteDialogOpen] = useState(false);\n    const [itemToPermDelete, setItemToPermDelete] = useState(null);\n\n    // Computed Permissions - Using frontend pattern (tenant.module.*)\n    const canView = viewPermission\n        ? hasPermission(viewPermission)\n        : hasPermission(`tenant.${permissionPrefix}.read`);\n    const canCreate = createPermission\n        ? hasPermission(createPermission)\n        : hasPermission(`tenant.${permissionPrefix}.create`);\n    const canRestore = restorePermission\n        ? hasPermission(restorePermission)\n        : hasPermission(`tenant.${permissionPrefix}.restore`);\n    const canPermDelete = hasPermission(`tenant.${permissionPrefix}.delete_permanent`);\n    const softDeleteEnabled = true;\n\n    const fetchItems = async () => {\n        if (!canView) return;\n\n        // Wait for tenant context to resolve, unless we are in a special global mode (future proofing)\n        if (!currentTenant?.id && !isPlatformAdmin) return;\n\n        setLoading(true);\n        try {\n            // Updated default select query to use valid PostgREST syntax for embedding 'users' via 'created_by' column.\n            const selectQuery = customSelect || '*, owner:users!created_by(email, full_name), tenant:tenants(name)';\n\n            // UnifiedDataManager Integration\n            let q = udm.from(tableName)\n                .select(selectQuery, { count: 'exact' });\n\n            // STRICT TENANT FILTERING\n            if (currentTenant?.id) {\n                q = q.eq('tenant_id', currentTenant.id);\n            } else if (isPlatformAdmin) {\n                // Platform admin view (no tenant selected) logic could go here\n                console.log('Platform Admin View: showing all records (careful)');\n            } else {\n                setItems([]);\n                setLoading(false);\n                return;\n            }\n\n            if (softDeleteEnabled) {\n                if (showTrash) {\n                    q = q.not('deleted_at', 'is', null);\n                } else {\n                    q = q.is('deleted_at', null);\n                }\n            }\n\n            // Apply default filters (e.g., { type: 'blogs' } for categories)\n            if (defaultFilters && Object.keys(defaultFilters).length > 0) {\n                Object.entries(defaultFilters).forEach(([key, value]) => {\n                    q = q.eq(key, value);\n                });\n            }\n\n            if (debouncedQuery) {\n                const searchCol = columns.find(c => c.key === 'title' || c.key === 'name')?.key || 'id';\n                q = q.ilike(searchCol, `%${debouncedQuery}%`);\n            }\n\n            const from = (currentPage - 1) * itemsPerPage;\n            const to = from + itemsPerPage - 1;\n\n            const { data, count, error } = await q\n                .range(from, to)\n                .order(defaultSortColumn, { ascending: false });\n\n            if (error) throw error;\n\n            setItems(data || []);\n            setTotalItems(count || 0);\n        } catch (err) {\n            console.error(err);\n            toast({ variant: 'destructive', title: 'Error', description: `Failed to load ${resourceName}s` });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    useEffect(() => {\n        fetchItems();\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [currentPage, itemsPerPage, debouncedQuery, canView, showTrash, tableName, currentTenant?.id]);\n\n    const handleEdit = (item) => {\n        if (!checkAccess('update', permissionPrefix, item)) {\n            toast({ variant: 'destructive', title: 'Access Denied', description: 'You can only edit your own content.' });\n            return;\n        }\n        setSelectedItem(item);\n        setShowEditor(true);\n    };\n\n    // Show delete confirmation dialog\n    const handleDelete = (id, item) => {\n        if (!checkAccess('soft_delete', permissionPrefix, item)) {\n            toast({ variant: 'destructive', title: 'Access Denied', description: 'You do not have permission to delete this content.' });\n            return;\n        }\n        setItemToDelete({ id, item });\n        setDeleteDialogOpen(true);\n    };\n\n    // Perform actual delete after confirmation\n    const confirmDelete = async () => {\n        if (!itemToDelete) return;\n\n        try {\n            const deletedAt = new Date().toISOString();\n\n            const { error } = await udm.from(tableName)\n                .update({ deleted_at: deletedAt })\n                .eq('id', itemToDelete.id);\n\n            if (error) throw error;\n            toast({ title: 'Success', description: `${resourceName} moved to trash` });\n\n            fetchItems();\n        } catch (err) {\n            console.error('Delete error:', err);\n            toast({ variant: 'destructive', title: 'Error', description: err.message });\n        } finally {\n            setDeleteDialogOpen(false);\n            setItemToDelete(null);\n        }\n    };\n\n    const handleRestore = async (id) => {\n        try {\n            const { error } = await udm.from(tableName)\n                .update({ deleted_at: null })\n                .eq('id', id);\n\n            if (error) throw error;\n\n            toast({ title: 'Restored', description: `${resourceName} restored from trash.` });\n            fetchItems();\n        } catch (err) {\n            console.error('Restore error:', err);\n            toast({ variant: 'destructive', title: 'Error', description: err.message });\n        }\n    };\n\n    const handlePermDelete = (item) => {\n        if (!checkAccess('delete_permanent', permissionPrefix)) {\n            toast({ variant: 'destructive', title: 'Access Denied', description: 'You generally do not have permission to permanently delete content.' });\n            return;\n        }\n        setItemToPermDelete(item);\n        setPermDeleteDialogOpen(true);\n    };\n\n    const confirmPermDelete = async () => {\n        if (!itemToPermDelete) return;\n\n        try {\n            const { error } = await udm.from(tableName)\n                .delete({ force: true })\n                .eq('id', itemToPermDelete.id);\n\n            if (error) throw error;\n            toast({ title: 'Permanently Deleted', description: `${resourceName} has been permanently removed.` });\n\n            fetchItems();\n        } catch (err) {\n            console.error('Permanent Delete error:', err);\n            toast({ variant: 'destructive', title: 'Error', description: err.message });\n        } finally {\n            setPermDeleteDialogOpen(false);\n            setItemToPermDelete(null);\n        }\n    };\n\n\n    if (!canView) return (\n        <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-card rounded-xl border border-border p-12 text-center\">\n            <div className=\"p-4 bg-destructive/10 rounded-full mb-4\">\n                <ShieldAlert className=\"w-12 h-12 text-destructive\" />\n            </div>\n            <h3 className=\"text-xl font-bold text-foreground\">{t('common.access_denied')}</h3>\n            <p className=\"text-muted-foreground mt-2\">{t('common.permission_required_resource', { resource: resourceName })}</p>\n        </div>\n    );\n\n    // Enhance columns with Owner info if available\n    const displayColumns = [\n        ...columns,\n        {\n            key: 'owner',\n            label: t('common.owner'),\n            render: (_, row) => (\n                <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                    <User className=\"w-3 h-3 text-muted-foreground\" />\n                    <span>{row.owner?.full_name || row.owner?.email || t('common.system')}</span>\n                    {user?.id === row.created_by && <span className=\"bg-primary/10 text-primary px-1.5 rounded-full text-[10px] font-bold\">{t('common.you')}</span>}\n                </div>\n            )\n        }\n    ];\n\n    // Added Tenant Column for platform admins\n\n    if (isPlatformAdmin) {\n        displayColumns.unshift({\n            key: 'tenant_id',\n            label: 'Nama Tenant',\n            render: (_, row) => (\n                <span className=\"text-xs font-medium text-muted-foreground bg-secondary px-2 py-0.5 rounded\">\n                    {row.tenant?.name || '(Unknown Tenant)'}\n                </span>\n            )\n        });\n    }\n\n    const handleManualRefresh = async () => {\n        await fetchItems();\n        toast({ title: 'Refreshed', description: `Latest ${resourceName.toLowerCase()}s loaded.` });\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            {showEditor ? (\n                EditorComponent ? (\n                    <EditorComponent\n                        item={selectedItem}\n                        onClose={() => { setShowEditor(false); setSelectedItem(null); }}\n                        onSuccess={fetchItems}\n                    />\n                ) : (\n                    <GenericResourceEditor\n                        tableName={tableName}\n                        resourceName={resourceName}\n                        fields={formFields}\n                        initialData={selectedItem}\n                        permissionPrefix={permissionPrefix}\n                        onClose={() => { setShowEditor(false); setSelectedItem(null); }}\n                        onSuccess={fetchItems}\n                        createPermission={createPermission}\n                        omitCreatedBy={omitCreatedBy}\n                    />\n                )\n            ) : (\n                <>\n\n                    {/* Enhanced Breadcrumb Navigation */}\n                    {showBreadcrumbs && (\n                        <nav className=\"mb-6\">\n                            <ol className=\"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\">\n                                <li className=\"inline-flex items-center gap-1.5\">\n                                    <Link to=\"/cmspanel\" className=\"transition-colors hover:text-foreground flex items-center gap-1\">\n                                        <Home className=\"w-4 h-4\" />\n                                        {t('menu.dashboard')}\n                                    </Link>\n                                </li>\n                                <li aria-hidden=\"true\" className=\"[&>svg]:size-3.5\"><ChevronRight /></li>\n\n                                <li className=\"inline-flex items-center gap-1.5\">\n                                    <div\n                                        className={`flex items-center gap-1.5 px-3 py-1 rounded-full font-medium transition-colors ${showTrash\n                                            ? 'bg-muted text-muted-foreground cursor-pointer hover:bg-muted/80'\n                                            : 'bg-primary text-primary-foreground shadow-sm'\n                                            }`}\n                                        onClick={showTrash ? () => setShowTrash(false) : undefined}\n                                    >\n                                        <span>{resourceName}s</span>\n                                    </div>\n                                </li>\n\n                                {showTrash && (\n                                    <>\n                                        <li aria-hidden=\"true\" className=\"[&>svg]:size-3.5\"><ChevronRight /></li>\n                                        <li className=\"inline-flex items-center gap-1.5\">\n                                            <div className=\"flex items-center gap-1.5 px-3 py-1 rounded-full bg-destructive text-destructive-foreground font-medium shadow-sm\">\n                                                <Trash2 className=\"w-3.5 h-3.5\" />\n                                                <span>{t('common.trash')}</span>\n                                            </div>\n                                        </li>\n                                    </>\n                                )}\n                            </ol>\n                        </nav>\n                    )}\n                    <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n                        <div>\n                            <h2 className=\"text-3xl font-bold tracking-tight text-foreground flex items-center gap-2\">\n                                {resourceName}s\n                                {showTrash && <span className=\"text-lg font-normal text-destructive bg-destructive/10 px-2 py-0.5 rounded-md\">{t('common.trash_bin')}</span>}\n                            </h2>\n                            <p className=\"text-muted-foreground\">{t('common.manage_resource', { resource: resourceName.toLowerCase() })}</p>\n                        </div>\n                        <div className=\"flex gap-2\">\n                            {softDeleteEnabled && (\n                                <Button\n                                    variant={showTrash ? \"destructive\" : \"outline\"}\n                                    onClick={() => { setShowTrash(!showTrash); setCurrentPage(1); }}\n                                    className={showTrash ? \"bg-destructive hover:bg-destructive/90\" : \"\"}\n                                >\n                                    {showTrash ? <RotateCcw className=\"w-4 h-4 mr-2\" /> : <Trash2 className=\"w-4 h-4 mr-2\" />}\n                                    {showTrash ? t('common.back_to_active') : t('common.trash')}\n                                </Button>\n                            )}\n\n                            {/* Custom Toolbar Actions */}\n                            {customToolbarActions && customToolbarActions({\n                                openEditor: (data = null) => { setSelectedItem(data); setShowEditor(true); }\n                            })}\n\n                            {canCreate && !showTrash && (\n                                <Button onClick={() => { setSelectedItem(null); setShowEditor(true); }} className=\"bg-primary text-primary-foreground hover:bg-primary/90\">\n                                    <Plus className=\"w-4 h-4 mr-2\" /> {t('common.create_resource', { resource: resourceName })}\n                                </Button>\n                            )}\n                        </div>\n                    </div>\n\n                    <div className=\"bg-card p-4 rounded-xl border border-border shadow-sm flex items-center gap-2\">\n                        <div className=\"flex-1 max-w-sm\">\n                            <MinCharSearchInput\n                                value={query}\n                                onChange={e => setQuery(e.target.value)}\n                                onClear={clearSearch}\n                                loading={loading || searchLoading}\n                                isValid={isSearchValid}\n                                message={searchMessage}\n                                minLength={minLength}\n                                placeholder={t('common.search_resource', { resource: resourceName })}\n                            />\n                        </div>\n                        <div className=\"flex-1\"></div>\n                        <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={handleManualRefresh}\n                            disabled={loading}\n                            title={t('common.refresh')}\n                            className=\"text-muted-foreground hover:text-foreground disabled:opacity-50\"\n                        >\n                            <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n                        </Button>\n                    </div>\n\n                    <ContentTable\n                        data={items}\n                        columns={displayColumns}\n                        loading={loading}\n                        // Dynamically check permissions for each row\n                        onEdit={!showTrash ? (item) => {\n                            if (checkAccess('update', permissionPrefix, item)) handleEdit(item);\n                            else toast({ variant: 'destructive', title: 'Access Denied', description: 'You can only edit your own content.' });\n                        } : null}\n\n                        onDelete={!showTrash ? (item) => handleDelete(item.id, item) : null}\n\n                        extraActions={(item) => (\n                            <div className=\"flex gap-1\" onClick={(e) => e.stopPropagation()}>\n                                {customRowActions && customRowActions(item, {\n                                    openEditor: (data) => { setSelectedItem(data || item); setShowEditor(true); }\n                                })}\n                                {showTrash && (\n                                    <>\n                                        {canRestore && (\n                                            <Button size=\"icon\" variant=\"ghost\" onClick={() => handleRestore(item.id)} className=\"text-green-600 hover:bg-green-50\" title={t('common.restore')}>\n                                                <RotateCcw className=\"w-4 h-4\" />\n                                            </Button>\n                                        )}\n                                        {canPermDelete && (\n                                            <Button size=\"icon\" variant=\"ghost\" onClick={() => handlePermDelete(item)} className=\"text-red-700 hover:bg-red-100\" title=\"Permanently Delete\">\n                                                <div className=\"relative\">\n                                                    <Trash2 className=\"w-4 h-4\" />\n                                                    <span className=\"absolute -top-1 -right-1 text-[10px] font-bold\"></span>\n                                                </div>\n                                            </Button>\n                                        )}\n                                    </>\n                                )}\n                            </div>\n                        )}\n\n                        pagination={{\n                            currentPage,\n                            totalPages: Math.ceil(totalItems / itemsPerPage),\n                            totalItems,\n                            itemsPerPage,\n                            onPageChange: setCurrentPage,\n                            onLimitChange: setItemsPerPage\n                        }}\n                    />\n                </>\n            )\n            }\n\n            {/* Delete Confirmation Dialog */}\n            <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>{t('common.move_to_trash')}</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            {t('common.move_to_trash_confirm', { resource: resourceName.toLowerCase() })}\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel onClick={() => setItemToDelete(null)}>{t('common.cancel')}</AlertDialogCancel>\n                        <AlertDialogAction onClick={confirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n                            {t('common.delete')}\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n\n            {/* Permanent Delete Confirmation Dialog */}\n            <AlertDialog open={permDeleteDialogOpen} onOpenChange={setPermDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle className=\"text-destructive\">Permanently Delete?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            This action cannot be undone. This will permanently delete the <strong>{resourceName}</strong> from the database.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel onClick={() => setItemToPermDelete(null)}>{t('common.cancel')}</AlertDialogCancel>\n                        <AlertDialogAction onClick={confirmPermDelete} className=\"bg-destructive hover:bg-destructive/90\">\n                            Delete Permanently\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n\n        </div >\n    );\n};\n\nexport default GenericContentManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/GenericResourceEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'permissionPrefix' is defined but never used.","line":37,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"permissionPrefix"},"fix":{"range":[1366,1388],"text":""},"desc":"Remove unused variable 'permissionPrefix'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'createPermission' is defined but never used.","line":38,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"createPermission"},"fix":{"range":[1388,1410],"text":""},"desc":"Remove unused variable 'createPermission'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'owner' is assigned a value but never used.","line":71,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"owner"},"fix":{"range":[2453,2459],"text":""},"desc":"Remove unused variable 'owner'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tenant' is assigned a value but never used.","line":71,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"tenant"},"fix":{"range":[2458,2466],"text":""},"desc":"Remove unused variable 'tenant'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'category' is assigned a value but never used.","line":71,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"category"},"fix":{"range":[2466,2476],"text":""},"desc":"Remove unused variable 'category'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/components/ui/use-toast';\nimport { udm } from '@/lib/data/UnifiedDataManager';\nimport { supabase } from '@/lib/customSupabaseClient'; // Keep for slug check if needed, or use udm\nimport { ArrowLeft, Loader2, Lock } from 'lucide-react';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue\n} from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport SlugGenerator from '@/components/dashboard/slug/SlugGenerator';\nimport { ImageUpload } from '@/components/ui/ImageUpload';\nimport { MultiImageUpload } from '@/components/ui/MultiImageUpload';\nimport RichTextEditor from '@/components/ui/RichTextEditor';\nimport TagInput from '@/components/ui/TagInput';\nimport ResourceSelect from '@/components/dashboard/ResourceSelect'; // Assuming this exists or works\n// Missing imports fixed\n// ...\n\nconst GenericResourceEditor = ({\n    tableName,\n    resourceName,\n    fields,\n    initialData,\n    onClose,\n    onSuccess,\n    permissionPrefix,\n    createPermission,\n    omitCreatedBy = false\n}) => {\n    const { user } = useAuth();\n    const { toast } = useToast();\n    const { currentTenant } = useTenant(); // Get Current Tenant\n    const [loading, setLoading] = useState(false);\n    const [formData, setFormData] = useState(() => {\n        if (initialData) return initialData;\n\n        // Calculate defaults\n        const defaults = {};\n        if (fields) {\n            fields.forEach(f => {\n                if (f.defaultValue !== undefined) defaults[f.key] = f.defaultValue;\n            });\n        }\n        return defaults;\n    });\n\n    // Initialize form data\n    useEffect(() => {\n        if (initialData) {\n            setFormData(initialData);\n        }\n    }, [initialData]); // Removed fields from dependency to prevent reset if fields config reference changes\n\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        setLoading(true);\n        try {\n            // Remove joined relationship objects that shouldn't be sent to the DB using destructuring\n            const { owner, tenant, category, ...cleanPayload } = formData;\n            const payload = { ...cleanPayload };\n\n            // ... slug logic\n\n            // Auto fields\n            payload.updated_at = new Date().toISOString();\n            if (!initialData) {\n                if (!omitCreatedBy) {\n                    payload.created_by = user.id;\n                }\n\n                // CRITICAL: Inject Tenant ID for new records\n                if (currentTenant?.id) {\n                    payload.tenant_id = currentTenant.id;\n                } else {\n                    throw new Error(\"Critical Error: No Tenant Context found. Cannot create record.\");\n                }\n            }\n\n            // Handle tags only if there's a tags field defined\n            const hasTagsField = fields.some(f => f.key === 'tags' || f.type === 'tags');\n            if (hasTagsField) {\n                if (Array.isArray(payload.tags)) {\n                    // Already an array, keep as is\n                } else if (typeof payload.tags === 'string' && payload.tags.trim()) {\n                    payload.tags = payload.tags.split(',').map(t => t.trim()).filter(Boolean);\n                } else {\n                    // Empty or undefined - set to empty array\n                    payload.tags = [];\n                }\n            } else {\n                // Remove tags from payload if field doesn't exist in form\n                delete payload.tags;\n            }\n\n            // Clean up empty date fields - convert \"\" to null for database\n            fields.forEach(field => {\n                if ((field.type === 'date' || field.key.includes('_at') || field.key.includes('_date')) && payload[field.key] === '') {\n                    payload[field.key] = null;\n                }\n                // Also convert empty strings for relation fields to null\n                if ((field.type === 'relation' || field.type === 'resource_select') && !payload[field.key]) {\n                    payload[field.key] = null;\n                }\n                // Handle boolean fields - ensure they are true/false, not empty string\n                if (field.type === 'boolean' || field.type === 'checkbox') {\n                    payload[field.key] = Boolean(payload[field.key]);\n                }\n            });\n\n            // Check for slug uniqueness before save (for tables that have slug)\n            if (payload.slug && fields.find(f => f.key === 'slug')) {\n                let slugCheckQuery = supabase\n                    .from(tableName)\n                    .select('id, slug')\n                    .eq('slug', payload.slug)\n                    .is('deleted_at', null);\n\n                // If editing, exclude current item from check\n                if (initialData?.id) {\n                    slugCheckQuery = slugCheckQuery.neq('id', initialData.id);\n                }\n\n                const { data: existingSlugs } = await slugCheckQuery.limit(1);\n\n                if (existingSlugs && existingSlugs.length > 0) {\n                    // Generate a unique slug by appending timestamp\n                    const uniqueSuffix = Date.now().toString(36);\n                    const suggestedSlug = `${payload.slug}-${uniqueSuffix}`;\n                    throw new Error(\n                        `Slug \"${payload.slug}\" already exists. Try using \"${suggestedSlug}\" or choose a different slug.`\n                    );\n                }\n            }\n\n\n            let error;\n            if (initialData) {\n                const { error: updateError } = await udm\n                    .from(tableName)\n                    .update(payload)\n                    .eq('id', initialData.id);\n                error = updateError;\n            } else {\n                const { error: insertError } = await udm\n                    .from(tableName)\n                    .insert([payload]);\n                error = insertError;\n            }\n\n            if (error) {\n                // Provide friendlier error messages for common constraints\n                if (error.message.includes('duplicate key') && error.message.includes('slug')) {\n                    throw new Error(`Slug \"${payload.slug}\" is already in use. Please use a different slug.`);\n                }\n                throw error;\n            }\n\n            toast({ title: 'Success', description: `${resourceName} saved successfully` });\n            onSuccess();\n            onClose();\n\n        } catch (err) {\n            console.error(err);\n            toast({ variant: 'destructive', title: 'Error', description: err.message });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    // Helper function to generate slug\n    const generateSlug = (text) => {\n        return text\n            .toLowerCase()\n            .trim()\n            .replace(/[^a-z0-9\\s-]/g, '') // Remove special chars except spaces and hyphens\n            .replace(/\\s+/g, '-')          // Replace spaces with hyphens\n            .replace(/-+/g, '-')           // Replace multiple hyphens with single hyphen\n            .replace(/^-|-$/g, '');        // Trim hyphens from start/end\n    };\n\n    const handleChange = (key, value) => {\n        setFormData(prev => {\n            const updated = { ...prev, [key]: value };\n\n            // Auto-generate slug when title or name changes\n            const hasSlugField = fields.some(f => f.key === 'slug');\n            if (hasSlugField && (key === 'title' || key === 'name')) {\n                // Auto-generate if slug is empty or matches previous auto-generated slug\n                const oldSlug = prev.slug || '';\n                const oldTitle = prev.title || prev.name || '';\n                const wasAutoGenerated = !oldSlug || oldSlug === generateSlug(oldTitle);\n\n                if (wasAutoGenerated) {\n                    updated.slug = generateSlug(value);\n                }\n            }\n\n            // Handle calculated fields\n            fields.forEach(field => {\n                if (field.calculate && typeof field.calculate === 'function') {\n                    // Pass the updated data to the calculation function\n                    const calculatedValue = field.calculate(updated);\n                    // Only update if the value actually changed to avoid unnecessary renders\n                    if (calculatedValue !== updated[field.key]) {\n                        updated[field.key] = calculatedValue;\n                    }\n                }\n            });\n\n            return updated;\n        });\n    };\n\n    return (\n        <div className=\"bg-card rounded-xl border border-border shadow-sm p-6 max-w-3xl mx-auto\">\n            <div className=\"flex items-center justify-between mb-6 pb-4 border-b border-border\">\n                <div className=\"flex items-center gap-4\">\n                    <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"hover:bg-muted text-muted-foreground hover:text-foreground\">\n                        <ArrowLeft className=\"w-4 h-4\" />\n                    </Button>\n                    <div>\n                        <h2 className=\"text-xl font-bold text-foreground\">\n                            {initialData ? `Edit ${resourceName}` : `Create New ${resourceName}`}\n                        </h2>\n                        {initialData && (\n                            <p className=\"text-xs text-muted-foreground mt-1 flex items-center gap-1\">\n                                <Lock className=\"w-3 h-3\" /> Owner: {initialData.owner?.full_name || 'System'}\n                            </p>\n                        )}\n                    </div>\n                </div>\n            </div>\n\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 gap-6\">\n                    {fields.map(field => {\n                        // Handle conditional visibility\n                        if (field.conditionalShow && typeof field.conditionalShow === 'function' && !field.conditionalShow(formData)) {\n                            return null;\n                        }\n\n                        return (\n                            <div key={field.key} className=\"space-y-2\">\n                                <Label>\n                                    {field.label} {field.required && <span className=\"text-red-500\">*</span>}\n                                </Label>\n\n                                {field.type === 'textarea' ? (\n                                    <Textarea\n                                        value={formData[field.key] || ''}\n                                        onChange={e => handleChange(field.key, e.target.value)}\n                                        rows={4}\n                                        required={field.required}\n                                    />\n                                ) : field.type === 'richtext' ? (\n                                    <RichTextEditor\n                                        value={formData[field.key] || ''}\n                                        onChange={val => handleChange(field.key, val)}\n                                        placeholder={field.description || 'Write content...'}\n                                    />\n                                ) : field.type === 'image' ? (\n                                    <ImageUpload\n                                        value={formData[field.key] || ''}\n                                        onChange={url => handleChange(field.key, url)}\n                                        className=\"h-48\"\n                                    />\n                                ) : field.type === 'images' ? (\n                                    <MultiImageUpload\n                                        value={formData[field.key] || []}\n                                        onChange={images => handleChange(field.key, images)}\n                                        maxImages={field.maxImages || 10}\n                                    />\n                                ) : field.type === 'tags' ? (\n                                    <TagInput\n                                        value={Array.isArray(formData[field.key]) ? formData[field.key] : (formData[field.key] || '').split(',').filter(Boolean).map(t => t.trim())}\n                                        onChange={tags => handleChange(field.key, tags)}\n                                        placeholder=\"Add tags...\"\n                                    />\n                                ) : field.type === 'select' ? (\n                                    <Select\n                                        value={formData[field.key] || field.defaultValue || ''}\n                                        onValueChange={val => handleChange(field.key, val)}\n                                        required={field.required}\n                                    >\n                                        <SelectTrigger className=\"w-full\">\n                                            <SelectValue placeholder={field.description || \"Select an option\"} />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            {field.options.map(opt => (\n                                                <SelectItem key={opt.value} value={opt.value}>\n                                                    {opt.label}\n                                                </SelectItem>\n                                            ))}\n                                        </SelectContent>\n                                    </Select>\n                                ) : field.type === 'resource_select' || field.type === 'relation' ? (\n                                    <ResourceSelect\n                                        table={field.resourceTable || field.table}\n                                        labelKey={field.relationLabel || 'name'}\n                                        valueKey={field.relationValue || 'id'}\n                                        value={formData[field.key]}\n                                        onChange={val => handleChange(field.key, val)}\n                                        placeholder={`Select ${field.label}...`}\n                                        filter={field.filter}\n                                    />\n                                ) : field.type === 'boolean' || field.type === 'checkbox' ? (\n                                    <div className=\"flex items-center space-x-2\">\n                                        <Checkbox\n                                            id={field.key}\n                                            checked={!!formData[field.key]}\n                                            onCheckedChange={(checked) => handleChange(field.key, checked)}\n                                        />\n                                        <label\n                                            htmlFor={field.key}\n                                            className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-foreground\"\n                                        >\n                                            {field.placeholder || \"Enable\"}\n                                        </label>\n                                    </div>\n                                ) : field.type === 'date' ? (\n                                    <Input\n                                        type=\"date\"\n                                        value={formData[field.key] ? formData[field.key].substring(0, 10) : ''}\n                                        onChange={e => handleChange(field.key, e.target.value ? new Date(e.target.value).toISOString() : '')}\n                                        required={field.required}\n                                    />\n                                ) : field.type === 'datetime' ? (\n                                    <Input\n                                        type=\"datetime-local\"\n                                        value={formData[field.key] ? new Date(formData[field.key]).toISOString().slice(0, 16) : ''}\n                                        onChange={e => handleChange(field.key, e.target.value ? new Date(e.target.value).toISOString() : null)}\n                                        required={field.required}\n                                        className=\"block\"\n                                    />\n                                ) : field.key === 'slug' ? (\n                                    <SlugGenerator\n                                        initialSlug={formData.slug || ''}\n                                        titleValue={formData.title || formData.name || ''}\n                                        tableName={tableName}\n                                        recordId={initialData?.id}\n                                        onSlugChange={(newSlug) => handleChange('slug', newSlug)}\n                                    />\n                                ) : (\n                                    <Input\n                                        type={field.type || 'text'}\n                                        value={formData[field.key] || ''}\n                                        onChange={e => handleChange(field.key, e.target.value)}\n                                        required={field.required}\n                                        placeholder={field.description}\n                                    />\n                                )}\n                                {field.description && <p className=\"text-[10px] text-muted-foreground\">{field.description}</p>}\n                            </div>\n                        )\n                    })}\n                </div>\n\n                <div className=\"flex justify-end pt-4 border-t border-border\">\n                    <Button type=\"button\" variant=\"outline\" onClick={onClose} className=\"mr-2\">Cancel</Button>\n                    <Button type=\"submit\" disabled={loading} className=\"bg-primary text-primary-foreground hover:bg-primary/90\">\n                        {loading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                        Save {resourceName}\n                    </Button>\n                </div>\n            </form>\n        </div>\n    );\n};\n\nexport default GenericResourceEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/Header.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'onNavigate' is defined but never used.","line":23,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"onNavigate"},"fix":{"range":[918,930],"text":""},"desc":"Remove unused variable 'onNavigate'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { Link } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { Menu, LogOut, User, Building2 } from 'lucide-react';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Button } from '@/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport LanguageSelector from '@/components/ui/LanguageSelector';\nimport { NotificationDropdown } from '@/components/dashboard/notifications/NotificationDropdown';\nimport { DarkModeToggle } from '@/components/ui/DarkModeToggle';\n\nfunction Header({ toggleSidebar, onNavigate }) {\n  const { user, signOut } = useAuth();\n  const { t } = useTranslation();\n  const { isPlatformAdmin } = usePermissions();\n  const { currentTenant } = useTenant();\n\n  const getInitials = (email) => {\n    return email ? email.substring(0, 2).toUpperCase() : 'U';\n  };\n\n  return (\n    <header className=\"sticky top-0 z-[60] bg-background/80 backdrop-blur border-b border-border/70 shadow-sm\">\n      <div className=\"flex items-center justify-between px-6 py-4\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={toggleSidebar}\n            className=\"lg:hidden text-muted-foreground hover:text-foreground\"\n          >\n            <Menu className=\"w-6 h-6\" />\n          </Button>\n          <div className=\"hidden md:block\">\n            {/* Title removed: Handled by individual pages via PageHeader */}\n          </div>\n          {/* Tenant Context Badge for Platform Admins */}\n          {isPlatformAdmin && currentTenant && (\n            <div className=\"hidden lg:flex items-center gap-2 ml-4 px-3 py-1.5 rounded-full bg-primary/10 dark:bg-primary/20 border border-primary/20 dark:border-primary/30\">\n              <Building2 className=\"w-4 h-4 text-primary\" />\n              <span className=\"text-sm font-medium text-primary\">{currentTenant.name || 'Primary Tenant'}</span>\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-2 md:gap-4\">\n          {/* Dark Mode Toggle */}\n          <DarkModeToggle />\n\n          <LanguageSelector />\n\n          {/* Notification Dropdown */}\n          <NotificationDropdown />\n\n          <div className=\"h-8 w-px bg-border mx-1 hidden md:block\"></div>\n\n          <DropdownMenu>\n            <DropdownMenuTrigger className=\"relative h-10 w-10 rounded-full hover:opacity-80 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-opacity flex items-center justify-center\">\n              <Avatar className=\"h-10 w-10 border-2 border-primary/20 hover:border-primary transition-colors ring-2 ring-background shadow-md cursor-pointer\">\n                {(user?.user_metadata?.avatar_url) ? (\n                  <AvatarImage\n                    src={user.user_metadata.avatar_url}\n                    alt=\"Profile\"\n                    className=\"object-cover\"\n                  />\n                ) : (\n                  <AvatarFallback className=\"bg-primary/10 text-primary font-bold\">\n                    {getInitials(user?.email)}\n                  </AvatarFallback>\n                )}\n              </Avatar>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent className=\"w-64 mt-2 p-0 bg-white dark:bg-slate-900/95 backdrop-blur-xl border border-slate-200 dark:border-slate-800 shadow-2xl rounded-xl overflow-hidden z-[100]\" align=\"end\" forceMount>\n              {/* Profile Header Section */}\n              <div className=\"px-6 py-5 bg-muted/30 border-b border-border/50 flex flex-col items-center text-center gap-2\">\n                <Avatar className=\"h-16 w-16 mb-2 border-4 border-background shadow-sm\">\n                  {(user?.user_metadata?.avatar_url) ? (\n                    <AvatarImage src={user.user_metadata.avatar_url} className=\"object-cover\" />\n                  ) : (\n                    <AvatarFallback className=\"text-xl bg-primary/10 text-primary font-bold\">\n                      {getInitials(user?.email)}\n                    </AvatarFallback>\n                  )}\n                </Avatar>\n                <div className=\"space-y-0.5\">\n                  <p className=\"font-semibold text-foreground text-sm truncate max-w-[200px]\">\n                    {user?.email}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground font-medium uppercase tracking-wider\">\n                    {isPlatformAdmin ? 'Platform Admin' : 'Tenant Admin'}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"p-2 space-y-1\">\n                <DropdownMenuLabel className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider px-3 py-2\">\n                  {t('menu.account', 'Account')}\n                </DropdownMenuLabel>\n\n                <DropdownMenuItem asChild className=\"rounded-lg focus:bg-primary/10 focus:text-primary cursor-pointer transition-colors px-3 py-2.5\">\n                  <Link to=\"/cmspanel/profile\" className=\"flex items-center w-full font-medium\">\n                    <User className=\"w-4 h-4 mr-3\" />\n                    {t('menu.profile')}\n                  </Link>\n                </DropdownMenuItem>\n              </div>\n\n              <DropdownMenuSeparator className=\"bg-border/50 my-1 mx-2\" />\n\n              <div className=\"p-2 pb-3\">\n                <DropdownMenuItem\n                  onClick={signOut}\n                  className=\"rounded-lg text-red-600 focus:bg-red-50 dark:focus:bg-red-950/30 focus:text-red-600 cursor-pointer transition-colors px-3 py-2.5 font-medium\"\n                >\n                  <LogOut className=\"w-4 h-4 mr-3\" />\n                  {t('auth.logout')}\n                </DropdownMenuItem>\n              </div>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      </div>\n    </header>\n  );\n}\n\nexport default Header;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/LanguageSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { motion } from 'framer-motion';\nimport { Globe, Check, ShieldAlert } from 'lucide-react';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useToast } from '@/components/ui/use-toast';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { supabase } from '@/lib/customSupabaseClient';\n\nfunction LanguageSettings() {\n  const { t, i18n } = useTranslation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const { hasPermission } = usePermissions();\n\n  const currentLang = i18n.language;\n\n  useEffect(() => {\n    // Add Google Translate Script if not exists\n    if (!document.getElementById('google-translate-script')) {\n      const script = document.createElement('script');\n      script.id = 'google-translate-script';\n      script.src = '//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';\n      document.body.appendChild(script);\n\n      window.googleTranslateElementInit = () => {\n        new window.google.translate.TranslateElement(\n          { pageLanguage: 'en', layout: window.google.translate.TranslateElement.InlineLayout.SIMPLE },\n          'google_translate_element'\n        );\n      };\n    }\n  }, []);\n\n  if (!hasPermission('tenant.languages.read')) {\n    return (\n      <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-white rounded-xl border border-slate-200 p-12 text-center\">\n        <div className=\"p-4 bg-red-50 rounded-full mb-4\">\n          <ShieldAlert className=\"w-12 h-12 text-red-500\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-slate-800\">Access Denied</h3>\n        <p className=\"text-slate-500 mt-2\">You do not have permission to view language settings.</p>\n      </div>\n    );\n  }\n\n  const handleLanguageChange = async (lang) => {\n    i18n.changeLanguage(lang);\n    localStorage.setItem('i18nextLng', lang);\n\n    if (user) {\n      const { error } = await supabase\n        .from('users')\n        .update({ language: lang })\n        .eq('id', user.id);\n\n      if (error) {\n        toast({\n          variant: \"destructive\",\n          title: t('common.error'),\n          description: \"Failed to save language preference\"\n        });\n      } else {\n        toast({\n          title: t('common.success'),\n          description: t('settings.save_preferences') + \" success\"\n        });\n      }\n    }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"space-y-8\"\n      >\n        <div>\n          <h2 className=\"text-3xl font-bold text-slate-900\">{t('settings.language_title')}</h2>\n          <p className=\"text-slate-600\">{t('settings.language_desc')}</p>\n        </div>\n\n        <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm p-6\">\n          <h3 className=\"text-lg font-bold mb-4 flex items-center gap-2\">\n            <Globe className=\"w-5 h-5 text-blue-600\" />\n            {t('settings.select_language')}\n          </h3>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <button\n              onClick={() => handleLanguageChange('id')}\n              className={`flex items-center justify-between p-4 rounded-lg border transition-all ${currentLang === 'id'\n                ? 'border-blue-600 bg-blue-50 ring-1 ring-blue-600'\n                : 'border-slate-200 hover:border-blue-300 hover:bg-slate-50'\n                }`}\n            >\n              <div className=\"flex items-center gap-3\">\n                <span className=\"text-2xl\"></span>\n                <div className=\"text-left\">\n                  <p className=\"font-bold text-slate-900\">Bahasa Indonesia</p>\n                  <p className=\"text-xs text-slate-500\">Secondary</p>\n                </div>\n              </div>\n              {currentLang === 'id' && <Check className=\"w-5 h-5 text-blue-600\" />}\n            </button>\n\n            <button\n              onClick={() => handleLanguageChange('en')}\n              className={`flex items-center justify-between p-4 rounded-lg border transition-all ${currentLang === 'en'\n                ? 'border-blue-600 bg-blue-50 ring-1 ring-blue-600'\n                : 'border-slate-200 hover:border-blue-300 hover:bg-slate-50'\n                }`}\n            >\n              <div className=\"flex items-center gap-3\">\n                <span className=\"text-2xl\"></span>\n                <div className=\"text-left\">\n                  <p className=\"font-bold text-slate-900\">English</p>\n                  <p className=\"text-xs text-slate-500\">Default (Primary)</p>\n                </div>\n              </div>\n              {currentLang === 'en' && <Check className=\"w-5 h-5 text-blue-600\" />}\n            </button>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm p-6\">\n          <h3 className=\"text-lg font-bold mb-2\">{t('settings.google_translate')}</h3>\n          <p className=\"text-slate-500 mb-4\">{t('settings.google_translate_desc')}</p>\n\n          <div className=\"p-4 bg-slate-50 rounded-lg border border-slate-200\">\n            <div id=\"google_translate_element\"></div>\n          </div>\n        </div>\n      </motion.div>\n    </div>\n  );\n}\n\nexport default LanguageSettings;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/MenusManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchMenus', 'fetchPages', and 'fetchRoles'. Either include them or remove the dependency array.","line":69,"column":6,"nodeType":"ArrayExpression","endLine":69,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [canView, currentLocation, currentTenant.id, fetchMenus, fetchPages, fetchRoles]","fix":{"range":[2594,2639],"text":"[canView, currentLocation, currentTenant.id, fetchMenus, fetchPages, fetchRoles]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { Reorder } from 'framer-motion';\nimport { GripVertical, Plus, Save, Trash2, Lock, Edit, ChevronRight, ChevronDown, RefreshCw, Menu, LayoutTemplate } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { PUBLIC_MODULES, getModulesByGroup } from '@/lib/publicModuleRegistry';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\n// Available Menu Locations\nconst MENU_LOCATIONS = [\n  { id: 'header', label: 'Primary Header' },\n  { id: 'footer', label: 'Footer' },\n  { id: 'public_sidebar', label: 'Public Sidebar' },\n  { id: 'mobile_menu', label: 'Mobile Menu' }\n];\n\nfunction MenusManager() {\n  const { toast } = useToast();\n  const { hasPermission, isPlatformAdmin } = usePermissions();\n  const { currentTenant } = useTenant();\n\n  // Data State\n  const [menus, setMenus] = useState([]); // This will store the TREE structure\n  const [flatMenus, setFlatMenus] = useState([]); // Store flat list for parent selection\n  const [roles, setRoles] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [currentLocation, setCurrentLocation] = useState('header');\n\n  // Editor State\n  const [isEditing, setIsEditing] = useState(false);\n  const [editingMenu, setEditingMenu] = useState(null);\n  const [menuFormData, setMenuFormData] = useState({});\n\n  // Permission Editor State\n  const [isPermEditorOpen, setIsPermEditorOpen] = useState(false);\n  const [selectedMenuPerms, setSelectedMenuPerms] = useState(null);\n  const [menuPermissions, setMenuPermissions] = useState({});\n  const [syncing, setSyncing] = useState(false);\n  const [selectedModule, setSelectedModule] = useState('');\n\n  const canView = hasPermission('tenant.menu.read');\n  const canCreate = hasPermission('tenant.menu.create');\n  const canEdit = hasPermission('tenant.menu.update');\n  const canDelete = hasPermission('tenant.menu.delete');\n\n  const [pages, setPages] = useState([]);\n\n  useEffect(() => {\n    if (canView) {\n      fetchMenus();\n      fetchRoles();\n      fetchPages();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [canView, currentLocation, currentTenant?.id]); // Re-fetch when location or tenant changes\n\n  const fetchPages = async () => {\n    try {\n      let q = supabase.from('pages').select('id, title, slug, status').neq('status', 'archived');\n      if (currentTenant?.id) q = q.eq('tenant_id', currentTenant.id);\n\n      const { data, error } = await q;\n      if (!error) setPages(data || []);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const fetchMenus = async () => {\n    setLoading(true);\n    try {\n      let query = supabase\n        .from('menus')\n        .select('*, tenant:tenants(name)')\n        .is('deleted_at', null)\n        .eq('location', currentLocation)\n        .order('order', { ascending: true });\n\n      if (currentTenant?.id) {\n        query = query.eq('tenant_id', currentTenant.id);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n\n      setFlatMenus(data || []);\n      const tree = buildMenuTree(data || []);\n      setMenus(tree);\n    } catch (err) {\n      console.error(err);\n      toast({ variant: 'destructive', title: 'Error fetching menus', description: err.message });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const buildMenuTree = (items) => {\n    const menuMap = {};\n    const roots = [];\n\n    // Initialize map\n    items.forEach(item => {\n      menuMap[item.id] = { ...item, children: [] };\n    });\n\n    // Build hierarchy\n    items.forEach(item => {\n      if (item.parent_id && menuMap[item.parent_id]) {\n        menuMap[item.parent_id].children.push(menuMap[item.id]);\n      } else {\n        roots.push(menuMap[item.id]);\n      }\n    });\n\n    // Sort by order\n    roots.sort((a, b) => a.order - b.order);\n    Object.values(menuMap).forEach(node => {\n      node.children.sort((a, b) => a.order - b.order);\n    });\n\n    return roots;\n  };\n\n  const fetchRoles = async () => {\n    if (!currentTenant?.id && !isPlatformAdmin) {\n      setRoles([]);\n      return;\n    }\n\n    let query = supabase\n      .from('roles')\n      .select('id, name, tenant_id')\n      .is('deleted_at', null)\n      .order('name');\n\n    if (currentTenant?.id) {\n      query = query.eq('tenant_id', currentTenant.id);\n    } else {\n      query = query.is('tenant_id', null);\n    }\n\n    const { data } = await query;\n    setRoles(data || []);\n  };\n\n  const handleReorder = (newOrder) => {\n    setMenus(newOrder);\n  };\n\n  const handleChildReorder = (parentId, newChildrenOrder) => {\n    const updateRecursive = (items) => {\n      return items.map(item => {\n        if (item.id === parentId) {\n          return { ...item, children: newChildrenOrder };\n        }\n        if (item.children) {\n          return { ...item, children: updateRecursive(item.children) };\n        }\n        return item;\n      });\n    };\n    setMenus(updateRecursive(menus));\n  };\n\n  const saveOrder = async () => {\n    try {\n      // Flatten the current tree state back into a list of updates\n      const updates = [];\n\n      const processNode = (node, index) => {\n        updates.push({ id: node.id, order: index });\n        if (node.children && node.children.length > 0) {\n          node.children.forEach((child, childIndex) => processNode(child, childIndex));\n        }\n      };\n\n      menus.forEach((menu, index) => processNode(menu, index));\n\n      // Use RPC to avoid 400 errors with partial upserts\n      const { error } = await supabase.rpc('update_menu_order', { payload: updates });\n\n      if (error) throw error;\n\n      toast({ title: 'Menu order saved', description: 'The navigation structure has been updated.' });\n    } catch (err) {\n      console.error(err);\n      toast({ variant: 'destructive', title: 'Failed to save order', description: err.message });\n    }\n  };\n\n  const handleEdit = (menu) => {\n    setEditingMenu(menu);\n    if (menu) {\n      // Ensure boolean values are properly set when editing existing menu\n      setMenuFormData({\n        ...menu,\n        is_active: menu.is_active === true,\n        is_public: menu.is_public === true,\n        page_id: menu.page_id || '', // Handle page_id\n        location: menu.location || currentLocation\n      });\n    } else {\n      // Default values for new menu\n      setMenuFormData({\n        label: '',\n        url: '',\n        name: '',\n        is_public: true,\n        is_active: true,\n        parent_id: null,\n        page_id: '',\n        location: currentLocation\n      });\n    }\n    setIsEditing(true);\n  };\n\n  // Handle Page Selection\n  const handlePageSelect = (pageId) => {\n    const page = pages.find(p => p.id === pageId);\n    if (page) {\n      setMenuFormData(prev => ({\n        ...prev,\n        page_id: pageId,\n        url: page.slug.startsWith('/') ? page.slug : `/${page.slug}`, // Auto-set URL\n        label: prev.label || page.title // Auto-set label if empty\n      }));\n    } else {\n      // Clear page association\n      setMenuFormData(prev => ({ ...prev, page_id: null }));\n    }\n  };\n\n  const handleSaveMenu = async (e) => {\n    e.preventDefault();\n\n    const payload = {\n      label: menuFormData.label,\n      name: menuFormData.name || menuFormData.label.toLowerCase().replace(/[^a-z0-9_]+/g, '_'),\n      url: menuFormData.url,\n      parent_id: menuFormData.parent_id || null,\n      page_id: menuFormData.page_id || null,\n      location: menuFormData.location || currentLocation,\n      is_public: menuFormData.is_public,\n      is_active: menuFormData.is_active,\n      updated_at: new Date().toISOString()\n    };\n\n    try {\n      let error;\n      if (editingMenu) {\n        const { error: updateError } = await supabase\n          .from('menus')\n          .update(payload)\n          .eq('id', editingMenu.id);\n        error = updateError;\n      } else {\n        // Get max order for new item\n        payload.order = 99; // Default to end, user can reorder\n        payload.tenant_id = currentTenant?.id; // Set tenant context\n        const { error: insertError } = await supabase\n          .from('menus')\n          .insert(payload);\n        error = insertError;\n      }\n\n      if (error) throw error;\n\n      toast({ title: 'Success', description: 'Menu item saved successfully' });\n      setIsEditing(false);\n      fetchMenus();\n    } catch (err) {\n      console.error(err);\n      toast({ variant: 'destructive', title: 'Error saving menu', description: err.message });\n    }\n  };\n\n  const handleDelete = async (id) => {\n    if (!window.confirm('Are you sure? This will delete the menu item and hide it from the site.')) return;\n\n    const { error } = await supabase\n      .from('menus')\n      .update({ deleted_at: new Date().toISOString() })\n      .eq('id', id);\n\n    if (error) {\n      toast({ variant: 'destructive', title: 'Error deleting menu' });\n    } else {\n      toast({ title: 'Menu deleted' });\n      fetchMenus();\n    }\n  };\n\n  const openPermissions = async (menu) => {\n    setSelectedMenuPerms(menu);\n    // Fetch existing perms\n    const { data } = await supabase\n      .from('menu_permissions')\n      .select('role_id, can_view')\n      .eq('menu_id', menu.id);\n\n    const permsMap = {};\n    roles.forEach(r => permsMap[r.id] = false); // Default false\n\n    if (data) {\n      data.forEach(p => {\n        if (p.can_view) permsMap[p.role_id] = true;\n      });\n    }\n    setMenuPermissions(permsMap);\n    setIsPermEditorOpen(true);\n  };\n\n  const savePermissions = async () => {\n    const upserts = Object.entries(menuPermissions).map(([roleId, canView]) => ({\n      menu_id: selectedMenuPerms.id,\n      role_id: roleId,\n      can_view: canView,\n      updated_at: new Date().toISOString()\n    }));\n\n    const { error } = await supabase\n      .from('menu_permissions')\n      .upsert(upserts, { onConflict: 'menu_id, role_id' });\n\n    if (error) {\n      toast({ variant: 'destructive', title: 'Failed to save permissions' });\n    } else {\n      toast({ title: 'Permissions updated' });\n      setIsPermEditorOpen(false);\n    }\n  };\n\n  // Sync from public module registry\n  const syncFromModules = async () => {\n    if (!currentTenant?.id) {\n      toast({ variant: 'destructive', title: 'No tenant selected' });\n      return;\n    }\n    setSyncing(true);\n    try {\n      const existingUrls = new Set(flatMenus.map(m => m.url));\n      const modulesToAdd = PUBLIC_MODULES.filter(mod => !existingUrls.has(mod.url));\n\n      if (modulesToAdd.length === 0) {\n        toast({ title: 'All modules already exist', description: 'No new items to add' });\n        setSyncing(false);\n        return;\n      }\n\n      const maxOrder = Math.max(0, ...flatMenus.map(m => m.order || 0));\n      const newItems = modulesToAdd.map((mod, idx) => ({\n        label: mod.label,\n        name: mod.key,\n        url: mod.url,\n        icon: mod.icon,\n        location: currentLocation,\n        parent_id: null,\n        order: maxOrder + ((idx + 1) * 10),\n        is_active: true,\n        is_public: true,\n        tenant_id: currentTenant.id,\n        created_at: new Date().toISOString(),\n      }));\n\n      const { error } = await supabase.from('menus').insert(newItems);\n      if (error) throw error;\n\n      toast({ title: 'Sync complete', description: `Added ${newItems.length} menu items` });\n      fetchMenus();\n    } catch (err) {\n      console.error(err);\n      toast({ variant: 'destructive', title: 'Sync failed', description: err.message });\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  // Handle module picker selection\n  const handleModuleSelect = (moduleKey) => {\n    setSelectedModule(moduleKey);\n    if (moduleKey) {\n      const mod = PUBLIC_MODULES.find(m => m.key === moduleKey);\n      if (mod) {\n        setMenuFormData(prev => ({\n          ...prev,\n          label: mod.label,\n          name: mod.key,\n          url: mod.url,\n        }));\n      }\n    }\n  };\n\n  if (!canView) return <div className=\"p-8 text-center text-slate-500\">Access Denied</div>;\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.menu.read\">\n      <PageHeader\n        title=\"Menu Management\"\n        description=\"Configure public navigation structure for headers, footers, and sidebars\"\n        icon={Menu}\n        breadcrumbs={[{ label: 'Menus', icon: Menu }]}\n        actions={(\n          <div className=\"flex gap-3 flex-wrap\">\n            {canCreate && (\n              <Button onClick={syncFromModules} variant=\"outline\" disabled={syncing} className=\"border-emerald-300 text-emerald-700 hover:bg-emerald-50\">\n                <RefreshCw className={`w-4 h-4 mr-2 ${syncing ? 'animate-spin' : ''}`} /> Sync Modules\n              </Button>\n            )}\n            <Button onClick={saveOrder} variant=\"outline\" className=\"border-slate-300\">\n              <Save className=\"w-4 h-4 mr-2\" /> Save Order\n            </Button>\n            {canCreate && (\n              <Button onClick={() => handleEdit(null)} className=\"bg-blue-600 hover:bg-blue-700\">\n                <Plus className=\"w-4 h-4 mr-2\" /> Add Item\n              </Button>\n            )}\n          </div>\n        )}\n      />\n\n      <div className=\"space-y-6\">\n\n        {/* Location Selector */}\n        <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 p-4 flex flex-col md:flex-row md:items-center gap-4\">\n          <div className=\"flex items-center gap-2 text-slate-500\">\n            <LayoutTemplate className=\"w-5 h-5\" />\n            <span className=\"font-medium text-sm\">Menu Location:</span>\n          </div>\n          <div className=\"flex gap-2 flex-wrap\">\n            {MENU_LOCATIONS.map(loc => (\n              <button\n                key={loc.id}\n                onClick={() => setCurrentLocation(loc.id)}\n                className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${currentLocation === loc.id\n                  ? 'bg-blue-600 text-white shadow-sm'\n                  : 'bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200'\n                  }`}\n              >\n                {loc.label}\n              </button>\n            ))}\n          </div>\n          <div className=\"flex-1 md:text-right text-xs text-slate-400 hidden md:block\">\n            Managing: <strong>{MENU_LOCATIONS.find(l => l.id === currentLocation)?.label}</strong>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 p-6 min-h-[300px]\">\n          {loading ? (\n            <div className=\"flex items-center justify-center h-40 text-slate-400\">Loading menus...</div>\n          ) : menus.length === 0 ? (\n            <div className=\"text-center py-12 text-slate-500\">No menu items found for this location. Create one to get started.</div>\n          ) : (\n            <Reorder.Group axis=\"y\" values={menus} onReorder={handleReorder} className=\"space-y-3\">\n              {menus.map((menu) => (\n                <MenuReorderItem\n                  key={menu.id}\n                  menu={menu}\n                  canEdit={canEdit}\n                  canDelete={canDelete}\n                  onEdit={handleEdit}\n                  onDelete={handleDelete}\n                  onPerms={openPermissions}\n                  onChildReorder={(newChildren) => handleChildReorder(menu.id, newChildren)}\n                  isPlatformAdmin={isPlatformAdmin}\n                />\n              ))}\n            </Reorder.Group>\n          )}\n        </div>\n\n        {/* Edit Menu Dialog */}\n        <Dialog open={isEditing} onOpenChange={setIsEditing}>\n          <DialogContent className=\"sm:max-w-[500px]\">\n            <DialogHeader>\n              <DialogTitle>{editingMenu ? 'Edit Menu Item' : 'Create Menu Item'}</DialogTitle>\n              <DialogDescription>\n                Configure the details for this navigation link in <strong>{MENU_LOCATIONS.find(l => l.id === currentLocation)?.label}</strong>.\n              </DialogDescription>\n            </DialogHeader>\n            <form onSubmit={handleSaveMenu} className=\"space-y-4 py-4\">\n              {/* Module Picker - only show for new items */}\n              {!editingMenu && (\n                <div className=\"space-y-2\">\n                  <Label>Quick Select (Optional)</Label>\n                  <select\n                    className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                    value={selectedModule}\n                    onChange={e => handleModuleSelect(e.target.value)}\n                  >\n                    <option value=\"\">-- Select a module or enter custom --</option>\n                    {Object.entries(getModulesByGroup()).map(([group, modules]) => (\n                      <optgroup key={group} label={group}>\n                        {modules.map(mod => (\n                          <option key={mod.key} value={mod.key}>{mod.label} ({mod.url})</option>\n                        ))}\n                      </optgroup>\n                    ))}\n                  </select>\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label>Link to Page (Optional)</Label>\n                <select\n                  className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                  value={menuFormData.page_id || ''}\n                  onChange={e => handlePageSelect(e.target.value)}\n                >\n                  <option value=\"\">-- No Page Linked --</option>\n                  {pages.map(p => (\n                    <option key={p.id} value={p.id}>{p.title} ({p.slug})</option>\n                  ))}\n                </select>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label>Label</Label>\n                  <Input\n                    value={menuFormData.label}\n                    onChange={e => setMenuFormData({ ...menuFormData, label: e.target.value })}\n                    placeholder=\"e.g. About Us\"\n                    required\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>Internal Name</Label>\n                  <Input\n                    value={menuFormData.name}\n                    onChange={e => setMenuFormData({ ...menuFormData, name: e.target.value })}\n                    placeholder=\"about_us\"\n                  />\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label>URL Path</Label>\n                <Input\n                  value={menuFormData.url}\n                  onChange={e => setMenuFormData({ ...menuFormData, url: e.target.value })}\n                  placeholder=\"e.g. /about or https://google.com\"\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Parent Menu</Label>\n                <select\n                  className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                  value={menuFormData.parent_id || ''}\n                  onChange={e => setMenuFormData({ ...menuFormData, parent_id: e.target.value || null })}\n                >\n                  <option value=\"\">No Parent (Top Level)</option>\n                  {flatMenus.filter(m => m.id !== editingMenu?.id && !m.parent_id).map(m => (\n                    <option key={m.id} value={m.id}>{m.label}</option>\n                  ))}\n                </select>\n              </div>\n\n              {/* Location Override (Optional) */}\n              <div className=\"space-y-2\">\n                <Label>Location</Label>\n                <select\n                  className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                  value={menuFormData.location || currentLocation}\n                  onChange={e => setMenuFormData({ ...menuFormData, location: e.target.value })}\n                >\n                  {MENU_LOCATIONS.map(loc => (\n                    <option key={loc.id} value={loc.id}>{loc.label}</option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"flex gap-6 pt-2\">\n                <label className=\"flex items-center gap-2 text-sm font-medium cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    checked={menuFormData.is_active === true}\n                    onChange={e => setMenuFormData({ ...menuFormData, is_active: e.target.checked })}\n                    className=\"rounded border-slate-300 text-blue-600 focus:ring-blue-500\"\n                  />\n                  Active\n                </label>\n                <label className=\"flex items-center gap-2 text-sm font-medium cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    checked={menuFormData.is_public === true}\n                    onChange={e => setMenuFormData({ ...menuFormData, is_public: e.target.checked })}\n                    className=\"rounded border-slate-300 text-blue-600 focus:ring-blue-500\"\n                  />\n                  Public Default\n                </label>\n              </div>\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setIsEditing(false)}>Cancel</Button>\n                <Button type=\"submit\">Save Changes</Button>\n              </DialogFooter>\n            </form>\n          </DialogContent>\n        </Dialog>\n\n        {/* Permissions Dialog */}\n        <Dialog open={isPermEditorOpen} onOpenChange={setIsPermEditorOpen}>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Manage Access: {selectedMenuPerms?.label}</DialogTitle>\n              <DialogDescription>\n                Toggle which roles can view this menu item in the public interface.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"py-4 space-y-3 max-h-[300px] overflow-y-auto\">\n              {roles.map(role => (\n                <div key={role.id} className=\"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100\">\n                  <span className=\"font-medium text-slate-700\">{role.name}</span>\n                  <label className=\"flex items-center gap-2 cursor-pointer\">\n                    <input\n                      type=\"checkbox\"\n                      checked={menuPermissions[role.id] || false}\n                      onChange={e => setMenuPermissions({\n                        ...menuPermissions,\n                        [role.id]: e.target.checked\n                      })}\n                      className=\"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500\"\n                    />\n                    <span className=\"text-xs font-semibold text-slate-500 uppercase\">Allow</span>\n                  </label>\n                </div>\n              ))}\n            </div>\n            <DialogFooter>\n              <Button onClick={savePermissions}>Save Permissions</Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </AdminPageLayout>\n  );\n}\n\nconst MenuReorderItem = ({ menu, canEdit, canDelete, onEdit, onDelete, onPerms, onChildReorder, isPlatformAdmin }) => {\n  const hasChildren = menu.children && menu.children.length > 0;\n  const [isOpen, setIsOpen] = useState(true);\n\n  return (\n    <Reorder.Item value={menu} id={menu.id} className=\"bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden select-none\">\n      <div className=\"flex items-center p-3 gap-3 hover:bg-slate-50/50 transition-colors\">\n        <GripVertical className=\"w-5 h-5 text-slate-400 cursor-grab active:cursor-grabbing flex-shrink-0\" />\n\n        <div className=\"flex-1 flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3 overflow-hidden\">\n          {isPlatformAdmin && (\n            <span className=\"text-[10px] font-medium text-slate-600 bg-slate-100 px-1.5 py-0.5 rounded\">\n              {menu.tenant?.name || '(Unknown)'}\n            </span>\n          )}\n          <div className=\"font-bold text-slate-800 flex items-center gap-2 truncate\">\n            {menu.label}\n            {!menu.is_active && <span className=\"text-[10px] bg-red-100 text-red-600 px-1.5 py-0.5 rounded border border-red-200\">Inactive</span>}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {menu.page_id && <span className=\"text-[10px] bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded border border-indigo-100\">Page Linked</span>}\n            <span className=\"text-xs font-mono text-slate-400 truncate\">{menu.url}</span>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-1\">\n          {hasChildren && (\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => setIsOpen(!isOpen)} className=\"h-8 w-8 p-0 mr-1\">\n              {isOpen ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronRight className=\"w-4 h-4\" />}\n            </Button>\n          )}\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => onPerms(menu)} title=\"Access Permissions\" className=\"h-8 w-8 p-0 text-slate-400 hover:text-slate-600\">\n            <Lock className=\"w-4 h-4\" />\n          </Button>\n          {canEdit && (\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => onEdit(menu)} className=\"h-8 w-8 p-0 text-blue-600 hover:bg-blue-50\">\n              <Edit className=\"w-4 h-4\" />\n            </Button>\n          )}\n          {canDelete && (\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => onDelete(menu.id)} className=\"h-8 w-8 p-0 text-red-600 hover:bg-red-50\">\n              <Trash2 className=\"w-4 h-4\" />\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {hasChildren && isOpen && (\n        <div className=\"pl-10 pr-3 pb-3 pt-1 bg-slate-50/30 border-t border-slate-100\">\n          {/* Recursive Reorder Group for Children */}\n          <Reorder.Group axis=\"y\" values={menu.children} onReorder={onChildReorder} className=\"space-y-2\">\n            {menu.children.map(child => (\n              <Reorder.Item key={child.id} value={child} id={child.id} className=\"bg-white border border-slate-200 p-2 rounded flex items-center justify-between shadow-sm\">\n                <div className=\"flex items-center gap-3\">\n                  <GripVertical className=\"w-4 h-4 text-slate-300 cursor-grab\" />\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm font-medium text-slate-700\">{child.label}</span>\n                    <div className=\"flex items-center gap-2\">\n                      {child.page_id && <span className=\"text-[10px] bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded border border-indigo-100\">Page</span>}\n                      <span className=\"text-xs text-slate-400\">{child.url}</span>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex gap-1\">\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => onPerms(child)}><Lock className=\"w-3 h-3 text-slate-400\" /></Button>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => onEdit(child)}><Edit className=\"w-3 h-3 text-blue-600\" /></Button>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => onDelete(child.id)}><Trash2 className=\"w-3 h-3 text-red-600\" /></Button>\n                </div>\n              </Reorder.Item>\n            ))}\n          </Reorder.Group>\n        </div>\n      )}\n    </Reorder.Item>\n  );\n};\n\nexport default MenusManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ModuleHeader.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ModuleTabs.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\n\n/**\n * ModuleTabs - Standardized tabs component for admin modules.\n * Provides consistent styling with gradient active states.\n *\n * @param {string} value - Current active tab value\n * @param {function} onValueChange - Callback when tab changes\n * @param {Array} tabs - Array of {value, label, icon, color} objects\n *   - color: 'blue' (default), 'purple', 'emerald', 'amber', 'rose', 'slate'\n * @param {React.ReactNode} children - TabsContent elements\n */\nconst ModuleTabs = ({\n    value,\n    onValueChange,\n    tabs = [],\n    children\n}) => {\n    const colorClasses = {\n        blue: 'data-[state=active]:from-blue-600 data-[state=active]:to-blue-700',\n        purple: 'data-[state=active]:from-purple-600 data-[state=active]:to-purple-700',\n        emerald: 'data-[state=active]:from-emerald-600 data-[state=active]:to-emerald-700',\n        amber: 'data-[state=active]:from-amber-600 data-[state=active]:to-amber-700',\n        rose: 'data-[state=active]:from-rose-600 data-[state=active]:to-rose-700',\n        slate: 'data-[state=active]:from-slate-600 data-[state=active]:to-slate-700',\n    };\n\n    return (\n        <Tabs value={value} onValueChange={onValueChange} className=\"w-full\">\n            <div className=\"bg-white rounded-xl border border-slate-200 p-1.5 shadow-sm mb-6 inline-flex\">\n                <TabsList className={`grid grid-cols-${tabs.length} gap-1 bg-transparent p-0`}>\n                    {tabs.map((tab) => {\n                        const Icon = tab.icon;\n                        const gradient = colorClasses[tab.color || 'blue'];\n                        return (\n                            <TabsTrigger\n                                key={tab.value}\n                                value={tab.value}\n                                className={`flex items-center gap-2 px-6 py-2.5 rounded-lg data-[state=active]:bg-gradient-to-r ${gradient} data-[state=active]:text-white data-[state=active]:shadow-md transition-all duration-200 font-medium`}\n                            >\n                                {Icon && <Icon className=\"w-4 h-4\" />}\n                                {tab.label}\n                            </TabsTrigger>\n                        );\n                    })}\n                </TabsList>\n            </div>\n            {children}\n        </Tabs>\n    );\n};\n\n// Re-export TabsContent for convenience\nexport { TabsContent };\nexport default ModuleTabs;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/OrdersManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'row' is defined but never used.","line":22,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"row"},"fix":{"range":[690,695],"text":""},"desc":"Remove unused variable 'row'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { User, ShoppingCart } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction OrdersManager() {\n    const columns = [\n        {\n            key: 'id',\n            label: 'Order #',\n            className: 'font-mono text-xs',\n            render: (val) => (\n                <span className=\"bg-muted px-2 py-1 rounded text-muted-foreground\">\n                    #{val?.substring(0, 8)}\n                </span>\n            )\n        },\n        {\n            key: 'user',\n            label: 'Customer',\n            render: (val, row) => (\n                <div className=\"flex items-center gap-2\">\n                    <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                        <User className=\"w-4 h-4 text-primary\" />\n                    </div>\n                    <div className=\"flex flex-col\">\n                        <span className=\"font-medium text-sm text-foreground\">{val?.full_name || val?.email || 'Guest'}</span>\n                        <span className=\"text-xs text-muted-foreground\">{val?.email}</span>\n                    </div>\n                </div>\n            )\n        },\n        {\n            key: 'total_amount',\n            label: 'Total',\n            render: (val) => (\n                <span className=\"font-semibold text-green-600 dark:text-green-400\">\n                    {new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(val)}\n                </span>\n            )\n        },\n        {\n            key: 'status',\n            label: 'Order Status',\n            render: (value) => {\n                const statusConfig = {\n                    pending: { bg: 'bg-amber-100 dark:bg-amber-900/30', text: 'text-amber-700 dark:text-amber-400', icon: '' },\n                    paid: { bg: 'bg-blue-100 dark:bg-blue-900/30', text: 'text-blue-700 dark:text-blue-400', icon: '' },\n                    processing: { bg: 'bg-purple-100 dark:bg-purple-900/30', text: 'text-purple-700 dark:text-purple-400', icon: '' },\n                    shipped: { bg: 'bg-cyan-100 dark:bg-cyan-900/30', text: 'text-cyan-700 dark:text-cyan-400', icon: '' },\n                    completed: { bg: 'bg-green-100 dark:bg-green-900/30', text: 'text-green-700 dark:text-green-400', icon: '' },\n                    cancelled: { bg: 'bg-red-100 dark:bg-red-900/30', text: 'text-red-700 dark:text-red-400', icon: '' },\n                    refunded: { bg: 'bg-muted', text: 'text-muted-foreground', icon: '' }\n                };\n                const config = statusConfig[value] || statusConfig.pending;\n                return (\n                    <span className={`px-2 py-1 rounded-full text-xs font-medium inline-flex items-center gap-1 ${config.bg} ${config.text}`}>\n                        <span>{config.icon}</span>\n                        {value ? value.charAt(0).toUpperCase() + value.slice(1) : 'Pending'}\n                    </span>\n                );\n            }\n        },\n        {\n            key: 'payment_status',\n            label: 'Payment',\n            render: (val) => {\n                const config = {\n                    paid: { bg: 'bg-green-100 dark:bg-green-900/30', text: 'text-green-700 dark:text-green-400' },\n                    unpaid: { bg: 'bg-red-100 dark:bg-red-900/30', text: 'text-red-700 dark:text-red-400' },\n                    partial: { bg: 'bg-amber-100 dark:bg-amber-900/30', text: 'text-amber-700 dark:text-amber-400' },\n                    refunded: { bg: 'bg-muted', text: 'text-muted-foreground' }\n                };\n                const style = config[val] || config.unpaid;\n                return (\n                    <span className={`px-2 py-0.5 rounded text-xs font-medium ${style.bg} ${style.text}`}>\n                        {val || 'Unpaid'}\n                    </span>\n                );\n            }\n        },\n        {\n            key: 'tracking_number',\n            label: 'Tracking',\n            render: (val) => val ? (\n                <span className=\"font-mono text-xs bg-muted px-2 py-1 rounded text-muted-foreground\">{val}</span>\n            ) : (\n                <span className=\"text-muted-foreground/50 text-xs\">-</span>\n            )\n        },\n        {\n            key: 'created_at',\n            label: 'Date',\n            type: 'date',\n            render: (value) => value ? new Date(value).toLocaleDateString('id-ID', {\n                day: 'numeric',\n                month: 'short',\n                year: 'numeric',\n                hour: '2-digit',\n                minute: '2-digit'\n            }) : '-'\n        }\n    ];\n\n    const formFields = [\n        { key: 'user_id', label: 'Customer', type: 'relation', table: 'users', relationLabel: 'email', description: 'Customer who placed the order', required: true },\n        {\n            key: 'status', label: 'Order Status', type: 'select', options: [\n                { value: 'pending', label: ' Pending' },\n                { value: 'paid', label: ' Paid' },\n                { value: 'processing', label: ' Processing' },\n                { value: 'shipped', label: ' Shipped' },\n                { value: 'completed', label: ' Completed' },\n                { value: 'cancelled', label: ' Cancelled' },\n                { value: 'refunded', label: ' Refunded' }\n            ]\n        },\n        {\n            key: 'payment_status', label: 'Payment Status', type: 'select', options: [\n                { value: 'unpaid', label: 'Unpaid' },\n                { value: 'paid', label: 'Paid' },\n                { value: 'partial', label: 'Partial Payment' },\n                { value: 'refunded', label: 'Refunded' }\n            ]\n        },\n        { key: 'payment_method', label: 'Payment Method', description: 'Bank Transfer, Credit Card, etc.' },\n        { key: 'subtotal', label: 'Subtotal', type: 'number', readOnly: false },\n        { key: 'shipping_cost', label: 'Shipping Cost', type: 'number' },\n        {\n            key: 'total_amount',\n            label: 'Total Amount',\n            type: 'number',\n            readOnly: true,\n            calculate: (data) => {\n                const sub = Number(data.subtotal) || 0;\n                const ship = Number(data.shipping_cost) || 0;\n                return sub + ship;\n            }\n        },\n        { key: 'shipping_address', label: 'Shipping Address', type: 'textarea' },\n        { key: 'tracking_number', label: 'Tracking Number', description: 'Courier tracking number' },\n        { key: 'notes', label: 'Order Notes', type: 'textarea', description: 'Internal notes about this order' }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.orders.read\">\n            <PageHeader\n                title=\"Orders\"\n                description=\"Manage customer orders and transactions.\"\n                icon={ShoppingCart}\n                breadcrumbs={[{ label: 'Orders', icon: ShoppingCart }]}\n            />\n\n            <GenericContentManager\n                tableName=\"orders\"\n                resourceName=\"Order\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"orders\"\n                canCreate={false}\n                customSelect=\"*\"\n                showBreadcrumbs={false}\n                omitCreatedBy={true}\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default OrdersManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PageEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { Save, X, Globe, Calendar, Lock, Layout, Share2, FolderOpen } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ImageUpload } from '@/components/ui/ImageUpload';\nimport RichTextEditor from '@/components/ui/RichTextEditor';\n\n\nfunction PageEditor({ page, onClose, onSuccess }) {\n    const { toast } = useToast();\n    const { user } = useAuth();\n    const { currentTenant } = useTenant(); // Get Current Tenant\n    const { hasPermission } = usePermissions();\n    const [loading, setLoading] = useState(false);\n    const [categories, setCategories] = useState([]);\n\n    const [formData, setFormData] = useState({\n        title: page?.title || '',\n        slug: page?.slug || '',\n        content: page?.content || '',\n        excerpt: page?.excerpt || '',\n        featured_image: page?.featured_image || '',\n        status: page?.status || 'draft',\n        is_public: page?.is_public ?? false,\n        category_id: page?.category_id || '',\n        tags: page?.tags || [],\n\n        // SEO\n        meta_title: page?.meta_title || '',\n        meta_description: page?.meta_description || '',\n        meta_keywords: page?.meta_keywords || '',\n        canonical_url: page?.canonical_url || '',\n        robots: page?.robots || 'index, follow',\n\n        // Social\n        og_title: page?.og_title || '',\n        og_description: page?.og_description || '',\n        og_image: page?.og_image || '',\n        twitter_card_type: page?.twitter_card_type || 'summary',\n        twitter_image: page?.twitter_image || '',\n\n        published_at: page?.published_at ? new Date(page.published_at).toISOString().slice(0, 16) : '',\n        layout_key: page?.layout_key || 'astrowind.standard',\n        content_type: page?.content_type || 'richtext',\n        // Hierarchy & Nav\n        parent_id: page?.parent_id || '',\n        template_key: page?.template_key || 'astrowind',\n        sort_order: page?.sort_order || 0,\n        nav_visibility: page?.nav_visibility ?? true\n    });\n\n    const isEditMode = !!page;\n\n    // Permissions\n    const canEdit = hasPermission('tenant.pages.update') || (user?.id === page?.created_by);\n    const canPublish = hasPermission('tenant.pages.publish');\n\n    const [parentPages, setParentPages] = useState([]);\n\n    useEffect(() => {\n        const fetchData = async () => {\n            try {\n                // Fetch Categories\n                let catQuery = supabase.from('categories').select('id, name').eq('type', 'page');\n                if (currentTenant?.id) catQuery = catQuery.eq('tenant_id', currentTenant.id);\n                const { data: catData } = await catQuery;\n                setCategories(catData || []);\n\n                // Fetch Potential Parent Pages (exclude current page if editing)\n                let pageQuery = supabase.from('pages').select('id, title, slug').eq('tenant_id', currentTenant?.id);\n                if (page?.id) pageQuery = pageQuery.neq('id', page.id);\n                const { data: pageData } = await pageQuery;\n                setParentPages(pageData || []);\n\n                // Fetch SEO Defaults (Only for new pages)\n                if (!page && currentTenant?.id) {\n                    const { data: seoData } = await supabase\n                        .from('settings')\n                        .select('value')\n                        .eq('key', 'seo_global')\n                        .eq('tenant_id', currentTenant.id)\n                        .maybeSingle();\n\n                    if (seoData?.value) {\n                        try {\n                            const parsedSeo = typeof seoData.value === 'string'\n                                ? JSON.parse(seoData.value)\n                                : seoData.value;\n\n                            setFormData(prev => ({\n                                ...prev,\n                                meta_title: parsedSeo.site_title || prev.meta_title,\n                                meta_description: parsedSeo.site_description || prev.meta_description,\n                                meta_keywords: parsedSeo.default_keywords || prev.meta_keywords,\n                                og_image: parsedSeo.og_image || prev.og_image,\n                                twitter_image: parsedSeo.og_image || prev.twitter_image, // Fallback to OG image\n                            }));\n                        } catch (err) {\n                            console.error(\"Error parsing SEO defaults:\", err);\n                        }\n                    }\n                }\n\n            } catch (e) { console.error(e); }\n        };\n        fetchData();\n    }, [currentTenant?.id, page?.id, page]);\n\n    const generateSlug = (text) => {\n        return text\n            .toLowerCase()\n            .replace(/[^a-z0-9]+/g, '-')\n            .replace(/(^-|-$)/g, '');\n    };\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        if (!canEdit) return;\n\n        if (!currentTenant?.id) {\n            toast({ variant: 'destructive', title: 'System Error', description: 'No active tenant context found.' });\n            return;\n        }\n\n        // Publish Check\n        if (formData.status === 'published' && !canPublish) {\n            toast({ variant: 'warning', title: 'Publish Restricted', description: 'Saved as draft (permission required).' });\n            setFormData(prev => ({ ...prev, status: 'draft' }));\n            // We continue saving as draft\n        }\n\n        setLoading(true);\n        try {\n            const payload = {\n                tenant_id: currentTenant.id, // Explicit Tenant ID\n                title: formData.title,\n                slug: formData.slug || generateSlug(formData.title),\n                content: formData.content,\n                excerpt: formData.excerpt,\n                featured_image: formData.featured_image,\n                status: (formData.status === 'published' && !canPublish) ? 'draft' : formData.status,\n                category_id: formData.category_id || null,\n                // SEO\n                meta_title: formData.meta_title,\n                meta_description: formData.meta_description,\n                meta_keywords: formData.meta_keywords,\n                canonical_url: formData.canonical_url,\n                robots: formData.robots,\n                // Social\n                og_title: formData.og_title,\n                og_description: formData.og_description,\n                og_image: formData.og_image,\n                twitter_card_type: formData.twitter_card_type,\n                twitter_image: formData.twitter_image,\n\n                published_at: formData.published_at || null,\n                is_public: formData.is_public,\n\n                layout_key: formData.layout_key,\n                content_type: formData.content_type,\n                parent_id: formData.parent_id || null, // Handle empty string as null\n                template_key: formData.template_key,\n                sort_order: parseInt(formData.sort_order),\n                nav_visibility: formData.nav_visibility,\n                updated_at: new Date().toISOString()\n            };\n\n            if (!isEditMode) {\n                payload.created_by = user.id;\n            }\n\n            if (page) {\n                // Keep existing tenant_id safe\n                delete payload.tenant_id;\n                const { error } = await supabase.from('pages').update(payload).eq('id', page.id);\n                if (error) throw error;\n            } else {\n                const { error } = await supabase.from('pages').insert([payload]);\n                if (error) throw error;\n            }\n\n            // Sync Tags - REMOVED\n\n            toast({ title: \"Success\", description: \"Page saved successfully\" });\n            onSuccess?.();\n            onClose();\n        } catch (error) {\n            console.error(error);\n            toast({ variant: \"destructive\", title: \"Error\", description: error.message });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"bg-white rounded-xl shadow-md p-0 flex flex-col h-full overflow-hidden\"\n        >\n            <div className=\"flex justify-between items-center px-6 py-4 border-b border-slate-100 bg-slate-50/50\">\n                <div>\n                    <h3 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\n                        {page ? 'Edit Page' : 'New Page'}\n                        {page?.status === 'published' && <span className=\"bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full border border-green-200\">Live</span>}\n                    </h3>\n                    <div className=\"text-xs text-slate-500 mt-1 flex items-center gap-2\">\n                        {page?.created_by ? (\n                            <span className=\"flex items-center gap-1\"><Lock className=\"w-3 h-3\" /> Owner: {user?.id === page.created_by ? 'You' : 'Others'}</span>\n                        ) : (\n                            <span>Author: You</span>\n                        )}\n                    </div>\n                </div>\n\n                <div className=\"flex gap-2\">\n                    <Button variant=\"outline\" size=\"sm\" onClick={() => {\n                        const baseUrl = import.meta.env.VITE_PUBLIC_PORTAL_URL || 'http://localhost:4321';\n                        const previewSecret = import.meta.env.VITE_PREVIEW_SECRET || '';\n                        const url = previewSecret\n                            ? `${baseUrl}/${formData.slug}?preview_secret=${previewSecret}`\n                            : `${baseUrl}/${formData.slug}`;\n                        window.open(url, '_blank');\n                    }}>\n                        <Globe className=\"w-4 h-4 mr-2\" /> Preview\n                    </Button>\n                    <Button type=\"button\" onClick={handleSubmit} disabled={loading} className=\"bg-slate-900 hover:bg-slate-800 text-white\">\n                        <Save className=\"w-4 h-4 mr-2\" />\n                        {loading ? 'Saving...' : 'Save Page'}\n                    </Button>\n                    <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n                        <X className=\"w-5 h-5\" />\n                    </Button>\n                </div>\n            </div >\n\n            <form onSubmit={handleSubmit} className=\"flex-1 overflow-hidden flex flex-col\">\n                <div className=\"flex-1 overflow-y-auto p-6 bg-slate-50/30\">\n                    <Tabs defaultValue=\"content\" className=\"w-full h-full flex flex-col\">\n                        <TabsList className=\"grid w-full grid-cols-4 mb-6 bg-slate-100 p-1 rounded-lg\">\n                            <TabsTrigger value=\"content\" className=\"flex items-center gap-2 data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all duration-200\">\n                                <Layout className=\"w-4 h-4\" /> Content\n                            </TabsTrigger>\n                            <TabsTrigger value=\"seo\" className=\"flex items-center gap-2 data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all duration-200\">\n                                <Globe className=\"w-4 h-4\" /> SEO & Meta\n                            </TabsTrigger>\n                            <TabsTrigger value=\"organization\" className=\"flex items-center gap-2 data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all duration-200\">\n                                <FolderOpen className=\"w-4 h-4\" /> Organization\n                            </TabsTrigger>\n                            <TabsTrigger value=\"social\" className=\"flex items-center gap-2 data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all duration-200\">\n                                <Share2 className=\"w-4 h-4\" /> Social Media\n                            </TabsTrigger>\n                        </TabsList>\n\n                        {/* Content Tab */}\n                        <TabsContent value=\"content\" className=\"space-y-6 animate-in fade-in zoom-in-95 duration-200\">\n                            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                                <div className=\"lg:col-span-3 space-y-6\">\n                                    <div className=\"space-y-4 bg-white p-6 rounded-xl border border-slate-200 shadow-sm\">\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"title\">Page Title <span className=\"text-red-500\">*</span></Label>\n                                            <Input\n                                                id=\"title\"\n                                                value={formData.title}\n                                                onChange={(e) => {\n                                                    setFormData({\n                                                        ...formData,\n                                                        title: e.target.value,\n                                                        slug: !page ? generateSlug(e.target.value) : formData.slug\n                                                    });\n                                                }}\n                                                className=\"text-lg font-semibold\"\n                                                placeholder=\"Enter page title\"\n                                                required\n                                            />\n                                        </div>\n\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"slug\" className=\"text-xs text-slate-500\">Permalink</Label>\n                                            <div className=\"flex items-center gap-0\">\n                                                <span className=\"text-xs text-slate-500 bg-slate-50 px-3 py-2 rounded-l-md border border-r-0 border-slate-300\">/pages/</span>\n                                                <Input\n                                                    id=\"slug\"\n                                                    value={formData.slug}\n                                                    onChange={(e) => setFormData({ ...formData, slug: e.target.value })}\n                                                    className=\"rounded-l-none font-mono text-sm\"\n                                                    required\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    <div className=\"space-y-4 bg-white p-6 rounded-xl border border-slate-200 shadow-sm\">\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"layout_key\">Page Layout</Label>\n                                            <select\n                                                id=\"layout_key\"\n                                                value={formData.layout_key}\n                                                onChange={(e) => setFormData({ ...formData, layout_key: e.target.value })}\n                                                className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                                            >\n                                                <option value=\"astrowind.standard\">Standard Layout (with Title)</option>\n                                                <option value=\"astrowind.landing\">Landing Page (Full Width)</option>\n                                            </select>\n                                        </div>\n                                    </div>\n\n                                    <div className=\"space-y-2 bg-white p-6 rounded-xl border border-slate-200 shadow-sm\">\n                                        <Label htmlFor=\"content\">Content <span className=\"text-red-500\">*</span></Label>\n                                        <RichTextEditor\n                                            value={formData.content}\n                                            onChange={(val) => setFormData({ ...formData, content: val })}\n                                            placeholder=\"Start designing your page...\"\n                                        />\n                                    </div>\n\n                                    <div className=\"space-y-2 bg-white p-6 rounded-xl border border-slate-200 shadow-sm\">\n                                        <Label htmlFor=\"excerpt\">Excerpt</Label>\n                                        <Textarea\n                                            id=\"excerpt\"\n                                            value={formData.excerpt}\n                                            onChange={(e) => setFormData({ ...formData, excerpt: e.target.value })}\n                                            placeholder=\"Brief summary of the page content...\"\n                                        />\n                                        <p className=\"text-xs text-slate-400\">Used for search results and previews.</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </TabsContent>\n\n                        {/* SEO & Meta Tab */}\n                        <TabsContent value=\"seo\" className=\"space-y-8 animate-in fade-in zoom-in-95 duration-200\">\n                            <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-6\">\n                                <h4 className=\"font-semibold text-slate-800 flex items-center gap-2 text-base border-b border-slate-100 pb-3\">\n                                    <Globe className=\"w-4 h-4 text-blue-600\" /> Search Engine Optimization\n                                </h4>\n\n                                <div className=\"space-y-2\">\n                                    <Label htmlFor=\"meta_title\">Meta Title</Label>\n                                    <Input\n                                        id=\"meta_title\"\n                                        value={formData.meta_title}\n                                        onChange={(e) => setFormData({ ...formData, meta_title: e.target.value })}\n                                        placeholder={formData.title}\n                                    />\n                                    <p className=\"text-xs text-slate-500\">Recommended length: 50-60 characters</p>\n                                </div>\n\n                                <div className=\"space-y-2\">\n                                    <div className=\"flex justify-between items-center\">\n                                        <Label htmlFor=\"meta_description\">Meta Description</Label>\n                                        <span className={`text-xs font-medium ${formData.meta_description.length > 160 ? 'text-red-500' : 'text-slate-400'}`}>\n                                            {formData.meta_description.length}/160\n                                        </span>\n                                    </div>\n                                    <Textarea\n                                        id=\"meta_description\"\n                                        value={formData.meta_description}\n                                        onChange={(e) => setFormData({ ...formData, meta_description: e.target.value })}\n                                        className={`min-h-[100px] ${formData.meta_description.length > 160 ? 'border-red-300 focus-visible:ring-red-200' : ''}`}\n                                        placeholder=\"Enter a concise description for search engines...\"\n                                    />\n                                </div>\n\n                                <div className=\"space-y-2\">\n                                    <Label htmlFor=\"meta_keywords\">Keywords (Comma separated)</Label>\n                                    <Input\n                                        id=\"meta_keywords\"\n                                        value={formData.meta_keywords}\n                                        onChange={(e) => setFormData({ ...formData, meta_keywords: e.target.value })}\n                                        placeholder=\"page, content, info...\"\n                                    />\n                                </div>\n                            </div>\n\n                            <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-6\">\n                                <h4 className=\"font-semibold text-slate-800 text-base border-b border-slate-100 pb-3\">Advanced SEO</h4>\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                    <div className=\"space-y-2\">\n                                        <Label htmlFor=\"canonical_url\">Canonical URL</Label>\n                                        <Input\n                                            id=\"canonical_url\"\n                                            value={formData.canonical_url}\n                                            onChange={(e) => setFormData({ ...formData, canonical_url: e.target.value })}\n                                            placeholder=\"https://...\"\n                                        />\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label htmlFor=\"robots\">Robots Meta</Label>\n                                        <select\n                                            id=\"robots\"\n                                            value={formData.robots}\n                                            onChange={(e) => setFormData({ ...formData, robots: e.target.value })}\n                                            className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                                        >\n                                            <option value=\"index, follow\">Index, Follow (Default)</option>\n                                            <option value=\"noindex, follow\">NoIndex, Follow</option>\n                                            <option value=\"index, nofollow\">Index, NoFollow</option>\n                                            <option value=\"noindex, nofollow\">NoIndex, NoFollow</option>\n                                        </select>\n                                    </div>\n                                </div>\n                            </div>\n                        </TabsContent>\n\n                        {/* Organization Tab */}\n                        <TabsContent value=\"organization\" className=\"space-y-6 animate-in fade-in zoom-in-95 duration-200\">\n                            <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-6\">\n                                <h4 className=\"font-semibold text-slate-800 flex items-center gap-2 text-base border-b border-slate-100 pb-3\">\n                                    <Calendar className=\"w-4 h-4 text-blue-600\" /> Publishing & Visibility\n                                </h4>\n\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                                    <div className=\"space-y-4\">\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"status\">Publish Status</Label>\n                                            <select\n                                                id=\"status\"\n                                                value={formData.status}\n                                                onChange={(e) => setFormData({ ...formData, status: e.target.value })}\n                                                className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                                            >\n                                                <option value=\"draft\">Draft</option>\n                                                <option value=\"published\" disabled={!canPublish}>Published {(!canPublish) && '(Locked)'}</option>\n                                                <option value=\"archived\">Archived</option>\n                                            </select>\n                                        </div>\n\n                                        <div className=\"flex items-center gap-2 pt-1\">\n                                            <input\n                                                type=\"checkbox\"\n                                                id=\"is_public\"\n                                                checked={formData.is_public}\n                                                onChange={(e) => setFormData({ ...formData, is_public: e.target.checked })}\n                                                className=\"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-600\"\n                                            />\n                                            <Label htmlFor=\"is_public\" className=\"font-normal text-slate-700 cursor-pointer\">Publicly Visible</Label>\n                                        </div>\n\n                                        <div className=\"flex items-center gap-2 pt-1\">\n                                            <input\n                                                type=\"checkbox\"\n                                                id=\"nav_visibility\"\n                                                checked={formData.nav_visibility}\n                                                onChange={(e) => setFormData({ ...formData, nav_visibility: e.target.checked })}\n                                                className=\"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-600\"\n                                            />\n                                            <Label htmlFor=\"nav_visibility\" className=\"font-normal text-slate-700 cursor-pointer\">Show in Menu</Label>\n                                        </div>\n\n                                        <div className=\"space-y-2 pt-2\">\n                                            <Label htmlFor=\"published_at\">Publish Date (Schedule)</Label>\n                                            <Input\n                                                type=\"datetime-local\"\n                                                id=\"published_at\"\n                                                value={formData.published_at}\n                                                onChange={(e) => setFormData({ ...formData, published_at: e.target.value })}\n                                                className=\"w-full\"\n                                            />\n                                            <p className=\"text-xs text-slate-500\">Leave blank to publish immediately.</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-6\">\n                                <h4 className=\"font-semibold text-slate-800 flex items-center gap-2 text-base border-b border-slate-100 pb-3\">\n                                    <FolderOpen className=\"w-4 h-4 text-blue-600\" /> Categorization & Hierarchy\n                                </h4>\n\n                                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                                    <div className=\"space-y-4\">\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"parent_id\">Parent Page</Label>\n                                            <select\n                                                id=\"parent_id\"\n                                                value={formData.parent_id}\n                                                onChange={(e) => setFormData({ ...formData, parent_id: e.target.value })}\n                                                className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                                            >\n                                                <option value=\"\">No Parent (Top Level)</option>\n                                                {parentPages.map(p => (\n                                                    <option key={p.id} value={p.id}>{p.title} (/{p.slug})</option>\n                                                ))}\n                                            </select>\n                                        </div>\n\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"sort_order\">Sort Order</Label>\n                                            <Input\n                                                id=\"sort_order\"\n                                                type=\"number\"\n                                                value={formData.sort_order}\n                                                onChange={(e) => setFormData({ ...formData, sort_order: e.target.value })}\n                                                placeholder=\"0\"\n                                            />\n                                            <p className=\"text-xs text-slate-500\">Higher numbers appear later in menus.</p>\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"featured_image\">Featured Image</Label>\n                                            <ImageUpload\n                                                value={formData.featured_image}\n                                                onChange={(url) => setFormData({ ...formData, featured_image: url })}\n                                                className=\"h-48\"\n                                            />\n                                        </div>\n                                    </div>\n\n                                    <div className=\"space-y-4\">\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"category\">Category <span className=\"text-red-500\">*</span></Label>\n                                            <select\n                                                id=\"category\"\n                                                value={formData.category_id}\n                                                onChange={(e) => setFormData({ ...formData, category_id: e.target.value })}\n                                                className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                                                required\n                                            >\n                                                <option value=\"\">Select Category</option>\n                                                {categories.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}\n                                            </select>\n                                        </div>\n\n                                        {/* Tags Removed */}\n                                    </div>\n                                </div>\n                            </div>\n                        </TabsContent>\n\n                        {/* Social Media Sharing Tab */}\n                        <TabsContent value=\"social\" className=\"space-y-6 animate-in fade-in zoom-in-95 duration-200\">\n                            <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-6\">\n                                <h4 className=\"font-semibold text-slate-800 flex items-center gap-2 text-base border-b border-slate-100 pb-3\">\n                                    <Share2 className=\"w-4 h-4 text-blue-600\" /> Social Media Settings\n                                </h4>\n\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                                    {/* Open Graph */}\n                                    <div className=\"space-y-4\">\n                                        <Label className=\"text-blue-600 font-semibold block mb-4\">Open Graph (Facebook, LinkedIn)</Label>\n                                        <div className=\"space-y-4 pl-4 border-l-2 border-blue-100\">\n                                            <div className=\"space-y-2\">\n                                                <Label>OG Title</Label>\n                                                <Input\n                                                    value={formData.og_title}\n                                                    onChange={(e) => setFormData({ ...formData, og_title: e.target.value })}\n                                                    placeholder={formData.title}\n                                                />\n                                            </div>\n                                            <div className=\"space-y-2\">\n                                                <Label>OG Description</Label>\n                                                <Textarea\n                                                    value={formData.og_description}\n                                                    onChange={(e) => setFormData({ ...formData, og_description: e.target.value })}\n                                                    placeholder={formData.excerpt}\n                                                    className=\"min-h-[80px]\"\n                                                />\n                                            </div>\n                                            <div className=\"space-y-2\">\n                                                <Label>OG Image</Label>\n                                                <ImageUpload\n                                                    value={formData.og_image}\n                                                    onChange={(url) => setFormData({ ...formData, og_image: url })}\n                                                    className=\"h-32\"\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    {/* Twitter Card */}\n                                    <div className=\"space-y-4\">\n                                        <Label className=\"text-sky-500 font-semibold block mb-4\">Twitter Card</Label>\n                                        <div className=\"space-y-4 pl-4 border-l-2 border-sky-100\">\n                                            <div className=\"space-y-2\">\n                                                <Label>Card Type</Label>\n                                                <select\n                                                    value={formData.twitter_card_type}\n                                                    onChange={(e) => setFormData({ ...formData, twitter_card_type: e.target.value })}\n                                                    className=\"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                                                >\n                                                    <option value=\"summary\">Summary</option>\n                                                    <option value=\"summary_large_image\">Summary Large Image</option>\n                                                </select>\n                                            </div>\n                                            <div className=\"space-y-2\">\n                                                <Label>Twitter Image</Label>\n                                                <ImageUpload\n                                                    value={formData.twitter_image}\n                                                    onChange={(url) => setFormData({ ...formData, twitter_image: url })}\n                                                    className=\"h-32\"\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </TabsContent>\n                    </Tabs>\n                </div>\n            </form >\n        </motion.div >\n    );\n}\n\nexport default PageEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PagesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useCallback } from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport VisualPageBuilder from '@/components/visual-builder/VisualPageBuilder';\nimport { AdminPageLayout, PageHeader, PageTabs, TabsContent } from '@/templates/flowbite-admin';\nimport { FileText, FolderOpen, Layers, Paintbrush, Tags } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useTranslation } from 'react-i18next';\n\n/**\n * PagesManager - Manages pages with Visual Builder support.\n * Refactored to use awadmintemplate01 components for consistent UI.\n */\nfunction PagesManager({ onlyVisual = false }) {\n  const { t } = useTranslation();\n  const [activeTab, setActiveTab] = useState('pages');\n  const [visualBuilderPage, setVisualBuilderPage] = useState(null);\n\n  // Tab definitions\n  const tabs = useMemo(() => onlyVisual ? [] : [\n    { value: 'pages', label: t('pages.tabs.pages'), icon: FileText, color: 'blue' },\n    { value: 'categories', label: t('pages.tabs.categories'), icon: FolderOpen, color: 'purple' },\n    { value: 'tags', label: t('pages.tabs.tags') || 'Tags', icon: Tags, color: 'green' },\n  ], [onlyVisual, t]);\n\n  // Dynamic breadcrumb based on active tab\n  const breadcrumbs = useMemo(() => [\n    { label: onlyVisual ? t('pages.breadcrumbs.visual_pages') : t('pages.breadcrumbs.pages'), href: activeTab !== 'pages' ? '/cmspanel/pages' : undefined, icon: Layers },\n    ...(activeTab !== 'pages' && !onlyVisual ? [{ label: t('pages.breadcrumbs.categories') }] : []),\n  ], [onlyVisual, activeTab, t]);\n\n  // Page columns with editor type indicator\n  const pageColumns = useMemo(() => [\n    { key: 'title', label: t('pages.columns.title'), className: 'font-medium' },\n    { key: 'slug', label: t('pages.columns.path') },\n    {\n      key: 'page_type',\n      label: t('pages.columns.type'),\n      render: (value) => {\n        const colors = {\n          homepage: 'bg-primary/10 text-primary border-primary/20',\n          header: 'bg-muted text-muted-foreground border-border',\n          footer: 'bg-muted text-muted-foreground border-border',\n          single_page: 'bg-secondary text-secondary-foreground',\n          single_post: 'bg-secondary text-secondary-foreground',\n          '404': 'bg-destructive/10 text-destructive border-destructive/20',\n          regular: 'bg-card text-card-foreground border-border border'\n        };\n        const labels = {\n          homepage: t('pages.badges.homepage'),\n          header: t('pages.badges.header'),\n          footer: t('pages.badges.footer'),\n          single_page: t('pages.badges.single_page'),\n          single_post: t('pages.badges.single_post'),\n          '404': t('pages.badges.404'),\n          regular: t('pages.badges.regular')\n        };\n        return (\n          <span className={`px-2 py-0.5 text-xs rounded-full font-medium border ${colors[value] || colors.regular}`}>\n            {labels[value] || value || t('pages.badges.regular')}\n          </span>\n        );\n      }\n    },\n    {\n      key: 'category',\n      label: t('pages.columns.category'),\n      render: (value, row) => (\n        <span className=\"text-sm text-muted-foreground\">\n          {row.category?.name || '-'}\n        </span>\n      )\n    },\n    {\n      key: 'editor_type',\n      label: t('pages.columns.editor'),\n      render: (value) => (\n        <span className={`px-2 py-0.5 text-xs rounded-full border ${value === 'visual'\n          ? 'bg-accent/10 text-accent-foreground border-accent/20'\n          : 'bg-muted text-muted-foreground border-border'\n          }`}>\n          {value === 'visual' ? ` ${t('pages.badges.visual')}` : ` ${t('pages.badges.richtext')}`}\n        </span>\n      )\n    },\n    { key: 'status', label: t('pages.columns.status') },\n    { key: 'published_at', label: t('pages.columns.published'), type: 'date' },\n    { key: 'updated_at', label: t('pages.columns.updated'), type: 'date' }\n  ], [t]);\n\n  const pageFormFields = useMemo(() => [\n    { key: 'title', label: t('pages.form.title'), required: true },\n    {\n      key: 'page_type',\n      label: t('pages.form.page_type'),\n      type: 'select',\n      options: [\n        { value: 'regular', label: t('pages.form.page_type_regular') }\n      ],\n      defaultValue: 'regular',\n      description: t('pages.form.page_type_desc')\n    },\n    { key: 'slug', label: t('pages.form.slug'), required: true },\n    {\n      key: 'status', label: t('pages.form.status'), type: 'select', options: [\n        { value: 'published', label: t('pages.form.status_published') },\n        { value: 'draft', label: t('pages.form.status_draft') }\n      ]\n    },\n    {\n      key: 'editor_type', label: t('pages.form.editor_type'), type: 'select', options: [\n        { value: 'richtext', label: ` ${t('pages.form.editor_richtext')}` },\n        { value: 'visual', label: ` ${t('pages.form.editor_visual')}` }\n      ],\n      defaultValue: onlyVisual ? 'visual' : 'richtext',\n      description: t('pages.form.editor_desc'),\n    },\n    { key: 'category_id', label: t('pages.form.category'), type: 'resource_select', resourceTable: 'categories', filter: { type: 'page' } },\n    { key: 'tags', label: t('pages.form.tags') || 'Tags', type: 'tag_input', description: t('pages.form.tags_desc') || 'Add tags to organize your content' },\n    {\n      key: 'content',\n      label: t('pages.form.content'),\n      type: 'richtext',\n      description: t('pages.form.content_desc'),\n      conditionalShow: (formData) => formData.editor_type !== 'visual'\n    },\n    { key: 'excerpt', label: t('pages.form.excerpt'), type: 'textarea' },\n    { key: 'featured_image', label: t('pages.form.featured_image'), type: 'image' },\n    // SEO Fields\n    { key: 'meta_title', label: t('pages.form.meta_title') || 'Meta Title', type: 'text', description: 'SEO title (60 chars recommended)' },\n    { key: 'meta_description', label: t('pages.form.meta_desc'), type: 'textarea' },\n    { key: 'meta_keywords', label: t('pages.form.meta_keywords') || 'Meta Keywords', type: 'text', description: 'Comma-separated keywords' },\n    { key: 'og_image', label: t('pages.form.og_image') || 'OG Image', type: 'image', description: 'Social sharing image (1200x630 recommended)' },\n    { key: 'canonical_url', label: t('pages.form.canonical_url') || 'Canonical URL', type: 'text', description: 'Full URL if this content exists elsewhere' },\n    { key: 'is_active', label: t('pages.form.active'), type: 'boolean' }\n  ], [onlyVisual, t]);\n\n  // Custom row actions for Visual Builder\n  const customRowActions = useCallback((page) => {\n    if (page.editor_type === 'visual') {\n      return (\n        <Button\n          size=\"sm\"\n          onClick={(e) => {\n            e.stopPropagation();\n            setVisualBuilderPage(page);\n          }}\n          variant=\"outline\"\n          className=\"h-7 px-2 text-xs border-accent text-accent-foreground hover:bg-accent/10\"\n          title={t('pages.action_edit_visual')}\n        >\n          <Paintbrush className=\"w-3 h-3 mr-1.5\" />\n          {t('pages.action_edit_visual')}\n        </Button>\n      );\n    }\n    return null;\n  }, [t]);\n\n  // Category columns and fields\n  const categoryColumns = useMemo(() => [\n    { key: 'name', label: t('pages.category.name'), className: 'font-medium' },\n    { key: 'slug', label: t('pages.category.slug') },\n    { key: 'description', label: t('pages.category.description') },\n    { key: 'created_at', label: t('pages.category.created'), type: 'date' }\n  ], [t]);\n\n  const categoryFormFields = useMemo(() => [\n    { key: 'name', label: t('pages.category.form.name'), required: true },\n    { key: 'slug', label: t('pages.category.form.slug') },\n    { key: 'description', label: t('pages.category.form.description'), type: 'textarea' },\n    {\n      key: 'type', label: t('pages.category.form.type'), type: 'select', options: [\n        { value: 'page', label: t('pages.category.form.type_page') },\n        { value: 'blog', label: t('pages.category.form.type_blog') },\n        { value: 'product', label: t('pages.category.form.type_product') }\n      ], defaultValue: 'page'\n    }\n  ], [t]);\n\n  // If Visual Builder is open, show it full screen\n  if (visualBuilderPage) {\n    return (\n      <VisualPageBuilder\n        page={visualBuilderPage}\n        onClose={() => setVisualBuilderPage(null)}\n        onSuccess={() => setVisualBuilderPage(null)}\n      />\n    );\n  }\n\n  return (\n    <AdminPageLayout requiredPermission={onlyVisual ? \"tenant.visual_pages.read\" : \"tenant.pages.read\"}>\n      {/* Page Header with Breadcrumbs */}\n      <PageHeader\n        title={onlyVisual ? t('pages.visual_title') : t('pages.title')}\n        description={onlyVisual ? t('pages.visual_desc') : t('pages.subtitle')}\n        icon={Layers}\n        breadcrumbs={breadcrumbs}\n      />\n\n      {/* Tabs Navigation (hidden for onlyVisual mode) */}\n      {onlyVisual ? (\n        <GenericContentManager\n          tableName=\"pages\"\n          resourceName={t('pages.visual_title')} // Or generic \"Visual Page\" if strictly needed in singular, but title works\n          columns={pageColumns}\n          formFields={pageFormFields}\n          permissionPrefix=\"visual_pages\"\n          customRowActions={customRowActions}\n          defaultFilters={{ editor_type: 'visual' }}\n          showBreadcrumbs={false}\n        />\n      ) : (\n        <PageTabs\n          value={activeTab}\n          onValueChange={setActiveTab}\n          tabs={tabs}\n        >\n          <TabsContent value=\"pages\" className=\"mt-0\">\n            <GenericContentManager\n              tableName=\"pages\"\n              resourceName={t('pages.badges.regular')}\n              columns={pageColumns}\n              formFields={pageFormFields}\n              permissionPrefix=\"pages\"\n              defaultFilters={{ page_type: 'regular' }}\n              customSelect=\"*, category:categories!pages_category_id_fkey(id, name), owner:users!created_by(email, full_name), tenant:tenants(name)\"\n              customRowActions={customRowActions}\n              showBreadcrumbs={false}\n            />\n          </TabsContent>\n\n          <TabsContent value=\"categories\" className=\"mt-0\">\n            <GenericContentManager\n              tableName=\"categories\"\n              resourceName={t('pages.category.form.type_page')} // Or Category singular\n              columns={categoryColumns}\n              formFields={categoryFormFields}\n              permissionPrefix=\"categories\"\n              customSelect=\"*, owner:users!created_by(email, full_name), tenant:tenants(name)\"\n              defaultFilters={{ type: 'page' }}\n              showBreadcrumbs={false}\n            />\n          </TabsContent>\n\n          <TabsContent value=\"tags\" className=\"mt-0\">\n            <GenericContentManager\n              tableName=\"tags\"\n              resourceName={t('pages.tags.singular') || 'Tag'}\n              columns={[\n                { key: 'name', label: t('pages.tags.name') || 'Name', className: 'font-medium' },\n                { key: 'slug', label: t('pages.tags.slug') || 'Slug' },\n                { key: 'created_at', label: t('pages.tags.created') || 'Created', type: 'date' }\n              ]}\n              formFields={[\n                { key: 'name', label: t('pages.tags.form.name') || 'Name', required: true },\n                { key: 'slug', label: t('pages.tags.form.slug') || 'Slug' }\n              ]}\n              permissionPrefix=\"tags\"\n              customSelect=\"*, owner:users!created_by(email, full_name), tenant:tenants(name)\"\n              showBreadcrumbs={false}\n            />\n          </TabsContent>\n        </PageTabs>\n      )}\n    </AdminPageLayout>\n  );\n}\n\nexport default PagesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PartnersManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Handshake } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction PartnersManager() {\n    const columns = [\n        {\n            key: 'logo',\n            label: 'Logo',\n            render: (value) => value ? <img src={value} alt=\"Partner\" className=\"h-8 object-contain\" /> : '-'\n        },\n        { key: 'name', label: 'Name' },\n        { key: 'link', label: 'Website' },\n        { key: 'order', label: 'Order', type: 'number' },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'published' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'draft' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n                        'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'draft'}\n                </span>\n            )\n        }\n    ];\n\n    const formFields = [\n        { key: 'name', label: 'Partner Name', required: true },\n        { key: 'logo', label: 'Logo Image', type: 'image', required: true },\n        { key: 'link', label: 'Website URL' },\n        { key: 'order', label: 'Sort Order', type: 'number', defaultValue: 0 },\n        {\n            key: 'status',\n            label: 'Status',\n            type: 'select',\n            options: [\n                { value: 'draft', label: 'Draft' },\n                { value: 'published', label: 'Published' },\n                { value: 'archived', label: 'Archived' }\n            ]\n        }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.partners.read\">\n            <PageHeader\n                title=\"Partners\"\n                description=\"Manage partner logos and sponsorships.\"\n                icon={Handshake}\n                breadcrumbs={[{ label: 'Partners', icon: Handshake }]}\n            />\n\n            <GenericContentManager\n                tableName=\"partners\"\n                resourceName=\"Partner\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"partners\"\n                showBreadcrumbs={false}\n                defaultSortColumn=\"order\"\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default PartnersManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PaymentMethodsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[80,91],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Payment Methods Manager - Configure available payment options\n */\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { CreditCard } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction PaymentMethodsManager() {\n    const columns = [\n        {\n            key: 'icon',\n            label: '',\n            className: 'w-12',\n            render: (val) => {\n                if (val && val.startsWith('http')) {\n                    return <img src={val} alt=\"\" className=\"w-8 h-8 object-contain\" />;\n                }\n                return (\n                    <div className=\"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center\">\n                        <CreditCard className=\"w-4 h-4 text-primary\" />\n                    </div>\n                );\n            }\n        },\n        { key: 'name', label: 'Payment Method', className: 'font-medium' },\n        {\n            key: 'type',\n            label: 'Type',\n            render: (val) => {\n                const typeConfig = {\n                    xendit: { bg: 'bg-blue-100 dark:bg-blue-900/30', text: 'text-blue-700 dark:text-blue-400', label: 'Xendit' },\n                    bank_transfer: { bg: 'bg-green-100 dark:bg-green-900/30', text: 'text-green-700 dark:text-green-400', label: 'Bank Transfer' },\n                    cod: { bg: 'bg-amber-100 dark:bg-amber-900/30', text: 'text-amber-700 dark:text-amber-400', label: 'Cash on Delivery' },\n                    manual: { bg: 'bg-muted', text: 'text-muted-foreground', label: 'Manual' }\n                };\n                const config = typeConfig[val] || typeConfig.manual;\n                return (\n                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${config.bg} ${config.text}`}>\n                        {config.label}\n                    </span>\n                );\n            }\n        },\n        {\n            key: 'description',\n            label: 'Description',\n            render: (val) => val ? (\n                <span className=\"text-slate-600 line-clamp-1 max-w-[300px]\">{val}</span>\n            ) : (\n                <span className=\"text-slate-300\">-</span>\n            )\n        },\n        {\n            key: 'is_active',\n            label: 'Status',\n            render: (val) => val ? (\n                <span className=\"text-green-600 dark:text-green-400 text-xs font-medium\"> Active</span>\n            ) : (\n                <span className=\"text-muted-foreground/50 text-xs\">Inactive</span>\n            )\n        },\n        { key: 'sort_order', label: 'Order', className: 'text-center' }\n    ];\n\n    const formFields = [\n        { key: 'name', label: 'Method Name', required: true, description: 'E.g., Credit Card, Bank Transfer' },\n        {\n            key: 'type', label: 'Payment Type', type: 'select', required: true, options: [\n                { value: 'xendit', label: 'Xendit (Online Payment)' },\n                { value: 'bank_transfer', label: 'Bank Transfer (Manual)' },\n                { value: 'cod', label: 'Cash on Delivery' },\n                { value: 'manual', label: 'Manual Payment' }\n            ]\n        },\n        { key: 'description', label: 'Description', type: 'textarea', description: 'Shown to customers during checkout' },\n        { key: 'icon', label: 'Icon URL', description: 'Image URL for payment method icon' },\n        {\n            key: 'config',\n            label: 'Configuration (JSON)',\n            type: 'textarea',\n            description: 'JSON config for payment gateway. Leave empty for manual methods.',\n            placeholder: '{\"api_key\": \"your_xendit_key\"}'\n        },\n        { key: 'is_active', label: 'Active', type: 'boolean', description: 'Enable this payment method' },\n        { key: 'sort_order', label: 'Display Order', type: 'number', description: 'Lower numbers appear first' }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.payment_methods.read\">\n            <PageHeader\n                title=\"Payment Methods\"\n                description=\"Configure available payment options for checkout.\"\n                icon={CreditCard}\n                breadcrumbs={[{ label: 'Payment Methods', icon: CreditCard }]}\n            />\n\n            <div className=\"space-y-6\">\n                <div className=\"bg-primary/5 border border-primary/20 rounded-xl p-4\">\n                    <div className=\"flex items-start gap-3\">\n                        <div className=\"p-2 bg-primary/10 rounded-lg\">\n                            <CreditCard className=\"w-5 h-5 text-primary\" />\n                        </div>\n                        <div className=\"flex-1\">\n                            <h3 className=\"font-semibold text-foreground mb-1\">Xendit Configuration</h3>\n                            <p className=\"text-sm text-muted-foreground mb-2\">\n                                To enable online payments via Xendit, you need to configure the API key in the Edge Function.\n                            </p>\n                            <ol className=\"text-sm text-muted-foreground space-y-1 list-decimal list-inside\">\n                                <li>Get your API key from <a href=\"https://dashboard.xendit.co\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline font-medium text-primary hover:text-primary/80\">Xendit Dashboard</a></li>\n                                <li>Add <code className=\"bg-muted px-1 rounded text-xs font-mono text-foreground\">XENDIT_API_KEY</code> to Supabase Edge Function secrets</li>\n                                <li>Create a payment method with type &quot;Xendit&quot;</li>\n                            </ol>\n                        </div>\n                    </div>\n                </div>\n\n                <GenericContentManager\n                    tableName=\"payment_methods\"\n                    resourceName=\"Payment Method\"\n                    columns={columns}\n                    formFields={formFields}\n                    permissionPrefix=\"payment_methods\"\n                    showBreadcrumbs={false}\n                />\n            </div>\n        </AdminPageLayout>\n    );\n}\n\nexport default PaymentMethodsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PermissionMatrix.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PermissionsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Shield, Plus, RefreshCw } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useSearch } from '@/hooks/useSearch';\nimport MinCharSearchInput from '@/components/common/MinCharSearchInput';\nimport ContentTable from '@/components/dashboard/ContentTable';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Label } from '@/components/ui/label';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction PermissionsManager() {\n  const { toast } = useToast();\n  const { isPlatformAdmin, isFullAccess, loading: permsLoading } = usePermissions();\n\n  const {\n    query,\n    setQuery,\n    debouncedQuery,\n    isValid: isSearchValid,\n    message: searchMessage,\n    loading: searchLoading,\n    minLength,\n    clearSearch\n  } = useSearch({ context: 'admin' });\n\n  const [permissions, setPermissions] = useState([]);\n  const [filteredPermissions, setFilteredPermissions] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [isEditorOpen, setIsEditorOpen] = useState(false);\n  const [editingPermission, setEditingPermission] = useState(null);\n  const [formData, setFormData] = useState({ name: '', description: '', resource: '', action: '' });\n\n  // Pagination State\n  const [currentPage, setCurrentPage] = useState(1);\n  const [itemsPerPage, setItemsPerPage] = useState(10);\n\n  const isSuperAdmin = isPlatformAdmin || isFullAccess;\n\n  const fetchPermissions = useCallback(async () => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('permissions')\n        .select('*')\n        .is('deleted_at', null)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setPermissions(data || []);\n      setFilteredPermissions(data || []);\n    } catch (error) {\n      console.error('Fetch permissions error:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to fetch permissions.\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [toast]);\n\n  useEffect(() => {\n    if (!permsLoading) {\n      if (isSuperAdmin) {\n        fetchPermissions();\n      } else {\n        setLoading(false);\n      }\n    }\n  }, [permsLoading, isSuperAdmin, fetchPermissions]);\n\n  useEffect(() => {\n    if (!debouncedQuery) {\n      setFilteredPermissions(permissions);\n    } else {\n      const lower = debouncedQuery.toLowerCase();\n      setFilteredPermissions(permissions.filter(p =>\n        p.name.toLowerCase().includes(lower) ||\n        (p.description && p.description.toLowerCase().includes(lower))\n      ));\n    }\n  }, [debouncedQuery, permissions]);\n\n  // Reset to page 1 on search\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [debouncedQuery]);\n\n  // Pagination Logic\n  const totalItems = filteredPermissions.length;\n  const totalPages = Math.ceil(totalItems / itemsPerPage);\n  const paginatedPermissions = filteredPermissions.slice(\n    (currentPage - 1) * itemsPerPage,\n    currentPage * itemsPerPage\n  );\n\n  const handleSave = async (e) => {\n    e.preventDefault();\n    try {\n      const payload = {\n        name: formData.name,\n        description: formData.description,\n        resource: formData.resource,\n        action: formData.action,\n        deleted_at: null,\n        updated_at: new Date().toISOString()\n      };\n\n      if (editingPermission) {\n        const { error } = await supabase\n          .from('permissions')\n          .update(payload)\n          .eq('id', editingPermission.id);\n        if (error) throw error;\n        toast({ title: \"Success\", description: \"Permission updated\" });\n      } else {\n        payload.created_at = new Date().toISOString();\n        const { error } = await supabase\n          .from('permissions')\n          .insert([payload]);\n        if (error) throw error;\n        toast({ title: \"Success\", description: \"Permission created\" });\n      }\n      setIsEditorOpen(false);\n      fetchPermissions();\n    } catch (error) {\n      toast({ variant: \"destructive\", title: \"Error\", description: error.message });\n    }\n  };\n\n  const handleDelete = async (id) => {\n    if (!window.confirm(\"Are you sure? This might break role access.\")) return;\n    try {\n      const { error } = await supabase\n        .from('permissions')\n        .update({ deleted_at: new Date().toISOString() })\n        .eq('id', id);\n      if (error) throw error;\n      toast({ title: \"Success\", description: \"Permission moved to trash\" });\n      fetchPermissions();\n    } catch (error) {\n      toast({ variant: \"destructive\", title: \"Error\", description: error.message });\n    }\n  };\n\n  const columns = [\n    { key: 'name', label: 'Permission Name', className: 'font-semibold' },\n    { key: 'resource', label: 'Resource', className: 'text-slate-500' },\n    { key: 'action', label: 'Action', className: 'text-slate-500' },\n    { key: 'description', label: 'Description' }\n  ];\n\n  if (!isSuperAdmin) {\n    return (\n      <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-card rounded-xl border border-border p-12 text-center\">\n        <Shield className=\"w-12 h-12 text-destructive mb-4\" />\n        <h3 className=\"text-xl font-bold text-foreground\">Access Restricted</h3>\n        <p className=\"text-muted-foreground\">Platform admin only.</p>\n      </div>\n    );\n  }\n\n  return (\n    <AdminPageLayout requiredPermission=\"platform.permissions.read\">\n      <PageHeader\n        title=\"Permissions\"\n        description=\"Manage system permissions\"\n        icon={Shield}\n        breadcrumbs={[{ label: 'Permissions', icon: Shield }]}\n        actions={(\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={fetchPermissions}\n              title=\"Refresh\"\n              className=\"h-10 w-10 border-slate-200/70 bg-white/70 hover:bg-white shadow-sm\"\n            >\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n            <Button onClick={() => {\n              setEditingPermission(null);\n              setFormData({ name: '', description: '', resource: '', action: '' });\n              setIsEditorOpen(true);\n            }} className=\"bg-indigo-600 text-white hover:bg-indigo-700 shadow-sm\">\n              <Plus className=\"w-4 h-4 mr-2\" /> New Permission\n            </Button>\n          </div>\n        )}\n      />\n\n      <div className=\"dashboard-surface dashboard-surface-hover p-4\">\n        <MinCharSearchInput\n          value={query}\n          onChange={e => setQuery(e.target.value)}\n          onClear={clearSearch}\n          loading={loading || searchLoading}\n          isValid={isSearchValid}\n          message={searchMessage}\n          minLength={minLength}\n          placeholder=\"Search permissions\"\n        />\n      </div>\n\n      <ContentTable\n        data={paginatedPermissions}\n        columns={columns}\n        loading={loading}\n        onEdit={(perm) => {\n          setEditingPermission(perm);\n          setFormData(perm);\n          setIsEditorOpen(true);\n        }}\n        onDelete={handleDelete}\n        pagination={{\n          currentPage,\n          totalPages,\n          totalItems,\n          itemsPerPage,\n          onPageChange: setCurrentPage,\n          onLimitChange: (limit) => {\n            setItemsPerPage(limit);\n            setCurrentPage(1);\n          }\n        }}\n      />\n\n      <Dialog open={isEditorOpen} onOpenChange={setIsEditorOpen}>\n        <DialogContent className=\"sm:max-w-xl\">\n          <DialogHeader>\n            <DialogTitle>{editingPermission ? 'Edit Permission' : 'New Permission'}</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSave} className=\"space-y-4\">\n            <div>\n              <Label>Name (e.g. view_blogs)</Label>\n              <Input value={formData.name} onChange={e => setFormData({ ...formData, name: e.target.value })} required className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\" />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label>Resource</Label>\n                <Input value={formData.resource} onChange={e => setFormData({ ...formData, resource: e.target.value })} required className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\" />\n              </div>\n              <div>\n                <Label>Action</Label>\n                <Input value={formData.action} onChange={e => setFormData({ ...formData, action: e.target.value })} required className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\" />\n              </div>\n            </div>\n            <div>\n              <Label>Description</Label>\n              <Input value={formData.description} onChange={e => setFormData({ ...formData, description: e.target.value })} className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\" />\n            </div>\n            <DialogFooter>\n              <Button type=\"submit\" className=\"bg-indigo-600 text-white hover:bg-indigo-700\">Save</Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </AdminPageLayout>\n  );\n}\n\nexport default PermissionsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PhotoGalleryManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { ImageIcon } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction PhotoGalleryManager() {\n    const columns = [\n        { key: 'title', label: 'Album Title' },\n        {\n            key: 'photos',\n            label: 'Photos',\n            render: (value) => (\n                <span className=\"text-sm text-muted-foreground\">\n                    {Array.isArray(value) ? value.length : 0} photos\n                </span>\n            )\n        },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'published' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'draft' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n                        'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'draft'}\n                </span>\n            )\n        },\n        {\n            key: 'published_at',\n            label: 'Publish Date',\n            type: 'date',\n            render: (value) => value ? new Date(value).toLocaleDateString() : '-'\n        }\n    ];\n\n    const formFields = [\n        { key: 'title', label: 'Album Title', required: true },\n        { key: 'slug', label: 'Slug', description: 'URL-friendly name (auto-generated if empty)' },\n        { key: 'description', label: 'Description', type: 'richtext' },\n        { key: 'cover_image', label: 'Cover Image', type: 'image', description: 'Main album thumbnail' },\n        { key: 'photos', label: 'Photos', type: 'images', description: 'Add multiple photos to album', maxImages: 50 },\n        { key: 'category_id', label: 'Category', type: 'relation', table: 'categories' },\n        { key: 'published_at', label: 'Publish Date', type: 'datetime', description: 'Schedule for future release (optional)' },\n        {\n            key: 'status', label: 'Status', type: 'select', options: [\n                { value: 'draft', label: 'Draft' },\n                { value: 'published', label: 'Published' }\n            ]\n        }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.photo_gallery.read\">\n            <PageHeader\n                title=\"Photo Gallery\"\n                description=\"Manage photo albums and galleries.\"\n                icon={ImageIcon}\n                breadcrumbs={[{ label: 'Photo Gallery', icon: ImageIcon }]}\n            />\n\n            <GenericContentManager\n                tableName=\"photo_gallery\"\n                resourceName=\"Photo Album\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"photo_gallery\"\n                showBreadcrumbs={false}\n                customSelect=\"*\"\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default PhotoGalleryManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PolicyManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":90,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":90,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useToast } from '@/components/ui/use-toast';\nimport { Plus, Trash2, Edit2, Shield } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nexport default function PolicyManager() {\n    const { tenantId, hasPermission, isPlatformAdmin } = usePermissions();\n    const { toast } = useToast();\n    const { t } = useTranslation();\n    const [policies, setPolicies] = useState([]);\n    const [loading, setLoading] = useState(false);\n\n    const canManage = isPlatformAdmin || hasPermission('tenant.policy.create'); // Simplified for now, usually create/update/delete separate\n    const canView = isPlatformAdmin || hasPermission('tenant.policy.read');\n\n    // Editor State\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\n    const [editingPolicy, setEditingPolicy] = useState(null);\n    const [formData, setFormData] = useState({\n        name: '',\n        description: '',\n        effect: 'deny',\n        actions: '',\n        conditions: '{}'\n    });\n\n    const fetchPolicies = useCallback(async () => {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('policies')\n                .select('*')\n                .is('deleted_at', null)\n                .order('created_at', { ascending: false });\n\n            if (error) throw error;\n            setPolicies(data || []);\n        } catch (err) {\n            console.error('Error fetching policies:', err);\n            toast({ variant: \"destructive\", title: t('policies.toasts.save_failed'), description: t('policies.toasts.load_error') });\n        } finally {\n            setLoading(false);\n        }\n    }, [toast, t]);\n\n    useEffect(() => {\n        if (canView) {\n            fetchPolicies();\n        }\n    }, [tenantId, canView, fetchPolicies]);\n\n    if (!canView) return <div className=\"p-8 text-center text-red-500\">{t('policies.access_denied')}</div>;\n\n    const handleOpenDialog = (policy = null) => {\n        if (policy) {\n            setEditingPolicy(policy);\n            setFormData({\n                name: policy.name,\n                description: policy.description || '',\n                effect: policy.definition?.effect || 'deny',\n                actions: (policy.definition?.actions || []).join(', '),\n                conditions: JSON.stringify(policy.definition?.conditions || {}, null, 2)\n            });\n        } else {\n            setEditingPolicy(null);\n            setFormData({\n                name: '',\n                description: '',\n                effect: 'deny',\n                actions: '',\n                conditions: '{\\n  \"channel\": \"mobile\"\\n}'\n            });\n        }\n        setIsDialogOpen(true);\n    };\n\n    const handleSave = async () => {\n        try {\n            // Validate JSON\n            let conditions = {};\n            try {\n                conditions = JSON.parse(formData.conditions);\n            } catch (e) {\n                toast({ variant: \"destructive\", title: t('policies.toasts.save_failed'), description: t('policies.toasts.invalid_json') });\n                return;\n            }\n\n            const definition = {\n                effect: formData.effect,\n                actions: formData.actions.split(',').map(s => s.trim()).filter(Boolean),\n                conditions\n            };\n\n            const payload = {\n                name: formData.name,\n                description: formData.description,\n                definition,\n                tenant_id: tenantId, // Context ensures correct tenant\n                deleted_at: null\n            };\n\n            let error;\n            if (editingPolicy) {\n                const { error: updateError } = await supabase\n                    .from('policies')\n                    .update(payload)\n                    .eq('id', editingPolicy.id);\n                error = updateError;\n            } else {\n                const { error: insertError } = await supabase\n                    .from('policies')\n                    .insert(payload);\n                error = insertError;\n            }\n\n            if (error) throw error;\n\n            toast({ title: t('policies.toasts.success_title'), description: editingPolicy ? t('policies.toasts.updated') : t('policies.toasts.created') });\n            setIsDialogOpen(false);\n            fetchPolicies();\n\n        } catch (err) {\n            console.error('Error saving policy:', err);\n            toast({ variant: \"destructive\", title: t('policies.toasts.save_failed'), description: err.message });\n        }\n    };\n\n    const handleDelete = async (id) => {\n        if (!window.confirm(t('policies.toasts.delete_confirm'))) return;\n\n        try {\n            const { error } = await supabase\n                .from('policies')\n                .update({ deleted_at: new Date().toISOString() })\n                .eq('id', id);\n            if (error) throw error;\n            toast({ title: t('policies.toasts.deleted'), description: t('policies.toasts.deleted') });\n            fetchPolicies();\n        } catch (err) {\n            toast({ variant: \"destructive\", title: t('policies.toasts.delete_failed'), description: err.message });\n        }\n    };\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.policy.read\">\n            <PageHeader\n                title={t('policies.page_title')}\n                description={t('policies.page_desc')}\n                icon={Shield}\n                breadcrumbs={[{ label: t('policies.page_title'), icon: Shield }]}\n                actions={canManage && (\n                    <Button onClick={() => handleOpenDialog()}>\n                        <Plus className=\"w-4 h-4 mr-2\" /> {t('policies.new_policy')}\n                    </Button>\n                )}\n            />\n\n            <div className=\"bg-white rounded-md border shadow-sm\">\n                <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-sm text-left\">\n                        <thead className=\"bg-slate-50 text-slate-500 font-medium border-b\">\n                            <tr>\n                                <th className=\"px-4 py-3\">{t('policies.table.name')}</th>\n                                <th className=\"px-4 py-3\">{t('policies.table.effect')}</th>\n                                <th className=\"px-4 py-3\">{t('policies.table.actions')}</th>\n                                <th className=\"px-4 py-3\">{t('policies.table.conditions')}</th>\n                                <th className=\"px-4 py-3 text-right\">{t('policies.table.actions')}</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y\">\n                            {loading ? (\n                                <tr><td colSpan=\"5\" className=\"p-8 text-center text-slate-400\">{t('policies.table.loading')}</td></tr>\n                            ) : policies.length === 0 ? (\n                                <tr><td colSpan=\"5\" className=\"p-8 text-center text-slate-400\">{t('policies.table.empty')}</td></tr>\n                            ) : (\n                                policies.map(policy => (\n                                    <tr key={policy.id} className=\"hover:bg-slate-50/50\">\n                                        <td className=\"px-4 py-3 font-medium\">\n                                            {policy.name}\n                                            {policy.description && <p className=\"text-xs text-slate-400 font-normal\">{policy.description}</p>}\n                                        </td>\n                                        <td className=\"px-4 py-3\">\n                                            <span className={`inline-flex px-2 py-0.5 rounded text-xs font-bold uppercase ${policy.definition?.effect === 'deny'\n                                                ? 'bg-red-100 text-red-700'\n                                                : 'bg-green-100 text-green-700'\n                                                }`}>\n                                                {policy.definition?.effect === 'deny' ? t('policies.effects.deny') : t('policies.effects.allow')}\n                                            </span>\n                                        </td>\n                                        <td className=\"px-4 py-3 font-mono text-xs text-slate-600\">\n                                            {policy.definition?.actions?.join(', ') || '*'}\n                                        </td>\n                                        <td className=\"px-4 py-3 font-mono text-xs text-slate-500 max-w-xs truncate\">\n                                            {JSON.stringify(policy.definition?.conditions)}\n                                        </td>\n                                        <td className=\"px-4 py-3 text-right space-x-2\">\n                                            {canManage && (\n                                                <>\n                                                    <Button variant=\"ghost\" size=\"sm\" onClick={() => handleOpenDialog(policy)}>\n                                                        <Edit2 className=\"w-4 h-4 text-slate-500\" />\n                                                    </Button>\n                                                    <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDelete(policy.id)}>\n                                                        <Trash2 className=\"w-4 h-4 text-red-500\" />\n                                                    </Button>\n                                                </>\n                                            )}\n                                        </td>\n                                    </tr>\n                                ))\n                            )}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n                <DialogContent className=\"max-w-md\">\n                    <DialogHeader>\n                        <DialogTitle>{editingPolicy ? t('policies.dialog.edit_title') : t('policies.dialog.create_title')}</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                        <div className=\"space-y-2\">\n                            <label className=\"text-sm font-medium\">{t('policies.dialog.name')}</label>\n                            <Input\n                                value={formData.name}\n                                onChange={e => setFormData({ ...formData, name: e.target.value })}\n                                placeholder={t('policies.dialog.name_placeholder')}\n                            />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <label className=\"text-sm font-medium\">{t('policies.dialog.description')}</label>\n                            <Input\n                                value={formData.description}\n                                onChange={e => setFormData({ ...formData, description: e.target.value })}\n                                placeholder={t('policies.dialog.desc_placeholder')}\n                            />\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <label className=\"text-sm font-medium\">{t('policies.dialog.effect')}</label>\n                                <select\n                                    className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                                    value={formData.effect}\n                                    onChange={e => setFormData({ ...formData, effect: e.target.value })}\n                                >\n                                    <option value=\"deny\">{t('policies.effects.deny')}</option>\n                                    <option value=\"allow\">{t('policies.effects.allow')}</option>\n                                </select>\n                            </div>\n                            <div className=\"space-y-2\">\n                                <label className=\"text-sm font-medium\">{t('policies.dialog.actions')}</label>\n                                <Input\n                                    value={formData.actions}\n                                    onChange={e => setFormData({ ...formData, actions: e.target.value })}\n                                    placeholder={t('policies.dialog.actions_placeholder')}\n                                />\n                            </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <label className=\"text-sm font-medium\">{t('policies.dialog.conditions')}</label>\n                            <Textarea\n                                value={formData.conditions}\n                                onChange={e => setFormData({ ...formData, conditions: e.target.value })}\n                                className=\"font-mono text-xs h-32\"\n                            />\n                            <p className=\"text-xs text-slate-500\">\n                                {t('policies.dialog.context_help')}\n                            </p>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>{t('policies.dialog.cancel')}</Button>\n                        <Button onClick={handleSave}>{t('policies.dialog.save')}</Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n        </AdminPageLayout>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PortfolioManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Briefcase } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction PortfolioManager() {\n    const columns = [\n        { key: 'title', label: 'Project' },\n        { key: 'client', label: 'Client' },\n        { key: 'project_date', label: 'Date', type: 'date' },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'published' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'draft' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n                        'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'draft'}\n                </span>\n            )\n        },\n        {\n            key: 'published_at',\n            label: 'Publish Date',\n            type: 'date',\n            render: (value) => value ? new Date(value).toLocaleDateString() : '-'\n        }\n    ];\n\n    const formFields = [\n        { key: 'title', label: 'Project Title', required: true },\n        { key: 'slug', label: 'URL Slug', placeholder: 'auto-generated-from-title' },\n        { key: 'featured_image', label: 'Cover Image', type: 'image', description: 'Main project thumbnail' },\n        { key: 'client', label: 'Client Name' },\n        { key: 'description', label: 'Description', type: 'richtext' },\n        { key: 'project_date', label: 'Project Date', type: 'date' },\n        { key: 'category_id', label: 'Category', type: 'relation', table: 'categories', filter: { type: 'portfolio' } },\n        { key: 'published_at', label: 'Publish Date', type: 'datetime' },\n        {\n            key: 'status',\n            label: 'Status',\n            type: 'select',\n            options: [\n                { value: 'draft', label: 'Draft' },\n                { value: 'published', label: 'Published' },\n                { value: 'archived', label: 'Archived' }\n            ]\n        },\n        { key: 'images', label: 'Project Gallery', type: 'images', maxImages: 20, description: 'Add multiple project images' }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.portfolio.read\">\n            <PageHeader\n                title=\"Portfolio\"\n                description=\"Manage your portfolio and project showcase.\"\n                icon={Briefcase}\n                breadcrumbs={[{ label: 'Portfolio', icon: Briefcase }]}\n            />\n\n            <GenericContentManager\n                tableName=\"portfolio\"\n                resourceName=\"Portfolio Project\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"portfolio\"\n                showBreadcrumbs={false}\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default PortfolioManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ProductTypesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Layers } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction ProductTypesManager() {\n  const columns = [\n    {\n      key: 'icon',\n      label: '',\n      className: 'w-12',\n      render: (val) => val ? (\n        <div className=\"w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center text-lg\">\n          {val.startsWith('http') ? (\n            <img src={val} alt=\"\" className=\"w-6 h-6 object-contain\" />\n          ) : (\n            val\n          )}\n        </div>\n      ) : (\n        <div className=\"w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center\">\n          <Layers className=\"w-5 h-5 text-slate-400\" />\n        </div>\n      )\n    },\n    { key: 'name', label: 'Type Name', className: 'font-medium' },\n    { key: 'slug', label: 'Slug', className: 'font-mono text-xs text-slate-500' },\n    {\n      key: 'description',\n      label: 'Description',\n      render: (val) => val ? (\n        <span className=\"text-slate-600 line-clamp-1 max-w-[300px]\">{val}</span>\n      ) : (\n        <span className=\"text-slate-300\">-</span>\n      )\n    },\n    {\n      key: 'tags',\n      label: 'Tags',\n      render: (val) => val && val.length > 0 ? (\n        <div className=\"flex gap-1 flex-wrap\">\n          {val.slice(0, 3).map((tag, i) => (\n            <span key={i} className=\"px-2 py-0.5 bg-blue-50 text-blue-600 rounded-full text-xs\">\n              {tag}\n            </span>\n          ))}\n          {val.length > 3 && (\n            <span className=\"text-xs text-slate-400\">+{val.length - 3}</span>\n          )}\n        </div>\n      ) : (\n        <span className=\"text-slate-300\">-</span>\n      )\n    },\n    { key: 'created_at', label: 'Created', type: 'date' }\n  ];\n\n  const formFields = [\n    { key: 'name', label: 'Type Name', required: true, description: 'E.g., Electronics, Clothing, Food' },\n    { key: 'slug', label: 'Slug', required: true, description: 'URL-friendly identifier' },\n    { key: 'description', label: 'Description', type: 'textarea', description: 'Brief description of this product type' },\n    { key: 'icon', label: 'Icon', description: 'Emoji or image URL' },\n    { key: 'tags', label: 'Tags', type: 'tags', description: 'Keywords for filtering and search' }\n  ];\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.product_types.read\">\n      <PageHeader\n        title=\"Product Types\"\n        description=\"Define product categories and classification types.\"\n        icon={Layers}\n        breadcrumbs={[{ label: 'Product Types', icon: Layers }]}\n      />\n\n      <GenericContentManager\n        tableName=\"product_types\"\n        resourceName=\"Product Type\"\n        columns={columns}\n        formFields={formFields}\n        permissionPrefix=\"product_types\"\n        showBreadcrumbs={false}\n      />\n    </AdminPageLayout>\n  );\n}\n\nexport default ProductTypesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ProductsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Package, Layers, FolderOpen } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction ProductsManager() {\n  const { t } = useTranslation();\n  const [activeTab, setActiveTab] = useState('products');\n\n  // Product columns\n  const productColumns = [\n    {\n      key: 'featured_image',\n      label: '',\n      className: 'w-16',\n      render: (val) => val ? (\n        <img src={val} alt=\"\" className=\"w-12 h-12 object-cover rounded-lg border border-border\" />\n      ) : (\n        <div className=\"w-12 h-12 bg-muted rounded-lg flex items-center justify-center\">\n          <Package className=\"w-6 h-6 text-muted-foreground\" />\n        </div>\n      )\n    },\n    { key: 'name', label: t('products.product_name'), className: 'font-medium' },\n    {\n      key: 'sku',\n      label: t('products.sku'),\n      className: 'font-mono text-xs text-muted-foreground',\n      render: (val) => val || <span className=\"text-muted-foreground/50\">-</span>\n    },\n    {\n      key: 'price',\n      label: t('products.price'),\n      render: (val, row) => (\n        <div className=\"flex flex-col\">\n          {row.discount_price && row.discount_price < val ? (\n            <>\n              <span className=\"text-green-600 font-semibold dark:text-green-400\">\n                {new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(row.discount_price)}\n              </span>\n              <span className=\"text-xs text-muted-foreground line-through\">\n                {new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(val)}\n              </span>\n            </>\n          ) : (\n            <span className=\"font-semibold\">\n              {new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(val)}\n            </span>\n          )}\n        </div>\n      )\n    },\n    {\n      key: 'stock',\n      label: t('products.stock'),\n      render: (val) => (\n        <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${val > 10 ? 'bg-green-100 text-green-700' :\n          val > 0 ? 'bg-amber-100 text-amber-700' :\n            'bg-red-100 text-red-700'\n          }`}>\n          {val > 0 ? val : t('products.out_of_stock')}\n        </span>\n      )\n    },\n    {\n      key: 'status',\n      label: t('common.status'),\n      render: (value) => (\n        <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'active' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n          value === 'out_of_stock' ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' :\n            value === 'draft' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n              'bg-muted text-muted-foreground'\n          }`}>\n          {value ? t(`products.status_options.${value}`) : t('common.draft')}\n        </span>\n      )\n    }\n  ];\n\n  const productFormFields = [\n    { key: 'name', label: t('products.product_name'), required: true, description: t('common.description') },\n    { key: 'slug', label: t('common.slug'), description: 'URL-friendly name (auto-generated if empty)' },\n    { key: 'sku', label: t('products.sku'), description: 'Stock Keeping Unit - unique product identifier' },\n    { key: 'price', label: t('products.price'), type: 'number', required: true },\n    { key: 'discount_price', label: t('products.discount_price'), type: 'number', description: 'Sale price (leave empty if no discount)' },\n    { key: 'stock', label: t('products.stock'), type: 'number', description: 'Available inventory count' },\n    { key: 'is_available', label: t('products.is_available'), type: 'boolean', description: 'Toggle product availability' },\n    { key: 'shipping_cost', label: t('products.shipping_cost'), type: 'number', description: 'Standard shipping cost' },\n    { key: 'weight', label: t('products.weight'), type: 'number', description: 'Product weight for shipping calculation' },\n    { key: 'dimensions', label: t('products.dimensions'), description: 'L x W x H in cm (e.g., 30x20x10)' },\n    { key: 'featured_image', label: t('products.main_image'), type: 'image', description: 'Product cover/thumbnail' },\n    { key: 'images', label: t('products.gallery'), type: 'images', description: 'Additional product images', maxImages: 10 },\n    { key: 'description', label: t('common.description'), type: 'richtext' },\n    { key: 'category_id', label: t('common.category'), type: 'relation', table: 'categories', filter: { type: 'product' } },\n    { key: 'product_type_id', label: t('menu.product_types'), type: 'relation', table: 'product_types', description: 'Specific type/brand/collection' },\n    // { key: 'tags', label: t('common.tags'), type: 'tags' }, // Removed\n    { key: 'published_at', label: t('products.launch_date'), type: 'datetime' },\n    {\n      key: 'status', label: t('common.status'), type: 'select', options: [\n        { value: 'draft', label: t('common.draft') },\n        { value: 'active', label: t('common.active') },\n        { value: 'out_of_stock', label: t('products.out_of_stock') },\n        { value: 'archived', label: t('common.archived') }\n      ]\n    }\n  ];\n\n  // Product Types columns\n  const typeColumns = [\n    {\n      key: 'icon',\n      label: '',\n      className: 'w-12',\n      render: (val) => val ? (\n        <div className=\"w-10 h-10 bg-muted rounded-lg flex items-center justify-center text-lg\">\n          {val.startsWith('http') ? (\n            <img src={val} alt=\"\" className=\"w-6 h-6 object-contain\" />\n          ) : (\n            val\n          )}\n        </div>\n      ) : (\n        <div className=\"w-10 h-10 bg-muted rounded-lg flex items-center justify-center\">\n          <Layers className=\"w-5 h-5 text-muted-foreground\" />\n        </div>\n      )\n    },\n    { key: 'name', label: t('products.type_name'), className: 'font-medium' },\n    { key: 'slug', label: t('common.slug'), className: 'font-mono text-xs text-muted-foreground' },\n    { key: 'created_at', label: t('common.created_at'), type: 'date' }\n  ];\n\n  const typeFormFields = [\n    { key: 'name', label: t('products.type_name'), required: true, description: 'E.g., Electronics, Clothing, Food' },\n    { key: 'slug', label: t('common.slug'), required: true, description: 'URL-friendly identifier' },\n    { key: 'description', label: t('common.description'), type: 'textarea', description: 'Brief description of this product type' },\n    { key: 'icon', label: t('products.icon'), description: 'Emoji or image URL' },\n    { key: 'tags', label: t('common.tags'), type: 'tags', description: 'Keywords for filtering and search' }\n  ];\n\n  // Category columns for products\n  const categoryColumns = [\n    { key: 'name', label: t('common.name'), className: 'font-medium' },\n    { key: 'slug', label: t('common.slug') },\n    { key: 'description', label: t('common.description') },\n    { key: 'created_at', label: t('common.created_at'), type: 'date' }\n  ];\n\n  const categoryFormFields = [\n    { key: 'name', label: t('products.category_name'), required: true },\n    { key: 'slug', label: t('common.slug') },\n    { key: 'description', label: t('common.description'), type: 'textarea' },\n    { key: 'type', label: t('blogs.type'), type: 'hidden', defaultValue: 'product' }\n  ];\n\n  // Breadcrumbs for PageHeader\n  const breadcrumbs = [\n    { label: t('menu.products'), icon: Package },\n    ...(activeTab !== 'products' ? [{ label: activeTab === 'categories' ? t('menu.categories') : t('menu.product_types') }] : []),\n  ];\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.products.read\">\n      <PageHeader\n        title={t('products.title')}\n        description={t('products.subtitle')}\n        icon={Package}\n        breadcrumbs={breadcrumbs}\n      />\n\n      {/* Enhanced Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <div className=\"bg-muted/50 rounded-xl border border-border p-1.5 shadow-sm mb-6 inline-flex\">\n          <TabsList className=\"grid grid-cols-3 gap-1 bg-transparent p-0\">\n            <TabsTrigger\n              value=\"products\"\n              className=\"flex items-center gap-2 px-6 py-2.5 rounded-lg data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-md transition-all duration-200 font-medium\"\n            >\n              <Package className=\"w-4 h-4\" />\n              {t('menu.products')}\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"types\"\n              className=\"flex items-center gap-2 px-6 py-2.5 rounded-lg data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-md transition-all duration-200 font-medium\"\n            >\n              <Layers className=\"w-4 h-4\" />\n              {t('menu.product_types')}\n            </TabsTrigger>\n            <TabsTrigger\n              value=\"categories\"\n              className=\"flex items-center gap-2 px-6 py-2.5 rounded-lg data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-md transition-all duration-200 font-medium\"\n            >\n              <FolderOpen className=\"w-4 h-4\" />\n              {t('menu.categories')}\n            </TabsTrigger>\n          </TabsList>\n        </div>\n      </Tabs>\n\n      {/* Tab Content */}\n      {activeTab === 'products' && (\n        <GenericContentManager\n          tableName=\"products\"\n          resourceName={t('menu.products')}\n          columns={productColumns}\n          formFields={productFormFields}\n          permissionPrefix=\"products\"\n          customSelect=\"*, category:categories(name), product_type:product_types(name), owner:users!created_by(email, full_name), tenant:tenants(name)\"\n          showBreadcrumbs={false}\n        />\n      )}\n\n      {activeTab === 'types' && (\n        <GenericContentManager\n          tableName=\"product_types\"\n          resourceName={t('menu.product_types')}\n          columns={typeColumns}\n          formFields={typeFormFields}\n          permissionPrefix=\"product_types\"\n          showBreadcrumbs={false}\n        />\n      )}\n\n      {activeTab === 'categories' && (\n        <GenericContentManager\n          tableName=\"categories\"\n          resourceName={t('common.category')}\n          columns={categoryColumns}\n          formFields={categoryFormFields}\n          permissionPrefix=\"categories\"\n          customSelect=\"*, owner:users!created_by(email, full_name), tenant:tenants(name)\"\n          defaultFilters={{ type: 'product' }}\n          showBreadcrumbs={false}\n        />\n      )}\n    </AdminPageLayout>\n  );\n}\n\nexport default ProductsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/PromotionsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Tag } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction PromotionsManager() {\n    const columns = [\n        { key: 'title', label: 'Promotion' },\n        { key: 'code', label: 'Promo Code' },\n        {\n            key: 'link',\n            label: 'Link',\n            render: (value) => value ? <a href={value} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary hover:underline truncate max-w-[150px] block\">{value}</a> : '-'\n        },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'active' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'inactive' ? 'bg-muted text-muted-foreground' :\n                        value === 'expired' ? 'bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400' :\n                            'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'inactive'}\n                </span>\n            )\n        }\n    ];\n\n    const formFields = [\n        { key: 'title', label: 'Title', required: true },\n        { key: 'code', label: 'Promo Code', description: 'e.g. WINTER50, SALE2025' },\n        { key: 'featured_image', label: 'Banner Image', type: 'image' },\n        { key: 'description', label: 'Description', type: 'richtext' },\n        { key: 'link', label: 'Redirect URL', type: 'url', description: 'Where to send the user when clicked (https://...)' },\n        { key: 'cta_text', label: 'Button Text', description: 'e.g. Shop Now, Learn More' },\n        {\n            key: 'target',\n            label: 'Open In',\n            type: 'select',\n            options: [{ value: '_self', label: 'Same Tab' }, { value: '_blank', label: 'New Tab' }],\n            defaultValue: '_self'\n        },\n        { key: 'category_id', label: 'Category', type: 'relation', table: 'categories', filter: { type: 'promotion' } },\n        { key: 'discount_percentage', label: 'Discount %', type: 'number', description: 'Leave empty if using fixed amount' },\n        { key: 'discount_amount', label: 'Discount Amount', type: 'number', description: 'Fixed discount value' },\n        { key: 'start_date', label: 'Start Date', type: 'datetime' },\n        { key: 'end_date', label: 'End Date', type: 'datetime' },\n        {\n            key: 'status', label: 'Status', type: 'select', options: [\n                { value: 'inactive', label: 'Inactive' },\n                { value: 'active', label: 'Active' },\n                { value: 'expired', label: 'Expired' }\n            ]\n        }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.promotions.read\">\n            <PageHeader\n                title=\"Promotions\"\n                description=\"Manage promotional campaigns and discount codes.\"\n                icon={Tag}\n                breadcrumbs={[{ label: 'Promotions', icon: Tag }]}\n            />\n\n            <GenericContentManager\n                tableName=\"promotions\"\n                resourceName=\"Promotion\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"promotions\"\n                showBreadcrumbs={false}\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default PromotionsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ResourceSelect.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filter'. Either include it or remove the dependency array.","line":69,"column":8,"nodeType":"ArrayExpression","endLine":69,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [table, labelKey, valueKey, filterString, toast, filter]","fix":{"range":[2234,2282],"text":"[table, labelKey, valueKey, filterString, toast, filter]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient'; // Use custom client for tenant headers\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from '@/components/ui/use-toast';\n\nconst ResourceSelect = ({\n    table,\n    labelKey = 'name',\n    valueKey = 'id',\n    value,\n    onChange,\n    placeholder = \"Select item...\",\n    filter = null // Optional filter object { column: 'value' } or function\n}) => {\n    const [items, setItems] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const { toast } = useToast();\n\n    const filterString = JSON.stringify(filter);\n\n    useEffect(() => {\n        if (!table) return;\n\n        const fetchItems = async () => {\n            setLoading(true);\n            try {\n                let query = supabase\n                    .from(table)\n                    .select(`${valueKey}, ${labelKey}`)\n                    .is('deleted_at', null);\n\n                // Apply simple equality filters if provided\n                if (filter && typeof filter === 'object') {\n                    Object.entries(filter).forEach(([key, val]) => {\n                        query = query.eq(key, val);\n                    });\n                }\n\n                // Default limit to prevent massive loads in dropdowns\n                query = query.limit(100);\n\n                console.log(`[ResourceSelect] Fetching ${table} with filter:`, filter);\n                const { data, error } = await query;\n                console.log(`[ResourceSelect] Fetched ${data?.length} items for ${table}`, data);\n\n                if (error) throw error;\n                setItems(data || []);\n            } catch (err) {\n                console.error(`Error fetching resources for ${table}:`, err);\n                toast({\n                    variant: \"destructive\",\n                    title: \"Error loading resources\",\n                    description: err.message\n                });\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchItems();\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [table, labelKey, valueKey, filterString, toast]);\n\n    return (\n        <div className=\"flex flex-col gap-1\">\n            {loading ? (\n                <div className=\"h-10 w-full border border-input bg-muted/50 rounded-md px-3 py-2 text-sm text-muted-foreground flex items-center\">\n                    Loading options...\n                </div>\n            ) : (\n                <Select\n                    value={value ? String(value) : ''}\n                    onValueChange={onChange}\n                    disabled={false}\n                >\n                    <SelectTrigger className=\"w-full\">\n                        <SelectValue placeholder={placeholder} />\n                    </SelectTrigger>\n                    <SelectContent>\n                        {items.length === 0 ? (\n                            <div className=\"p-2 text-sm text-center text-muted-foreground\">No items found</div>\n                        ) : (\n                            items.map(item => (\n                                <SelectItem key={item[valueKey]} value={String(item[valueKey])}>\n                                    {item[labelKey] || `Item ${item[valueKey]}`}\n                                </SelectItem>\n                            ))\n                        )}\n                    </SelectContent>\n                </Select>\n            )}\n        </div>\n    );\n};\n\nexport default ResourceSelect;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/RoleEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { Shield, Save, X, Loader2, Lock, Info, CheckCircle2, Zap } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport PermissionMatrix from '@/components/dashboard/PermissionMatrix';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { useTenant } from '@/contexts/TenantContext';\n\nconst RoleEditor = ({ role, onClose, onSave }) => {\n  const { toast } = useToast();\n  const { currentTenant } = useTenant();\n\n\n\n  // Form State\n  const [formData, setFormData] = useState({\n    name: role?.name || '',\n    description: role?.description || ''\n  });\n\n  // Permissions State\n  const [permissions, setPermissions] = useState([]);\n  const [selectedPermissions, setSelectedPermissions] = useState(new Set());\n\n  // UI State\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [activeTemplate, setActiveTemplate] = useState('');\n\n  // Protect system roles\n  const isSystemRole = Boolean(role?.is_system || role?.is_public || role?.is_guest);\n  const isFullAccessRole = Boolean(role?.is_full_access || role?.is_platform_admin);\n  const [syncingFullAccess, setSyncingFullAccess] = useState(false);\n\n  useEffect(() => {\n    const fetchPermissions = async () => {\n      try {\n        // 1. Fetch All Available Permissions (Master List)\n        const { data: allPerms, error: permError } = await supabase\n          .from('permissions')\n          .select('*')\n          .is('deleted_at', null)\n          .order('resource', { ascending: true });\n\n        if (permError) throw permError;\n        setPermissions(allPerms || []);\n\n        // 2. If editing existing role, fetch its current permissions\n        if (role?.id) {\n          const { data: rolePerms, error: rpError } = await supabase\n            .from('role_permissions')\n            .select('permission_id')\n            .eq('role_id', role.id)\n            .is('deleted_at', null);\n\n          if (rpError) throw rpError;\n\n          const permSet = new Set(rolePerms.map(rp => rp.permission_id));\n          setSelectedPermissions(permSet);\n        }\n      } catch (err) {\n        console.error(\"Error loading permission matrix:\", err);\n        toast({ variant: 'destructive', title: 'Error', description: 'Failed to load permissions' });\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchPermissions();\n  }, [role, toast]);\n\n  // Auto-select all permissions for full-access roles\n  useEffect(() => {\n    if (isFullAccessRole && permissions.length > 0) {\n      const allIds = new Set(permissions.map(p => p.id));\n      setSelectedPermissions(allIds);\n    }\n  }, [isFullAccessRole, permissions]);\n\n  const togglePermission = (permId) => {\n    if (isFullAccessRole) return; // Cannot edit root admin permissions (they have all)\n\n    setSelectedPermissions(prev => {\n      const next = new Set(prev);\n      if (next.has(permId)) {\n        next.delete(permId);\n      } else {\n        next.add(permId);\n      }\n      return next;\n    });\n    setActiveTemplate(''); // Clear template selection if custom changes made\n  };\n\n  const applyTemplate = (templateName) => {\n    if (isFullAccessRole) return;\n\n    // Filter permissions based on the template\n    const targetIds = permissions\n      .filter(p => {\n        // Standardized Template Logic (ABAC Pattern) - using resource column\n        if (templateName === 'Viewer') {\n          // Viewer: Read-only access to content, exclude admin resources\n          const excludedResources = ['users', 'roles', 'settings', 'permissions', 'policies', 'platform', 'tenants', 'system'];\n          return (p.action === 'read' || p.action === 'view') && !excludedResources.includes(p.resource);\n        }\n        if (templateName === 'Editor') {\n          // Editor: Full content management (CRUD + publish) for content modules\n          const contentResources = ['blogs', 'pages', 'products', 'files', 'photo_gallery', 'video_gallery',\n            'portfolio', 'announcements', 'testimonies', 'promotions', 'galleries',\n            'menus', 'categories', 'tags', 'visual_pages'];\n          return ['read', 'view', 'create', 'update', 'edit', 'publish', 'delete', 'restore'].includes(p.action)\n            && contentResources.includes(p.resource);\n        }\n        if (templateName === 'Manager') {\n          // Manager: Full admin access (197 permissions)\n          // Excludes: system/platform resources and specialized actions\n          const excludedActions = ['permanent_delete', 'delete_permanent', 'view_public', 'soft_delete', 'manage', 'configure', 'comment', 'send', 'like', 'view_logs', 'view_readers'];\n          const excludedResources = ['platform', 'tenant', 'tenants', 'system', '2fa', 'dashboard', 'content', 'tenant.region', 'orders'];\n          return !excludedActions.includes(p.action) && !excludedResources.includes(p.resource);\n        }\n        return false;\n      })\n      .map(p => p.id);\n\n    setSelectedPermissions(new Set(targetIds));\n    setActiveTemplate(templateName);\n    toast({ title: \"Template Applied\", description: `Applied permissions for ${templateName}` });\n  };\n\n  // Bulk action: Select All\n  const selectAllPermissions = () => {\n    if (isFullAccessRole) return;\n    const allIds = new Set(permissions.map(p => p.id));\n    setSelectedPermissions(allIds);\n    setActiveTemplate('');\n    toast({ title: \"All Selected\", description: `${permissions.length} permissions selected.` });\n  };\n\n  // Bulk action: Deselect All\n  const deselectAllPermissions = () => {\n    if (isFullAccessRole) return;\n    setSelectedPermissions(new Set());\n    setActiveTemplate('');\n    toast({ title: \"All Cleared\", description: \"All permissions deselected.\" });\n  };\n\n  // Sync Full Access: Persist all permissions for full-access roles to database\n  const syncFullAccess = async () => {\n    if (!isFullAccessRole || !role?.id) return;\n\n    setSyncingFullAccess(true);\n    try {\n      // Soft-delete existing role_permissions\n      await supabase\n        .from('role_permissions')\n        .update({ deleted_at: new Date().toISOString() })\n        .eq('role_id', role.id)\n        .is('deleted_at', null);\n\n      // Insert all permissions for this role\n      const allPerms = permissions.map(p => ({\n        role_id: role.id,\n        permission_id: p.id,\n        deleted_at: null\n      }));\n\n      if (allPerms.length > 0) {\n        const { error } = await supabase\n          .from('role_permissions')\n          .upsert(allPerms, { onConflict: 'role_id, permission_id' });\n\n        if (error) throw error;\n      }\n\n      toast({ title: \"Full Access Synced\", description: `${permissions.length} permissions activated for ${role.name}.` });\n    } catch (err) {\n      console.error('Sync error:', err);\n      toast({ variant: 'destructive', title: 'Sync Failed', description: err.message });\n    } finally {\n      setSyncingFullAccess(false);\n    }\n  };\n\n\n  const handleSave = async (e) => {\n    e.preventDefault();\n    if (isFullAccessRole) {\n      onClose(); // Just close, no save needed\n      return;\n    }\n\n    setSaving(true);\n    console.log('Starting save for role:', role?.name || formData.name);\n\n    try {\n      let roleId = role?.id;\n\n      // 1. Create/Update Role Metadata\n      if (roleId) {\n        const { error } = await supabase\n          .from('roles')\n          .update({\n            name: formData.name,\n            description: formData.description,\n            updated_at: new Date().toISOString()\n          })\n          .eq('id', roleId);\n        if (error) throw error;\n      } else {\n        const { data, error } = await supabase\n          .from('roles')\n          .insert({\n            name: formData.name,\n            description: formData.description,\n            tenant_id: currentTenant?.id || null,\n            scope: currentTenant?.id ? 'tenant' : 'platform'\n          })\n          .select()\n          .single();\n        if (error) throw error;\n        roleId = data.id;\n      }\n\n      console.log('Role ID secured:', roleId);\n\n      // 2. Update Permissions (Matrix)\n      // Standard pattern: Soft-delete all current permissions, then re-insert active ones.\n\n      // A. Soft-delete all active permissions for this role\n      const { error: deleteError } = await supabase\n        .from('role_permissions')\n        .update({ deleted_at: new Date().toISOString() })\n        .eq('role_id', roleId)\n        .is('deleted_at', null);\n\n      if (deleteError) {\n        console.error('Error clearing old permissions:', deleteError);\n        throw deleteError;\n      }\n\n      // B. Insert/Restore selected permissions\n      if (selectedPermissions.size > 0) {\n        const newPerms = Array.from(selectedPermissions).map(permId => ({\n          role_id: roleId,\n          permission_id: permId,\n          deleted_at: null\n        }));\n\n        console.log(`Saving ${newPerms.length} permissions...`);\n\n        // Use upsert to handle potential race conditions or re-activation\n        const { error: permInsertError } = await supabase\n          .from('role_permissions')\n          .upsert(newPerms, { onConflict: 'role_id, permission_id', ignoreDuplicates: false });\n\n        if (permInsertError) {\n          console.error('Error inserting permissions:', permInsertError);\n          throw permInsertError;\n        }\n      }\n\n      toast({ title: 'Success', description: 'Role and permissions saved successfully.' });\n      onSave();\n\n    } catch (err) {\n      console.error('Save failed:', err);\n      toast({ variant: 'destructive', title: 'Error', description: err.message });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 bg-slate-900/40 z-[100] flex items-center justify-center p-4 backdrop-blur-sm\"\n    >\n      <motion.div\n        initial={{ scale: 0.95, y: 20 }}\n        animate={{ scale: 1, y: 0 }}\n        className=\"bg-white/95 dark:bg-slate-950/90 rounded-2xl shadow-2xl w-full max-w-[95vw] xl:max-w-[1600px] h-[92vh] flex flex-col overflow-hidden border border-slate-200/70 dark:border-slate-800/70\"\n      >\n        {/* Header */}\n        <div className=\"px-6 py-4 border-b border-slate-200/70 dark:border-slate-800/70 flex justify-between items-center bg-slate-50/70 dark:bg-slate-900/60 shrink-0\">\n          <div>\n            <h2 className=\"text-lg font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2\">\n              <Shield className={`w-5 h-5 ${isFullAccessRole ? 'text-purple-600' : 'text-blue-600'}`} />\n              {role ? (role.scope === 'platform' ? 'Platform Role Configuration' : 'Edit Role Configuration') : 'Create New Role'}\n            </h2>\n            <p className=\"text-sm text-slate-500 mt-1\">\n              {isFullAccessRole ? 'This System Root Role has complete 100% access. Configuration is read-only.' : 'Define access control policies and permission scopes.'}\n            </p>\n          </div>\n          <div className=\"flex gap-2\">\n            {/* Bulk Actions for non-system roles */}\n            {!isSystemRole && (\n              <div className=\"hidden md:flex bg-white/80 rounded-lg border border-slate-200/70 p-1 mr-2\">\n                <button\n                  type=\"button\"\n                  onClick={selectAllPermissions}\n                  className=\"px-2 py-1 text-xs font-medium rounded-md text-green-600 hover:bg-green-50 flex items-center gap-1\"\n                >\n                  <CheckCircle2 className=\"w-3 h-3\" /> All\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={deselectAllPermissions}\n                  className=\"px-2 py-1 text-xs font-medium rounded-md text-slate-600 hover:bg-slate-100 flex items-center gap-1\"\n                >\n                  <X className=\"w-3 h-3\" /> None\n                </button>\n              </div>\n            )}\n            {!isFullAccessRole && (\n              <div className=\"hidden md:flex bg-white/80 rounded-lg border border-slate-200/70 p-1 mr-4\">\n                {['Viewer', 'Editor', 'Manager'].map(t => (\n                  <button\n                    key={t}\n                    type=\"button\"\n                    onClick={() => applyTemplate(t)}\n                    className={`px-3 py-1 text-xs font-medium rounded-md transition-all ${activeTemplate === t ? 'bg-slate-800 text-white shadow-sm' : 'text-slate-600 hover:bg-slate-100'}`}\n                  >\n                    {t} Set\n                  </button>\n                ))}\n              </div>\n            )}\n            {/* Sync Full Access button for full-access roles */}\n            {isFullAccessRole && (\n              <Button\n                type=\"button\"\n                onClick={syncFullAccess}\n                disabled={syncingFullAccess}\n                className=\"bg-purple-600 hover:bg-purple-700 text-white mr-2 shadow-sm\"\n              >\n                {syncingFullAccess ? (\n                  <><Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> Syncing...</>\n                ) : (\n                  <><Zap className=\"w-4 h-4 mr-2\" /> Sync Full Access</>\n                )}\n              </Button>\n            )}\n            <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"rounded-full hover:bg-slate-200/70 dark:hover:bg-slate-800\">\n              <X className=\"w-5 h-5 text-slate-500\" />\n            </Button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <form onSubmit={handleSave} className=\"flex-1 flex flex-col overflow-hidden\">\n          <div className=\"flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar bg-white/95 dark:bg-slate-950/80\">\n\n            {/* Role Details */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              <div className=\"space-y-4 lg:col-span-1\">\n                <div className=\"bg-slate-50/80 dark:bg-slate-900/70 p-5 rounded-2xl border border-slate-200/70 dark:border-slate-800/70 space-y-4\">\n                  <h3 className=\"font-semibold text-slate-800 dark:text-slate-200 flex items-center gap-2\">\n                    <Info className=\"w-4 h-4 text-blue-500\" /> Role Details\n                  </h3>\n\n                  <div className=\"space-y-3\">\n                    <div className=\"space-y-1\">\n                      <Label htmlFor=\"name\">Role Name <span className=\"text-red-500\">*</span></Label>\n                        <Input\n                          id=\"name\"\n                          value={formData.name}\n                          onChange={e => setFormData({ ...formData, name: e.target.value })}\n                          placeholder=\"e.g. Content Editor\"\n                          required\n                          disabled={isSystemRole}\n                          className={isSystemRole ? \"h-11 rounded-xl bg-slate-100 text-slate-500 font-mono dark:bg-slate-800 dark:text-slate-400\" : \"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus-visible:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60 dark:text-slate-200\"}\n                        />\n                      {isSystemRole && <p className=\"text-[10px] text-amber-600 flex items-center gap-1 mt-1\"><Lock className=\"w-3 h-3\" /> System role name cannot be changed.</p>}\n                    </div>\n\n                    <div className=\"space-y-1\">\n                      <Label htmlFor=\"description\">Description</Label>\n                      <Textarea\n                        id=\"description\"\n                        value={formData.description}\n                        onChange={e => setFormData({ ...formData, description: e.target.value })}\n                        placeholder=\"Describe the purpose and access level of this role...\"\n                        rows={3}\n                        className=\"rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus-visible:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                      />\n                    </div>\n\n                    {/* Hierarchy Reference */}\n                    <div className=\"pt-2 border-t border-slate-200 dark:border-slate-700\">\n                      <p className=\"text-xs font-medium text-slate-500 mb-2\">Tenant Staff Hierarchy Reference (Levels 1-10)</p>\n                      <div className=\"grid grid-cols-2 gap-x-2 gap-y-1 text-[10px] text-slate-500 dark:text-slate-400 bg-slate-100/70 dark:bg-slate-800/60 p-2 rounded border border-slate-200/70 dark:border-slate-700\">\n                        <div>10: Super Manager</div>\n                        <div>9: Senior Manager</div>\n                        <div>8: Manager</div>\n                        <div>7: Senior Supervisor</div>\n                        <div>6: Supervisor</div>\n                        <div>5: Senior Specialist</div>\n                        <div>4: Specialist</div>\n                        <div>3: Associate</div>\n                        <div>2: Assistant</div>\n                        <div>1: Internship</div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <Alert className=\"bg-blue-50/80 dark:bg-blue-950/30 border-blue-100 dark:border-blue-900 text-blue-800 dark:text-blue-200\">\n                  <Info className=\"w-4 h-4 text-blue-600\" />\n                  <AlertTitle>Permission Stats</AlertTitle>\n                  <AlertDescription className=\"text-xs mt-1\">\n                    <div className=\"flex justify-between items-center mt-2\">\n                      <span>Granted:</span>\n                      <span className=\"font-mono font-bold\">{isFullAccessRole ? 'ALL' : selectedPermissions.size}</span>\n                    </div>\n                    <div className=\"flex justify-between items-center mt-1\">\n                      <span>Total Available:</span>\n                      <span className=\"font-mono\">{permissions.length}</span>\n                    </div>\n                   <div className=\"w-full bg-blue-200/80 dark:bg-blue-900 h-1.5 rounded-full mt-2 overflow-hidden\">\n                     <div\n                        className=\"bg-blue-600 h-full transition-all duration-500\"\n                        style={{ width: `${isFullAccessRole ? 100 : (permissions.length ? (selectedPermissions.size / permissions.length) * 100 : 0)}%` }}\n                      />\n                    </div>\n                  </AlertDescription>\n                </Alert>\n              </div>\n\n              <div className=\"lg:col-span-2 space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <h3 className=\"font-semibold text-slate-800 dark:text-slate-200 text-lg\">Access Control Matrix</h3>\n                  <div className=\"text-xs text-slate-500 dark:text-slate-400\">\n                    {isFullAccessRole ? (\n                      <span className=\"flex items-center gap-1 text-purple-600 dark:text-purple-400 font-medium bg-purple-50 dark:bg-purple-900/40 px-2 py-1 rounded\"><Shield className=\"w-3 h-3\" /> Full System Access Granted (100%)</span>\n                    ) : (\n                      <span>Configure modular permissions below</span>\n                    )}\n                  </div>\n                </div>\n\n                {loading ? (\n                  <div className=\"h-64 flex flex-col items-center justify-center border rounded-2xl border-dashed border-slate-200/70 bg-slate-50/70\">\n                    <Loader2 className=\"w-8 h-8 text-indigo-600 animate-spin mb-2\" />\n                    <span className=\"text-slate-500 text-sm\">Loading permissions matrix...</span>\n                  </div>\n                ) : (\n                  <PermissionMatrix\n                    permissions={permissions}\n                    selectedPermissions={selectedPermissions}\n                    onToggle={togglePermission}\n                    readOnly={isFullAccessRole}\n                  />\n                )}\n              </div>\n            </div>\n\n          </div>\n\n          {/* Footer Actions */}\n          <div className=\"p-4 border-t border-slate-200/70 dark:border-slate-800/70 bg-slate-50/70 dark:bg-slate-900/60 flex justify-between items-center shrink-0\">\n            <div className=\"text-xs text-slate-400 hidden sm:block\">\n              Last updated: {new Date().toLocaleDateString()}\n            </div>\n            <div className=\"flex gap-3 w-full sm:w-auto justify-end\">\n              <Button type=\"button\" variant=\"outline\" onClick={onClose}>Cancel</Button>\n              {!isFullAccessRole && (\n                <Button type=\"submit\" disabled={saving || loading} className=\"bg-indigo-600 hover:bg-indigo-700 text-white min-w-[120px]\">\n                  {saving ? (\n                    <><Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> Saving...</>\n                  ) : (\n                    <><Save className=\"w-4 h-4 mr-2\" /> Save Configuration</>\n                  )}\n                </Button>\n              )}\n            </div>\n          </div>\n        </form>\n      </motion.div>\n    </motion.div>\n  );\n};\n\nexport default RoleEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/RolesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRoles'. Either include it or remove the dependency array.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRoles]","fix":{"range":[2255,2257],"text":"[fetchRoles]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport ContentTable from '@/components/dashboard/ContentTable';\nimport RoleEditor from '@/components/dashboard/RoleEditor';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { sanitizeHTML } from '@/utils/sanitize';\n// Standard Permissions: tenant.role.read, tenant.role.create, tenant.role.update, tenant.role.delete\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Button } from '@/components/ui/button';\nimport { Plus, Shield, RefreshCw, Trash2, Crown } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\nimport { useSearch } from '@/hooks/useSearch';\nimport MinCharSearchInput from '@/components/common/MinCharSearchInput';\nimport { useTranslation } from 'react-i18next';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\n\nimport { useTenant } from '@/contexts/TenantContext';\n\nfunction RolesManager() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const { hasPermission, isPlatformAdmin } = usePermissions();\n  const { currentTenant } = useTenant();\n\n  // State declarations\n  const [roles, setRoles] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  // Search\n  const {\n    query,\n    setQuery,\n    debouncedQuery,\n    isValid: isSearchValid,\n    message: searchMessage,\n    loading: searchLoading,\n    minLength,\n    clearSearch\n  } = useSearch({ context: 'admin' });\n\n  const [showEditor, setShowEditor] = useState(false);\n  const [selectedRole, setSelectedRole] = useState(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [roleToDelete, setRoleToDelete] = useState(null);\n\n  // Permission checks\n  const canView = hasPermission('tenant.role.read');\n  const canCreate = hasPermission('tenant.role.create');\n  const canEdit = hasPermission('tenant.role.update');\n  const canDelete = hasPermission('tenant.role.delete');\n\n  useEffect(() => {\n    fetchRoles();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const fetchRoles = async () => {\n    setLoading(true);\n    try {\n      let dbQuery = supabase\n        .from('roles')\n        .select('*, owner:users!created_by(email), role_permissions(count), tenant:tenants(name)')\n        .is('deleted_at', null)\n        .order('created_at', { ascending: true });\n\n      // Explicit Tenant Isolation (unless Platform Admin)\n      if (!isPlatformAdmin && currentTenant?.id) {\n        dbQuery = dbQuery.eq('tenant_id', currentTenant.id);\n      }\n\n      const { data, error } = await dbQuery;\n\n      if (error) throw error;\n      setRoles(data || []);\n    } catch (err) {\n      console.error(err);\n      toast({ variant: 'destructive', title: t('common.error'), description: 'Failed to load roles' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleEdit = (role) => {\n    setSelectedRole(role);\n    setShowEditor(true);\n  };\n\n  // Open delete confirmation dialog\n  const openDeleteDialog = (role) => {\n    if (role.is_system || role.is_platform_admin || role.is_full_access || role.is_public || role.is_guest) {\n      toast({ variant: 'destructive', title: 'Protected Role', description: t('roles.errors.protected_role') });\n      return;\n    }\n    setRoleToDelete(role);\n    setDeleteDialogOpen(true);\n  };\n\n  // Execute the actual delete\n  const handleConfirmDelete = async () => {\n    if (!roleToDelete) return;\n\n    setDeleteDialogOpen(false);\n    setLoading(true);\n\n    try {\n      // Check if users are assigned\n      const { count } = await supabase.from('users').select('*', { count: 'exact', head: true }).eq('role_id', roleToDelete.id);\n\n      if (count > 0) {\n        toast({ variant: 'destructive', title: t('common.error'), description: t('roles.errors.assigned_users', { count }) });\n        return;\n      }\n\n      const { error } = await supabase\n        .from('roles')\n        .update({ deleted_at: new Date().toISOString() })\n        .eq('id', roleToDelete.id);\n\n      if (error) throw error;\n\n      toast({ title: t('common.success'), description: t('common.move_to_trash_confirm', { resource: t('roles.title') }) });\n      fetchRoles();\n    } catch (err) {\n      toast({ variant: 'destructive', title: t('common.error'), description: err.message });\n    } finally {\n      setLoading(false);\n      setRoleToDelete(null);\n    }\n  };\n\n  const filteredRoles = roles.filter(role => {\n    if (!debouncedQuery) return true;\n    const lower = debouncedQuery.toLowerCase();\n    return role.name.toLowerCase().includes(lower) ||\n      role.description?.toLowerCase().includes(lower);\n  });\n\n  const columns = [\n    {\n      key: 'name',\n      label: t('roles.columns.name'),\n      className: 'font-bold w-[200px]',\n      render: (name, row) => (\n        <div className=\"flex items-center gap-2\">\n          <Shield className={`w-4 h-4 ${row.is_full_access || row.is_platform_admin ? 'text-primary' : 'text-muted-foreground'}`} />\n          {(row.is_platform_admin || row.is_full_access) && <Crown className=\"w-4 h-4 text-amber-500 fill-amber-500\" />}\n          <span>{name}</span>\n          {(row.is_platform_admin || row.is_full_access) && (\n            <span className=\"bg-primary/10 text-primary text-[10px] px-1.5 py-0.5 rounded-full uppercase font-bold border border-primary/20\">\n              {t('roles.badges.tenant_root')}\n            </span>\n          )}\n        </div>\n      )\n    },\n    { key: 'description', label: t('roles.columns.description'), className: 'text-muted-foreground' },\n    {\n      key: 'permissions_count',\n      label: t('roles.columns.permissions'),\n      className: 'text-center w-[120px]',\n      render: (_, row) => {\n        const count = row.role_permissions ? row.role_permissions[0]?.count : 0;\n        if (row.is_full_access || row.is_platform_admin) {\n          return <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-500/10 text-green-600 dark:text-green-400 border border-green-500/20\">{t('roles.badges.all_access')} ({count || ''})</span>;\n        }\n        return <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-secondary text-secondary-foreground\">{count || 0} {t('roles.columns.permissions')}</span>;\n      }\n    },\n    {\n      key: 'owner',\n      label: t('roles.columns.created_by'),\n      className: 'text-muted-foreground text-xs',\n      render: (_, row) => row.owner?.email || '-'\n    }\n  ];\n\n  if (isPlatformAdmin) {\n    columns.push({\n      key: 'tenant_id',\n      label: t('roles.columns.tenant'),\n      className: 'text-xs text-slate-500',\n      render: (tid, row) => row.tenant?.name || (tid ? 'Unknown Tenant' : t('common.global'))\n    });\n  }\n\n  // Header actions for PageHeader\n  const headerActions = (\n    <div className=\"flex gap-2\">\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        onClick={fetchRoles}\n        title={t('common.refresh')}\n        className=\"h-10 w-10 border-slate-200/70 bg-white/70 hover:bg-white shadow-sm\"\n      >\n        <RefreshCw className=\"w-4 h-4\" />\n      </Button>\n      {canCreate && (\n        <Button onClick={() => { setSelectedRole(null); setShowEditor(true); }} className=\"bg-indigo-600 text-white hover:bg-indigo-700 shadow-sm\">\n          <Plus className=\"w-4 h-4 mr-2\" /> {t('roles.create_role')}\n        </Button>\n      )}\n    </div>\n  );\n\n  // Breadcrumbs for PageHeader\n  const breadcrumbs = [{ label: t('roles.title'), icon: Shield }];\n\n  if (!canView) return <div className=\"p-8 text-center text-slate-500\">{t('common.access_denied')}</div>;\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.role.read\">\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2\">\n              <Trash2 className=\"w-5 h-5 text-red-500\" />\n              {t('roles.delete.title')}\n            </AlertDialogTitle>\n            <AlertDialogDescription asChild>\n              <div className=\"space-y-3\">\n                <p dangerouslySetInnerHTML={{ __html: sanitizeHTML(t('roles.delete.confirm', { name: roleToDelete?.name })) }} />\n                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3 text-amber-800 text-sm\">\n                  <p className=\"font-medium mb-1\"> {t('common.error')}:</p>\n                  <p>{t('roles.delete.warning_users')}</p>\n                </div>\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3 text-red-700 text-sm\">\n                  <p className=\"font-medium\"> {t('common.error')}:</p>\n                  <p>{t('roles.delete.warning_restore')}</p>\n                </div>\n              </div>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{t('common.cancel')}</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirmDelete}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              {t('common.move_to_trash')}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {showEditor ? (\n        <RoleEditor\n          role={selectedRole}\n          onClose={() => { setShowEditor(false); setSelectedRole(null); }}\n          onSave={() => { setShowEditor(false); setSelectedRole(null); fetchRoles(); }}\n        />\n      ) : (\n        <>\n          <PageHeader\n            title={t('roles.title')}\n            description={t('roles.subtitle')}\n            icon={Shield}\n            breadcrumbs={breadcrumbs}\n            actions={headerActions}\n          />\n\n          <div className=\"dashboard-surface dashboard-surface-hover overflow-hidden\">\n            <div className=\"p-4 border-b border-slate-200/60 bg-slate-50/70\">\n              <div className=\"max-w-sm\">\n                <MinCharSearchInput\n                  value={query}\n                  onChange={e => setQuery(e.target.value)}\n                  onClear={clearSearch}\n                  loading={loading || searchLoading}\n                  isValid={isSearchValid}\n                  message={searchMessage}\n                  minLength={minLength}\n                  placeholder={t('common.search_resource', { resource: t('roles.title') })}\n                />\n              </div>\n            </div>\n\n            <ContentTable\n              data={filteredRoles}\n              columns={columns}\n              loading={loading}\n              onEdit={canEdit ? (role) => handleEdit(role) : null}\n              onDelete={canDelete ? (role) => openDeleteDialog(role) : null}\n            />\n          </div>\n        </>\n      )}\n    </AdminPageLayout>\n  );\n}\n\nexport default RolesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/SSOManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSecurityData'. Either include it or remove the dependency array.","line":107,"column":6,"nodeType":"ArrayExpression","endLine":107,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSecurityData]","fix":{"range":[3550,3552],"text":"[fetchSecurityData]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Shield, Key, Lock, Activity, RefreshCw, CheckCircle, XCircle, AlertTriangle, Users, Clock, ChevronLeft, ChevronRight } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { useTranslation } from 'react-i18next';\nimport { format } from 'date-fns';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction SSOManager() {\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [loading, setLoading] = useState(true);\n  const [currentPage, setCurrentPage] = useState(0);\n  const [totalCount, setTotalCount] = useState(0);\n  const PAGE_SIZE = 20;\n  const MAX_RECORDS = 1000;\n  const [securityInfo, setSecurityInfo] = useState({\n    authProviders: [],\n    recentLogins: [],\n    securityFeatures: {\n      turnstile: true,\n      emailVerification: true,\n      passwordMinLength: 8,\n    }\n  });\n\n  const fetchSecurityData = useCallback(async (page = 0) => {\n    setLoading(true);\n    try {\n      const from = page * PAGE_SIZE;\n      const to = from + PAGE_SIZE - 1;\n\n      // Get total count first (capped at MAX_RECORDS)\n      const { count: rawCount } = await supabase\n        .from('audit_logs')\n        .select('id', { count: 'exact', head: true })\n        .eq('action', 'user.login');\n\n      const totalRecords = Math.min(rawCount || 0, MAX_RECORDS);\n      setTotalCount(totalRecords);\n\n      // Fetch recent login activity from audit_logs with user email\n      const { data: auditData, error: auditError } = await supabase\n        .from('audit_logs')\n        .select('*, user:users!user_id(email)')\n        .eq('action', 'user.login')\n        .order('created_at', { ascending: false })\n        .range(from, to);\n\n      if (auditError) {\n        console.error('Audit logs fetch error:', auditError);\n      }\n\n      // Get configured OAuth providers from database\n      const { data: dbProviders, error: providersError } = await supabase\n        .from('sso_providers')\n        .select('*')\n        .order('provider_id');\n\n      if (providersError) {\n        console.error('SSO providers fetch error:', providersError);\n      }\n\n      // Icon mapping\n      const iconMap = {\n        email: '',\n        google: '',\n        github: '',\n        azure: ''\n      };\n\n      const authProviders = dbProviders?.map(p => ({\n        name: p.name,\n        provider_id: p.provider_id,\n        enabled: p.is_active,\n        icon: iconMap[p.provider_id] || ''\n      })) || [];\n\n      // Fallback if no providers found in DB (e.g. fresh tenant), show defaults or keep empty\n      // Ideally the backend seeds this, which we did.\n\n      setSecurityInfo({\n        authProviders,\n        recentLogins: auditData || [],\n        securityFeatures: {\n          turnstile: true,\n          emailVerification: true,\n          passwordMinLength: 8,\n        }\n      });\n\n    } catch (error) {\n      console.error('Security data fetch error:', error);\n      toast({ variant: \"destructive\", title: t('common.error'), description: \"Failed to load security data\" });\n    } finally {\n      setLoading(false);\n    }\n  }, [t, toast]);\n\n  useEffect(() => {\n    fetchSecurityData(0);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const SecurityFeatureCard = ({ title, description, enabled, icon: Icon }) => (\n    <div className=\"flex items-start gap-4 p-4 bg-card rounded-lg border\">\n      <div className={`p-2 rounded-lg ${enabled ? 'bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400' : 'bg-muted text-muted-foreground'}`}>\n        <Icon className=\"w-5 h-5\" />\n      </div>\n      <div className=\"flex-1\">\n        <div className=\"flex items-center gap-2\">\n          <h4 className=\"font-medium text-foreground\">{title}</h4>\n          {enabled ? (\n            <CheckCircle className=\"w-4 h-4 text-green-500\" />\n          ) : (\n            <XCircle className=\"w-4 h-4 text-muted-foreground\" />\n          )}\n        </div>\n        <p className=\"text-sm text-muted-foreground\">{description}</p>\n      </div>\n    </div>\n  );\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.sso.read\">\n      <PageHeader\n        title={t('sso.title')}\n        description={t('sso.subtitle')}\n        icon={Shield}\n        breadcrumbs={[{ label: 'SSO & Security', icon: Shield }]}\n        actions={(\n          <Button onClick={() => { setCurrentPage(0); fetchSecurityData(0); }} variant=\"outline\" className=\"gap-2\" disabled={loading}>\n            <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n            {t('common.refresh')}\n          </Button>\n        )}\n      />\n\n      <Tabs defaultValue=\"overview\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3 mb-6\">\n          <TabsTrigger value=\"overview\">Security Overview</TabsTrigger>\n          <TabsTrigger value=\"providers\">Auth Providers</TabsTrigger>\n          <TabsTrigger value=\"activity\">Login Activity</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <Shield className=\"w-5 h-5 text-blue-600\" />\n                  <CardTitle>Security Features</CardTitle>\n                </div>\n                <CardDescription>Active security measures protecting your platform</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <SecurityFeatureCard\n                  title=\"Turnstile CAPTCHA\"\n                  description=\"Cloudflare Turnstile protection on login\"\n                  enabled={securityInfo.securityFeatures.turnstile}\n                  icon={Shield}\n                />\n                <SecurityFeatureCard\n                  title=\"Email Verification\"\n                  description=\"Users must verify email before access\"\n                  enabled={securityInfo.securityFeatures.emailVerification}\n                  icon={Key}\n                />\n                <SecurityFeatureCard\n                  title=\"Password Policy\"\n                  description={`Minimum ${securityInfo.securityFeatures.passwordMinLength} characters required`}\n                  enabled={true}\n                  icon={Lock}\n                />\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <Lock className=\"w-5 h-5 text-green-600\" />\n                  <CardTitle>Platform Security</CardTitle>\n                </div>\n                <CardDescription>Core security infrastructure</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <SecurityFeatureCard\n                  title=\"Row Level Security (RLS)\"\n                  description=\"Database-level access control enabled\"\n                  enabled={true}\n                  icon={Shield}\n                />\n                <SecurityFeatureCard\n                  title=\"JWT Authentication\"\n                  description=\"Secure token-based authentication\"\n                  enabled={true}\n                  icon={Key}\n                />\n                <SecurityFeatureCard\n                  title=\"HTTPS Enforced\"\n                  description=\"All connections encrypted in transit\"\n                  enabled={true}\n                  icon={Lock}\n                />\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card className=\"bg-blue-50 border-blue-100 dark:bg-blue-900/10 dark:border-blue-800\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n                <CardTitle className=\"text-blue-900 dark:text-blue-200\">OAuth Provider Configuration</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent className=\"text-sm text-blue-800 dark:text-blue-300 space-y-2\">\n              <p>OAuth providers (Google, GitHub, Azure AD, etc.) are configured directly in <strong>Supabase Dashboard</strong>.</p>\n              <p className=\"flex items-center gap-2\">\n                <span></span>\n                <a href=\"https://supabase.com/dashboard/project/_/auth/providers\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline hover:text-blue-600 dark:hover:text-blue-400\">\n                  Configure OAuth in Supabase Dashboard\n                </a>\n              </p>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"providers\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Authentication Providers</CardTitle>\n              <CardDescription>Identity providers configured for this platform</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"rounded-md border overflow-hidden\">\n                <table className=\"w-full text-sm\">\n                  <thead className=\"bg-muted/50 border-b\">\n                    <tr>\n                      <th className=\"p-3 text-left font-medium text-muted-foreground\">Provider</th>\n                      <th className=\"p-3 text-left font-medium text-muted-foreground\">Provider ID</th>\n                      <th className=\"p-3 text-left font-medium text-muted-foreground\">Status</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y\">\n                    {securityInfo.authProviders.map(provider => (\n                      <tr key={provider.provider_id}>\n                        <td className=\"p-3 flex items-center gap-2\">\n                          <span className=\"text-lg\">{provider.icon}</span>\n                          <span className=\"font-medium\">{provider.name}</span>\n                        </td>\n                        <td className=\"p-3 font-mono text-xs text-muted-foreground\">{provider.provider_id}</td>\n                        <td className=\"p-3\">\n                          {provider.enabled ? (\n                            <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full text-xs font-medium\">\n                              <CheckCircle className=\"w-3 h-3\" /> Enabled\n                            </span>\n                          ) : (\n                            <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-secondary text-muted-foreground rounded-full text-xs font-medium\">\n                              <XCircle className=\"w-3 h-3\" /> Disabled\n                            </span>\n                          )}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n              <div className=\"mt-4 p-3 bg-amber-50 border border-amber-200 dark:bg-amber-900/10 dark:border-amber-800 rounded-lg text-sm text-amber-800 dark:text-amber-300\">\n                <strong>Note:</strong> To enable/disable OAuth providers, configure them in the{' '}\n                <a href=\"https://supabase.com/dashboard\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline\">\n                  Supabase Dashboard  Authentication  Providers\n                </a>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"activity\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <Activity className=\"w-5 h-5 text-muted-foreground\" />\n                <CardTitle>Recent Login Activity</CardTitle>\n              </div>\n              <CardDescription>Login events from audit logs (page {currentPage + 1} of {Math.ceil(totalCount / PAGE_SIZE) || 1})</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <RefreshCw className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                </div>\n              ) : securityInfo.recentLogins.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Users className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground/50\" />\n                  <p>No login activity recorded yet.</p>\n                  <p className=\"text-sm\">Login events will appear here once users start signing in.</p>\n                </div>\n              ) : (\n                <div className=\"rounded-md border overflow-hidden\">\n                  <table className=\"w-full text-sm\">\n                    <thead className=\"bg-muted/50 border-b\">\n                      <tr>\n                        <th className=\"p-3 text-left font-medium text-muted-foreground\">Time</th>\n                        <th className=\"p-3 text-left font-medium text-muted-foreground\">Email</th>\n                        <th className=\"p-3 text-left font-medium text-muted-foreground\">Status</th>\n                        <th className=\"p-3 text-left font-medium text-muted-foreground\">Channel</th>\n                        <th className=\"p-3 text-left font-medium text-muted-foreground\">IP Address</th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"divide-y\">\n                      {securityInfo.recentLogins.map((log, idx) => {\n                        const status = log.details?.status || 'success';\n                        const errorMsg = log.details?.error;\n                        return (\n                          <tr key={log.id || idx}>\n                            <td className=\"p-3 text-muted-foreground\">\n                              <div className=\"flex items-center gap-2\">\n                                <Clock className=\"w-4 h-4 text-muted-foreground\" />\n                                {log.created_at ? format(new Date(log.created_at), 'dd MMM yyyy HH:mm:ss') : '-'}\n                              </div>\n                            </td>\n                            <td className=\"p-3\">{log.user?.email || log.details?.attempted_email || log.user_id || '-'}</td>\n                            <td className=\"p-3\">\n                              <span className={`px-2 py-1 rounded text-xs font-medium ${status === 'success'\n                                ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'\n                                : 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'\n                                }`} title={errorMsg || ''}>\n                                {status === 'success' ? ' Success' : ` ${errorMsg || 'Failed'}`}\n                              </span>\n                            </td>\n                            <td className=\"p-3\">\n                              <span className=\"px-2 py-1 bg-secondary rounded text-xs font-medium\">\n                                {log.channel || 'web'}\n                              </span>\n                            </td>\n                            <td className=\"p-3 font-mono text-xs text-muted-foreground\">\n                              {log.ip_address || '-'}\n                            </td>\n                          </tr>\n                        );\n                      })}\n                    </tbody>\n                  </table>\n                  {/* Pagination Controls */}\n                  <div className=\"flex items-center justify-between p-3 border-t bg-muted/20\">\n                    <div className=\"text-sm text-muted-foreground\">\n                      Showing {currentPage * PAGE_SIZE + 1} - {Math.min((currentPage + 1) * PAGE_SIZE, totalCount)} of {totalCount}\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => { setCurrentPage(p => p - 1); fetchSecurityData(currentPage - 1); }}\n                        disabled={currentPage === 0}\n                      >\n                        <ChevronLeft className=\"w-4 h-4 mr-1\" /> Previous\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => { setCurrentPage(p => p + 1); fetchSecurityData(currentPage + 1); }}\n                        disabled={(currentPage + 1) * PAGE_SIZE >= totalCount}\n                      >\n                        Next <ChevronRight className=\"w-4 h-4 ml-1\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </AdminPageLayout>\n  );\n}\n\nexport default SSOManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/SchoolPagesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updateField' is defined but never used.","line":375,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":375,"endColumn":53,"suggestions":[{"messageId":"removeVar","data":{"varName":"updateField"},"fix":{"range":[15035,15048],"text":""},"desc":"Remove unused variable 'updateField'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updateField' is defined but never used.","line":450,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":450,"endColumn":46,"suggestions":[{"messageId":"removeVar","data":{"varName":"updateField"},"fix":{"range":[18538,18551],"text":""},"desc":"Remove unused variable 'updateField'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updateField' is defined but never used.","line":597,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":597,"endColumn":48,"suggestions":[{"messageId":"removeVar","data":{"varName":"updateField"},"fix":{"range":[24762,24775],"text":""},"desc":"Remove unused variable 'updateField'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updateField' is defined but never used.","line":689,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":689,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"updateField"},"fix":{"range":[28623,28636],"text":""},"desc":"Remove unused variable 'updateField'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useToast } from '@/components/ui/use-toast';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport LocalizedInput from '@/components/ui/LocalizedInput';\nimport LocalizedArrayEditor from '@/components/ui/LocalizedArrayEditor';\nimport { PositionArrayEditor, StaffArrayEditor } from '@/components/ui/PositionArrayEditor';\nimport ImageUpload from '@/components/ui/ImageUpload';\nimport {\n    School,\n    Save,\n    RefreshCw,\n    Building2,\n    Users,\n    GraduationCap,\n    Trophy,\n    UserCheck,\n    Wallet,\n    Image,\n    CalendarDays,\n    Phone,\n    Loader2,\n    Plus,\n    Trash2\n} from 'lucide-react';\n\nconst SETTINGS_KEYS = {\n    profile: 'page_profile',\n    organization: 'page_organization',\n    staff: 'page_staff',\n    services: 'page_services',\n    achievements: 'page_achievements',\n    alumni: 'page_alumni',\n    finance: 'page_finance',\n    gallery: 'page_gallery',\n    agenda: 'page_agenda',\n    contact: 'page_contact'\n};\n\nfunction SchoolPagesManager() {\n    useTranslation();\n    const { currentTenant } = useTenant();\n    const { toast } = useToast();\n    const [activeTab, setActiveTab] = useState('profile');\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    const [data, setData] = useState({});\n    const [hasChanges, setHasChanges] = useState(false);\n\n    const tenantId = currentTenant?.id;\n\n    // Load all settings data\n    const loadData = useCallback(async () => {\n        if (!tenantId) return;\n        setLoading(true);\n        try {\n            const { data: settings, error } = await supabase\n                .from('settings')\n                .select('key, value')\n                .eq('tenant_id', tenantId)\n                .in('key', Object.values(SETTINGS_KEYS));\n\n            if (error) throw error;\n\n            const loaded = {};\n            settings?.forEach((s) => {\n                const parsed = typeof s.value === 'string' ? JSON.parse(s.value) : s.value;\n                const keyName = Object.keys(SETTINGS_KEYS).find(k => SETTINGS_KEYS[k] === s.key);\n                if (keyName) loaded[keyName] = parsed;\n            });\n            setData(loaded);\n        } catch (err) {\n            console.error('Error loading school pages data:', err);\n            toast({ title: 'Error', description: 'Failed to load data', variant: 'destructive' });\n        } finally {\n            setLoading(false);\n        }\n    }, [tenantId, toast]);\n\n    useEffect(() => {\n        loadData();\n    }, [loadData]);\n\n    // Save current tab data\n    const handleSave = async () => {\n        if (!tenantId) return;\n        setSaving(true);\n        try {\n            const key = SETTINGS_KEYS[activeTab];\n            const value = data[activeTab] || {};\n\n            const { error } = await supabase\n                .from('settings')\n                .upsert({\n                    tenant_id: tenantId,\n                    key,\n                    value: JSON.stringify(value),\n                    type: 'json'\n                }, { onConflict: 'tenant_id,key' });\n\n            if (error) throw error;\n\n            toast({ title: 'Saved', description: `${activeTab} data saved successfully` });\n            setHasChanges(false);\n        } catch (err) {\n            console.error('Error saving:', err);\n            toast({ title: 'Error', description: 'Failed to save data', variant: 'destructive' });\n        } finally {\n            setSaving(false);\n        }\n    };\n\n    // Update data for current tab\n    const updateField = (section, field, value) => {\n        setData(prev => ({\n            ...prev,\n            [activeTab]: {\n                ...prev[activeTab],\n                [section]: {\n                    ...prev[activeTab]?.[section],\n                    [field]: value\n                }\n            }\n        }));\n        setHasChanges(true);\n    };\n\n    const updateTopLevel = (field, value) => {\n        setData(prev => ({\n            ...prev,\n            [activeTab]: {\n                ...prev[activeTab],\n                [field]: value\n            }\n        }));\n        setHasChanges(true);\n    };\n\n    const tabs = [\n        { id: 'profile', label: 'Profile', icon: Building2 },\n        { id: 'organization', label: 'Organization', icon: Users },\n        { id: 'staff', label: 'Staff', icon: UserCheck },\n        { id: 'services', label: 'Services', icon: GraduationCap },\n        { id: 'achievements', label: 'Achievements', icon: Trophy },\n        { id: 'alumni', label: 'Alumni', icon: GraduationCap },\n        { id: 'finance', label: 'Finance', icon: Wallet },\n        { id: 'gallery', label: 'Gallery', icon: Image },\n        { id: 'agenda', label: 'Agenda', icon: CalendarDays },\n        { id: 'contact', label: 'Contact', icon: Phone }\n    ];\n\n    if (loading) {\n        return (\n            <AdminPageLayout requiredPermission={['tenant.school_pages.read', 'platform.school_pages.read']}>\n                <PageHeader\n                    title=\"School Website Pages\"\n                    description=\"Manage content for your school's public website\"\n                    icon={School}\n                    breadcrumbs={[{ label: 'School Pages', icon: School }]}\n                />\n                <div className=\"space-y-4 p-6\">\n                    <Skeleton className=\"h-10 w-full\" />\n                    <Skeleton className=\"h-64 w-full\" />\n                </div>\n            </AdminPageLayout>\n        );\n    }\n\n    return (\n        <AdminPageLayout requiredPermission={['tenant.school_pages.read', 'platform.school_pages.read']}>\n            <PageHeader\n                title=\"School Website Pages\"\n                description=\"Manage content for your school's public website\"\n                icon={School}\n                breadcrumbs={[{ label: 'School Pages', icon: School }]}\n                actions={[\n                    <Button\n                        key=\"refresh\"\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={loadData}\n                        disabled={loading}\n                    >\n                        <RefreshCw className=\"h-4 w-4 mr-2\" />\n                        Refresh\n                    </Button>,\n                    <Button\n                        key=\"save\"\n                        size=\"sm\"\n                        onClick={handleSave}\n                        disabled={saving || !hasChanges}\n                    >\n                        {saving ? (\n                            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        ) : (\n                            <Save className=\"h-4 w-4 mr-2\" />\n                        )}\n                        Save Changes\n                    </Button>\n                ]}\n            />\n\n            <div className=\"p-6\">\n                <Tabs value={activeTab} onValueChange={setActiveTab}>\n                    <TabsList className=\"grid grid-cols-5 lg:grid-cols-10 h-auto gap-1 p-1\">\n                        {tabs.map((tab) => (\n                            <TabsTrigger\n                                key={tab.id}\n                                value={tab.id}\n                                className=\"flex flex-col items-center gap-1 py-2 px-3 text-xs\"\n                            >\n                                <tab.icon className=\"h-4 w-4\" />\n                                <span className=\"hidden sm:inline\">{tab.label}</span>\n                            </TabsTrigger>\n                        ))}\n                    </TabsList>\n\n                    {/* Profile Tab */}\n                    <TabsContent value=\"profile\" className=\"mt-6 space-y-6\">\n                        <ProfileEditor data={data.profile} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n\n                    {/* Organization Tab */}\n                    <TabsContent value=\"organization\" className=\"mt-6 space-y-6\">\n                        <OrganizationEditor data={data.organization} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n\n                    {/* Staff Tab */}\n                    <TabsContent value=\"staff\" className=\"mt-6 space-y-6\">\n                        <StaffEditor data={data.staff} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n\n                    {/* Services Tab */}\n                    <TabsContent value=\"services\" className=\"mt-6 space-y-6\">\n                        <ServicesEditor data={data.services} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n\n                    {/* Achievements Tab */}\n                    <TabsContent value=\"achievements\" className=\"mt-6 space-y-6\">\n                        <AchievementsEditor data={data.achievements} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n\n                    {/* Alumni Tab */}\n                    <TabsContent value=\"alumni\" className=\"mt-6 space-y-6\">\n                        <AlumniEditor data={data.alumni} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n\n                    {/* Finance Tab */}\n                    <TabsContent value=\"finance\" className=\"mt-6 space-y-6\">\n                        <FinanceEditor data={data.finance} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n\n                    {/* Gallery Tab */}\n                    <TabsContent value=\"gallery\" className=\"mt-6 space-y-6\">\n                        <GalleryEditor data={data.gallery} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n\n                    {/* Agenda Tab */}\n                    <TabsContent value=\"agenda\" className=\"mt-6 space-y-6\">\n                        <AgendaEditor data={data.agenda} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n\n                    {/* Contact Tab */}\n                    <TabsContent value=\"contact\" className=\"mt-6 space-y-6\">\n                        <ContactEditor data={data.contact} updateField={updateField} updateTopLevel={updateTopLevel} />\n                    </TabsContent>\n                </Tabs>\n            </div>\n        </AdminPageLayout>\n    );\n}\n\n// ============ SUB-EDITORS ============\n\nfunction ProfileEditor({ data = {}, updateField }) {\n    return (\n        <div className=\"grid gap-6\">\n            {/* Principal Message */}\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg\">Principal Message</CardTitle>\n                    <CardDescription>Welcome message from the school principal</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <LocalizedInput\n                        label=\"Title\"\n                        value={data.principalMessage?.title}\n                        onChange={(v) => updateField('principalMessage', 'title', v)}\n                    />\n                    <LocalizedInput\n                        label=\"Content\"\n                        type=\"richtext\"\n                        value={data.principalMessage?.content}\n                        onChange={(v) => updateField('principalMessage', 'content', v)}\n                    />\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                            <Label>Author Name</Label>\n                            <Input\n                                value={data.principalMessage?.author || ''}\n                                onChange={(e) => updateField('principalMessage', 'author', e.target.value)}\n                                placeholder=\"Principal's name\"\n                            />\n                        </div>\n                        <div>\n                            <Label>Position</Label>\n                            <Input\n                                value={data.principalMessage?.position || ''}\n                                onChange={(e) => updateField('principalMessage', 'position', e.target.value)}\n                                placeholder=\"e.g., Kepala Sekolah\"\n                            />\n                        </div>\n                    </div>\n                    <ImageUpload\n                        label=\"Principal Photo\"\n                        value={data.principalMessage?.image}\n                        onChange={(v) => updateField('principalMessage', 'image', v)}\n                    />\n                </CardContent>\n            </Card>\n\n            {/* Vision & Mission */}\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg\">Vision & Mission</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <LocalizedInput\n                        label=\"Vision\"\n                        type=\"textarea\"\n                        value={data.visionMission?.vision}\n                        onChange={(v) => updateField('visionMission', 'vision', v)}\n                    />\n                    <LocalizedArrayEditor\n                        label=\"Mission Statements\"\n                        itemLabel=\"Mission\"\n                        addLabel=\"Add Mission\"\n                        value={data.visionMission?.mission}\n                        onChange={(v) => updateField('visionMission', 'mission', v)}\n                    />\n                    <LocalizedInput\n                        label=\"Motto\"\n                        value={data.visionMission?.motto}\n                        onChange={(v) => updateField('visionMission', 'motto', v)}\n                    />\n                </CardContent>\n            </Card>\n\n            {/* History */}\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg\">School History</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <LocalizedInput\n                        label=\"History Content\"\n                        type=\"richtext\"\n                        value={data.history?.content}\n                        onChange={(v) => updateField('history', 'content', v)}\n                    />\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n\nfunction OrganizationEditor({ data = {}, updateField, updateTopLevel }) {\n    const [activeOrg, setActiveOrg] = useState('school');\n\n    const orgTypes = [\n        { id: 'school', label: 'School Structure', key: 'schoolOrganization' },\n        { id: 'committee', label: 'Committee', key: 'committeeOrganization' },\n        { id: 'osis', label: 'OSIS', key: 'osisOrganization' },\n        { id: 'mpk', label: 'MPK', key: 'mpkOrganization' }\n    ];\n\n    const currentOrg = orgTypes.find(o => o.id === activeOrg);\n    const currentData = data?.[currentOrg?.key] || {};\n\n    const handleOrgChange = (field, value) => {\n        updateTopLevel(currentOrg.key, {\n            ...currentData,\n            [field]: value\n        });\n    };\n\n    return (\n        <div className=\"space-y-4\">\n            <Tabs value={activeOrg} onValueChange={setActiveOrg}>\n                <TabsList className=\"grid grid-cols-4 w-full\">\n                    {orgTypes.map((org) => (\n                        <TabsTrigger key={org.id} value={org.id}>{org.label}</TabsTrigger>\n                    ))}\n                </TabsList>\n\n                {orgTypes.map((org) => (\n                    <TabsContent key={org.id} value={org.id} className=\"mt-4 space-y-4\">\n                        <Card>\n                            <CardHeader>\n                                <CardTitle className=\"text-lg\">{org.label}</CardTitle>\n                            </CardHeader>\n                            <CardContent className=\"space-y-4\">\n                                <LocalizedInput\n                                    label=\"Title\"\n                                    value={data?.[org.key]?.title}\n                                    onChange={(v) => handleOrgChange('title', v)}\n                                />\n                                {(org.id === 'committee' || org.id === 'osis' || org.id === 'mpk') && (\n                                    <div>\n                                        <Label>Period</Label>\n                                        <Input\n                                            value={data?.[org.key]?.period || ''}\n                                            onChange={(e) => handleOrgChange('period', e.target.value)}\n                                            placeholder=\"e.g., 2024/2025\"\n                                        />\n                                    </div>\n                                )}\n                                <PositionArrayEditor\n                                    label=\"Positions\"\n                                    value={data?.[org.key]?.positions || []}\n                                    onChange={(v) => handleOrgChange('positions', v)}\n                                    showPhoto={org.id === 'school'}\n                                    showClass={org.id === 'osis' || org.id === 'mpk'}\n                                />\n                                {org.id === 'mpk' && (\n                                    <LocalizedInput\n                                        label=\"Description\"\n                                        type=\"textarea\"\n                                        value={data?.[org.key]?.description}\n                                        onChange={(v) => handleOrgChange('description', v)}\n                                    />\n                                )}\n                            </CardContent>\n                        </Card>\n                    </TabsContent>\n                ))}\n            </Tabs>\n        </div>\n    );\n}\n\nfunction StaffEditor({ data = {}, updateField, updateTopLevel }) {\n    const [activeStaff, setActiveStaff] = useState('teachers');\n\n    return (\n        <div className=\"space-y-4\">\n            <Tabs value={activeStaff} onValueChange={setActiveStaff}>\n                <TabsList className=\"grid grid-cols-2 w-[400px]\">\n                    <TabsTrigger value=\"teachers\">Teaching Staff</TabsTrigger>\n                    <TabsTrigger value=\"admin\">Administrative Staff</TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"teachers\" className=\"mt-4 space-y-4\">\n                    <Card>\n                        <CardHeader>\n                            <CardTitle className=\"text-lg\">Teaching Council</CardTitle>\n                            <CardDescription>Manage teacher roster with roles and subjects</CardDescription>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                            <LocalizedInput\n                                label=\"Section Title\"\n                                value={data?.teachingStaff?.title}\n                                onChange={(v) => updateTopLevel('teachingStaff', { ...data?.teachingStaff, title: v })}\n                            />\n                            <LocalizedInput\n                                label=\"Description\"\n                                type=\"textarea\"\n                                value={data?.teachingStaff?.description}\n                                onChange={(v) => updateTopLevel('teachingStaff', { ...data?.teachingStaff, description: v })}\n                            />\n                            <StaffArrayEditor\n                                label=\"Staff Members\"\n                                value={data?.teachingStaff?.staff || []}\n                                onChange={(v) => updateTopLevel('teachingStaff', { ...data?.teachingStaff, staff: v })}\n                                showSubject={true}\n                            />\n                        </CardContent>\n                    </Card>\n                </TabsContent>\n\n                <TabsContent value=\"admin\" className=\"mt-4 space-y-4\">\n                    <Card>\n                        <CardHeader>\n                            <CardTitle className=\"text-lg\">Administrative Staff</CardTitle>\n                            <CardDescription>Non-teaching support staff</CardDescription>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                            <LocalizedInput\n                                label=\"Section Title\"\n                                value={data?.administrativeStaff?.title}\n                                onChange={(v) => updateTopLevel('administrativeStaff', { ...data?.administrativeStaff, title: v })}\n                            />\n                            <StaffArrayEditor\n                                label=\"Staff Members\"\n                                value={data?.administrativeStaff?.staff || []}\n                                onChange={(v) => updateTopLevel('administrativeStaff', { ...data?.administrativeStaff, staff: v })}\n                                showSubject={false}\n                            />\n                        </CardContent>\n                    </Card>\n                </TabsContent>\n            </Tabs>\n        </div>\n    );\n}\n\nfunction ServicesEditor({ data = {}, updateField }) {\n    return (\n        <div className=\"grid gap-6\">\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg\">Library</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <LocalizedInput\n                        label=\"Title\"\n                        value={data.library?.title}\n                        onChange={(v) => updateField('library', 'title', v)}\n                    />\n                    <LocalizedInput\n                        label=\"Content\"\n                        type=\"richtext\"\n                        value={data.library?.content}\n                        onChange={(v) => updateField('library', 'content', v)}\n                    />\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n\nfunction AchievementsEditor({ data = {}, updateField }) {\n    return (\n        <Card>\n            <CardHeader>\n                <CardTitle className=\"text-lg\">School Achievements</CardTitle>\n                <CardDescription>Awards, competitions, and recognitions</CardDescription>\n            </CardHeader>\n            <CardContent>\n                <LocalizedInput\n                    label=\"Page Description\"\n                    type=\"textarea\"\n                    value={data.achievementsPage?.description}\n                    onChange={(v) => updateField('achievementsPage', 'description', v)}\n                />\n            </CardContent>\n        </Card>\n    );\n}\n\nfunction AlumniEditor({ data = {}, updateField }) {\n    return (\n        <Card>\n            <CardHeader>\n                <CardTitle className=\"text-lg\">Alumni</CardTitle>\n                <CardDescription>Featured alumni and association info</CardDescription>\n            </CardHeader>\n            <CardContent>\n                <LocalizedInput\n                    label=\"Page Description\"\n                    type=\"textarea\"\n                    value={data.alumniPage?.description}\n                    onChange={(v) => updateField('alumniPage', 'description', v)}\n                />\n            </CardContent>\n        </Card>\n    );\n}\n\nfunction FinanceEditor({ data = {}, updateField }) {\n    return (\n        <Card>\n            <CardHeader>\n                <CardTitle className=\"text-lg\">Financial Transparency</CardTitle>\n                <CardDescription>BOS, APBD, and Committee reports</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n                <LocalizedInput\n                    label=\"BOS Report Content\"\n                    type=\"richtext\"\n                    value={data.bos?.content}\n                    onChange={(v) => updateField('bos', 'content', v)}\n                />\n            </CardContent>\n        </Card>\n    );\n}\n\nfunction GalleryEditor({ data = {}, updateField, updateTopLevel }) {\n    const [albums, setAlbums] = useState(data?.albums || []);\n\n    const handleAlbumsChange = (newAlbums) => {\n        setAlbums(newAlbums);\n        updateTopLevel('albums', newAlbums);\n    };\n\n    const addAlbum = () => {\n        handleAlbumsChange([...albums, {\n            id: `album-${Date.now()}`,\n            title: { id: '', en: '' },\n            description: { id: '', en: '' },\n            coverImage: '',\n            images: []\n        }]);\n    };\n\n    const updateAlbum = (index, field, value) => {\n        const updated = albums.map((album, i) =>\n            i === index ? { ...album, [field]: value } : album\n        );\n        handleAlbumsChange(updated);\n    };\n\n    const removeAlbum = (index) => {\n        handleAlbumsChange(albums.filter((_, i) => i !== index));\n    };\n\n    return (\n        <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h3 className=\"text-lg font-medium\">Photo Gallery Albums</h3>\n                    <p className=\"text-sm text-muted-foreground\">Create and manage gallery albums</p>\n                </div>\n                <Button onClick={addAlbum} variant=\"outline\" size=\"sm\">\n                    <Plus className=\"h-4 w-4 mr-1\" /> Add Album\n                </Button>\n            </div>\n\n            {albums.length === 0 ? (\n                <Card className=\"border-dashed\">\n                    <CardContent className=\"py-8 text-center text-muted-foreground\">\n                        No albums created yet. Click &quot;Add Album&quot; to create one.\n                    </CardContent>\n                </Card>\n            ) : (\n                <div className=\"grid gap-4\">\n                    {albums.map((album, index) => (\n                        <Card key={album.id || index}>\n                            <CardHeader className=\"flex flex-row items-start justify-between\">\n                                <div>\n                                    <CardTitle className=\"text-base\">\n                                        {album.title?.id || album.title?.en || `Album ${index + 1}`}\n                                    </CardTitle>\n                                </div>\n                                <Button\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    className=\"text-destructive\"\n                                    onClick={() => removeAlbum(index)}\n                                >\n                                    <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                            </CardHeader>\n                            <CardContent className=\"space-y-4\">\n                                <LocalizedInput\n                                    label=\"Album Title\"\n                                    value={album.title}\n                                    onChange={(v) => updateAlbum(index, 'title', v)}\n                                />\n                                <LocalizedInput\n                                    label=\"Description\"\n                                    type=\"textarea\"\n                                    value={album.description}\n                                    onChange={(v) => updateAlbum(index, 'description', v)}\n                                />\n                                <ImageUpload\n                                    label=\"Cover Image\"\n                                    value={album.coverImage}\n                                    onChange={(v) => updateAlbum(index, 'coverImage', v)}\n                                />\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n}\n\nfunction AgendaEditor({ data = {}, updateField, updateTopLevel }) {\n    const [events, setEvents] = useState(data?.events || []);\n\n    const handleEventsChange = (newEvents) => {\n        setEvents(newEvents);\n        updateTopLevel('events', newEvents);\n    };\n\n    const addEvent = () => {\n        handleEventsChange([...events, {\n            id: `event-${Date.now()}`,\n            title: { id: '', en: '' },\n            description: { id: '', en: '' },\n            date: '',\n            endDate: '',\n            location: '',\n            isAllDay: false\n        }]);\n    };\n\n    const updateEvent = (index, field, value) => {\n        const updated = events.map((event, i) =>\n            i === index ? { ...event, [field]: value } : event\n        );\n        handleEventsChange(updated);\n    };\n\n    const removeEvent = (index) => {\n        handleEventsChange(events.filter((_, i) => i !== index));\n    };\n\n    return (\n        <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h3 className=\"text-lg font-medium\">School Agenda</h3>\n                    <p className=\"text-sm text-muted-foreground\">Manage upcoming events and activities</p>\n                </div>\n                <Button onClick={addEvent} variant=\"outline\" size=\"sm\">\n                    <Plus className=\"h-4 w-4 mr-1\" /> Add Event\n                </Button>\n            </div>\n\n            {events.length === 0 ? (\n                <Card className=\"border-dashed\">\n                    <CardContent className=\"py-8 text-center text-muted-foreground\">\n                        No events scheduled. Click &quot;Add Event&quot; to create one.\n                    </CardContent>\n                </Card>\n            ) : (\n                <div className=\"grid gap-4\">\n                    {events.map((event, index) => (\n                        <Card key={event.id || index}>\n                            <CardHeader className=\"flex flex-row items-start justify-between pb-2\">\n                                <div>\n                                    <CardTitle className=\"text-base\">\n                                        {event.title?.id || event.title?.en || `Event ${index + 1}`}\n                                    </CardTitle>\n                                    {event.date && (\n                                        <CardDescription>{event.date}{event.endDate ? ` - ${event.endDate}` : ''}</CardDescription>\n                                    )}\n                                </div>\n                                <Button\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    className=\"text-destructive\"\n                                    onClick={() => removeEvent(index)}\n                                >\n                                    <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                            </CardHeader>\n                            <CardContent className=\"space-y-4\">\n                                <LocalizedInput\n                                    label=\"Event Title\"\n                                    value={event.title}\n                                    onChange={(v) => updateEvent(index, 'title', v)}\n                                />\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div>\n                                        <Label>Start Date</Label>\n                                        <Input\n                                            type=\"date\"\n                                            value={event.date || ''}\n                                            onChange={(e) => updateEvent(index, 'date', e.target.value)}\n                                        />\n                                    </div>\n                                    <div>\n                                        <Label>End Date (optional)</Label>\n                                        <Input\n                                            type=\"date\"\n                                            value={event.endDate || ''}\n                                            onChange={(e) => updateEvent(index, 'endDate', e.target.value)}\n                                        />\n                                    </div>\n                                </div>\n                                <div>\n                                    <Label>Location</Label>\n                                    <Input\n                                        value={event.location || ''}\n                                        onChange={(e) => updateEvent(index, 'location', e.target.value)}\n                                        placeholder=\"Event location\"\n                                    />\n                                </div>\n                                <LocalizedInput\n                                    label=\"Description\"\n                                    type=\"textarea\"\n                                    value={event.description}\n                                    onChange={(v) => updateEvent(index, 'description', v)}\n                                />\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n}\n\nfunction ContactEditor({ data = {}, updateField }) {\n    return (\n        <Card>\n            <CardHeader>\n                <CardTitle className=\"text-lg\">Contact Information</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n                <LocalizedInput\n                    label=\"Address\"\n                    type=\"textarea\"\n                    value={data.contactInfo?.address}\n                    onChange={(v) => updateField('contactInfo', 'address', v)}\n                />\n                <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                        <Label>Phone</Label>\n                        <Input\n                            value={data.contactInfo?.phone || ''}\n                            onChange={(e) => updateField('contactInfo', 'phone', e.target.value)}\n                            placeholder=\"Phone number\"\n                        />\n                    </div>\n                    <div>\n                        <Label>Email</Label>\n                        <Input\n                            value={data.contactInfo?.email || ''}\n                            onChange={(e) => updateField('contactInfo', 'email', e.target.value)}\n                            placeholder=\"Email address\"\n                        />\n                    </div>\n                </div>\n                <LocalizedInput\n                    label=\"Operational Hours\"\n                    value={data.contactInfo?.operationalHours}\n                    onChange={(v) => updateField('contactInfo', 'operationalHours', v)}\n                />\n                <div>\n                    <Label>Google Maps Embed URL</Label>\n                    <Input\n                        value={data.mapEmbed || ''}\n                        onChange={(e) => updateField('mapEmbed', e.target.value)}\n                        placeholder=\"https://maps.google.com/...\"\n                    />\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n\nexport default SchoolPagesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/SeoManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Globe, Save, Loader2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { ShieldAlert } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction SeoManager() {\n    const { t } = useTranslation();\n    const { toast } = useToast();\n    const { currentTenant } = useTenant();\n    const { hasPermission } = usePermissions();\n    const tenantId = currentTenant?.id;\n    const [loading, setLoading] = useState(false);\n    const [saving, setSaving] = useState(false);\n    const [globalSeo, setGlobalSeo] = useState({\n        site_title: 'AWCMS - Advanced CMS',\n        site_description: 'A powerful, secure, and extensible Content Management System.',\n        default_keywords: 'cms, react, supabase, secure',\n        og_image: '',\n        twitter_handle: '@awcms'\n    });\n\n    /* \n     * Fetch SEO Settings from 'settings' table (key='seo_global')\n     */\n    const fetchSeoSettings = useCallback(async () => {\n        if (!tenantId) return;\n\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('settings')\n                .select('value')\n                .eq('key', 'seo_global')\n                .eq('tenant_id', tenantId)\n                .is('deleted_at', null)\n                .maybeSingle();\n\n            if (error) throw error;\n\n            if (data?.value) {\n                try {\n                    const parsed = typeof data.value === 'string'\n                        ? JSON.parse(data.value)\n                        : data.value;\n                    setGlobalSeo(prev => ({ ...prev, ...parsed }));\n                } catch (parseError) {\n                    console.error('Failed to parse SEO settings:', parseError);\n                }\n            }\n        } catch (err) {\n            console.error('Failed to load SEO settings:', err);\n        } finally {\n            setLoading(false);\n        }\n    }, [tenantId]);\n\n    useEffect(() => {\n        fetchSeoSettings();\n    }, [tenantId, fetchSeoSettings]);\n\n    const handleSave = async (e) => {\n        e.preventDefault();\n        setSaving(true);\n\n        try {\n            // All users should use their tenant_id for settings\n            // The settings table requires tenant_id as part of primary key\n            if (!tenantId) {\n                throw new Error(t('seo_manager.error_no_tenant'));\n            }\n\n            const upsertData = {\n                key: 'seo_global',\n                value: JSON.stringify(globalSeo),\n                type: 'json',\n                description: 'Global SEO Configuration',\n                is_public: true,\n                deleted_at: null,\n                tenant_id: tenantId\n            };\n\n            const { error } = await supabase\n                .from('settings')\n                .upsert(upsertData, {\n                    onConflict: 'tenant_id,key'\n                });\n\n            if (error) throw error;\n\n            toast({\n                title: t('seo_manager.toast_saved_title'),\n                description: t('seo_manager.toast_saved_desc')\n            });\n        } catch (err) {\n            toast({\n                variant: \"destructive\",\n                title: t('seo_manager.toast_error_title'),\n                description: t('seo_manager.toast_error_desc_prefix') + err.message\n            });\n        } finally {\n            setSaving(false);\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n        );\n    }\n\n    if (!hasPermission('tenant.seo.read')) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-card rounded-xl border border-border p-12 text-center\">\n                <div className=\"p-4 bg-destructive/10 rounded-full mb-4\">\n                    <ShieldAlert className=\"w-12 h-12 text-destructive\" />\n                </div>\n                <h3 className=\"text-xl font-bold text-foreground\">{t('seo_manager.access_denied')}</h3>\n                <p className=\"text-muted-foreground mt-2\">{t('seo_manager.access_denied_desc')}</p>\n            </div>\n        );\n    }\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.seo.read\">\n            <PageHeader\n                title={t('seo_manager.title')}\n                description={t('seo_manager.description')}\n                icon={Globe}\n                breadcrumbs={[{ label: 'SEO Default', icon: Globe }]}\n            />\n\n            <div className=\"max-w-4xl space-y-6\">\n\n                <Card>\n                    <CardHeader>\n                        <CardTitle>{t('seo_manager.card_meta_title')}</CardTitle>\n                        <CardDescription>{t('seo_manager.card_meta_desc')}</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                        <form onSubmit={handleSave} className=\"space-y-6\">\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                <div className=\"space-y-2\">\n                                    <Label htmlFor=\"site_title\">{t('seo_manager.label_site_title')}</Label>\n                                    <Input\n                                        id=\"site_title\"\n                                        value={globalSeo.site_title}\n                                        onChange={(e) => setGlobalSeo({ ...globalSeo, site_title: e.target.value })}\n                                        placeholder={t('seo_manager.placeholder_site_title')}\n                                    />\n                                </div>\n                                <div className=\"space-y-2\">\n                                    <Label htmlFor=\"twitter_handle\">{t('seo_manager.label_twitter')}</Label>\n                                    <Input\n                                        id=\"twitter_handle\"\n                                        value={globalSeo.twitter_handle}\n                                        onChange={(e) => setGlobalSeo({ ...globalSeo, twitter_handle: e.target.value })}\n                                        placeholder={t('seo_manager.placeholder_twitter')}\n                                    />\n                                </div>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"site_description\">{t('seo_manager.label_meta_desc')}</Label>\n                                <Textarea\n                                    id=\"site_description\"\n                                    value={globalSeo.site_description}\n                                    onChange={(e) => setGlobalSeo({ ...globalSeo, site_description: e.target.value })}\n                                    rows={3}\n                                    placeholder={t('seo_manager.placeholder_meta_desc')}\n                                />\n                                <p className=\"text-xs text-muted-foreground\">\n                                    {t('seo_manager.helper_meta_desc')}\n                                </p>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"default_keywords\">{t('seo_manager.label_keywords')}</Label>\n                                <Input\n                                    id=\"default_keywords\"\n                                    value={globalSeo.default_keywords}\n                                    onChange={(e) => setGlobalSeo({ ...globalSeo, default_keywords: e.target.value })}\n                                    placeholder={t('seo_manager.placeholder_keywords')}\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"og_image\">{t('seo_manager.label_og_image')}</Label>\n                                <div className=\"flex gap-2\">\n                                    <Input\n                                        id=\"og_image\"\n                                        value={globalSeo.og_image}\n                                        onChange={(e) => setGlobalSeo({ ...globalSeo, og_image: e.target.value })}\n                                        placeholder={t('seo_manager.placeholder_og_image')}\n                                    />\n                                    <Button type=\"button\" variant=\"outline\">{t('seo_manager.button_browse')}</Button>\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">\n                                    {t('seo_manager.helper_og_image')}\n                                </p>\n                            </div>\n\n                            <div className=\"pt-4 border-t border-border flex justify-end\">\n                                <Button type=\"submit\" disabled={saving}>\n                                    {saving ? (\n                                        <>\n                                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                                            {t('seo_manager.saving')}\n                                        </>\n                                    ) : (\n                                        <>\n                                            <Save className=\"w-4 h-4 mr-2\" />\n                                            {t('seo_manager.button_save')}\n                                        </>\n                                    )}\n                                </Button>\n                            </div>\n                        </form>\n                    </CardContent>\n                </Card>\n\n                <Card className=\"bg-primary/5 border-primary/20\">\n                    <CardContent className=\"pt-6\">\n                        <div className=\"flex items-start gap-4\">\n                            <div className=\"p-3 bg-primary/10 rounded-lg text-primary\">\n                                <Globe className=\"w-6 h-6\" />\n                            </div>\n                            <div>\n                                <h3 className=\"font-bold text-foreground mb-1\">{t('seo_manager.card_robots_title')}</h3>\n                                <p className=\"text-sm text-muted-foreground mb-4\">\n                                    {t('seo_manager.card_robots_desc_prefix')} <code className=\"bg-muted px-1 py-0.5 rounded text-foreground font-mono\">/sitemap.xml</code> {t('seo_manager.card_robots_desc_suffix')}\n                                </p>\n                                <Button variant=\"outline\" size=\"sm\" className=\"bg-background hover:bg-muted text-foreground border-border\">\n                                    {t('seo_manager.button_view_sitemap')}\n                                </Button>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n        </AdminPageLayout>\n    );\n}\n\nexport default SeoManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ServicesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Wrench } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction ServicesManager() {\n    const columns = [\n        { key: 'title', label: 'Title' },\n        {\n            key: 'icon',\n            label: 'Icon',\n            render: (value) => value ? <i className={value}></i> : '-'\n        },\n        { key: 'order', label: 'Order', type: 'number' },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'published' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'draft' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n                        'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'draft'}\n                </span>\n            )\n        }\n    ];\n\n    const formFields = [\n        { key: 'title', label: 'Title', required: true },\n        { key: 'description', label: 'Description', type: 'richtext' },\n        { key: 'icon', label: 'Icon Class (e.g., ti-ruler-pencil)', description: 'Use Themify icon class names' },\n        { key: 'image', label: 'Service Image', type: 'image' },\n        { key: 'link', label: 'Link URL' },\n        { key: 'order', label: 'Sort Order', type: 'number', defaultValue: 0 },\n        {\n            key: 'status',\n            label: 'Status',\n            type: 'select',\n            options: [\n                { value: 'draft', label: 'Draft' },\n                { value: 'published', label: 'Published' },\n                { value: 'archived', label: 'Archived' }\n            ]\n        }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.services.read\">\n            <PageHeader\n                title=\"Services\"\n                description=\"Manage your company's services showcase.\"\n                icon={Wrench}\n                breadcrumbs={[{ label: 'Services', icon: Wrench }]}\n            />\n\n            <GenericContentManager\n                tableName=\"services\"\n                resourceName=\"Service\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"services\"\n                showBreadcrumbs={false}\n                defaultSortColumn=\"order\"\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default ServicesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/SettingsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Settings } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction SettingsManager() {\n    const columns = [\n        { key: 'key', label: 'Setting Key', className: 'font-mono font-medium' },\n        { key: 'value', label: 'Value', className: 'truncate max-w-[200px]' },\n        { key: 'description', label: 'Description', className: 'text-muted-foreground text-xs' }\n    ];\n\n    const formFields = [\n        { key: 'key', label: 'Key', required: true, description: 'Unique identifier (e.g., site_name, maintenance_mode)' },\n        { key: 'value', label: 'Value', type: 'textarea', required: true, description: 'The value for this setting' },\n        { key: 'description', label: 'Description', type: 'textarea', description: 'What this setting controls' },\n        {\n            key: 'type',\n            label: 'Type',\n            type: 'select',\n            options: [\n                { value: 'string', label: 'String' },\n                { value: 'boolean', label: 'Boolean (true/false)' },\n                { value: 'number', label: 'Number' },\n                { value: 'json', label: 'JSON' }\n            ]\n        }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.setting.read\">\n            <PageHeader\n                title=\"Settings\"\n                description=\"Manage system configuration and preferences.\"\n                icon={Settings}\n                breadcrumbs={[{ label: 'Settings', icon: Settings }]}\n            />\n\n            <GenericContentManager\n                tableName=\"settings\"\n                resourceName=\"Setting\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"setting\"\n                viewPermission=\"tenant.setting.read\"\n                createPermission=\"tenant.setting.create\"\n                customSelect=\"*\"\n                enableSoftDelete={false}\n                defaultSortColumn=\"key\"\n                showBreadcrumbs={false}\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default SettingsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/Sidebar.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  124 |\n  125 |   useEffect(() => {\n> 126 |     if (searchQuery) setCollapsedGroups(new Set());\n      |                      ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  127 |   }, [searchQuery]);\n  128 |\n  129 |   const sidebarVariants = {","line":126,"column":22,"nodeType":null,"endLine":126,"endColumn":40}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useMemo, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { X, LogOut, ChevronDown, ChevronRight, Search, LayoutGrid } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { useAdminMenu } from '@/hooks/useAdminMenu';\nimport { getIconComponent } from '@/lib/adminIcons';\nimport { usePlugins } from '@/contexts/PluginContext';\nimport { TenantUsage } from './TenantUsage';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { checkTierAccess } from '@/lib/tierFeatures';\n\nfunction Sidebar({ isOpen, setIsOpen }) {\n  const { t } = useTranslation();\n  const { hasPermission, userRole, isPlatformAdmin, isFullAccess } = usePermissions();\n  const { currentTenant } = useTenant();\n  const { signOut } = useAuth();\n  const { applyFilters } = usePlugins(); // Moved to top level\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { menuItems, loading } = useAdminMenu();\n\n  const [searchQuery, setSearchQuery] = useState('');\n  const [collapsedGroups, setCollapsedGroups] = useState(new Set());\n\n  const currentPath = location.pathname.split('/cmspanel/')[1] || 'home';\n\n  const handleNavigation = (path) => {\n    // Handle empty, null, undefined, or root path\n    if (!path || path === '' || path === '/' || path === 'home') {\n      navigate('/cmspanel');\n    }\n    // Prevent external URLs (http, https, mailto, etc.)\n    else if (path.includes('://') || path.startsWith('mailto:') || path.startsWith('tel:')) {\n      return; // Don't navigate to external URLs\n    }\n    // Handle path that's just a slash followed by nothing useful\n    else if (path.trim() === '/' || path.trim() === '') {\n      navigate('/cmspanel');\n    }\n    else {\n      // Strip any leading slashes\n      let cleanPath = path;\n      while (cleanPath.startsWith('/')) {\n        cleanPath = cleanPath.slice(1);\n      }\n\n      // If cleanPath is empty after stripping, go to dashboard\n      if (!cleanPath || cleanPath.trim() === '') {\n        navigate('/cmspanel');\n      } else {\n        const targetPath = `/cmspanel/${cleanPath}`;\n        navigate(targetPath);\n      }\n    }\n\n    if (window.innerWidth < 1024) {\n      setIsOpen(false);\n    }\n  };\n\n  const toggleGroup = (groupLabel) => {\n    setCollapsedGroups(prev => {\n      const next = new Set(prev);\n      if (next.has(groupLabel)) {\n        next.delete(groupLabel);\n      } else {\n        next.add(groupLabel);\n      }\n      return next;\n    });\n  };\n\n  const groupedMenus = useMemo(() => {\n    if (loading) return {};\n\n    const authorizedItems = menuItems.filter(item => {\n      if (!item.is_visible) {\n        return false;\n      }\n      if (item.permission === 'super_admin_only') return isFullAccess || isPlatformAdmin;\n      if (item.permission === 'platform_admin_only') return isPlatformAdmin;\n\n      // Check Subscription Tier\n      if (!checkTierAccess(currentTenant?.subscription_tier, item.key)) {\n        return false;\n      }\n\n      if (item.permission) {\n        const hasPerm = hasPermission(item.permission);\n        return hasPerm;\n      }\n      return true;\n    });\n\n    // HOOK: Allow plugins to modify the menu items dynamically (applyFilters from top-level hook)\n    const filteredByPlugins = applyFilters('admin_sidebar_menu', authorizedItems, { userRole, hasPermission });\n\n    const filteredItems = searchQuery\n      ? filteredByPlugins.filter(item =>\n        item.label.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        t(`menu.${item.key}`, item.label).toLowerCase().includes(searchQuery.toLowerCase())\n      )\n      : filteredByPlugins;\n    const groups = {};\n    filteredItems.forEach(item => {\n      const groupLabel = item.group_label || 'General';\n      if (!groups[groupLabel]) {\n        groups[groupLabel] = { order: item.group_order || 999, items: [] };\n      }\n      groups[groupLabel].items.push(item);\n    });\n    Object.keys(groups).forEach(key => groups[key].items.sort((a, b) => a.order - b.order));\n    return groups;\n  }, [menuItems, loading, userRole, hasPermission, isPlatformAdmin, isFullAccess, searchQuery, t, applyFilters, currentTenant?.subscription_tier]);\n\n  const sortedGroupKeys = Object.keys(groupedMenus).sort((a, b) =>\n    groupedMenus[a].order - groupedMenus[b].order\n  );\n\n  useEffect(() => {\n    if (searchQuery) setCollapsedGroups(new Set());\n  }, [searchQuery]);\n\n  const sidebarVariants = {\n    mobile: {\n      x: isOpen ? 0 : -280,\n      width: 280,\n      position: 'fixed'\n    },\n    desktop: {\n      x: 0,\n      width: isOpen ? 280 : 0,\n      position: 'relative'\n    }\n  };\n\n  const isMobile = typeof window !== 'undefined' && window.innerWidth < 1024;\n\n  return (\n    <>\n      {/* Mobile Overlay */}\n      <AnimatePresence>\n        {isOpen && isMobile && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={() => setIsOpen(false)}\n            className=\"fixed inset-0 bg-black/60 z-40 lg:hidden backdrop-blur-sm\"\n          />\n        )}\n      </AnimatePresence>\n\n      <motion.aside\n        initial={false}\n        animate={isMobile ? sidebarVariants.mobile : sidebarVariants.desktop}\n        transition={{ duration: 0.3, ease: \"easeInOut\" }}\n        className={cn(\n          \"inset-y-0 left-0 z-50 overflow-hidden border-r shadow-xl\",\n          \"bg-white/95 dark:bg-slate-950/95 backdrop-blur text-slate-900 dark:text-white\",\n          \"border-slate-200/80 dark:border-slate-800\"\n        )}\n        style={{ whiteSpace: 'nowrap' }}\n      >\n        <div className=\"w-[280px] flex flex-col h-full\">\n          {/* Header */}\n          <div className=\"p-6 border-b border-slate-200/70 dark:border-slate-800/80 flex items-center justify-between bg-white/80 dark:bg-slate-950/70 h-20 shrink-0\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"h-8 w-8 bg-gradient-to-br from-indigo-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/25\">\n                <LayoutGrid className=\"w-5 h-5 text-white\" />\n              </div>\n              <span className=\"font-bold text-lg tracking-tight\">{t('sidebar.title')}</span>\n            </div>\n            <button\n              onClick={() => setIsOpen(false)}\n              className=\"lg:hidden p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors text-slate-500 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n\n          {/* Search */}\n          <div className=\"px-4 py-4 border-b border-slate-200/70 dark:border-slate-800/50\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-2.5 w-4 h-4 text-slate-400 dark:text-slate-500\" />\n              <input\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                placeholder={t('sidebar.search_placeholder')}\n                className=\"w-full rounded-md border border-slate-200/70 bg-slate-100/80 py-2 pl-9 pr-4 text-sm text-slate-700 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition-all dark:border-slate-700/70 dark:bg-slate-900/70 dark:text-slate-100 dark:placeholder:text-slate-500\"\n              />\n            </div>\n          </div>\n\n          {/* Menu Items */}\n          <div className=\"flex-1 overflow-y-auto py-4 px-3 custom-scrollbar space-y-6\">\n            {loading ? (\n              <div className=\"space-y-4 px-2\">\n                {[1, 2, 3].map(i => (\n                  <div key={i} className=\"space-y-2\">\n                    <div className=\"h-4 w-20 bg-slate-800 rounded animate-pulse\" />\n                    <div className=\"h-10 w-full bg-slate-800/50 rounded-lg animate-pulse\" />\n                    <div className=\"h-10 w-full bg-slate-800/50 rounded-lg animate-pulse\" />\n                  </div>\n                ))}\n              </div>\n            ) : sortedGroupKeys.length === 0 ? (\n              <div className=\"text-center py-8 text-slate-500 text-sm\">\n                {t('sidebar.no_items')}\n              </div>\n            ) : (\n              sortedGroupKeys.map(groupLabel => {\n                const group = groupedMenus[groupLabel];\n                const isCollapsed = collapsedGroups.has(groupLabel);\n\n                return (\n                  <div key={groupLabel} className=\"space-y-1\">\n                    {/* Group Header */}\n                    {groupLabel !== 'General' && (\n                      <button\n                        onClick={() => toggleGroup(groupLabel)}\n                        className=\"w-full flex items-center justify-between px-3 py-1 text-xs font-semibold text-slate-500 uppercase tracking-wider hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 transition-colors group\"\n                      >\n                        <span>{groupLabel}</span>\n                        {isCollapsed ? (\n                          <ChevronRight className=\"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity\" />\n                        ) : (\n                          <ChevronDown className=\"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity\" />\n                        )}\n                      </button>\n                    )}\n\n                    <AnimatePresence initial={false}>\n                      {!isCollapsed && (\n                        <motion.div\n                          initial={{ height: 0, opacity: 0 }}\n                          animate={{ height: \"auto\", opacity: 1 }}\n                          exit={{ height: 0, opacity: 0 }}\n                          transition={{ duration: 0.2 }}\n                          className=\"space-y-1 overflow-hidden\"\n                        >\n                          {group.items.map((item) => {\n                            const Icon = getIconComponent(item.icon);\n                            const isActive = item.path === ''\n                              ? currentPath === '' || currentPath === 'home'\n                              : currentPath === item.path || currentPath.startsWith(item.path + '/');\n\n                            return (\n                              <button\n                                key={item.id}\n                                onClick={() => handleNavigation(item.path)}\n                                className={cn(\n                                  \"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200\",\n                                  \"group font-medium text-sm relative\",\n                                  isActive\n                                    ? \"bg-blue-50 text-blue-700 dark:bg-blue-500/10 dark:text-blue-300\"\n                                    : \"text-slate-600 hover:bg-slate-100/80 hover:text-slate-900 dark:text-slate-400 dark:hover:bg-slate-800/80 dark:hover:text-white\"\n                                )}\n                              >\n                                {isActive && (\n                                  <motion.div\n                                    layoutId=\"activeTab\"\n                                    className=\"absolute left-0 w-1 h-6 bg-blue-500 rounded-r-full\"\n                                  />\n                                )}\n                                <Icon className={cn(\n                                  \"w-4 h-4 transition-colors shrink-0\",\n                                  isActive ? \"text-blue-600 dark:text-blue-300\" : \"text-slate-400 dark:text-slate-500 group-hover:text-slate-700 dark:group-hover:text-white\"\n                                )} />\n                                <span className=\"truncate\">{t(`menu.${item.key}`, item.label)}</span>\n                              </button>\n                            );\n                          })}\n                        </motion.div>\n                      )}\n                    </AnimatePresence>\n                  </div>\n                );\n              })\n            )}\n          </div>\n\n          {/* Footer Actions */}\n          <div className=\"mt-auto\">\n            <TenantUsage />\n            <div className=\"p-4 border-t border-slate-200/70 dark:border-slate-800 bg-white/80 dark:bg-slate-950/70 shrink-0\">\n              <button\n                onClick={signOut}\n                className=\"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-500 hover:bg-red-50 hover:text-red-600 dark:text-slate-400 dark:hover:bg-red-950/30 dark:hover:text-red-400 transition-colors text-sm font-medium border border-transparent hover:border-red-200/70 dark:hover:border-red-900/30\"\n              >\n                <LogOut className=\"w-4 h-4\" />\n                {t('auth.logout')}\n              </button>\n            </div>\n          </div>\n        </div>\n      </motion.aside>\n    </>\n  );\n}\n\nexport default Sidebar;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/SidebarMenuManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":133,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":133,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":155,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":155,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":211,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":211,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":228,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":228,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":265,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":265,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'checked' is defined but never used.","line":444,"column":87,"nodeType":"Identifier","messageId":"unusedVar","endLine":444,"endColumn":94,"suggestions":[{"messageId":"removeVar","data":{"varName":"checked"},"fix":{"range":[23555,23562],"text":""},"desc":"Remove unused variable 'checked'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { Reorder, AnimatePresence } from 'framer-motion';\nimport { Helmet } from 'react-helmet-async';\nimport {\n    GripVertical, Eye, EyeOff, Edit2, Save, RefreshCw,\n    Settings2, ShieldAlert, FolderOpen, Puzzle, Plus\n} from 'lucide-react';\nimport { useAdminMenu } from '@/hooks/useAdminMenu';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useSearch } from '@/hooks/useSearch';\nimport { getIconComponent } from '@/lib/adminIcons';\nimport { Button } from '@/components/ui/button';\nimport { useTranslation } from 'react-i18next';\nimport { Input } from '@/components/ui/input';\nimport MinCharSearchInput from '@/components/common/MinCharSearchInput';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/components/ui/use-toast';\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogFooter,\n    DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { Label } from '@/components/ui/label';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction SidebarMenuManager() {\n    const { t } = useTranslation();\n    const { menuItems, loading, updateMenuOrder, toggleVisibility, updateMenuItem, updateGroup, fetchMenu } = useAdminMenu();\n    const { hasPermission, isPlatformAdmin, isFullAccess, loading: permsLoading } = usePermissions();\n    const { toast } = useToast();\n\n    const {\n        query,\n        setQuery,\n        debouncedQuery,\n        isValid: isSearchValid,\n        message: searchMessage,\n        loading: searchLoading,\n        minLength,\n        clearSearch\n    } = useSearch({ context: 'admin' });\n\n    const [items, setItems] = useState([]);\n    const [activeTab, setActiveTab] = useState('items');\n\n    // Groups Management State\n    const [groups, setGroups] = useState([]);\n    const [editingGroup, setEditingGroup] = useState(null);\n    const [groupEditForm, setGroupEditForm] = useState({ label: '', order: 0 });\n    const [isSaving, setIsSaving] = useState(false);\n    const [hasChanges, setHasChanges] = useState(false);\n\n    // New Group Dialog State\n    const [showNewGroupDialog, setShowNewGroupDialog] = useState(false);\n    const [newGroupForm, setNewGroupForm] = useState({ label: '', order: 100 });\n\n    // Edit Dialog State\n    const [editingItem, setEditingItem] = useState(null);\n    const [editForm, setEditForm] = useState({\n        label: '',\n        group_label: 'General',\n        group_order: 0\n    });\n\n    const canView = hasPermission('platform.sidebar.read');\n    const canEdit = hasPermission('platform.sidebar.update');\n    const isSuperAdmin = isPlatformAdmin || isFullAccess;\n\n    useEffect(() => {\n        if (!menuItems.length) return;\n\n        const uniqueGroups = [];\n        const seen = new Set();\n        const groupSources = new Map(); // Track source of each group\n\n        // First pass: identify sources\n        menuItems.forEach(item => {\n            if (item.source === 'extension') {\n                groupSources.set(item.group_label, 'extension');\n            } else if (item.source === 'plugin') {\n                groupSources.set(item.group_label, 'plugin');\n            }\n        });\n\n        menuItems.forEach(item => {\n            if (!seen.has(item.group_label)) {\n                seen.add(item.group_label);\n                uniqueGroups.push({\n                    id: item.group_label, // Use label as ID for reorder\n                    label: item.group_label,\n                    order: item.group_order || 999,\n                    isExtension: groupSources.get(item.group_label) === 'extension',\n                    isPlugin: groupSources.get(item.group_label) === 'plugin'\n                });\n            }\n        });\n\n        // Sort by group_order\n        uniqueGroups.sort((a, b) => a.order - b.order);\n        setGroups(uniqueGroups);\n\n        // IMPORTANT: Also sync items state with menuItems\n        setItems(menuItems);\n    }, [menuItems]);\n\n\n    const handleGroupReorder = (newOrder) => {\n        if (!canEdit && !isSuperAdmin) return;\n        setGroups(newOrder);\n        setHasChanges(true);\n    };\n\n    const handleSaveGroupOrder = async () => {\n        if (!canEdit && !isSuperAdmin) return;\n        setIsSaving(true);\n        try {\n            // We need to update *all* items in each group to reflect the new group_order\n            for (let i = 0; i < groups.length; i++) {\n                const group = groups[i];\n                await updateGroup(group.label, { newOrder: (i + 1) * 10 });\n            }\n\n            toast({ title: t('common.success'), description: t('sidebar_manager.toast.group_order_updated') });\n            setHasChanges(false);\n            fetchMenu(); // Refresh to get consistent state\n        } catch (err) {\n            toast({ variant: 'destructive', title: t('common.error'), description: t('sidebar_manager.toast.error_save_group') });\n        } finally {\n            setIsSaving(false);\n        }\n    };\n\n    const handleEditGroup = (group) => {\n        setEditingGroup(group);\n        setGroupEditForm({ label: group.label, order: group.order });\n    };\n\n    const saveGroupEdit = async () => {\n        if (!editingGroup) return;\n        try {\n            await updateGroup(editingGroup.label, {\n                newLabel: groupEditForm.label,\n                newOrder: parseInt(groupEditForm.order)\n            });\n            setEditingGroup(null);\n            toast({ title: t('common.success'), description: t('sidebar_manager.toast.group_updated') });\n            fetchMenu();\n        } catch (err) {\n            toast({ variant: 'destructive', title: t('common.error'), description: t('sidebar_manager.toast.error_update_group') });\n        }\n    };\n\n    const handleCreateGroup = async () => {\n        if (!newGroupForm.label.trim()) return;\n\n        try {\n            // To create a group, we create a placeholder menu item with that group\n            // This will be a hidden item that just establishes the group\n            const groupKey = newGroupForm.label.toLowerCase().replace(/\\s+/g, '_');\n\n            const { error } = await supabase\n                .from('admin_menus')\n                .insert({\n                    key: `group_placeholder_${groupKey}`,\n                    label: `[${newGroupForm.label} Placeholder]`,\n                    path: '',\n                    icon: 'FolderOpen',\n                    permission: 'super_admin_only', // Hidden from non-platform admins\n                    group_label: newGroupForm.label.toUpperCase(),\n                    group_order: parseInt(newGroupForm.order) || 100,\n                    order: 9999, // At the end of the group\n                    is_visible: false, // Hidden placeholder\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                });\n\n            if (error) throw error;\n\n            setShowNewGroupDialog(false);\n            toast({ title: t('common.success'), description: t('sidebar_manager.toast.group_created', { name: newGroupForm.label }) });\n            fetchMenu(); // Refresh to show new group\n        } catch (err) {\n            console.error('Error creating group:', err);\n            toast({ variant: 'destructive', title: t('common.error'), description: t('sidebar_manager.toast.error_create_group') });\n        }\n    };\n\n    const handleReorder = (newOrder) => {\n        if (!canEdit && !isSuperAdmin) return;\n        setItems(newOrder);\n        setHasChanges(true);\n    };\n\n    const handleSaveOrder = async () => {\n        if (!canEdit && !isSuperAdmin) {\n            toast({ variant: 'destructive', title: t('sidebar_manager.toast.permission_denied'), description: t('sidebar_manager.toast.permission_desc') });\n            return;\n        }\n        setIsSaving(true);\n        try {\n            await updateMenuOrder(items);\n            setHasChanges(false);\n            toast({ title: t('common.success'), description: t('sidebar_manager.toast.menu_order_updated') });\n        } catch (err) {\n            toast({ variant: 'destructive', title: t('common.error'), description: t('sidebar_manager.toast.error_save_order') });\n        } finally {\n            setIsSaving(false);\n        }\n    };\n\n    const handleToggleVisibility = async (e, item) => {\n        e.stopPropagation();\n        if (!canEdit && !isSuperAdmin) {\n            toast({ variant: 'destructive', title: t('sidebar_manager.toast.permission_denied'), description: t('sidebar_manager.toast.permission_desc') });\n            return;\n        }\n        try {\n            await toggleVisibility(item.id, item.is_visible);\n            setItems(prev => prev.map(i => i.id === item.id ? { ...i, is_visible: !i.is_visible } : i));\n            toast({ title: item.is_visible ? t('sidebar_manager.hidden') : t('sidebar_manager.visible'), description: t('sidebar_manager.toast.visibility_updated', { status: item.is_visible ? t('sidebar_manager.hidden') : t('sidebar_manager.visible') }) });\n        } catch (err) {\n            toast({ variant: 'destructive', title: t('common.error'), description: t('sidebar_manager.toast.error_visibility') });\n        }\n    };\n\n    const handleEdit = (item) => {\n        if (!canEdit && !isSuperAdmin) {\n            toast({ variant: 'destructive', title: t('sidebar_manager.toast.permission_denied'), description: t('sidebar_manager.toast.permission_desc') });\n            return;\n        }\n        setEditingItem(item);\n        setEditForm({\n            label: item.label,\n            group_label: item.group_label || 'General',\n            group_order: item.group_order || 0\n        });\n    };\n\n    const saveEdit = async () => {\n        if (!editingItem) return;\n        try {\n            await updateMenuItem(editingItem.id, {\n                label: editForm.label,\n                group_label: editForm.group_label,\n                group_order: parseInt(editForm.group_order) || 0\n            });\n\n            // Update local state\n            setItems(prev => prev.map(i => i.id === editingItem.id ? {\n                ...i,\n                label: editForm.label,\n                group_label: editForm.group_label,\n                group_order: parseInt(editForm.group_order) || 0\n            } : i));\n\n            setEditingItem(null);\n            toast({ title: t('common.success'), description: t('sidebar_manager.toast.item_updated') });\n        } catch (err) {\n            toast({ variant: 'destructive', title: t('common.error'), description: t('sidebar_manager.toast.error_update_item') });\n        }\n    };\n\n    const filteredItems = items.filter(item =>\n        !debouncedQuery ||\n        item.label.toLowerCase().includes(debouncedQuery.toLowerCase()) ||\n        item.key.toLowerCase().includes(debouncedQuery.toLowerCase()) ||\n        (item.group_label || '').toLowerCase().includes(debouncedQuery.toLowerCase())\n    );\n\n    // Derive unique groups for autocomplete suggestion (optional)\n    const existingGroups = [...new Set(items.map(i => i.group_label || 'General'))].sort();\n\n    if (permsLoading) {\n        return <div className=\"p-8 text-center text-slate-500\">Checking permissions...</div>;\n    }\n\n    if (!canView && !isSuperAdmin) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-card rounded-xl border border-border p-12 text-center\">\n                <div className=\"p-4 bg-destructive/10 rounded-full mb-4\">\n                    <ShieldAlert className=\"w-12 h-12 text-destructive\" />\n                </div>\n                <h3 className=\"text-xl font-bold text-foreground\">{t('sidebar_manager.access_restricted.title')}</h3>\n                <p className=\"text-muted-foreground mt-2\">{t('sidebar_manager.access_restricted.desc')}</p>\n            </div>\n        );\n    }\n\n    return (\n        <AdminPageLayout requiredPermission=\"platform.sidebar.read\">\n            <Helmet>\n                <title>{t('sidebar_manager.title')} - CMS</title>\n            </Helmet>\n\n            <PageHeader\n                title={t('sidebar_manager.title')}\n                description={t('sidebar_manager.subtitle')}\n                icon={Settings2}\n                breadcrumbs={[{ label: t('sidebar_manager.breadcrumbs'), icon: Settings2 }]}\n                actions={(\n                    <div className=\"flex items-center gap-3\">\n                        <Button variant=\"outline\" onClick={() => fetchMenu()} disabled={loading}>\n                            <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n                            {t('sidebar_manager.refresh')}\n                        </Button>\n                        {hasChanges && (\n                            <Button onClick={handleSaveOrder} disabled={isSaving}>\n                                <Save className=\"w-4 h-4 mr-2\" />\n                                {isSaving ? t('sidebar_manager.saving') : t('sidebar_manager.save_order')}\n                            </Button>\n                        )}\n                    </div>\n                )}\n            />\n\n            <div>\n\n                {/* Main Content */}\n                <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n                    <div className=\"flex justify-between items-center mb-4\">\n                        <TabsList>\n                            <TabsTrigger value=\"items\">{t('sidebar_manager.tabs.items')}</TabsTrigger>\n                            <TabsTrigger value=\"groups\">{t('sidebar_manager.tabs.groups')}</TabsTrigger>\n                        </TabsList>\n                    </div>\n\n                    <TabsContent value=\"items\" className=\"space-y-4\">\n                        <div className=\"bg-card rounded-xl border border-border shadow-sm flex flex-col min-h-[500px]\">\n                            <div className=\"p-4 border-b border-border flex items-center justify-between bg-muted/30\">\n                                <div className=\"w-full max-w-sm\">\n                                    <MinCharSearchInput\n                                        value={query}\n                                        onChange={e => setQuery(e.target.value)}\n                                        onClear={clearSearch}\n                                        loading={loading || searchLoading}\n                                        isValid={isSearchValid}\n                                        message={searchMessage}\n                                        minLength={minLength}\n                                        placeholder={t('sidebar_manager.search_placeholder')}\n                                    />\n                                </div>\n                                <div className=\"text-sm text-muted-foreground\">\n                                    {t('sidebar_manager.items_found', { count: filteredItems.length })}\n                                </div>\n                            </div>\n\n                            <div className=\"flex-1 p-6\">\n                                {loading && items.length === 0 ? (\n                                    <div className=\"flex flex-col items-center justify-center h-64 text-muted-foreground\">\n                                        <RefreshCw className=\"w-8 h-8 animate-spin mb-2\" />\n                                        <p>{t('sidebar_manager.loading_config')}</p>\n                                    </div>\n                                ) : (\n                                    <Reorder.Group axis=\"y\" values={items} onReorder={handleReorder} className=\"space-y-2\">\n                                        <AnimatePresence>\n                                            {filteredItems.map(item => {\n                                                const Icon = getIconComponent(item.icon);\n                                                return (\n                                                    <Reorder.Item\n                                                        key={item.id}\n                                                        value={item}\n                                                        dragListener={canEdit || isSuperAdmin}\n                                                        className={`\n                                                flex items - center gap - 4 p - 3 rounded - lg border\nbg - card shadow - sm transition - all\n                                                ${item.is_visible ? 'border-border' : 'border-border bg-muted/30 opacity-75'}\n                                                ${(canEdit || isSuperAdmin) ? 'hover:shadow-md cursor-grab active:cursor-grabbing hover:border-primary/50' : 'cursor-default'}\n`}\n                                                    >\n                                                        {(canEdit || isSuperAdmin) ? (\n                                                            <div className=\"text-muted-foreground hover:text-foreground p-1\">\n                                                                <GripVertical className=\"w-5 h-5\" />\n                                                            </div>\n                                                        ) : (\n                                                            <div className=\"w-5 h-5\" />\n                                                        )}\n\n                                                        <div className={`p - 2 rounded - md ${item.is_visible ? 'bg-primary/10 text-primary' : 'bg-muted text-muted-foreground'} `}>\n                                                            <Icon className=\"w-5 h-5\" />\n                                                        </div>\n\n                                                        <div className=\"flex-1 min-w-0\">\n                                                            <div className=\"flex items-center gap-2 mb-1\">\n                                                                <span className={`font - medium ${item.is_visible ? 'text-foreground' : 'text-muted-foreground line-through'} truncate`}>\n                                                                    {item.label}\n                                                                </span>\n                                                                <Badge variant=\"outline\" className=\"text-[10px] font-mono text-muted-foreground\">\n                                                                    {item.key}\n                                                                </Badge>\n                                                            </div>\n                                                            <div className=\"flex items-center gap-2 text-xs\">\n                                                                <div className=\"flex items-center gap-1 text-muted-foreground bg-muted px-1.5 py-0.5 rounded\">\n                                                                    <FolderOpen className=\"w-3 h-3\" />\n                                                                    <span className=\"truncate max-w-[100px]\">{item.group_label || 'General'}</span>\n                                                                </div>\n                                                                {item.permission && (\n                                                                    <span className=\"flex items-center text-amber-600 bg-amber-50 px-1.5 py-0.5 rounded border border-amber-100 dark:bg-amber-900/10 dark:text-amber-500 dark:border-amber-900/20\">\n                                                                        <Settings2 className=\"w-3 h-3 mr-1\" />\n                                                                        {item.permission}\n                                                                    </span>\n                                                                )}\n                                                                {item.source === 'extension' && (\n                                                                    <span className=\"flex items-center text-indigo-600 bg-indigo-50 px-1.5 py-0.5 rounded border border-indigo-100 dark:bg-indigo-900/10 dark:text-indigo-400 dark:border-indigo-900/20\">\n                                                                        <Puzzle className=\"w-3 h-3 mr-1\" />\n                                                                        {t('sidebar_manager.module')}\n                                                                    </span>\n                                                                )}\n                                                                {(item.plugin_type === 'core' || item.is_core) && (\n                                                                    <span className=\"flex items-center text-emerald-600 bg-emerald-50 px-1.5 py-0.5 rounded border border-emerald-100 dark:bg-emerald-900/10 dark:text-emerald-400 dark:border-emerald-900/20\">\n                                                                        <Puzzle className=\"w-3 h-3 mr-1\" />\n                                                                        {t('sidebar_manager.core')}\n                                                                    </span>\n                                                                )}\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"flex items-center gap-2\">\n                                                            {(canEdit || isSuperAdmin) && (\n                                                                <Button\n                                                                    variant=\"ghost\"\n                                                                    size=\"sm\"\n                                                                    onClick={() => handleEdit(item)}\n                                                                    disabled={item.source === 'extension'}\n                                                                    className={`text - muted - foreground ${item.source === 'extension' ? 'opacity-50 cursor-not-allowed' : 'hover:text-primary'} `}\n                                                                    title={item.source === 'extension' ? t('sidebar_manager.managed_by_ext') : t('sidebar_manager.edit_item')}\n                                                                >\n                                                                    <Edit2 className=\"w-4 h-4\" />\n                                                                </Button>\n                                                            )}\n\n                                                            <div className=\"flex items-center gap-2 border-l border-border pl-2\">\n                                                                <Label htmlFor={`visible - ${item.id} `} className=\"sr-only\">Visibility</Label>\n                                                                <Switch\n                                                                    id={`visible - ${item.id} `}\n                                                                    checked={item.is_visible}\n                                                                    disabled={!canEdit && !isSuperAdmin}\n                                                                    onCheckedChange={(checked) => handleToggleVisibility({ stopPropagation: () => { } }, item)}\n                                                                />\n                                                                {item.is_visible ? (\n                                                                    <Eye className=\"w-4 h-4 text-muted-foreground\" />\n                                                                ) : (\n                                                                    <EyeOff className=\"w-4 h-4 text-muted-foreground/50\" />\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </Reorder.Item>\n                                                );\n                                            })}\n                                        </AnimatePresence>\n                                    </Reorder.Group>\n                                )}\n                            </div>\n                        </div>\n                    </TabsContent>\n\n                    <TabsContent value=\"groups\" className=\"space-y-4\">\n                        <div className=\"bg-card rounded-xl border border-border shadow-sm flex flex-col min-h-[500px]\">\n                            <div className=\"p-4 border-b border-border flex items-center justify-between bg-muted/30\">\n                                <div>\n                                    <h3 className=\"text-sm font-medium text-foreground\">{t('sidebar_manager.tabs.groups')}</h3>\n                                    <p className=\"text-xs text-muted-foreground\">{t('sidebar_manager.subtitle')}</p>\n                                </div>\n                                {/* Show Save Button specific to Groups tab if changes exist */}\n                                {hasChanges && activeTab === 'groups' && (\n                                    <Button onClick={handleSaveGroupOrder} disabled={isSaving} size=\"sm\">\n                                        <Save className=\"w-4 h-4 mr-2\" />\n                                        {isSaving ? t('sidebar_manager.saving') : t('sidebar_manager.save_group_order')}\n                                    </Button>\n                                )}\n                                {(canEdit || isSuperAdmin) && (\n                                    <Button\n                                        onClick={() => {\n                                            setNewGroupForm({ label: '', order: (groups.length + 1) * 10 });\n                                            setShowNewGroupDialog(true);\n                                        }}\n                                        size=\"sm\"\n                                        variant=\"outline\"\n                                        className=\"border-green-600/30 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/10\"\n                                    >\n                                        <Plus className=\"w-4 h-4 mr-2\" />\n                                        {t('sidebar_manager.add_group')}\n                                    </Button>\n                                )}\n                            </div>\n                            <div className=\"flex-1 p-6\">\n                                <Reorder.Group axis=\"y\" values={groups} onReorder={handleGroupReorder} className=\"space-y-2\">\n                                    <AnimatePresence>\n                                        {groups.map(group => (\n                                            <Reorder.Item\n                                                key={group.id}\n                                                value={group}\n                                                drag={!group.isExtension && (canEdit || isSuperAdmin) ? \"y\" : false}\n                                                className={`flex items-center gap-3 p-3 bg-card border rounded-lg shadow-sm ${group.isExtension ? 'bg-muted/30 border-dashed border-indigo-200 dark:border-indigo-900/30' : 'border-border'} ${(!group.isExtension && (canEdit || isSuperAdmin)) ? 'cursor-grab active:cursor-grabbing hover:border-primary/50' : ''\n                                                    }`}\n                                            >\n                                                {(!group.isExtension && (canEdit || isSuperAdmin)) ? (\n                                                    <div className=\"text-muted-foreground hover:text-foreground p-1\">\n                                                        <GripVertical className=\"w-5 h-5\" />\n                                                    </div>\n                                                ) : (\n                                                    <div className=\"p-1 w-7 flex justify-center\">\n                                                        {group.isExtension && <Puzzle className=\"w-4 h-4 text-indigo-400\" />}\n                                                    </div>\n                                                )}\n\n                                                <div className={`p-2 rounded-md ${group.isExtension ? 'bg-indigo-100/50 text-indigo-600 dark:bg-indigo-900/20 dark:text-indigo-400' : 'bg-muted text-muted-foreground'}`}>\n                                                    <FolderOpen className=\"w-5 h-5\" />\n                                                </div>\n                                                <div className=\"flex-1\">\n                                                    <div className=\"flex items-center gap-2\">\n                                                        <h4 className={`font-medium ${group.isExtension ? 'text-indigo-700 dark:text-indigo-300' : 'text-foreground'}`}>{group.label}</h4>\n                                                        {group.isExtension && <span className=\"text-[10px] bg-indigo-100 text-indigo-700 px-1.5 rounded-full border border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-300 dark:border-indigo-800\">{t('sidebar_manager.module')}</span>}\n                                                        {group.isPlugin && <span className=\"text-[10px] bg-emerald-100 text-emerald-700 px-1.5 rounded-full border border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-300 dark:border-emerald-800\">{t('sidebar_manager.core')}</span>}\n                                                    </div>\n                                                    <p className=\"text-xs text-muted-foreground\">{t('sidebar_manager.order')}: {group.order}</p>\n                                                </div>\n                                                {(canEdit || isSuperAdmin) && (\n                                                    <Button\n                                                        variant=\"ghost\"\n                                                        size=\"sm\"\n                                                        disabled={group.isExtension}\n                                                        onClick={() => handleEditGroup(group)}\n                                                        className=\"text-muted-foreground hover:text-primary disabled:opacity-30 disabled:hover:text-muted-foreground\"\n                                                        title={group.isExtension ? t('sidebar_manager.managed_by_ext') : t('sidebar_manager.edit_group')}\n                                                    >\n                                                        <Edit2 className=\"w-4 h-4\" />\n                                                    </Button>\n                                                )}\n                                            </Reorder.Item>\n                                        ))}\n                                    </AnimatePresence>\n                                </Reorder.Group>\n                            </div>\n                        </div>\n                    </TabsContent>\n                </Tabs >\n\n\n                {/* Edit Dialog */}\n                < Dialog open={!!editingItem\n                } onOpenChange={(open) => !open && setEditingItem(null)}>\n                    <DialogContent>\n                        <DialogHeader>\n                            <DialogTitle>{t('sidebar_manager.edit_item')}</DialogTitle>\n                            <DialogDescription>\n                                {t('sidebar_manager.dialogs.edit_item_desc')}\n                            </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"py-4 space-y-4\">\n                            <div className=\"space-y-2\">\n                                <Label>{t('sidebar_manager.label')}</Label>\n                                <Input\n                                    value={editForm.label}\n                                    onChange={e => setEditForm({ ...editForm, label: e.target.value })}\n                                    placeholder={t('sidebar_manager.label')}\n                                />\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"space-y-2\">\n                                    <Label>{t('sidebar_manager.group_label')}</Label>\n                                    <div className=\"relative\">\n                                        <Input\n                                            list=\"groups-list\"\n                                            value={editForm.group_label}\n                                            onChange={e => setEditForm({ ...editForm, group_label: e.target.value })}\n                                            placeholder=\"General\"\n                                        />\n                                        <datalist id=\"groups-list\">\n                                            {existingGroups.map(g => (\n                                                <option key={g} value={g} />\n                                            ))}\n                                        </datalist>\n                                    </div>\n                                </div>\n                                <div className=\"space-y-2\">\n                                    <Label>{t('sidebar_manager.group_order')}</Label>\n                                    <Input\n                                        type=\"number\"\n                                        value={editForm.group_order}\n                                        onChange={e => setEditForm({ ...editForm, group_order: e.target.value })}\n                                        placeholder=\"0\"\n                                        min=\"0\"\n                                    />\n                                    <p className=\"text-[10px] text-slate-500\">{t('sidebar_manager.dialogs.group_order_helper')}</p>\n                                </div>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label>{t('sidebar_manager.key')}</Label>\n                                <Input value={editingItem?.key || ''} disabled className=\"bg-muted\" />\n                            </div>\n                        </div>\n                        <DialogFooter>\n                            <Button variant=\"outline\" onClick={() => setEditingItem(null)}>{t('sidebar_manager.cancel')}</Button>\n                            <Button onClick={saveEdit}>{t('sidebar_manager.save_changes')}</Button>\n                        </DialogFooter>\n                    </DialogContent>\n                </Dialog >\n\n                {/* Group Edit Dialog */}\n                < Dialog open={!!editingGroup} onOpenChange={(open) => !open && setEditingGroup(null)}>\n                    <DialogContent>\n                        <DialogHeader>\n                            <DialogTitle>{t('sidebar_manager.edit_group')}</DialogTitle>\n                            <DialogDescription>\n                                {t('sidebar_manager.dialogs.edit_group_desc')}\n                            </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"py-4 space-y-4\">\n                            <div className=\"space-y-2\">\n                                <Label>{t('sidebar_manager.group_label')}</Label>\n                                <Input\n                                    value={groupEditForm.label}\n                                    onChange={e => setGroupEditForm({ ...groupEditForm, label: e.target.value })}\n                                    placeholder={t('sidebar_manager.group_name')}\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>Order</Label>\n                                <Input\n                                    type=\"number\"\n                                    value={groupEditForm.order}\n                                    onChange={e => setGroupEditForm({ ...groupEditForm, order: e.target.value })}\n                                    placeholder=\"0\"\n                                />\n                            </div>\n                        </div>\n                        <DialogFooter>\n                            <Button variant=\"outline\" onClick={() => setEditingGroup(null)}>{t('sidebar_manager.cancel')}</Button>\n                            <Button onClick={saveGroupEdit}>{t('sidebar_manager.save_group')}</Button>\n                        </DialogFooter>\n                    </DialogContent>\n                </Dialog >\n\n                {/* New Group Dialog */}\n                < Dialog open={showNewGroupDialog} onOpenChange={(open) => !open && setShowNewGroupDialog(false)}>\n                    <DialogContent>\n                        <DialogHeader>\n                            <DialogTitle>{t('sidebar_manager.create_group')}</DialogTitle>\n                            <DialogDescription>\n                                {t('sidebar_manager.dialogs.create_group_desc')}\n                            </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"py-4 space-y-4\">\n                            <div className=\"space-y-2\">\n                                <Label>{t('sidebar_manager.group_name')}</Label>\n                                <Input\n                                    value={newGroupForm.label}\n                                    onChange={e => setNewGroupForm({ ...newGroupForm, label: e.target.value })}\n                                    placeholder=\"e.g., MARKETING\"\n                                />\n                                <p className=\"text-[10px] text-slate-500\">{t('sidebar_manager.dialogs.create_group_helper')}</p>\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>Order</Label>\n                                <Input\n                                    type=\"number\"\n                                    value={newGroupForm.order}\n                                    onChange={e => setNewGroupForm({ ...newGroupForm, order: e.target.value })}\n                                    placeholder=\"10\"\n                                    min=\"1\"\n                                />\n                                <p className=\"text-[10px] text-muted-foreground\">{t('sidebar_manager.dialogs.create_group_order_helper')}</p>\n                            </div>\n                        </div>\n                        <DialogFooter>\n                            <Button variant=\"outline\" onClick={() => setShowNewGroupDialog(false)}>{t('sidebar_manager.cancel')}</Button>\n                            <Button\n                                onClick={handleCreateGroup}\n                                disabled={!newGroupForm.label.trim()}\n                                className=\"bg-green-600 hover:bg-green-700\"\n                            >\n                                {t('sidebar_manager.create')}\n                            </Button>\n                        </DialogFooter>\n                    </DialogContent>\n                </Dialog >\n            </div >\n        </AdminPageLayout >\n    );\n}\n\nexport default SidebarMenuManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/SiteImagesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useToast } from '@/components/ui/use-toast';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport ImageUpload from '@/components/ui/ImageUpload';\nimport LocalizedInput from '@/components/ui/LocalizedInput';\nimport {\n    Image as ImageIcon,\n    Save,\n    RefreshCw,\n    Loader2,\n    Plus,\n    Trash2,\n    GripVertical,\n    ChevronDown,\n    ChevronUp\n} from 'lucide-react';\n\nconst SETTINGS_KEY = 'site_images';\n\nfunction SiteImagesManager() {\n    const { currentTenant } = useTenant();\n    const { toast } = useToast();\n    const [activeTab, setActiveTab] = useState('hero');\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    const [data, setData] = useState({});\n    const [hasChanges, setHasChanges] = useState(false);\n\n    const tenantId = currentTenant?.id;\n\n    const loadData = useCallback(async () => {\n        if (!tenantId) return;\n        setLoading(true);\n        try {\n            const { data: settings, error } = await supabase\n                .from('settings')\n                .select('value')\n                .eq('tenant_id', tenantId)\n                .eq('key', SETTINGS_KEY)\n                .single();\n\n            if (error && error.code !== 'PGRST116') throw error;\n\n            const parsed = settings?.value\n                ? (typeof settings.value === 'string' ? JSON.parse(settings.value) : settings.value)\n                : {};\n            setData(parsed);\n        } catch (err) {\n            console.error('Error loading site images:', err);\n            toast({ title: 'Error', description: 'Failed to load data', variant: 'destructive' });\n        } finally {\n            setLoading(false);\n        }\n    }, [tenantId, toast]);\n\n    useEffect(() => {\n        loadData();\n    }, [loadData]);\n\n    const handleSave = async () => {\n        if (!tenantId) return;\n        setSaving(true);\n        try {\n            const { error } = await supabase\n                .from('settings')\n                .upsert({\n                    tenant_id: tenantId,\n                    key: SETTINGS_KEY,\n                    value: JSON.stringify(data),\n                    type: 'json'\n                }, { onConflict: 'tenant_id,key' });\n\n            if (error) throw error;\n\n            toast({ title: 'Saved', description: 'Site images saved successfully' });\n            setHasChanges(false);\n        } catch (err) {\n            console.error('Error saving:', err);\n            toast({ title: 'Error', description: 'Failed to save data', variant: 'destructive' });\n        } finally {\n            setSaving(false);\n        }\n    };\n\n    const updateSection = (section, value) => {\n        setData(prev => ({\n            ...prev,\n            [section]: value\n        }));\n        setHasChanges(true);\n    };\n\n    const tabs = [\n        { id: 'hero', label: 'Hero Images' },\n        { id: 'sections', label: 'Section Images' },\n        { id: 'gallery', label: 'Gallery Collections' }\n    ];\n\n    if (loading) {\n        return (\n            <AdminPageLayout requiredPermission={['tenant.school_pages.read', 'platform.school_pages.read']}>\n                <PageHeader\n                    title=\"Site Images\"\n                    description=\"Manage hero images, section images, and gallery collections\"\n                    icon={ImageIcon}\n                    breadcrumbs={[{ label: 'Site Images', icon: ImageIcon }]}\n                />\n                <div className=\"space-y-4 p-6\">\n                    <Skeleton className=\"h-10 w-full\" />\n                    <Skeleton className=\"h-64 w-full\" />\n                </div>\n            </AdminPageLayout>\n        );\n    }\n\n    return (\n        <AdminPageLayout requiredPermission={['tenant.school_pages.read', 'platform.school_pages.read']}>\n            <PageHeader\n                title=\"Site Images\"\n                description=\"Manage hero images, section images, and gallery collections\"\n                icon={ImageIcon}\n                breadcrumbs={[{ label: 'Site Images', icon: ImageIcon }]}\n                actions={[\n                    <Button\n                        key=\"refresh\"\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={loadData}\n                        disabled={loading}\n                    >\n                        <RefreshCw className=\"h-4 w-4 mr-2\" />\n                        Refresh\n                    </Button>,\n                    <Button\n                        key=\"save\"\n                        size=\"sm\"\n                        onClick={handleSave}\n                        disabled={saving || !hasChanges}\n                    >\n                        {saving ? (\n                            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        ) : (\n                            <Save className=\"h-4 w-4 mr-2\" />\n                        )}\n                        Save Changes\n                    </Button>\n                ]}\n            />\n\n            <div className=\"p-6\">\n                <Tabs value={activeTab} onValueChange={setActiveTab}>\n                    <TabsList className=\"grid grid-cols-3 w-[400px]\">\n                        {tabs.map((tab) => (\n                            <TabsTrigger key={tab.id} value={tab.id}>\n                                {tab.label}\n                            </TabsTrigger>\n                        ))}\n                    </TabsList>\n\n                    <TabsContent value=\"hero\" className=\"mt-6\">\n                        <HeroImagesEditor\n                            data={data.hero || {}}\n                            onChange={(v) => updateSection('hero', v)}\n                        />\n                    </TabsContent>\n\n                    <TabsContent value=\"sections\" className=\"mt-6\">\n                        <SectionImagesEditor\n                            data={data.sections || {}}\n                            onChange={(v) => updateSection('sections', v)}\n                        />\n                    </TabsContent>\n\n                    <TabsContent value=\"gallery\" className=\"mt-6\">\n                        <GalleryCollectionsEditor\n                            data={data.collections || []}\n                            onChange={(v) => updateSection('collections', v)}\n                        />\n                    </TabsContent>\n                </Tabs>\n            </div>\n        </AdminPageLayout>\n    );\n}\n\n// ============ SUB-EDITORS ============\n\nfunction HeroImagesEditor({ data = {}, onChange }) {\n    const updateField = (field, value) => {\n        onChange({ ...data, [field]: value });\n    };\n\n    return (\n        <div className=\"grid gap-6\">\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg\">Homepage Hero</CardTitle>\n                    <CardDescription>Main hero image for the homepage</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <ImageUpload\n                        label=\"Hero Image\"\n                        value={data.main}\n                        onChange={(v) => updateField('main', v)}\n                    />\n                    <LocalizedInput\n                        label=\"Hero Title\"\n                        value={data.mainTitle}\n                        onChange={(v) => updateField('mainTitle', v)}\n                    />\n                    <LocalizedInput\n                        label=\"Hero Subtitle\"\n                        type=\"textarea\"\n                        value={data.mainSubtitle}\n                        onChange={(v) => updateField('mainSubtitle', v)}\n                    />\n                </CardContent>\n            </Card>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg\">About Page Hero</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <ImageUpload\n                        label=\"About Hero Image\"\n                        value={data.about}\n                        onChange={(v) => updateField('about', v)}\n                    />\n                </CardContent>\n            </Card>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg\">Contact Page Hero</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <ImageUpload\n                        label=\"Contact Hero Image\"\n                        value={data.contact}\n                        onChange={(v) => updateField('contact', v)}\n                    />\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n\nfunction SectionImagesEditor({ data = {}, onChange }) {\n    const sections = [\n        { key: 'classroom', label: 'Classroom', description: 'KBM / Teaching activities' },\n        { key: 'laboratory', label: 'Laboratory', description: 'Science labs' },\n        { key: 'library', label: 'Library', description: 'Library and reading areas' },\n        { key: 'sports', label: 'Sports', description: 'Sports facilities and activities' },\n        { key: 'extracurricular', label: 'Extracurricular', description: 'Clubs and activities' },\n        { key: 'ceremony', label: 'Ceremony', description: 'Flag ceremonies and events' },\n        { key: 'graduation', label: 'Graduation', description: 'Graduation ceremonies' }\n    ];\n\n    const updateField = (field, value) => {\n        onChange({ ...data, [field]: value });\n    };\n\n    return (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n            {sections.map((section) => (\n                <Card key={section.key}>\n                    <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-base\">{section.label}</CardTitle>\n                        <CardDescription className=\"text-xs\">{section.description}</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                        <ImageUpload\n                            value={data[section.key]}\n                            onChange={(v) => updateField(section.key, v)}\n                            compact\n                        />\n                    </CardContent>\n                </Card>\n            ))}\n        </div>\n    );\n}\n\nfunction GalleryCollectionsEditor({ data = [], onChange }) {\n    const [expandedIndex, setExpandedIndex] = useState(null);\n\n    const addCollection = () => {\n        onChange([...data, {\n            id: `collection-${Date.now()}`,\n            name: { id: '', en: '' },\n            description: { id: '', en: '' },\n            category: '',\n            images: []\n        }]);\n    };\n\n    const updateCollection = (index, field, value) => {\n        const updated = data.map((item, i) =>\n            i === index ? { ...item, [field]: value } : item\n        );\n        onChange(updated);\n    };\n\n    const removeCollection = (index) => {\n        onChange(data.filter((_, i) => i !== index));\n        if (expandedIndex === index) setExpandedIndex(null);\n    };\n\n    const addImageToCollection = (index, imageUrl) => {\n        const collection = data[index];\n        const updatedImages = [...(collection.images || []), imageUrl];\n        updateCollection(index, 'images', updatedImages);\n    };\n\n    const removeImageFromCollection = (collectionIndex, imageIndex) => {\n        const collection = data[collectionIndex];\n        const updatedImages = collection.images.filter((_, i) => i !== imageIndex);\n        updateCollection(collectionIndex, 'images', updatedImages);\n    };\n\n    return (\n        <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h3 className=\"text-lg font-medium\">Gallery Collections</h3>\n                    <p className=\"text-sm text-muted-foreground\">Organize images into themed collections</p>\n                </div>\n                <Button onClick={addCollection} variant=\"outline\" size=\"sm\">\n                    <Plus className=\"h-4 w-4 mr-1\" /> Add Collection\n                </Button>\n            </div>\n\n            {data.length === 0 ? (\n                <Card className=\"border-dashed\">\n                    <CardContent className=\"py-8 text-center text-muted-foreground\">\n                        No collections created yet. Click &quot;Add Collection&quot; to create one.\n                    </CardContent>\n                </Card>\n            ) : (\n                <div className=\"space-y-3\">\n                    {data.map((collection, index) => (\n                        <Card key={collection.id || index}>\n                            <div\n                                className=\"flex items-center gap-3 p-4 cursor-pointer hover:bg-muted/50\"\n                                onClick={() => setExpandedIndex(expandedIndex === index ? null : index)}\n                            >\n                                <GripVertical className=\"h-4 w-4 text-muted-foreground\" />\n                                <div className=\"flex-1\">\n                                    <div className=\"font-medium\">\n                                        {collection.name?.id || collection.name?.en || `Collection ${index + 1}`}\n                                    </div>\n                                    <div className=\"text-sm text-muted-foreground\">\n                                        {collection.images?.length || 0} images  {collection.category || 'No category'}\n                                    </div>\n                                </div>\n                                <div className=\"flex items-center gap-1\">\n                                    {expandedIndex === index ? (\n                                        <ChevronUp className=\"h-4 w-4\" />\n                                    ) : (\n                                        <ChevronDown className=\"h-4 w-4\" />\n                                    )}\n                                    <Button\n                                        variant=\"ghost\"\n                                        size=\"icon\"\n                                        className=\"h-8 w-8 text-destructive\"\n                                        onClick={(e) => { e.stopPropagation(); removeCollection(index); }}\n                                    >\n                                        <Trash2 className=\"h-4 w-4\" />\n                                    </Button>\n                                </div>\n                            </div>\n\n                            {expandedIndex === index && (\n                                <CardContent className=\"border-t pt-4 space-y-4\">\n                                    <LocalizedInput\n                                        label=\"Collection Name\"\n                                        value={collection.name}\n                                        onChange={(v) => updateCollection(index, 'name', v)}\n                                    />\n                                    <LocalizedInput\n                                        label=\"Description\"\n                                        type=\"textarea\"\n                                        value={collection.description}\n                                        onChange={(v) => updateCollection(index, 'description', v)}\n                                    />\n                                    <div>\n                                        <Label>Category</Label>\n                                        <Input\n                                            value={collection.category || ''}\n                                            onChange={(e) => updateCollection(index, 'category', e.target.value)}\n                                            placeholder=\"e.g., KBM, Ekskul, Upacara\"\n                                        />\n                                    </div>\n\n                                    <div className=\"space-y-2\">\n                                        <div className=\"flex items-center justify-between\">\n                                            <Label>Images ({collection.images?.length || 0})</Label>\n                                            <ImageUpload\n                                                buttonOnly\n                                                onUpload={(url) => addImageToCollection(index, url)}\n                                            />\n                                        </div>\n                                        {collection.images?.length > 0 && (\n                                            <div className=\"grid grid-cols-4 gap-2\">\n                                                {collection.images.map((img, imgIndex) => (\n                                                    <div key={imgIndex} className=\"relative group\">\n                                                        <img\n                                                            src={img}\n                                                            alt=\"\"\n                                                            className=\"w-full h-20 object-cover rounded border\"\n                                                        />\n                                                        <Button\n                                                            variant=\"destructive\"\n                                                            size=\"icon\"\n                                                            className=\"absolute top-1 right-1 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity\"\n                                                            onClick={() => removeImageFromCollection(index, imgIndex)}\n                                                        >\n                                                            <Trash2 className=\"h-3 w-3\" />\n                                                        </Button>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        )}\n                                    </div>\n                                </CardContent>\n                            )}\n                        </Card>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n}\n\nexport default SiteImagesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/TagsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { Tag, Trash2, Filter, RefreshCw, Edit, Plus, RotateCcw, CheckCircle, AlertCircle, SortAsc, SortDesc } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport MinCharSearchInput from '@/components/common/MinCharSearchInput';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useSearch } from '@/hooks/useSearch';\nimport { Pagination } from '@/components/ui/pagination';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Label } from '@/components/ui/label';\n\nconst MODULES = [\n    { value: 'all', label: 'All Modules' },\n    { value: 'blogs', label: 'Blogs' },\n    { value: 'pages', label: 'Pages' },\n    { value: 'products', label: 'Products' },\n    { value: 'portfolio', label: 'Portfolio' },\n    { value: 'announcements', label: 'Announcements' },\n    { value: 'promotions', label: 'Promotions' },\n    { value: 'testimonies', label: 'Testimonials' },\n    { value: 'photo_gallery', label: 'Photo Gallery' },\n    { value: 'video_gallery', label: 'Video Gallery' },\n    { value: 'contacts', label: 'Contacts' },\n    { value: 'contact_messages', label: 'Messages' },\n    { value: 'product_types', label: 'Product Types' },\n];\n\nfunction TagsManager() {\n    const { toast } = useToast();\n    const { hasPermission, isPlatformAdmin } = usePermissions();\n    const { currentTenant } = useTenant();\n\n    // Search\n    const {\n        query,\n        setQuery,\n        debouncedQuery,\n        isValid: isSearchValid,\n        message: searchMessage,\n        loading: searchLoading,\n        minLength,\n        clearSearch\n    } = useSearch({ context: 'admin' });\n\n    // Data State\n    const [rawTags, setRawTags] = useState([]);\n    const [displayedTags, setDisplayedTags] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    // Filters State\n    const [moduleFilter, setModuleFilter] = useState('all');\n    const [activeFilter, setActiveFilter] = useState('all');\n    const [showTrash, setShowTrash] = useState(false);\n\n    // Sort State\n    const [sortConfig, setSortConfig] = useState({ key: 'total_usage', direction: 'desc' });\n\n    // Pagination State\n    const [currentPage, setCurrentPage] = useState(1);\n    const [itemsPerPage, setItemsPerPage] = useState(10);\n\n    // Edit/Create State\n    const [dialogOpen, setDialogOpen] = useState(false);\n    const [editingTag, setEditingTag] = useState(null);\n    const [formData, setFormData] = useState({\n        name: '',\n        slug: '',\n        color: '#3b82f6',\n        description: '',\n        icon: '',\n        is_active: true\n    });\n    const [saving, setSaving] = useState(false);\n\n    // Permissions (using tenant.tag.* pattern)\n    const canCreate = hasPermission('tenant.tag.create');\n    const canEdit = hasPermission('tenant.tag.update');\n    const canSoftDelete = hasPermission('tenant.tag.delete');\n    const canRestore = hasPermission('tenant.tag.restore') || hasPermission('tenant.tag.delete');\n\n    const fetchTags = useCallback(async () => {\n        setLoading(true);\n        try {\n            let data = [];\n\n            if (showTrash) {\n                let trashQuery = supabase\n                    .from('tags')\n                    .select('*, tenant:tenants(name)')\n                    .not('deleted_at', 'is', null);\n\n                // Apply tenant filter for non-platform admins\n                if (currentTenant?.id && !isPlatformAdmin) {\n                    trashQuery = trashQuery.eq('tenant_id', currentTenant.id);\n                }\n\n                const { data: trashData, error } = await trashQuery;\n\n                if (error) throw error;\n\n                data = trashData.map(t => ({\n                    id: t.id,\n                    tag_id: t.id,\n                    tag_name: t.name,\n                    tag_slug: t.slug,\n                    tag_color: t.color,\n                    tag_icon: t.icon,\n                    tag_description: t.description,\n                    tag_is_active: t.is_active,\n                    tag_created_at: t.created_at,\n                    tag_updated_at: t.updated_at,\n                    tenant_name: t.tenant?.name,\n                    module: 'trash', // dummy\n                    count: 0\n                }));\n\n            } else {\n                // Regular View\n                let tagsQuery = supabase\n                    .from('tags')\n                    .select('*, tenant:tenants(name)')\n                    .is('deleted_at', null);\n\n                // Apply tenant filter for non-platform admins\n                if (currentTenant?.id && !isPlatformAdmin) {\n                    tagsQuery = tagsQuery.eq('tenant_id', currentTenant.id);\n                }\n\n                const { data: allTags, error: tagsError } = await tagsQuery;\n\n                if (tagsError) throw tagsError;\n\n                // Then get usage stats\n                const { data: usageData, error: usageError } = await supabase.rpc('get_detailed_tag_usage');\n                if (usageError) throw usageError;\n\n                // Merge: Create a base list from allTags\n                const mergedMap = new Map();\n\n                allTags.forEach(t => {\n                    mergedMap.set(t.id, {\n                        ...t,\n                        tag_id: t.id,\n                        tag_name: t.name,\n                        tag_slug: t.slug,\n                        tag_color: t.color,\n                        tag_icon: t.icon,\n                        tag_description: t.description,\n                        tag_is_active: t.is_active,\n                        tag_created_at: t.created_at,\n                        tag_updated_at: t.updated_at,\n                        tenant_name: t.tenant?.name,\n                        count: 0,\n                        modules: new Set(),\n                        breakdown: {}\n                    });\n                });\n\n                if (usageData) {\n                    usageData.forEach(u => {\n                        if (mergedMap.has(u.tag_id)) {\n                            const tag = mergedMap.get(u.tag_id);\n                            tag.count += parseInt(u.count);\n                            tag.modules.add(u.module);\n                            tag.breakdown[u.module] = (tag.breakdown[u.module] || 0) + parseInt(u.count);\n                        }\n                    });\n                }\n\n                data = Array.from(mergedMap.values()).map(t => ({\n                    ...t,\n                    modules: Array.from(t.modules)\n                }));\n            }\n\n            setRawTags(data);\n\n        } catch (error) {\n            console.error(error);\n            toast({\n                variant: \"destructive\",\n                title: \"Error fetching tags\",\n                description: error.message\n            });\n        } finally {\n            setLoading(false);\n        }\n    }, [showTrash, toast, currentTenant?.id, isPlatformAdmin]);\n\n    useEffect(() => {\n        fetchTags();\n    }, [fetchTags]);\n\n    useEffect(() => {\n        let filtered = [...rawTags];\n\n        if (debouncedQuery) {\n            const lower = debouncedQuery.toLowerCase();\n            filtered = filtered.filter(t =>\n                t.tag_name?.toLowerCase().includes(lower) ||\n                t.tag_slug?.toLowerCase().includes(lower) ||\n                t.tag_description?.toLowerCase().includes(lower)\n            );\n        }\n\n        if (!showTrash && moduleFilter !== 'all') {\n            filtered = filtered.filter(t => t.modules && t.modules.includes(moduleFilter));\n        }\n\n        if (activeFilter !== 'all') {\n            const isActive = activeFilter === 'active';\n            filtered = filtered.filter(t => t.tag_is_active === isActive);\n        }\n\n        filtered.sort((a, b) => {\n            let valA = a[sortConfig.key];\n            let valB = b[sortConfig.key];\n\n            if (sortConfig.key === 'total_usage') {\n                valA = a.count || 0;\n                valB = b.count || 0;\n            } else if (sortConfig.key === 'name') {\n                valA = a.tag_name?.toLowerCase();\n                valB = b.tag_name?.toLowerCase();\n            } else if (sortConfig.key === 'created_at') {\n                valA = new Date(a.tag_created_at);\n                valB = new Date(b.tag_created_at);\n            } else if (sortConfig.key === 'updated_at') {\n                valA = new Date(a.tag_updated_at);\n                valB = new Date(b.tag_updated_at);\n            }\n\n            if (valA < valB) return sortConfig.direction === 'asc' ? -1 : 1;\n            if (valA > valB) return sortConfig.direction === 'asc' ? 1 : -1;\n            return 0;\n        });\n\n        setDisplayedTags(filtered);\n    }, [rawTags, debouncedQuery, moduleFilter, activeFilter, sortConfig, showTrash]);\n\n    const handleSort = (key) => {\n        setSortConfig(current => ({\n            key,\n            direction: current.key === key && current.direction === 'asc' ? 'desc' : 'asc'\n        }));\n    };\n\n    const handleDelete = async (id) => {\n        if (!canSoftDelete) {\n            toast({ variant: \"destructive\", title: \"Action Denied\", description: \"You do not have permission to delete tags.\" });\n            return;\n        }\n\n        const message = 'Are you sure? This tag will be moved to trash.';\n\n        if (!window.confirm(message)) return;\n\n        try {\n            const { error } = await supabase\n                .from('tags')\n                .update({ deleted_at: new Date().toISOString() })\n                .eq('id', id);\n            if (error) throw error;\n\n            toast({ title: \"Success\", description: \"Tag moved to trash.\" });\n            fetchTags();\n        } catch (error) {\n            toast({ variant: \"destructive\", title: \"Error deleting tag\", description: error.message });\n        }\n    };\n\n    const handleRestore = async (id) => {\n        if (!canRestore) {\n            toast({ variant: \"destructive\", title: \"Action Denied\", description: \"You do not have permission to restore tags.\" });\n            return;\n        }\n        try {\n            const { error } = await supabase\n                .from('tags')\n                .update({ deleted_at: null })\n                .eq('id', id);\n\n            if (error) throw error;\n            toast({ title: \"Success\", description: \"Tag restored.\" });\n            fetchTags();\n        } catch (error) {\n            toast({ variant: \"destructive\", title: \"Error restoring tag\", description: error.message });\n        }\n    };\n\n    const openModal = (tag = null) => {\n        if (tag) {\n            setEditingTag(tag);\n            setFormData({\n                name: tag.tag_name,\n                slug: tag.tag_slug,\n                color: tag.tag_color || '#3b82f6',\n                description: tag.tag_description || '',\n                icon: tag.tag_icon || '',\n                is_active: tag.tag_is_active\n            });\n        } else {\n            setEditingTag(null);\n            setFormData({\n                name: '',\n                slug: '',\n                color: '#3b82f6',\n                description: '',\n                icon: '',\n                is_active: true\n            });\n        }\n        setDialogOpen(true);\n    };\n\n    const handleSave = async () => {\n        if (editingTag && !canEdit) {\n            toast({ variant: \"destructive\", title: \"Action Denied\", description: \"You do not have permission to edit tags.\" });\n            return;\n        }\n        if (!editingTag && !canCreate) {\n            toast({ variant: \"destructive\", title: \"Action Denied\", description: \"You do not have permission to create tags.\" });\n            return;\n        }\n\n        if (!formData.name) {\n            toast({ variant: \"destructive\", title: \"Validation Error\", description: \"Name is required\" });\n            return;\n        }\n\n        setSaving(true);\n        try {\n            const payload = {\n                name: formData.name,\n                slug: formData.slug || formData.name.toLowerCase().replace(/[^a-z0-9]+/g, '-'),\n                color: formData.color,\n                description: formData.description,\n                icon: formData.icon,\n                is_active: formData.is_active,\n                updated_at: new Date().toISOString()\n            };\n\n            if (editingTag) {\n                const { error } = await supabase\n                    .from('tags')\n                    .update(payload)\n                    .eq('id', editingTag.tag_id);\n                if (error) throw error;\n                toast({ title: \"Success\", description: \"Tag updated successfully\" });\n            } else {\n                // Always use current tenant context for new tags\n                const insertPayload = {\n                    ...payload,\n                    tenant_id: currentTenant?.id\n                };\n                const { error } = await supabase\n                    .from('tags')\n                    .insert([insertPayload]);\n                if (error) throw error;\n                toast({ title: \"Success\", description: \"New tag created successfully\" });\n            }\n\n            setDialogOpen(false);\n            fetchTags();\n        } catch (error) {\n            console.error(error);\n            toast({ variant: \"destructive\", title: \"Error saving tag\", description: error.message });\n        } finally {\n            setSaving(false);\n        }\n    };\n\n    // Pagination Logic\n    const totalPages = Math.ceil(displayedTags.length / itemsPerPage);\n    const currentData = displayedTags.slice(\n        (currentPage - 1) * itemsPerPage,\n        currentPage * itemsPerPage\n    );\n\n    // Breadcrumbs for PageHeader\n    const breadcrumbs = [\n        { label: 'Tags', icon: Tag },\n        ...(showTrash ? [{ label: 'Trash', icon: Trash2 }] : []),\n    ];\n\n    // Header actions for PageHeader\n    const headerActions = (\n        <div className=\"flex flex-wrap gap-3\">\n            {(canSoftDelete || showTrash) && (\n                <Button\n                    variant={showTrash ? \"destructive\" : \"outline\"}\n                    onClick={() => { setShowTrash(!showTrash); setCurrentPage(1); }}\n                    className={showTrash ? \"bg-destructive hover:bg-destructive/90 text-destructive-foreground\" : \"text-muted-foreground hover:text-foreground\"}\n                >\n                    {showTrash ? \"View Active Tags\" : \"Trash / Deleted\"}\n                    <Trash2 className=\"w-4 h-4 ml-2\" />\n                </Button>\n            )}\n\n            {!showTrash && canCreate && (\n                <Button onClick={() => openModal(null)} className=\"bg-primary text-primary-foreground hover:bg-primary/90\">\n                    <Plus className=\"w-4 h-4 mr-2\" /> Create Tag\n                </Button>\n            )}\n        </div>\n    );\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.tag.read\">\n            <PageHeader\n                title={showTrash ? 'Tags - Trash' : 'Tags Manager'}\n                description=\"Manage content tags, colors, and view usage statistics across the system.\"\n                icon={Tag}\n                breadcrumbs={breadcrumbs}\n                actions={headerActions}\n            />\n\n            <div className=\"flex flex-col lg:flex-row gap-4 bg-card p-4 rounded-xl border border-border shadow-sm\">\n                <div className=\"flex-1 max-w-sm\">\n                    <MinCharSearchInput\n                        value={query}\n                        onChange={e => { setQuery(e.target.value); setCurrentPage(1); }}\n                        onClear={() => { clearSearch(); setCurrentPage(1); }}\n                        loading={loading || searchLoading}\n                        isValid={isSearchValid}\n                        message={searchMessage}\n                        minLength={minLength}\n                        placeholder=\"Search tags... (5+ chars)\"\n                    />\n                </div>\n\n                {!showTrash && (\n                    <div className=\"flex flex-col sm:flex-row gap-3\">\n                        <div className=\"relative w-full sm:w-48\">\n                            <Filter className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\n                            <select\n                                value={moduleFilter}\n                                onChange={(e) => { setModuleFilter(e.target.value); setCurrentPage(1); }}\n                                className=\"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm pl-9 appearance-none focus:ring-2 focus:ring-ring dark:bg-slate-950 dark:text-slate-200 dark:border-slate-800\"\n                            >\n                                {MODULES.map(m => (\n                                    <option key={m.value} value={m.value}>{m.label}</option>\n                                ))}\n                            </select>\n                        </div>\n                        <div className=\"relative w-full sm:w-40\">\n                            <CheckCircle className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\n                            <select\n                                value={activeFilter}\n                                onChange={(e) => { setActiveFilter(e.target.value); setCurrentPage(1); }}\n                                className=\"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm pl-9 appearance-none focus:ring-2 focus:ring-ring dark:bg-slate-950 dark:text-slate-200 dark:border-slate-800\"\n                            >\n                                <option value=\"all\">All Status</option>\n                                <option value=\"active\">Active</option>\n                                <option value=\"inactive\">Inactive</option>\n                            </select>\n                        </div>\n                    </div>\n                )}\n\n                <Button variant=\"ghost\" size=\"icon\" onClick={fetchTags} title=\"Refresh Data\" className=\"text-muted-foreground hover:text-foreground\">\n                    <RefreshCw className=\"w-4 h-4\" />\n                </Button>\n            </div>\n\n            <div className=\"bg-card rounded-xl shadow-sm border border-border overflow-hidden\">\n                <div className=\"overflow-x-auto\">\n                    <table className=\"w-full\">\n                        <thead className=\"bg-muted/50 border-b border-border\">\n                            <tr>\n                                {isPlatformAdmin && <th className=\"px-6 py-4 text-left text-xs font-bold text-muted-foreground uppercase\">Nama Tenant</th>}\n                                <th\n                                    className=\"px-6 py-4 text-left text-xs font-bold text-muted-foreground uppercase cursor-pointer hover:text-foreground group\"\n                                    onClick={() => handleSort('name')}\n                                >\n                                    <div className=\"flex items-center gap-1\">\n                                        Tag Details\n                                        {sortConfig.key === 'name' && (sortConfig.direction === 'asc' ? <SortAsc className=\"w-3 h-3\" /> : <SortDesc className=\"w-3 h-3\" />)}\n                                    </div>\n                                </th>\n                                <th className=\"px-6 py-4 text-left text-xs font-bold text-muted-foreground uppercase\">Color</th>\n                                {!showTrash && <th className=\"px-6 py-4 text-left text-xs font-bold text-muted-foreground uppercase\">Usage Breakdown</th>}\n                                <th\n                                    className=\"px-6 py-4 text-center text-xs font-bold text-muted-foreground uppercase cursor-pointer hover:text-foreground\"\n                                    onClick={() => handleSort('total_usage')}\n                                >\n                                    <div className=\"flex items-center justify-center gap-1\">\n                                        Total Usage\n                                        {sortConfig.key === 'total_usage' && (sortConfig.direction === 'asc' ? <SortAsc className=\"w-3 h-3\" /> : <SortDesc className=\"w-3 h-3\" />)}\n                                    </div>\n                                </th>\n                                <th className=\"px-6 py-4 text-center text-xs font-bold text-muted-foreground uppercase\">Status</th>\n                                <th className=\"px-6 py-4 text-right text-xs font-bold text-muted-foreground uppercase\">Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-border\">\n                            {loading ? (\n                                <tr><td colSpan=\"6\" className=\"p-12 text-center text-slate-500\">\n                                    <div className=\"flex flex-col items-center gap-2\">\n                                        <RefreshCw className=\"w-6 h-6 animate-spin text-blue-500\" />\n                                        <span>Loading tags...</span>\n                                    </div>\n                                </td></tr>\n                            ) : currentData.length === 0 ? (\n                                <tr><td colSpan=\"6\" className=\"p-12 text-center text-slate-500\">\n                                    <div className=\"flex flex-col items-center gap-2\">\n                                        <AlertCircle className=\"w-8 h-8 text-slate-300\" />\n                                        <span>No tags found matching your criteria.</span>\n                                    </div>\n                                </td></tr>\n                            ) : (\n                                currentData.map((tag) => (\n                                    <motion.tr\n                                        key={tag.tag_id}\n                                        initial={{ opacity: 0 }}\n                                        animate={{ opacity: 1 }}\n                                        className=\"hover:bg-muted/50 transition-colors\"\n                                    >\n                                        {isPlatformAdmin && (\n                                            <td className=\"px-6 py-4\">\n                                                <span className=\"text-xs font-medium text-slate-600 bg-slate-100 px-2 py-0.5 rounded\">\n                                                    {tag.tenant_name || '(Unknown Tenant)'}\n                                                </span>\n                                            </td>\n                                        )}\n                                        <td className=\"px-6 py-4\">\n                                            <div className=\"flex flex-col\">\n                                                <div className=\"flex items-center gap-2\">\n                                                    <Tag className=\"w-4 h-4 text-muted-foreground\" />\n                                                    <span className=\"font-medium text-foreground\">{tag.tag_name}</span>\n                                                </div>\n                                                <span className=\"text-xs text-muted-foreground pl-6\">{tag.tag_slug}</span>\n                                                {tag.tag_description && <span className=\"text-xs text-muted-foreground pl-6 mt-1 truncate max-w-[200px]\">{tag.tag_description}</span>}\n                                            </div>\n                                        </td>\n                                        <td className=\"px-6 py-4\">\n                                            <div className=\"flex items-center gap-2 group relative\">\n                                                <div className=\"w-6 h-6 rounded-full border border-border shadow-sm transition-transform hover:scale-110 cursor-help\" style={{ backgroundColor: tag.tag_color }} />\n                                                <span className=\"text-xs text-muted-foreground font-mono opacity-0 group-hover:opacity-100 transition-opacity absolute left-8 bg-card border border-border px-1 rounded shadow-sm z-10\">\n                                                    {tag.tag_color}\n                                                </span>\n                                            </div>\n                                        </td>\n                                        {!showTrash && (\n                                            <td className=\"px-6 py-4\">\n                                                <div className=\"flex flex-wrap gap-1 max-w-[250px]\">\n                                                    {Object.entries(tag.breakdown || {}).slice(0, 4).map(([mod, count]) => (\n                                                        <span key={mod} className=\"text-[10px] uppercase bg-secondary text-secondary-foreground px-1.5 py-0.5 rounded border border-border flex items-center gap-1\">\n                                                            {mod.replace('_', ' ').slice(0, 8)}\n                                                            <span className=\"bg-background px-1 rounded-full text-[9px] font-bold\">{count}</span>\n                                                        </span>\n                                                    ))}\n                                                    {Object.keys(tag.breakdown || {}).length > 4 && (\n                                                        <span className=\"text-[10px] bg-muted text-muted-foreground px-2 py-0.5 rounded\">+{Object.keys(tag.breakdown).length - 4} more</span>\n                                                    )}\n                                                </div>\n                                            </td>\n                                        )}\n                                        <td className=\"px-6 py-4 text-center\">\n                                            <span className={`inline-flex items-center justify-center px-2.5 py-0.5 rounded-full text-xs font-medium ${tag.count > 0 ? 'bg-primary/10 text-primary' : 'bg-muted text-muted-foreground'\n                                                }`}>\n                                                {tag.count || 0} uses\n                                            </span>\n                                        </td>\n                                        <td className=\"px-6 py-4 text-center\">\n                                            {tag.tag_is_active ? (\n                                                <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-500/10 text-green-600 dark:text-green-400 border border-green-500/20\">Active</span>\n                                            ) : (\n                                                <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-muted text-muted-foreground border border-border\">Inactive</span>\n                                            )}\n                                        </td>\n                                        <td className=\"px-6 py-4 text-right\">\n                                            <div className=\"flex justify-end gap-1\">\n                                                {showTrash ? (\n                                                    <>\n                                                        {canRestore && (\n                                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => handleRestore(tag.tag_id)} className=\"text-green-600 hover:text-green-700 hover:bg-green-50\" title=\"Restore\">\n                                                                <RotateCcw className=\"w-4 h-4\" />\n                                                            </Button>\n                                                        )}\n                                                    </>\n                                                ) : (\n                                                    <>\n                                                        {canEdit && (\n                                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => openModal(tag)} className=\"text-muted-foreground hover:text-primary hover:bg-primary/10\">\n                                                                <Edit className=\"w-4 h-4\" />\n                                                            </Button>\n                                                        )}\n                                                        {canSoftDelete && (\n                                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDelete(tag.tag_id)} className=\"text-muted-foreground hover:text-destructive hover:bg-destructive/10\">\n                                                                <Trash2 className=\"w-4 h-4\" />\n                                                            </Button>\n                                                        )}\n                                                    </>\n                                                )}\n                                            </div>\n                                        </td>\n                                    </motion.tr>\n                                ))\n                            )}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            {displayedTags.length > 0 && (\n                <div className=\"flex flex-col sm:flex-row justify-between items-center gap-4 px-2\">\n                    <div className=\"text-xs text-muted-foreground\">\n                        Showing <span className=\"font-medium text-foreground\">{((currentPage - 1) * itemsPerPage) + 1}</span> to <span className=\"font-medium text-foreground\">{Math.min(currentPage * itemsPerPage, displayedTags.length)}</span> of <span className=\"font-medium text-foreground\">{displayedTags.length}</span> items\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                        <select\n                            className=\"h-8 rounded-md border border-input bg-background text-xs text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring dark:bg-slate-950 dark:text-slate-200 dark:border-slate-800\"\n                            value={itemsPerPage}\n                            onChange={(e) => { setItemsPerPage(Number(e.target.value)); setCurrentPage(1); }}\n                        >\n                            <option value={10}>10 / page</option>\n                            <option value={20}>20 / page</option>\n                            <option value={50}>50 / page</option>\n                            <option value={100}>100 / page</option>\n                        </select>\n                        <Pagination\n                            currentPage={currentPage}\n                            totalPages={totalPages}\n                            onPageChange={setCurrentPage}\n                        />\n                    </div>\n                </div>\n            )}\n\n            {/* Create/Edit Dialog */}\n            <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n                <DialogContent className=\"sm:max-w-[500px]\">\n                    <DialogHeader>\n                        <DialogTitle>{editingTag ? 'Edit Tag' : 'Create New Tag'}</DialogTitle>\n                        <DialogDescription>\n                            {editingTag ? 'Update tag details. Changes reflect across all modules immediately.' : 'Create a new tag to categorize content.'}\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"grid gap-4 py-4\">\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\n                            <Label htmlFor=\"name\" className=\"text-right\">Name <span className=\"text-destructive\">*</span></Label>\n                            <Input\n                                id=\"name\"\n                                value={formData.name}\n                                onChange={(e) => {\n                                    setFormData(prev => ({\n                                        ...prev,\n                                        name: e.target.value,\n                                        slug: !editingTag ? e.target.value.toLowerCase().replace(/[^a-z0-9]+/g, '-') : prev.slug\n                                    }))\n                                }}\n                                className=\"col-span-3\"\n                                placeholder=\"e.g. Technology\"\n                            />\n                        </div>\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\n                            <Label htmlFor=\"slug\" className=\"text-right\">Slug</Label>\n                            <Input\n                                id=\"slug\"\n                                value={formData.slug}\n                                onChange={(e) => setFormData(prev => ({ ...prev, slug: e.target.value }))}\n                                className=\"col-span-3\"\n                                placeholder=\"e.g. technology\"\n                            />\n                        </div>\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\n                            <Label htmlFor=\"description\" className=\"text-right\">Description</Label>\n                            <Input\n                                id=\"description\"\n                                value={formData.description}\n                                onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\n                                className=\"col-span-3\"\n                            />\n                        </div>\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\n                            <Label htmlFor=\"color\" className=\"text-right\">Color</Label>\n                            <div className=\"col-span-3 flex gap-2\">\n                                <Input\n                                    id=\"color\"\n                                    type=\"color\"\n                                    value={formData.color}\n                                    onChange={(e) => setFormData(prev => ({ ...prev, color: e.target.value }))}\n                                    className=\"w-12 h-10 p-1 cursor-pointer bg-transparent border-input\"\n                                />\n                                <Input\n                                    value={formData.color}\n                                    onChange={(e) => setFormData(prev => ({ ...prev, color: e.target.value }))}\n                                    className=\"font-mono uppercase\"\n                                />\n                            </div>\n                        </div>\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\n                            <Label htmlFor=\"is_active\" className=\"text-right\">Status</Label>\n                            <div className=\"col-span-3 flex items-center gap-2\">\n                                <input\n                                    type=\"checkbox\"\n                                    id=\"is_active\"\n                                    checked={formData.is_active}\n                                    onChange={(e) => setFormData(prev => ({ ...prev, is_active: e.target.checked }))}\n                                    className=\"h-4 w-4 rounded border-input text-primary focus:ring-primary bg-background\"\n                                />\n                                <Label htmlFor=\"is_active\" className=\"font-normal text-muted-foreground\">Active (Visible in selectors)</Label>\n                            </div>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setDialogOpen(false)}>Cancel</Button>\n                        <Button onClick={handleSave} disabled={saving} className=\"bg-primary text-primary-foreground hover:bg-primary/90\">\n                            {saving ? 'Saving...' : 'Save Changes'}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n        </AdminPageLayout>\n    );\n}\n\nexport default TagsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/TeamManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Users } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction TeamManager() {\n    const columns = [\n        {\n            key: 'image',\n            label: 'Photo',\n            render: (value) => value ? <img src={value} alt=\"Team\" className=\"w-8 h-8 rounded-full object-cover\" /> : <div className=\"w-8 h-8 rounded-full bg-slate-200\"></div>\n        },\n        { key: 'name', label: 'Name' },\n        { key: 'role', label: 'Role' },\n        { key: 'order', label: 'Order', type: 'number' },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'published' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'draft' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n                        'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'draft'}\n                </span>\n            )\n        }\n    ];\n\n    const formFields = [\n        { key: 'name', label: 'Full Name', required: true },\n        { key: 'role', label: 'Job Role/Position', required: true },\n        { key: 'image', label: 'Profile Photo', type: 'image' },\n        {\n            key: 'social_links',\n            label: 'Social Links',\n            type: 'json',\n            description: 'Array of objects: [{\"icon\": \"ti-facebook\", \"link\": \"https://...\"}]',\n            defaultValue: '[]'\n        },\n        { key: 'order', label: 'Sort Order', type: 'number', defaultValue: 0 },\n        {\n            key: 'status',\n            label: 'Status',\n            type: 'select',\n            options: [\n                { value: 'draft', label: 'Draft' },\n                { value: 'published', label: 'Published' },\n                { value: 'archived', label: 'Archived' }\n            ]\n        }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.teams.read\">\n            <PageHeader\n                title=\"Team\"\n                description=\"Manage your team members and their profiles.\"\n                icon={Users}\n                breadcrumbs={[{ label: 'Team', icon: Users }]}\n            />\n\n            <GenericContentManager\n                tableName=\"teams\"\n                resourceName=\"Team Member\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"teams\"\n                showBreadcrumbs={false}\n                defaultSortColumn=\"order\"\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default TeamManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/TemplatesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { AdminPageLayout, PageHeader, PageTabs, TabsContent } from '@/templates/flowbite-admin';\nimport TemplatesList from './templates/TemplatesList';\nimport TemplatePartsList from './templates/TemplatePartsList';\nimport TemplateAssignments from './templates/TemplateAssignments';\nimport TemplateLanguageManager from './templates/TemplateLanguageManager';\nimport { Layout, Puzzle, Link2, Languages } from 'lucide-react';\n\n/**\n * TemplatesManager - Manages admin templates and configurations.\n * RESTRICTED: Only accessible to platform admin or full-access roles.\n * Refactored to use awadmintemplate01 with ABAC enforcement.\n */\nconst TemplatesManager = () => {\n    const [activeTab, setActiveTab] = useState('pages');\n\n    // Tab definitions\n    const tabs = [\n        { value: 'pages', label: 'Page Templates', icon: Layout, color: 'blue' },\n        { value: 'parts', label: 'Template Parts', icon: Puzzle, color: 'purple' },\n        { value: 'assignments', label: 'Assignments', icon: Link2, color: 'emerald' },\n        { value: 'languages', label: 'Languages', icon: Languages, color: 'amber' },\n    ];\n\n    // Breadcrumb\n    const breadcrumbs = [\n        { label: 'Templates', icon: Layout },\n    ];\n\n    return (\n        <AdminPageLayout\n            requiredPermission=\"platform.template.manage\"\n            showTenantBadge={false}\n        >\n            {/* Page Header */}\n            <PageHeader\n                title=\"Templates\"\n                description=\"Manage page templates, parts, and language assignments\"\n                icon={Layout}\n                breadcrumbs={breadcrumbs}\n            />\n\n            {/* Tabs Navigation */}\n            <PageTabs value={activeTab} onValueChange={setActiveTab} tabs={tabs}>\n                <TabsContent value=\"pages\" className=\"mt-0\">\n                    <TemplatesList />\n                </TabsContent>\n\n                <TabsContent value=\"parts\" className=\"mt-0\">\n                    <TemplatePartsList />\n                </TabsContent>\n\n                <TabsContent value=\"assignments\" className=\"mt-0\">\n                    <TemplateAssignments />\n                </TabsContent>\n\n                <TabsContent value=\"languages\" className=\"mt-0\">\n                    <TemplateLanguageManager />\n                </TabsContent>\n            </PageTabs>\n        </AdminPageLayout>\n    );\n};\n\nexport default TemplatesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/TenantSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useForm } from 'react-hook-form';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useToast } from '@/components/ui/use-toast';\n\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { ImageUpload } from '@/components/ui/ImageUpload';\nimport { Loader2, Save } from 'lucide-react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\n\nexport default function TenantSettings() {\n    const { t } = useTranslation();\n    const { currentTenant: tenant, loading: tenantLoading } = useTenant();\n    const { checkAccess } = usePermissions();\n    const { toast } = useToast();\n    const [saving, setSaving] = useState(false);\n\n    // Permission Check\n    const canManageSettings = checkAccess('update', 'setting');\n    // Ideally we'd have a specific permission 'manage_tenant_settings', but 'update_settings' is a fair proxy for now.\n\n    const form = useForm({\n        defaultValues: {\n            brandColor: '#000000',\n            fontFamily: 'Inter',\n            logoUrl: '',\n            siteName: ''\n        }\n    });\n\n    useEffect(() => {\n        if (tenant) {\n            form.reset({\n                brandColor: tenant.config?.theme?.brandColor || '#000000',\n                fontFamily: tenant.config?.theme?.fontFamily || 'Inter',\n                logoUrl: tenant.config?.theme?.logoUrl || '',\n                siteName: tenant.config?.settings?.siteName || tenant.name || ''\n            });\n        }\n    }, [tenant, form]);\n\n    const onSubmit = async (values) => {\n        setSaving(true);\n        try {\n            const newConfig = {\n                ...tenant.config,\n                theme: {\n                    brandColor: values.brandColor,\n                    fontFamily: values.fontFamily,\n                    logoUrl: values.logoUrl\n                },\n                settings: {\n                    ...tenant.config?.settings,\n                    siteName: values.siteName\n                }\n            };\n\n            const { error } = await supabase\n                .from('tenants')\n                .update({\n                    config: newConfig,\n                    updated_at: new Date().toISOString()\n                })\n                .eq('id', tenant.id);\n\n            if (error) throw error;\n\n            toast({ title: t('tenant_settings.toasts.saved_title'), description: t('tenant_settings.toasts.saved_desc') });\n\n            // Note: refreshTenant not available in current TenantContext\n            // Full refresh would require page reload or context enhancement\n\n        } catch (err) {\n            console.error('Error saving settings:', err);\n            toast({ variant: 'destructive', title: t('tenant_settings.toasts.error_title'), description: err.message });\n        } finally {\n            setSaving(false);\n        }\n    };\n\n    if (tenantLoading) return <div className=\"p-8 flex justify-center\"><Loader2 className=\"animate-spin text-slate-400\" /></div>;\n    if (!tenant) return <div className=\"p-8 text-center\"><h2 className=\"text-xl font-bold text-slate-800\">{t('tenant_settings.errors.tenant_not_found')}</h2><p className=\"text-slate-500\">{t('tenant_settings.errors.tenant_load_error')}</p></div>;\n\n    if (!canManageSettings) {\n        return (\n            <div className=\"p-8 text-center\">\n                <h2 className=\"text-xl font-bold text-slate-800\">{t('tenant_settings.errors.access_denied')}</h2>\n                <p className=\"text-slate-500\">{t('tenant_settings.errors.access_denied_desc')}</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"max-w-5xl mx-auto space-y-8 pb-12\">\n            <div className=\"space-y-1\">\n                <h1 className=\"text-3xl font-semibold tracking-tight text-slate-900 dark:text-white\">{t('tenant_settings.title')}</h1>\n                <p className=\"text-slate-500 dark:text-slate-400\">{t('tenant_settings.description')}</p>\n            </div>\n\n            <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n\n                    {/* Branding Section */}\n                    <Card className=\"dashboard-surface dashboard-surface-hover overflow-hidden\">\n                        <CardHeader className=\"border-b border-slate-200/60 bg-slate-50/70 dark:border-slate-800/70 dark:bg-slate-900/60\">\n                            <CardTitle className=\"text-lg text-slate-900 dark:text-white\">{t('tenant_settings.branding.title')}</CardTitle>\n                            <CardDescription>{t('tenant_settings.branding.description')}</CardDescription>\n                        </CardHeader>\n                        <CardContent className=\"space-y-6 pt-6\">\n\n                            <FormField\n                                control={form.control}\n                                name=\"siteName\"\n                                render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">{t('tenant_settings.branding.site_name')}</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    placeholder={t('tenant_settings.branding.site_name_placeholder')}\n                                                    className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                )}\n                            />\n\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                <FormField\n                                    control={form.control}\n                                    name=\"brandColor\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">{t('tenant_settings.branding.brand_color')}</FormLabel>\n                                            <div className=\"flex gap-3 items-center\">\n                                                <div className=\"relative\">\n                                                    <div\n                                                        className=\"w-12 h-12 rounded-xl border border-slate-200/70 shadow-sm cursor-pointer transition-transform hover:scale-105\"\n                                                        style={{ backgroundColor: field.value }}\n                                                        onClick={() => document.getElementById('color-picker').click()}\n                                                    />\n                                                    <input\n                                                        id=\"color-picker\"\n                                                        type=\"color\"\n                                                        className=\"invisible absolute top-0 left-0 w-full h-full\"\n                                                        value={field.value}\n                                                        onChange={(e) => field.onChange(e.target.value)}\n                                                    />\n                                                </div>\n                                                <div className=\"flex-1\">\n                                                    <FormControl>\n                                                        <Input\n                                                            placeholder={t('tenant_settings.branding.brand_color_desc')}\n                                                            {...field}\n                                                            className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 font-mono uppercase shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                                                            onChange={(e) => {\n                                                                const val = e.target.value;\n                                                                field.onChange(val);\n                                                            }}\n                                                        />\n                                                    </FormControl>\n                                                    <FormDescription className=\"text-xs mt-1\">\n                                                        {t('tenant_settings.branding.brand_color_desc')}\n                                                    </FormDescription>\n                                                </div>\n                                            </div>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n\n                                <FormField\n                                    control={form.control}\n                                    name=\"fontFamily\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">{t('tenant_settings.branding.font_family')}</FormLabel>\n                                            <Select onValueChange={field.onChange} defaultValue={field.value}>\n                                                <FormControl>\n                                                    <SelectTrigger className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\">\n                                                        <SelectValue placeholder={t('tenant_settings.branding.font_select_placeholder')} />\n                                                    </SelectTrigger>\n                                                </FormControl>\n                                                <SelectContent>\n                                                    <SelectItem value=\"Inter\" style={{ fontFamily: 'Inter, sans-serif' }}>Inter (Default)</SelectItem>\n                                                    <SelectItem value=\"Roboto\" style={{ fontFamily: 'Roboto, sans-serif' }}>Roboto</SelectItem>\n                                                    <SelectItem value=\"Open Sans\" style={{ fontFamily: '\"Open Sans\", sans-serif' }}>Open Sans</SelectItem>\n                                                    <SelectItem value=\"Lato\" style={{ fontFamily: 'Lato, sans-serif' }}>Lato</SelectItem>\n                                                    <SelectItem value=\"Montserrat\" style={{ fontFamily: 'Montserrat, sans-serif' }}>Montserrat</SelectItem>\n                                                    <SelectItem value=\"Poppins\" style={{ fontFamily: 'Poppins, sans-serif' }}>Poppins</SelectItem>\n                                                    <SelectItem value=\"Playfair Display\" style={{ fontFamily: '\"Playfair Display\", serif' }}>Playfair Display</SelectItem>\n                                                    <SelectItem value=\"Merriweather\" style={{ fontFamily: 'Merriweather, serif' }}>Merriweather</SelectItem>\n                                                    <SelectItem value=\"system-ui\" style={{ fontFamily: 'system-ui, sans-serif' }}>System Default</SelectItem>\n                                                </SelectContent>\n                                            </Select>\n                                            <FormDescription>\n                                                {t('tenant_settings.branding.font_family_desc')}\n                                                <span\n                                                    className=\"block mt-2 text-lg text-slate-800 border border-slate-200/70 p-2 rounded-xl bg-slate-50/70\"\n                                                    style={{ fontFamily: field.value === 'system-ui' ? 'system-ui' : `${field.value}, sans-serif` }}\n                                                >\n                                                    {t('tenant_settings.branding.font_preview')}\n                                                </span>\n                                            </FormDescription>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                            </div>\n\n                            <FormField\n                                control={form.control}\n                                name=\"logoUrl\"\n                                render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">{t('tenant_settings.branding.logo')}</FormLabel>\n                                            <FormControl>\n                                                <ImageUpload\n                                                    value={field.value}\n                                                    onChange={field.onChange}\n                                                    className=\"w-full\"\n                                                />\n                                            </FormControl>\n                                            <FormDescription>{t('tenant_settings.branding.logo_desc')}</FormDescription>\n                                            <FormMessage />\n                                        </FormItem>\n                                )}\n                            />\n\n                        </CardContent>\n                    </Card>\n\n                    <div className=\"flex justify-end\">\n                        <Button type=\"submit\" disabled={saving} className=\"bg-indigo-600 hover:bg-indigo-700\">\n                            {saving && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                            <Save className=\"w-4 h-4 mr-2\" />\n                            {saving ? t('tenant_settings.buttons.saving') : t('tenant_settings.buttons.save_changes')}\n                        </Button>\n                    </div>\n\n                </form>\n            </Form>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/TenantUsage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { Progress } from \"@/components/ui/progress\";\nimport { Users, Database } from \"lucide-react\";\n\n// Limits must match SQL enforcement logic\nconst TIERS = {\n    free: { max_users: 5, max_storage: 104857600, label: 'Free Plan' },\n    pro: { max_users: 50, max_storage: 10737418240, label: 'Pro Plan' },\n    enterprise: { max_users: -1, max_storage: -1, label: 'Enterprise' }\n};\n\nexport function TenantUsage() {\n    const { tenantId } = usePermissions();\n    const [usage, setUsage] = useState({ users: 0, storage: 0 });\n    const [tier, setTier] = useState('free');\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        if (!tenantId) {\n            setLoading(false);\n            return;\n        }\n\n        const fetchData = async () => {\n            setLoading(true);\n            try {\n                // 1. Get Tenant Tier\n                const { data: tenant } = await supabase\n                    .from('tenants')\n                    .select('subscription_tier')\n                    .eq('id', tenantId)\n                    .single();\n\n                const currentTier = tenant?.subscription_tier || 'free';\n                setTier(currentTier);\n\n                // 2. Get User Count (RLS automatically restricts to tenant)\n                const { count: userCount } = await supabase\n                    .from('users')\n                    .select('*', { count: 'exact', head: true });\n\n                // 3. Get Storage Usage (Sum file_size)\n                const { data: files } = await supabase\n                    .from('files')\n                    .select('file_size')\n                    .is('deleted_at', null);\n\n                const totalSize = files?.reduce((acc, f) => acc + (f.file_size || 0), 0) || 0;\n\n                setUsage({ users: userCount || 0, storage: totalSize });\n\n            } catch (error) {\n                console.error(\"Error fetching usage:\", error);\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchData();\n    }, [tenantId]);\n\n    // Don't show if loading or no tenantId\n    if (loading || !tenantId) return null;\n\n    const limits = TIERS[tier] || TIERS.free;\n    const storagePercent = limits.max_storage === -1 ? 0 : Math.min((usage.storage / limits.max_storage) * 100, 100);\n    const usersPercent = limits.max_users === -1 ? 0 : Math.min((usage.users / limits.max_users) * 100, 100);\n\n    const formatBytes = (bytes) => {\n        if (bytes === 0) return '0 B';\n        const k = 1024;\n        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    };\n\n    return (\n        <div className=\"px-4 py-2 border-t border-slate-800 bg-slate-900/50\">\n            <div className=\"mb-2 flex items-center justify-between\">\n                <span className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider\">{limits.label}</span>\n                {tier === 'free' && <span className=\"text-xs text-blue-400 cursor-pointer hover:underline\">Upgrade</span>}\n            </div>\n\n            <div className=\"space-y-3\">\n                {/* Users Usage */}\n                <div className=\"space-y-1\">\n                    <div className=\"flex justify-between text-[10px] text-slate-400\">\n                        <span className=\"flex items-center gap-1\"><Users className=\"w-3 h-3\" /> Users</span>\n                        <span>{usage.users} / {limits.max_users === -1 ? '' : limits.max_users}</span>\n                    </div>\n                    {limits.max_users !== -1 && (\n                        <Progress value={usersPercent} className=\"h-1 bg-slate-800\" indicatorClassName={usersPercent > 90 ? \"bg-red-500\" : \"bg-blue-500\"} />\n                    )}\n                </div>\n\n                {/* Storage Usage */}\n                <div className=\"space-y-1\">\n                    <div className=\"flex justify-between text-[10px] text-slate-400\">\n                        <span className=\"flex items-center gap-1\"><Database className=\"w-3 h-3\" /> Storage</span>\n                        <span>{formatBytes(usage.storage)} / {limits.max_storage === -1 ? '' : formatBytes(limits.max_storage)}</span>\n                    </div>\n                    {limits.max_storage !== -1 && (\n                        <Progress value={storagePercent} className=\"h-1 bg-slate-800\" indicatorClassName={storagePercent > 90 ? \"bg-red-500\" : \"bg-purple-500\"} />\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/TenantsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'row' is defined but never used.","line":507,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":507,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"row"},"fix":{"range":[19702,19707],"text":""},"desc":"Remove unused variable 'row'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport ContentTable from '@/components/dashboard/ContentTable';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Button } from '@/components/ui/button';\nimport { Plus, Building, RefreshCw, DollarSign, Mail, FileText, Globe, ChevronLeft, ChevronRight, Radio } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { Input } from '@/components/ui/input';\nimport { useSearch } from '@/hooks/useSearch';\nimport MinCharSearchInput from '@/components/common/MinCharSearchInput';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction TenantsManager() {\n    const { toast } = useToast();\n    const { isPlatformAdmin } = usePermissions();\n\n    const [tenants, setTenants] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [showEditor, setShowEditor] = useState(false);\n    const [editingTenant, setEditingTenant] = useState(null);\n\n    // Search\n    const {\n        query,\n        setQuery,\n        debouncedQuery,\n        isValid: isSearchValid,\n        message: searchMessage,\n        loading: searchLoading,\n        minLength,\n        clearSearch\n    } = useSearch({ context: 'admin' });\n\n    const [currentPage, setCurrentPage] = useState(1);\n    const [itemsPerPage, setItemsPerPage] = useState(10);\n\n    const [formData, setFormData] = useState({\n        name: '',\n        slug: '',\n        domain: '',\n        parent_tenant_id: '',\n        role_inheritance_mode: 'auto',\n        status: 'active',\n        subscription_tier: 'free',\n        subscription_expires_at: '',\n        billing_amount: '',\n        billing_cycle: 'monthly',\n        currency: 'USD',\n        locale: 'en',\n        notes: '',\n        contact_email: ''\n    });\n\n    // Channel domains state\n    const [channelDomains, setChannelDomains] = useState({\n        web_public: '',\n        mobile: '',\n        esp32: ''\n    });\n\n    const [resourceRegistry, setResourceRegistry] = useState([]);\n    const [resourceRules, setResourceRules] = useState([]);\n    const [rulesLoading, setRulesLoading] = useState(false);\n    const [roleLinks, setRoleLinks] = useState([]);\n    const [roleLinksLoading, setRoleLinksLoading] = useState(false);\n\n    // Delete state\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n    const [tenantToDelete, setTenantToDelete] = useState(null);\n\n    const fetchTenants = React.useCallback(async () => {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('tenants')\n                .select('*')\n                .is('deleted_at', null)\n                .order('created_at', { ascending: false });\n\n            if (error) throw error;\n            setTenants(data || []);\n        } catch (err) {\n            console.error(err);\n            toast({ variant: 'destructive', title: 'Error', description: 'Failed to load tenants' });\n        } finally {\n            setLoading(false);\n        }\n    }, [toast]);\n\n    useEffect(() => {\n        if (isPlatformAdmin) {\n            fetchTenants();\n        }\n    }, [isPlatformAdmin, fetchTenants]);\n\n    const handleCreate = () => {\n        setEditingTenant(null);\n        setFormData({\n            name: '',\n            slug: '',\n            domain: '',\n            parent_tenant_id: '',\n            role_inheritance_mode: 'auto',\n            status: 'active',\n            subscription_tier: 'free',\n            subscription_expires_at: '',\n            billing_amount: '',\n            billing_cycle: 'monthly',\n            currency: 'USD',\n            locale: 'en',\n            notes: '',\n            contact_email: ''\n        });\n        setChannelDomains({ web_public: '', mobile: '', esp32: '' });\n        loadResourceRules(null);\n        setShowEditor(true);\n    };\n\n    const handleEdit = async (tenant) => {\n        setEditingTenant(tenant);\n        setFormData({\n            name: tenant.name,\n            slug: tenant.slug,\n            domain: tenant.domain || '',\n            parent_tenant_id: tenant.parent_tenant_id || '',\n            role_inheritance_mode: tenant.role_inheritance_mode || 'auto',\n            status: tenant.status,\n            subscription_tier: tenant.subscription_tier || 'free',\n            subscription_expires_at: tenant.subscription_expires_at ? tenant.subscription_expires_at.split('T')[0] : '',\n            billing_amount: tenant.billing_amount || '',\n            billing_cycle: tenant.billing_cycle || 'monthly',\n            currency: tenant.currency || 'USD',\n            locale: tenant.locale || 'en',\n            notes: tenant.notes || '',\n            contact_email: tenant.contact_email || ''\n        });\n\n        // Fetch channel domains\n        try {\n            const { data: channels } = await supabase\n                .from('tenant_channels')\n                .select('channel, domain')\n                .eq('tenant_id', tenant.id)\n                .in('channel', ['web_public', 'mobile', 'esp32']);\n\n            const domains = { web_public: '', mobile: '', esp32: '' };\n            channels?.forEach(c => { domains[c.channel] = c.domain || ''; });\n            setChannelDomains(domains);\n        } catch (err) {\n            console.error('Failed to load channels:', err);\n        }\n        loadResourceRules(tenant.id);\n        setShowEditor(true);\n    };\n\n    const loadResourceRules = useCallback(async (tenantId) => {\n        setRulesLoading(true);\n        try {\n            const { data: registryData, error: registryError } = await supabase\n                .from('tenant_resource_registry')\n                .select('resource_key, description, default_share_mode, default_access_mode')\n                .order('resource_key');\n\n            if (registryError) throw registryError;\n            setResourceRegistry(registryData || []);\n\n            let existingRules = [];\n            if (tenantId) {\n                const { data: rulesData, error: rulesError } = await supabase\n                    .from('tenant_resource_rules')\n                    .select('resource_key, share_mode, access_mode')\n                    .eq('tenant_id', tenantId);\n\n                if (rulesError) throw rulesError;\n                existingRules = rulesData || [];\n            }\n\n            const ruleMap = new Map(existingRules.map(rule => [rule.resource_key, rule]));\n            const rules = (registryData || []).map(rule => ({\n                resource_key: rule.resource_key,\n                description: rule.description,\n                share_mode: ruleMap.get(rule.resource_key)?.share_mode || rule.default_share_mode,\n                access_mode: ruleMap.get(rule.resource_key)?.access_mode || rule.default_access_mode\n            }));\n            setResourceRules(rules);\n        } catch (err) {\n            console.error('Failed to load resource rules:', err);\n            toast({ variant: 'destructive', title: 'Error', description: 'Failed to load resource sharing rules.' });\n        } finally {\n            setRulesLoading(false);\n        }\n    }, [toast]);\n\n    const loadRoleLinks = useCallback(async (tenantId, parentTenantId) => {\n        if (!tenantId || !parentTenantId) {\n            setRoleLinks([]);\n            return;\n        }\n        setRoleLinksLoading(true);\n        try {\n            const [{ data: parentRoles, error: parentError }, { data: childRoles, error: childError }, { data: linkData, error: linkError }] = await Promise.all([\n                supabase\n                    .from('roles')\n                    .select('id, name')\n                    .eq('tenant_id', parentTenantId)\n                    .is('deleted_at', null),\n                supabase\n                    .from('roles')\n                    .select('id, name')\n                    .eq('tenant_id', tenantId)\n                    .is('deleted_at', null),\n                supabase\n                    .from('tenant_role_links')\n                    .select('parent_role_id, child_role_id')\n                    .eq('tenant_id', tenantId)\n            ]);\n\n            if (parentError || childError || linkError) throw parentError || childError || linkError;\n\n            const childMap = new Map((childRoles || []).map(role => [role.name, role]));\n            const linkSet = new Set((linkData || []).map(link => `${link.parent_role_id}:${link.child_role_id}`));\n\n            const merged = (parentRoles || []).map(parentRole => {\n                const childRole = childMap.get(parentRole.name);\n                const linkKey = childRole ? `${parentRole.id}:${childRole.id}` : null;\n                return {\n                    name: parentRole.name,\n                    parent_role_id: parentRole.id,\n                    child_role_id: childRole?.id || null,\n                    linked: linkKey ? linkSet.has(linkKey) : false\n                };\n            });\n\n            setRoleLinks(merged);\n        } catch (err) {\n            console.error('Failed to load role links:', err);\n            toast({ variant: 'destructive', title: 'Error', description: 'Failed to load role links.' });\n        } finally {\n            setRoleLinksLoading(false);\n        }\n    }, [toast]);\n\n    useEffect(() => {\n        if (!showEditor || !editingTenant) {\n            return;\n        }\n        if (formData.role_inheritance_mode === 'linked' && formData.parent_tenant_id) {\n            loadRoleLinks(editingTenant.id, formData.parent_tenant_id);\n        } else {\n            setRoleLinks([]);\n        }\n    }, [showEditor, editingTenant, formData.parent_tenant_id, formData.role_inheritance_mode, loadRoleLinks]);\n\n    const handleSave = async () => {\n        if (!formData.name || !formData.slug) {\n            toast({ variant: 'destructive', title: 'Error', description: 'Name and Slug are required' });\n            return;\n        }\n\n        setLoading(true);\n        try {\n            // Check for duplicate slug\n            const { data: existing } = await supabase\n                .from('tenants')\n                .select('id')\n                .eq('slug', formData.slug)\n                .neq('id', editingTenant?.id || '00000000-0000-0000-0000-000000000000') // Exclude self\n                .maybeSingle();\n\n            if (existing) {\n                throw new Error('Tenant Slug is already taken. Please choose another.');\n            }\n\n            const payload = {\n                name: formData.name,\n                slug: formData.slug,\n                domain: formData.domain || null,\n                parent_tenant_id: formData.parent_tenant_id || null,\n                role_inheritance_mode: formData.role_inheritance_mode || 'auto',\n                status: formData.status,\n                subscription_tier: formData.subscription_tier,\n                subscription_expires_at: formData.subscription_expires_at || null,\n                billing_amount: formData.billing_amount ? parseFloat(formData.billing_amount) : null,\n                billing_cycle: formData.billing_cycle,\n                currency: formData.currency,\n                locale: formData.locale,\n                notes: formData.notes || null,\n                contact_email: formData.contact_email || null\n            };\n\n            let error;\n            let newTenantId = null;\n            if (editingTenant) {\n                const { error: updateError } = await supabase\n                    .from('tenants')\n                    .update(payload)\n                    .eq('id', editingTenant.id);\n                error = updateError;\n            } else {\n                const { data: createdTenant, error: insertError } = await supabase\n                    .rpc('create_tenant_with_defaults', {\n                        p_name: payload.name,\n                        p_slug: payload.slug,\n                        p_domain: payload.domain,\n                        p_tier: payload.subscription_tier,\n                        p_parent_tenant_id: payload.parent_tenant_id,\n                        p_role_inheritance_mode: payload.role_inheritance_mode\n                    });\n                error = insertError;\n                if (createdTenant?.tenant_id) newTenantId = createdTenant.tenant_id;\n            }\n\n            if (error) throw error;\n\n            if (!editingTenant && newTenantId) {\n                const { error: updateError } = await supabase\n                    .from('tenants')\n                    .update(payload)\n                    .eq('id', newTenantId);\n                if (updateError) throw updateError;\n            }\n\n            // Save channel domains for tenant (both new and existing)\n            const tenantId = editingTenant?.id || newTenantId;\n            const tenantSlug = editingTenant?.slug || formData.slug;\n            if (tenantId) {\n                for (const channel of ['web_public', 'mobile', 'esp32']) {\n                    if (channelDomains[channel]) {\n                        // Upsert channel domain\n                        const { error: channelError } = await supabase\n                            .from('tenant_channels')\n                            .upsert({\n                                tenant_id: tenantId,\n                                channel,\n                                domain: channelDomains[channel].toLowerCase().trim(),\n                                base_path: channel === 'web_public' ? `/awcms-public/${tenantSlug}/` :\n                                    channel === 'mobile' ? `/awcms-mobile/${tenantSlug}/` :\n                                        `/awcms-esp32/${tenantSlug}/`,\n                                is_primary: true,\n                                is_active: true\n                            }, { onConflict: 'tenant_id,channel,is_primary' });\n                        if (channelError) console.error('Channel upsert error:', channelError);\n                    }\n                }\n            }\n\n            if (tenantId && resourceRules.length > 0) {\n                const rulesPayload = resourceRules.map(rule => ({\n                    tenant_id: tenantId,\n                    resource_key: rule.resource_key,\n                    share_mode: rule.share_mode,\n                    access_mode: rule.access_mode\n                }));\n                const { error: rulesError } = await supabase\n                    .from('tenant_resource_rules')\n                    .upsert(rulesPayload, { onConflict: 'tenant_id,resource_key' });\n                if (rulesError) throw rulesError;\n            }\n\n            if (tenantId && payload.role_inheritance_mode === 'linked') {\n                await supabase\n                    .from('tenant_role_links')\n                    .delete()\n                    .eq('tenant_id', tenantId);\n\n                const linkPayload = roleLinks\n                    .filter(link => link.linked && link.child_role_id)\n                    .map(link => ({\n                        tenant_id: tenantId,\n                        parent_role_id: link.parent_role_id,\n                        child_role_id: link.child_role_id\n                    }));\n\n                if (linkPayload.length > 0) {\n                    const { error: linkError } = await supabase\n                        .from('tenant_role_links')\n                        .insert(linkPayload);\n                    if (linkError) throw linkError;\n                }\n            }\n\n            if (tenantId && payload.parent_tenant_id) {\n                await supabase.rpc('apply_tenant_role_inheritance', { p_tenant_id: tenantId });\n            }\n\n            toast({ title: 'Success', description: `Tenant ${editingTenant ? 'updated' : 'created'} successfully` });\n            setShowEditor(false);\n            fetchTenants();\n        } catch (err) {\n            console.error(err);\n            toast({ variant: 'destructive', title: 'Error', description: err.message });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleDelete = async () => {\n        if (!tenantToDelete) return;\n        setLoading(true);\n        try {\n            // Soft Delete Implementation\n            const { error } = await supabase\n                .from('tenants')\n                .update({\n                    deleted_at: new Date().toISOString(),\n                    status: 'archived' // Optional: also mark as archived\n                })\n                .eq('id', tenantToDelete.id);\n\n            if (error) throw error;\n\n            toast({ title: 'Success', description: 'Tenant deleted successfully (Soft Delete)' });\n            setDeleteDialogOpen(false);\n            setTenantToDelete(null);\n            fetchTenants();\n        } catch (err) {\n            console.error(err);\n            toast({ variant: 'destructive', title: 'Error', description: `Failed to delete: ${err.message}` });\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const filteredTenants = tenants.filter(t => {\n        if (!debouncedQuery) return true;\n        const lower = debouncedQuery.toLowerCase();\n        return t.name.toLowerCase().includes(lower) ||\n            t.slug.toLowerCase().includes(lower);\n    });\n\n    // Pagination logic\n    const totalPages = Math.ceil(filteredTenants.length / itemsPerPage);\n    const startIndex = (currentPage - 1) * itemsPerPage;\n    const endIndex = startIndex + itemsPerPage;\n    const paginatedTenants = filteredTenants.slice(startIndex, endIndex);\n\n    // Reset to page 1 when search changes\n    useEffect(() => {\n        setCurrentPage(1);\n    }, [debouncedQuery]);\n\n    const hasRegistry = resourceRegistry.length > 0;\n\n    const columns = [\n        { key: 'name', label: 'Name', className: 'font-semibold' },\n        { key: 'slug', label: 'Slug', className: 'text-muted-foreground font-mono text-xs' },\n        { key: 'level', label: 'Level', className: 'text-xs text-muted-foreground text-center w-[80px]' },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (status) => (\n                <span className={`px-2 py-1 rounded-full text-xs font-bold ${status === 'active' ? 'bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300' :\n                    status === 'suspended' ? 'bg-destructive/10 text-destructive' : 'bg-muted text-muted-foreground'\n                    }`}>\n                    {status.toUpperCase()}\n                </span>\n            )\n        },\n        {\n            key: 'subscription_tier',\n            label: 'Plan',\n            render: (tier) => (\n                <span className=\"uppercase text-xs font-bold text-primary border border-primary/20 px-2 py-0.5 rounded bg-primary/10\">\n                    {tier}\n                </span>\n            )\n        },\n        {\n            key: 'created_at',\n            label: 'Created',\n            render: (date) => date ? (\n                <span className=\"text-xs text-muted-foreground\">{format(new Date(date), 'dd MMM yyyy')}</span>\n            ) : '-'\n        },\n        {\n            key: 'subscription_expires_at',\n            label: 'Expires',\n            render: (date, row) => {\n                if (!date) return <span className=\"text-xs text-muted-foreground\">-</span>;\n                const expDate = new Date(date);\n                const isExpired = expDate < new Date();\n                const isExpiringSoon = expDate < new Date(Date.now() + 30 * 24 * 60 * 60 * 1000); // 30 days\n                return (\n                    <span className={`text-xs font-medium ${isExpired ? 'text-destructive' : isExpiringSoon ? 'text-amber-600 dark:text-amber-400' : 'text-green-600 dark:text-green-400'}`}>\n                        {format(expDate, 'dd MMM yyyy')}\n                    </span>\n                );\n            }\n        },\n        {\n            key: 'billing_amount',\n            label: 'Billing',\n            render: (amount, row) => {\n                if (!amount) return <span className=\"text-xs text-muted-foreground\">-</span>;\n                const currencySymbols = { IDR: 'Rp', USD: '$', EUR: '', SGD: 'S$', MYR: 'RM' };\n                const symbol = currencySymbols[row.currency] || row.currency || '$';\n                const cycleLabel = row.billing_cycle === 'yearly' ? '/yr' : row.billing_cycle === 'monthly' ? '/mo' : '';\n                return (\n                    <span className=\"text-xs text-muted-foreground font-medium\">\n                        {symbol}{parseFloat(amount).toLocaleString()}{cycleLabel}\n                    </span>\n                );\n            }\n        }\n    ];\n\n    if (!isPlatformAdmin) return (\n        <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-card rounded-xl border border-border p-12 text-center\">\n            <Building className=\"w-12 h-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-xl font-bold text-foreground\">Access Denied</h3>\n            <p className=\"text-muted-foreground\">Platform Admins Only</p>\n        </div>\n    );\n\n    return (\n        <AdminPageLayout requiredPermission=\"platform.tenants.read\">\n            <PageHeader\n                title=\"Tenants\"\n                description=\"Manage platform tenants, subscriptions, and domains.\"\n                icon={Building}\n                breadcrumbs={[{ label: 'Tenants', icon: Building }]}\n                actions={(\n                    <div className=\"flex gap-2\">\n                        <Button variant=\"ghost\" onClick={fetchTenants} title=\"Refresh\" className=\"text-muted-foreground hover:text-foreground\">\n                            <RefreshCw className=\"w-4 h-4\" />\n                        </Button>\n                        <Button onClick={handleCreate} className=\"bg-primary text-primary-foreground hover:bg-primary/90\">\n                            <Plus className=\"w-4 h-4 mr-2\" /> New Tenant\n                        </Button>\n                    </div>\n                )}\n            />\n\n            <div className=\"bg-card rounded-xl border border-border shadow-sm overflow-hidden\">\n                <div className=\"p-4 border-b border-border bg-muted/20 flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\">\n                    <div className=\"flex-1 max-w-sm\">\n                        <MinCharSearchInput\n                            value={query}\n                            onChange={e => setQuery(e.target.value)}\n                            onClear={clearSearch}\n                            loading={loading || searchLoading}\n                            isValid={isSearchValid}\n                            message={searchMessage}\n                            minLength={minLength}\n                            placeholder=\"Search tenants\"\n                        />\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <span className=\"text-sm text-muted-foreground\">Show:</span>\n                        <Select value={String(itemsPerPage)} onValueChange={(v) => { setItemsPerPage(Number(v)); setCurrentPage(1); }}>\n                            <SelectTrigger className=\"w-[70px] h-8 bg-background border-input\">\n                                <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                                <SelectItem value=\"5\">5</SelectItem>\n                                <SelectItem value=\"10\">10</SelectItem>\n                                <SelectItem value=\"25\">25</SelectItem>\n                                <SelectItem value=\"50\">50</SelectItem>\n                            </SelectContent>\n                        </Select>\n                    </div>\n                </div>\n                <ContentTable\n                    data={paginatedTenants}\n                    columns={columns}\n                    loading={loading}\n                    onEdit={handleEdit}\n                    onDelete={(t) => { setTenantToDelete(t); setDeleteDialogOpen(true); }}\n                />\n                {/* Pagination Controls */}\n                {totalPages > 1 && (\n                    <div className=\"flex items-center justify-between px-4 py-3 border-t border-border bg-muted/20\">\n                        <div className=\"text-sm text-muted-foreground\">\n                            Showing {startIndex + 1} - {Math.min(endIndex, filteredTenants.length)} of {filteredTenants.length} tenants\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                            <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n                                disabled={currentPage === 1}\n                                className=\"h-8 w-8 p-0\"\n                            >\n                                <ChevronLeft className=\"w-4 h-4\" />\n                            </Button>\n                            {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n                                let pageNum;\n                                if (totalPages <= 5) {\n                                    pageNum = i + 1;\n                                } else if (currentPage <= 3) {\n                                    pageNum = i + 1;\n                                } else if (currentPage >= totalPages - 2) {\n                                    pageNum = totalPages - 4 + i;\n                                } else {\n                                    pageNum = currentPage - 2 + i;\n                                }\n                                return (\n                                    <Button\n                                        key={pageNum}\n                                        variant={currentPage === pageNum ? \"default\" : \"outline\"}\n                                        size=\"sm\"\n                                        onClick={() => setCurrentPage(pageNum)}\n                                        className={`h-8 w-8 p-0 ${currentPage === pageNum ? 'bg-blue-600 hover:bg-blue-700' : ''}`}\n                                    >\n                                        {pageNum}\n                                    </Button>\n                                );\n                            })}\n                            <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\n                                disabled={currentPage === totalPages}\n                                className=\"h-8 w-8 p-0\"\n                            >\n                                <ChevronRight className=\"w-4 h-4\" />\n                            </Button>\n                        </div>\n                    </div>\n                )}\n            </div>\n\n            {/* Editor Dialog */}\n            <Dialog open={showEditor} onOpenChange={setShowEditor}>\n                <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-hidden flex flex-col\">\n                    <DialogHeader>\n                        <DialogTitle>{editingTenant ? 'Edit Tenant' : 'New Tenant'}</DialogTitle>\n                        <DialogDescription>Configure tenant details and subscription.</DialogDescription>\n                    </DialogHeader>\n                    <div className=\"flex-1 overflow-y-auto pr-2\">\n                        <div className=\"space-y-4 py-4\">\n                            <div className=\"grid gap-2\">\n                                <Label>Name</Label>\n                                <Input\n                                    value={formData.name}\n                                    onChange={e => setFormData({ ...formData, name: e.target.value })}\n                                    placeholder=\"Acme Corp\"\n                                />\n                            </div>\n                            <div className=\"grid gap-2\">\n                                <Label>Slug (Unique ID)</Label>\n                                <Input\n                                    value={formData.slug}\n                                    onChange={e => setFormData({ ...formData, slug: e.target.value.toLowerCase().replace(/\\s+/g, '-') })}\n                                    placeholder=\"acme-corp\"\n                                    disabled={!!editingTenant}\n                                />\n                            </div>\n                            <div className=\"grid gap-2\">\n                                <Label>Custom Domain (Optional)</Label>\n                                <Input\n                                    value={formData.domain}\n                                    onChange={e => setFormData({ ...formData, domain: e.target.value })}\n                                    placeholder=\"app.acme.com\"\n                                />\n                            </div>\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"grid gap-2\">\n                                    <Label>Parent Tenant</Label>\n                                    <Select\n                                        value={formData.parent_tenant_id || 'none'}\n                                        onValueChange={v => setFormData({ ...formData, parent_tenant_id: v === 'none' ? '' : v })}\n                                    >\n                                        <SelectTrigger className=\"bg-background border-input\"><SelectValue /></SelectTrigger>\n                                        <SelectContent>\n                                            <SelectItem value=\"none\">None (Top-Level)</SelectItem>\n                                            {tenants\n                                                .filter(t => !editingTenant || t.id !== editingTenant.id)\n                                                .map(t => (\n                                                    <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>\n                                                ))}\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                                <div className=\"grid gap-2\">\n                                    <Label>Role Inheritance</Label>\n                                    <Select\n                                        value={formData.role_inheritance_mode}\n                                        onValueChange={v => setFormData({ ...formData, role_inheritance_mode: v })}\n                                    >\n                                        <SelectTrigger className=\"bg-background border-input\"><SelectValue /></SelectTrigger>\n                                        <SelectContent>\n                                            <SelectItem value=\"auto\">Auto Inherit</SelectItem>\n                                            <SelectItem value=\"linked\">Linked Only</SelectItem>\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                            </div>\n                            {formData.role_inheritance_mode === 'linked' && formData.parent_tenant_id && (\n                                <div className=\"pt-4 border-t border-border\">\n                                    <h4 className=\"text-sm font-semibold text-foreground mb-3\">Linked Roles</h4>\n                                    {roleLinksLoading ? (\n                                        <div className=\"text-xs text-muted-foreground\">Loading role links...</div>\n                                    ) : (\n                                        <div className=\"space-y-2\">\n                                            {roleLinks.map(link => (\n                                                <div key={link.parent_role_id} className=\"flex items-center gap-2\">\n                                                    <Checkbox\n                                                        checked={link.linked}\n                                                        disabled={!link.child_role_id}\n                                                        onCheckedChange={value => setRoleLinks(prev => prev.map(item => item.parent_role_id === link.parent_role_id ? { ...item, linked: Boolean(value) } : item))}\n                                                    />\n                                                    <span className=\"text-sm text-foreground\">\n                                                        {link.name}\n                                                    </span>\n                                                    {!link.child_role_id && (\n                                                        <span className=\"text-xs text-muted-foreground\">Missing child role</span>\n                                                    )}\n                                                </div>\n                                            ))}\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"grid gap-2\">\n                                    <Label>Status</Label>\n                                    <Select value={formData.status} onValueChange={v => setFormData({ ...formData, status: v })}>\n                                        <SelectTrigger className=\"bg-background border-input\"><SelectValue /></SelectTrigger>\n                                        <SelectContent>\n                                            <SelectItem value=\"active\">Active</SelectItem>\n                                            <SelectItem value=\"suspended\">Suspended</SelectItem>\n                                            <SelectItem value=\"archived\">Archived</SelectItem>\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                                <div className=\"grid gap-2\">\n                                    <Label>Subscription</Label>\n                                    <Select value={formData.subscription_tier} onValueChange={v => setFormData({ ...formData, subscription_tier: v })}>\n                                        <SelectTrigger className=\"bg-background border-input\"><SelectValue /></SelectTrigger>\n                                        <SelectContent>\n                                            <SelectItem value=\"free\">Free</SelectItem>\n                                            <SelectItem value=\"pro\">Pro</SelectItem>\n                                            <SelectItem value=\"enterprise\">Enterprise</SelectItem>\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                            </div>\n\n                            {/* Billing Section */}\n                            <div className=\"pt-4 border-t border-border\">\n                                <h4 className=\"text-sm font-semibold text-foreground mb-3 flex items-center gap-2\">\n                                    <DollarSign className=\"w-4 h-4 text-muted-foreground\" /> Billing Information\n                                </h4>\n                                <div className=\"grid grid-cols-4 gap-4\">\n                                    <div className=\"grid gap-2\">\n                                        <Label>Expiry Date</Label>\n                                        <Input\n                                            type=\"date\"\n                                            value={formData.subscription_expires_at}\n                                            onChange={e => setFormData({ ...formData, subscription_expires_at: e.target.value })}\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label>Amount</Label>\n                                        <Input\n                                            type=\"number\"\n                                            value={formData.billing_amount}\n                                            onChange={e => setFormData({ ...formData, billing_amount: e.target.value })}\n                                            placeholder=\"99.00\"\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label>Currency</Label>\n                                        <Select value={formData.currency} onValueChange={v => setFormData({ ...formData, currency: v })}>\n                                            <SelectTrigger className=\"bg-background border-input\"><SelectValue /></SelectTrigger>\n                                            <SelectContent>\n                                                <SelectItem value=\"IDR\">IDR (Rupiah)</SelectItem>\n                                                <SelectItem value=\"USD\">USD (Dollar)</SelectItem>\n                                                <SelectItem value=\"EUR\">EUR (Euro)</SelectItem>\n                                                <SelectItem value=\"SGD\">SGD (Singapore)</SelectItem>\n                                                <SelectItem value=\"MYR\">MYR (Ringgit)</SelectItem>\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label>Cycle</Label>\n                                        <Select value={formData.billing_cycle} onValueChange={v => setFormData({ ...formData, billing_cycle: v })}>\n                                            <SelectTrigger className=\"bg-background border-input\"><SelectValue /></SelectTrigger>\n                                            <SelectContent>\n                                                <SelectItem value=\"monthly\">Monthly</SelectItem>\n                                                <SelectItem value=\"yearly\">Yearly</SelectItem>\n                                                <SelectItem value=\"custom\">Custom</SelectItem>\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                </div>\n\n                                {/* Locale / Language */}\n                                <div className=\"grid gap-2 mt-4\">\n                                    <Label className=\"flex items-center gap-1\"><Globe className=\"w-3 h-3 text-muted-foreground\" /> Default Language</Label>\n                                    <Select value={formData.locale} onValueChange={v => setFormData({ ...formData, locale: v })}>\n                                        <SelectTrigger className=\"max-w-[200px] bg-background border-input\"><SelectValue /></SelectTrigger>\n                                        <SelectContent>\n                                            <SelectItem value=\"id\"> Bahasa Indonesia</SelectItem>\n                                            <SelectItem value=\"en\"> English</SelectItem>\n                                            <SelectItem value=\"zh\">  (Chinese)</SelectItem>\n                                            <SelectItem value=\"ja\">  (Japanese)</SelectItem>\n                                            <SelectItem value=\"ko\">  (Korean)</SelectItem>\n                                            <SelectItem value=\"ar\">  (Arabic)</SelectItem>\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                            </div>\n\n                            {/* Resource Sharing Section */}\n                            <div className=\"pt-4 border-t border-border\">\n                                <h4 className=\"text-sm font-semibold text-foreground mb-3 flex items-center gap-2\">\n                                    <Building className=\"w-4 h-4 text-muted-foreground\" /> Resource Sharing\n                                </h4>\n                                <p className=\"text-xs text-muted-foreground mb-3\">\n                                    Configure which resources are shared across tenant levels. Shared resources allow read/write access for tenant admins.\n                                </p>\n                                {rulesLoading ? (\n                                    <div className=\"text-xs text-muted-foreground\">Loading resource rules...</div>\n                                ) : !hasRegistry ? (\n                                    <div className=\"text-xs text-muted-foreground\">Resource registry not available.</div>\n                                ) : (\n                                    <div className=\"space-y-3\">\n                                        {resourceRules.map(rule => (\n                                            <div key={rule.resource_key} className=\"grid grid-cols-[1fr_160px_160px] gap-3 items-center\">\n                                                <div>\n                                                    <div className=\"text-sm font-medium text-foreground\">{rule.resource_key}</div>\n                                                    {rule.description && (\n                                                        <div className=\"text-xs text-muted-foreground\">{rule.description}</div>\n                                                    )}\n                                                </div>\n                                                <Select\n                                                    value={rule.share_mode}\n                                                    onValueChange={value => setResourceRules(prev => prev.map(item => item.resource_key === rule.resource_key ? { ...item, share_mode: value } : item))}\n                                                >\n                                                    <SelectTrigger className=\"bg-background border-input\"><SelectValue /></SelectTrigger>\n                                                    <SelectContent>\n                                                        <SelectItem value=\"isolated\">Isolated</SelectItem>\n                                                        <SelectItem value=\"shared_descendants\">Share to Descendants</SelectItem>\n                                                        <SelectItem value=\"shared_ancestors\">Share to Ancestors</SelectItem>\n                                                        <SelectItem value=\"shared_all\">Share All Levels</SelectItem>\n                                                    </SelectContent>\n                                                </Select>\n                                                <Select\n                                                    value={rule.access_mode}\n                                                    onValueChange={value => setResourceRules(prev => prev.map(item => item.resource_key === rule.resource_key ? { ...item, access_mode: value } : item))}\n                                                >\n                                                    <SelectTrigger className=\"bg-background border-input\"><SelectValue /></SelectTrigger>\n                                                    <SelectContent>\n                                                        <SelectItem value=\"read\">Read Only</SelectItem>\n                                                        <SelectItem value=\"write\">Write Only</SelectItem>\n                                                        <SelectItem value=\"read_write\">Read & Write</SelectItem>\n                                                    </SelectContent>\n                                                </Select>\n                                            </div>\n                                        ))}\n                                    </div>\n                                )}\n                            </div>\n\n                            {/* Contact & Notes */}\n                            <div className=\"pt-4 border-t border-border\">\n                                <h4 className=\"text-sm font-semibold text-foreground mb-3 flex items-center gap-2\">\n                                    <FileText className=\"w-4 h-4 text-muted-foreground\" /> Administrative Notes\n                                </h4>\n                                <div className=\"grid gap-4\">\n                                    <div className=\"grid gap-2\">\n                                        <Label className=\"flex items-center gap-1\"><Mail className=\"w-3 h-3 text-muted-foreground\" /> Contact Email</Label>\n                                        <Input\n                                            type=\"email\"\n                                            value={formData.contact_email}\n                                            onChange={e => setFormData({ ...formData, contact_email: e.target.value })}\n                                            placeholder=\"admin@tenant.com\"\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label>Notes</Label>\n                                        <textarea\n                                            value={formData.notes}\n                                            onChange={e => setFormData({ ...formData, notes: e.target.value })}\n                                            placeholder=\"Internal notes about this tenant...\"\n                                            className=\"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Channel Domains Section */}\n                            <div className=\"pt-4 border-t border-border\">\n                                <h4 className=\"text-sm font-semibold text-foreground mb-3 flex items-center gap-2\">\n                                    <Radio className=\"w-4 h-4 text-muted-foreground\" /> Channel Domains\n                                </h4>\n                                <p className=\"text-xs text-muted-foreground mb-3\">Configure domain mappings for each channel.</p>\n                                <div className=\"space-y-3\">\n                                    <div className=\"grid grid-cols-[120px_1fr] gap-2 items-center\">\n                                        <Label className=\"text-xs font-medium\">Web Public</Label>\n                                        <Input\n                                            value={channelDomains.web_public}\n                                            onChange={e => setChannelDomains({ ...channelDomains, web_public: e.target.value })}\n                                            placeholder=\"primarypublic.example.com\"\n                                            className=\"text-sm\"\n                                        />\n                                    </div>\n                                    <div className=\"grid grid-cols-[120px_1fr] gap-2 items-center\">\n                                        <Label className=\"text-xs font-medium\">Mobile</Label>\n                                        <Input\n                                            value={channelDomains.mobile}\n                                            onChange={e => setChannelDomains({ ...channelDomains, mobile: e.target.value })}\n                                            placeholder=\"primarymobile.example.com\"\n                                            className=\"text-sm\"\n                                        />\n                                    </div>\n                                    <div className=\"grid grid-cols-[120px_1fr] gap-2 items-center\">\n                                        <Label className=\"text-xs font-medium\">ESP32</Label>\n                                        <Input\n                                            value={channelDomains.esp32}\n                                            onChange={e => setChannelDomains({ ...channelDomains, esp32: e.target.value })}\n                                            placeholder=\"primaryesp32.example.com\"\n                                            className=\"text-sm\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <DialogFooter className=\"pt-4 border-t\">\n                        <Button variant=\"outline\" onClick={() => setShowEditor(false)}>Cancel</Button>\n                        <Button onClick={handleSave} disabled={loading}>Save Changes</Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            {/* Delete Confirmation */}\n            <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Delete Tenant?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Are you sure you want to delete <strong>{tenantToDelete?.name}</strong>? This action cannot be undone.\n                            If the tenant has associated users or data, deletion might fail.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={handleDelete} className=\"bg-red-600 hover:bg-red-700\">Delete</AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </AdminPageLayout>\n    );\n}\n\nexport default TenantsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/TestimonyManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Star, MessageSquareQuote } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction TestimonyManager() {\n    const columns = [\n        { key: 'author_name', label: 'Author' },\n        { key: 'title', label: 'Title' },\n        { key: 'category_id', label: 'Category', type: 'relation', relationTable: 'categories', relationLabel: 'name' },\n        {\n            key: 'rating',\n            label: 'Rating',\n            render: (value) => (\n                <div className=\"flex text-yellow-500 dark:text-yellow-400\">\n                    {[...Array(5)].map((_, i) => (\n                        <Star key={i} className={`w-3 h-3 ${i < (value || 0) ? 'fill-current' : 'text-muted/30'}`} />\n                    ))}\n                </div>\n            )\n        },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'published' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'pending' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n                        'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'pending'}\n                </span>\n            )\n        },\n        {\n            key: 'published_at',\n            label: 'Publish Date',\n            type: 'date',\n            render: (value) => value ? new Date(value).toLocaleDateString() : '-'\n        }\n    ];\n\n    const formFields = [\n        { key: 'title', label: 'Title/Headline', required: true, description: 'E.g. \"Great Service!\"' },\n        { key: 'slug', label: 'Slug', required: false, description: 'Auto-generated if empty' },\n        { key: 'author_name', label: 'Author Name', required: true },\n        { key: 'author_position', label: 'Position/Company' },\n        { key: 'author_image', label: 'Author Photo', type: 'image', description: 'Upload or select from Media Library' },\n        { key: 'content', label: 'Testimony', type: 'richtext', required: true },\n        { key: 'category_id', label: 'Category', type: 'resource_select', resourceTable: 'categories', filter: { type: 'testimony' } },\n        { key: 'rating', label: 'Rating (1-5)', type: 'number', required: true },\n        { key: 'published_at', label: 'Publish Date', type: 'datetime' },\n        {\n            key: 'status', label: 'Status', type: 'select', options: [\n                { value: 'pending', label: 'Pending' },\n                { value: 'published', label: 'Published' }\n            ]\n        }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.testimonies.read\">\n            <PageHeader\n                title=\"Testimonies\"\n                description=\"Manage customer reviews and testimonials.\"\n                icon={MessageSquareQuote}\n                breadcrumbs={[{ label: 'Testimonies', icon: MessageSquareQuote }]}\n            />\n\n            <GenericContentManager\n                tableName=\"testimonies\"\n                resourceName=\"Testimonial\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"testimonies\"\n                showBreadcrumbs={false}\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default TestimonyManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ThemeEditor.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ThemeLayoutManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useMemo, useCallback } from 'react';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Layout, Globe, FileType, AlertTriangle, PanelTop, PanelBottom, Pencil } from 'lucide-react';\nimport GenericContentManager from './GenericContentManager';\nimport VisualPageBuilder from '@/components/visual-builder/VisualPageBuilder';\nimport { Button } from '@/components/ui/button';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\n/**\n * ThemeLayoutManager\n * Manages system templates like Homepage, Header, Footer, etc.\n */\nconst ThemeLayoutManager = () => {\n    const [visualBuilderOpen, setVisualBuilderOpen] = useState(false);\n    const [selectedPage, setSelectedPage] = useState(null);\n\n    const handleOpenVisualBuilder = useCallback((page) => {\n        setSelectedPage(page);\n        setVisualBuilderOpen(true);\n    }, []);\n\n    const handleCloseVisualBuilder = useCallback(() => {\n        setVisualBuilderOpen(false);\n        setSelectedPage(null);\n    }, []);\n\n    const columns = useMemo(() => [\n        { key: 'title', label: 'Template Name', className: 'font-medium' },\n        {\n            key: 'page_type',\n            label: 'Type',\n            render: (value) => {\n                const labels = {\n                    homepage: 'Homepage',\n                    header: 'Header',\n                    footer: 'Footer',\n                    single_page: 'Single Page',\n                    single_post: 'Single Post',\n                    '404': '404 Error',\n                    archive: 'Archive'\n                };\n                return <span className=\"font-semibold text-xs uppercase bg-slate-100 dark:bg-slate-800 dark:text-slate-200 px-2 py-1 rounded\">{labels[value] || value}</span>\n            }\n        },\n        { key: 'status', label: 'Status' },\n        { key: 'updated_at', label: 'Last Updated', type: 'date' }\n    ], []);\n\n    const formFields = useMemo(() => [\n        { key: 'title', label: 'Template Name', required: true },\n        {\n            key: 'page_type',\n            label: 'Template Type',\n            type: 'select',\n            options: [\n                { value: 'homepage', label: 'Homepage' },\n                { value: 'header', label: 'Global Header' },\n                { value: 'footer', label: 'Global Footer' },\n                { value: 'single_page', label: 'Single Page Template' },\n                { value: 'single_post', label: 'Single Post Template' },\n                { value: '404', label: '404 Error Page' },\n                { value: 'archive', label: 'Archive Template' }\n            ],\n            required: true\n        },\n        { key: 'slug', label: 'System Slug', description: 'Unique identifier (e.g. system-header-v1)', required: true },\n        { key: 'status', label: 'Status', type: 'select', options: [{ value: 'published', label: 'Active' }, { value: 'draft', label: 'Draft' }] },\n        { key: 'editor_type', label: 'Editor', type: 'hidden', defaultValue: 'visual' },\n        { key: 'is_active', label: 'Active', type: 'boolean', defaultValue: true }\n    ], []);\n\n    // Custom row action to launch Visual Page Builder\n    const visualEditorAction = useCallback((item) => (\n        <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={() => handleOpenVisualBuilder(item)}\n            className=\"text-purple-600 border-purple-200 hover:bg-purple-50\"\n            title=\"Open in Visual Editor\"\n        >\n            <Pencil className=\"w-4 h-4 mr-1\" />\n            Visual Editor\n        </Button>\n    ), [handleOpenVisualBuilder]);\n\n    // Helper to render manager for specific type\n    const renderManager = useCallback((type, icon, title) => (\n        <GenericContentManager\n            tableName=\"pages\"\n            resourceName={title}\n            columns={columns}\n            formFields={formFields.map(f => f.key === 'page_type' ? { ...f, defaultValue: type } : f)}\n            permissionPrefix=\"visual_pages\"\n            defaultFilters={{ page_type: type, editor_type: 'visual' }}\n            customRowActions={visualEditorAction}\n            // Custom instructions\n            headerContent={\n                <div className=\"bg-blue-50 border border-blue-100 rounded-lg p-3 mb-4 flex items-start gap-2 text-sm text-blue-700\">\n                    {icon}\n                    <div>\n                        <strong>Managing {title}</strong>\n                        <p className=\"mt-1 opacity-90\">\n                            Only the <strong>Published</strong> template of this type will be used by the system.\n                            Ensure you have exactly one published item if you want it to be active.\n                        </p>\n                    </div>\n                </div>\n            }\n        />\n    ), [columns, formFields, visualEditorAction]);\n\n    // If Visual Builder is open, render it full-screen\n    if (visualBuilderOpen && selectedPage) {\n        return (\n            <VisualPageBuilder\n                page={selectedPage}\n                onClose={handleCloseVisualBuilder}\n                onSuccess={handleCloseVisualBuilder}\n            />\n        );\n    }\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.visual_pages.read\">\n            <PageHeader\n                title=\"Theme Layouts\"\n                description=\"Manage system templates for homepage, header, footer, and more.\"\n                icon={Layout}\n                breadcrumbs={[{ label: 'Theme Layouts', icon: Layout }]}\n            />\n\n            <Tabs defaultValue=\"homepage\" className=\"w-full\">\n                <TabsList className=\"grid grid-cols-3 lg:grid-cols-6 mb-6 h-auto\">\n                    <TabsTrigger value=\"homepage\" className=\"flex flex-col gap-1 py-3\"><Globe className=\"w-4 h-4\" /> Homepage</TabsTrigger>\n                    <TabsTrigger value=\"header\" className=\"flex flex-col gap-1 py-3\"><PanelTop className=\"w-4 h-4\" /> Header</TabsTrigger>\n                    <TabsTrigger value=\"footer\" className=\"flex flex-col gap-1 py-3\"><PanelBottom className=\"w-4 h-4\" /> Footer</TabsTrigger>\n                    <TabsTrigger value=\"single\" className=\"flex flex-col gap-1 py-3\"><FileType className=\"w-4 h-4\" /> Singles</TabsTrigger>\n                    <TabsTrigger value=\"404\" className=\"flex flex-col gap-1 py-3\"><AlertTriangle className=\"w-4 h-4\" /> 404 Ops</TabsTrigger>\n                    <TabsTrigger value=\"archive\" className=\"flex flex-col gap-1 py-3\"><Layout className=\"w-4 h-4\" /> Archive</TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"homepage\">{renderManager('homepage', <Globe className=\"w-5 h-5\" />, 'Homepage')}</TabsContent>\n                <TabsContent value=\"header\">{renderManager('header', <PanelTop className=\"w-5 h-5\" />, 'Global Header')}</TabsContent>\n                <TabsContent value=\"footer\">{renderManager('footer', <PanelBottom className=\"w-5 h-5\" />, 'Global Footer')}</TabsContent>\n\n                <TabsContent value=\"single\">\n                    <div className=\"grid gap-8\">\n                        <div>\n                            <h3 className=\"text-lg font-semibold mb-3 flex items-center gap-2\"><FileType className=\"w-5 h-5\" /> Single Page Template</h3>\n                            {renderManager('single_page', null, 'Single Page Template')}\n                        </div>\n                        <div className=\"border-t pt-6\">\n                            <h3 className=\"text-lg font-semibold mb-3 flex items-center gap-2\"><FileType className=\"w-5 h-5\" /> Single Post Template</h3>\n                            {renderManager('single_post', null, 'Single Post Template')}\n                        </div>\n                    </div>\n                </TabsContent>\n\n                <TabsContent value=\"404\">{renderManager('404', <AlertTriangle className=\"w-5 h-5\" />, '404 Page')}</TabsContent>\n                <TabsContent value=\"archive\">{renderManager('archive', <Layout className=\"w-5 h-5\" />, 'Archive Template')}</TabsContent>\n            </Tabs>\n        </AdminPageLayout>\n    );\n};\n\nexport default ThemeLayoutManager;\n\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/ThemesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":137,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":137,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[5771,5774],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'created_at' is assigned a value but never used.","line":137,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":137,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"created_at"},"fix":{"range":[5773,5785],"text":""},"desc":"Remove unused variable 'created_at'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updated_at' is assigned a value but never used.","line":137,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":137,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"updated_at"},"fix":{"range":[5785,5797],"text":""},"desc":"Remove unused variable 'updated_at'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState, useCallback } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useNavigate } from 'react-router-dom';\nimport { Palette, Plus, Edit, Check, Trash2, Power, Copy, Download, Upload, Search, MoreVertical, LayoutTemplate } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useToast } from '@/components/ui/use-toast';\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuLabel,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { shadcnHslToHex } from '@/lib/themeUtils';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nconst MiniThemePreview = ({ config, isActive }) => {\n    const primary = shadcnHslToHex(config?.colors?.primary) || '#3b82f6';\n    const bg = shadcnHslToHex(config?.colors?.background) || '#ffffff';\n    const card = shadcnHslToHex(config?.colors?.card) || '#ffffff';\n    const text = shadcnHslToHex(config?.colors?.foreground) || '#000000';\n    const secondary = shadcnHslToHex(config?.colors?.secondary) || '#f1f5f9';\n\n    return (\n        <div className=\"w-full h-32 rounded-t-lg relative overflow-hidden border-b border-slate-100\" style={{ backgroundColor: bg }}>\n            <div className=\"h-6 w-full flex items-center px-3 gap-2 border-b border-black/5\" style={{ backgroundColor: bg }}>\n                <div className=\"w-12 h-2 rounded-full opacity-80\" style={{ backgroundColor: primary }}></div>\n                <div className=\"flex-1\"></div>\n                <div className=\"w-4 h-4 rounded-full opacity-50\" style={{ backgroundColor: secondary }}></div>\n            </div>\n\n            <div className=\"p-3 flex gap-2 h-full\">\n                <div className=\"w-1/4 h-20 rounded opacity-50 hidden sm:block\" style={{ backgroundColor: secondary }}></div>\n                <div className=\"flex-1 flex flex-col gap-2\">\n                    <div className=\"w-3/4 h-3 rounded opacity-80\" style={{ backgroundColor: text }}></div>\n                    <div className=\"w-1/2 h-2 rounded opacity-40\" style={{ backgroundColor: text }}></div>\n                    <div className=\"mt-2 p-2 rounded border border-black/5 shadow-sm\" style={{ backgroundColor: card }}>\n                        <div className=\"w-8 h-8 rounded mb-1 opacity-90\" style={{ backgroundColor: primary }}></div>\n                        <div className=\"w-full h-1.5 rounded opacity-30 mb-1\" style={{ backgroundColor: text }}></div>\n                        <div className=\"w-2/3 h-1.5 rounded opacity-30\" style={{ backgroundColor: text }}></div>\n                    </div>\n                </div>\n            </div>\n\n            {isActive && (\n                <div className=\"absolute top-2 right-2 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1\">\n                    <Check className=\"w-3 h-3\" /> ACTIVE\n                </div>\n            )}\n        </div>\n    );\n};\n\nconst ThemesManager = () => {\n    const navigate = useNavigate();\n    const { toast } = useToast();\n    const [themes, setThemes] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [searchTerm, setSearchTerm] = useState('');\n    const [themeToDelete, setThemeToDelete] = useState(null);\n\n    const { hasPermission, isPlatformAdmin } = usePermissions();\n\n    const fetchThemes = useCallback(async () => {\n        setLoading(true);\n        const { data, error } = await supabase\n            .from('themes')\n            .select('*, tenant:tenants(name)')\n            .is('deleted_at', null)\n            .order('is_active', { ascending: false })\n            .order('created_at', { ascending: false });\n\n        if (error) {\n            toast({ title: \"Error\", description: \"Failed to load themes\", variant: \"destructive\" });\n        } else {\n            setThemes(data || []);\n        }\n        setLoading(false);\n    }, [toast]);\n\n    useEffect(() => {\n        fetchThemes();\n    }, [fetchThemes]);\n\n    const handleActivate = async (id) => {\n        if (!hasPermission('tenant.setting.update')) {\n            toast({ title: \"Access Denied\", description: \"Permission required.\", variant: \"destructive\" });\n            return;\n        }\n        try {\n            const { error } = await supabase\n                .from('themes')\n                .update({ is_active: true })\n                .eq('id', id);\n\n            if (error) throw error;\n            toast({ title: \"Theme Activated\", description: \"New theme is now live!\" });\n            fetchThemes();\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n        }\n    };\n\n    const handleDelete = async () => {\n        if (!themeToDelete) return;\n        try {\n            const { error } = await supabase\n                .from('themes')\n                .update({ deleted_at: new Date().toISOString() })\n                .eq('id', themeToDelete);\n\n            if (error) throw error;\n            toast({ title: \"Deleted\", description: \"Theme moved to trash.\" });\n            setThemeToDelete(null);\n            fetchThemes();\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n        }\n    };\n\n    const handleDuplicate = async (theme) => {\n        // Let DB handle ID generation by not including 'id'\n        const { id, created_at, updated_at, ...rest } = theme;\n        const newTheme = {\n            ...rest,\n            is_active: false,\n            name: `${theme.name} (Copy)`,\n            slug: `${theme.slug}-copy-${Date.now()}`\n        };\n\n        const { error } = await supabase.from('themes').insert([newTheme]);\n        if (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n        } else {\n            toast({ title: \"Success\", description: \"Theme duplicated.\" });\n            fetchThemes();\n        }\n    };\n\n    const handleExport = (theme) => {\n        const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(theme.config));\n        const downloadAnchorNode = document.createElement('a');\n        downloadAnchorNode.setAttribute(\"href\", dataStr);\n        downloadAnchorNode.setAttribute(\"download\", `${theme.slug || 'theme'}.json`);\n        document.body.appendChild(downloadAnchorNode);\n        downloadAnchorNode.click();\n        downloadAnchorNode.remove();\n    };\n\n    const handleImport = (event) => {\n        const fileReader = new FileReader();\n        const file = event.target.files[0];\n        if (!file) return;\n\n        fileReader.readAsText(file, \"UTF-8\");\n        fileReader.onload = async (e) => {\n            try {\n                const importedConfig = JSON.parse(e.target.result);\n                if (!importedConfig.colors) throw new Error(\"Invalid theme file: missing colors\");\n\n                const { error } = await supabase.from('themes').insert([{\n                    name: `Imported Theme ${new Date().toLocaleDateString()}`,\n                    slug: `imported-${Date.now()}`,\n                    description: \"Imported from JSON file\",\n                    is_active: false,\n                    config: importedConfig\n                }]);\n\n                if (error) throw error;\n                toast({ title: \"Success\", description: \"Theme imported successfully.\" });\n                fetchThemes();\n            } catch (err) {\n                toast({ title: \"Import Failed\", description: err.message, variant: \"destructive\" });\n            }\n        };\n    };\n\n    const handleCreate = async () => {\n        // We explicitly generate an ID client-side as a fallback, \n        // although the DB default should now handle it.\n        const fallbackId = crypto.randomUUID();\n\n        const defaultTheme = {\n            id: fallbackId,\n            name: \"New Theme\",\n            slug: \"new-theme-\" + Date.now(),\n            description: \"A fresh start.\",\n            is_active: false,\n            config: {\n                colors: {\n                    background: \"0 0% 100%\",\n                    foreground: \"222.2 84% 4.9%\",\n                    primary: \"221.2 83.2% 53.3%\",\n                    primaryForeground: \"210 40% 98%\",\n                    border: \"214.3 31.8% 91.4%\",\n                    card: \"0 0% 100%\",\n                    cardForeground: \"222.2 84% 4.9%\",\n                    secondary: \"210 40% 96.1%\",\n                    secondaryForeground: \"222.2 47.4% 11.2%\",\n                    muted: \"210 40% 96.1%\",\n                    mutedForeground: \"215.4 16.3% 46.9%\",\n                    accent: \"210 40% 96.1%\",\n                    destructive: \"0 84.2% 60.2%\",\n                    input: \"214.3 31.8% 91.4%\",\n                    ring: \"221.2 83.2% 53.3%\"\n                },\n                fonts: { heading: 'Inter, sans-serif', body: 'Inter, sans-serif' },\n                radius: 0.5\n            }\n        };\n\n        const { data, error } = await supabase\n            .from('themes')\n            .insert([defaultTheme])\n            .select()\n            .single();\n\n        if (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n        } else {\n            // Navigate to the new theme (using the returned ID or our fallback)\n            navigate(`/cmspanel/themes/${data?.id || fallbackId}`);\n        }\n    };\n\n    const filteredThemes = themes.filter(t =>\n        t.name.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.setting.read\">\n            <PageHeader\n                title=\"Theme Gallery\"\n                description=\"Manage, customize, and activate visual themes for your site.\"\n                icon={Palette}\n                breadcrumbs={[{ label: 'Themes', icon: Palette }]}\n                actions={\n                    <div className=\"flex gap-2 w-full sm:w-auto\">\n                        <div className=\"relative\">\n                            <input\n                                type=\"file\"\n                                accept=\".json\"\n                                className=\"absolute inset-0 opacity-0 cursor-pointer w-full\"\n                                onChange={handleImport}\n                                disabled={!hasPermission('tenant.setting.update')}\n                            />\n                            <Button variant=\"outline\" className=\"w-full sm:w-auto\">\n                                <Upload className=\"w-4 h-4 mr-2\" /> Import\n                            </Button>\n                        </div>\n\n                        {hasPermission('tenant.setting.update') && (\n                            <Button onClick={handleCreate} className=\"w-full sm:w-auto\">\n                                <Plus className=\"w-4 h-4 mr-2\" /> New Theme\n                            </Button>\n                        )}\n                    </div>\n                }\n            />\n\n            {/* Search Bar */}\n            <div className=\"relative max-w-md\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                <Input\n                    placeholder=\"Search themes...\"\n                    className=\"pl-9 bg-background\"\n                    value={searchTerm}\n                    onChange={e => setSearchTerm(e.target.value)}\n                />\n            </div>\n\n            {/* Grid Layout */}\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                {loading ? (\n                    [...Array(4)].map((_, i) => (\n                        <div key={i} className=\"h-64 bg-muted/50 rounded-xl animate-pulse\"></div>\n                    ))\n                ) : filteredThemes.length === 0 ? (\n                    <div className=\"col-span-full py-20 text-center text-muted-foreground bg-card rounded-xl border border-dashed border-border\">\n                        <LayoutTemplate className=\"w-12 h-12 mx-auto mb-4 opacity-20\" />\n                        <p>No themes found matching your search.</p>\n                    </div>\n                ) : (\n                    filteredThemes.map(theme => (\n                        <div key={theme.id} className={`group bg-card rounded-xl border transition-all duration-200 overflow-hidden flex flex-col ${theme.is_active ? 'border-primary shadow-md ring-1 ring-primary' : 'border-border hover:border-primary/50 hover:shadow-lg'}`}>\n\n                            <MiniThemePreview config={theme.config} isActive={theme.is_active} />\n\n                            <div className=\"p-4 flex-1 flex flex-col\">\n                                <div className=\"flex justify-between items-start mb-2\">\n                                    <div>\n                                        <h3 className=\"font-semibold text-foreground truncate pr-2\" title={theme.name}>{theme.name}</h3>\n                                        {isPlatformAdmin && (\n                                            <span className=\"text-xs font-medium text-slate-600 bg-slate-100 px-2 py-0.5 rounded\">\n                                                {theme.tenant?.name || '(Unknown Tenant)'}\n                                            </span>\n                                        )}\n                                        <p className=\"text-xs text-muted-foreground line-clamp-2 min-h-[2.5em] mt-1\">{theme.description || 'No description provided.'}</p>\n                                    </div>\n\n                                    <DropdownMenu>\n                                        <DropdownMenuTrigger asChild>\n                                            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                                                <MoreVertical className=\"w-4 h-4 text-muted-foreground\" />\n                                            </Button>\n                                        </DropdownMenuTrigger>\n                                        <DropdownMenuContent align=\"end\">\n                                            <DropdownMenuLabel>Actions</DropdownMenuLabel>\n                                            <DropdownMenuSeparator />\n                                            <DropdownMenuItem onClick={() => handleExport(theme)}>\n                                                <Download className=\"w-4 h-4 mr-2\" /> Export JSON\n                                            </DropdownMenuItem>\n                                            {hasPermission('tenant.setting.update') && (\n                                                <DropdownMenuItem onClick={() => handleDuplicate(theme)}>\n                                                    <Copy className=\"w-4 h-4 mr-2\" /> Duplicate\n                                                </DropdownMenuItem>\n                                            )}\n                                            <DropdownMenuSeparator />\n                                            {hasPermission('tenant.setting.update') && (\n                                                <DropdownMenuItem\n                                                    onClick={() => setThemeToDelete(theme.id)}\n                                                    className=\"text-destructive focus:text-destructive focus:bg-destructive/10\"\n                                                    disabled={theme.is_active}\n                                                >\n                                                    <Trash2 className=\"w-4 h-4 mr-2\" /> Delete\n                                                </DropdownMenuItem>\n                                            )}\n                                        </DropdownMenuContent>\n                                    </DropdownMenu>\n                                </div>\n\n                                <div className=\"mt-auto pt-4 flex gap-2\">\n                                    {hasPermission('tenant.setting.update') && (\n                                        <Button\n                                            variant=\"outline\"\n                                            size=\"sm\"\n                                            className=\"flex-1\"\n                                            onClick={() => navigate(`/cmspanel/themes/edit/${theme.id}`)}\n                                        >\n                                            <Edit className=\"w-3.5 h-3.5 mr-1.5\" /> Customize\n                                        </Button>\n                                    )}\n\n                                    {!theme.is_active && hasPermission('tenant.setting.update') && (\n                                        <Button\n                                            size=\"sm\"\n                                            className=\"flex-1\"\n                                            onClick={() => handleActivate(theme.id)}\n                                        >\n                                            <Power className=\"w-3.5 h-3.5 mr-1.5\" /> Activate\n                                        </Button>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n                    ))\n                )}\n            </div>\n\n            <AlertDialog open={!!themeToDelete} onOpenChange={(open) => !open && setThemeToDelete(null)}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            This will move the theme to trash. You can restore it later if needed.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={handleDelete} className=\"bg-red-600 hover:bg-red-700\">Move to Trash</AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </AdminPageLayout>\n    );\n};\n\nexport default ThemesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/TwoFactorSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { Shield, Smartphone, Lock, CheckCircle2, AlertTriangle, Copy, Check } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { useTwoFactor } from '@/hooks/useTwoFactor';\n\nfunction TwoFactorSettings() {\n  const { isEnabled, isLoading, setupData, startSetup, verifyAndEnable, disable2FA } = useTwoFactor();\n  const { toast } = useToast();\n  const [setupStep, setSetupStep] = useState(0); // 0: Idle, 1: QR, 2: Backup Codes\n  const [verificationCode, setVerificationCode] = useState('');\n  const [isVerifying, setIsVerifying] = useState(false);\n  const [showDisableDialog, setShowDisableDialog] = useState(false);\n  const [copiedCodes, setCopiedCodes] = useState(false);\n\n  const handleStartSetup = async () => {\n    const result = await startSetup();\n    if (result.success) {\n      setSetupStep(1);\n    } else {\n      toast({\n        variant: \"destructive\",\n        title: \"Setup Failed\",\n        description: result.error\n      });\n    }\n  };\n\n  const handleVerify = async () => {\n    if (verificationCode.length !== 6) return;\n\n    setIsVerifying(true);\n    const result = await verifyAndEnable(verificationCode);\n    setIsVerifying(false);\n\n    if (result.success) {\n      setSetupStep(2); // Move to backup codes\n      toast({\n        title: \"2FA Enabled\",\n        description: \"Two-factor authentication is now active.\"\n      });\n    } else {\n      toast({\n        variant: \"destructive\",\n        title: \"Verification Failed\",\n        description: result.error || \"Invalid code. Please try again.\"\n      });\n    }\n  };\n\n  const handleDisable = async () => {\n    const result = await disable2FA();\n    if (result.success) {\n      setShowDisableDialog(false);\n      setSetupStep(0);\n      toast({\n        title: \"2FA Disabled\",\n        description: \"Two-factor authentication has been turned off.\"\n      });\n    } else {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: result.error\n      });\n    }\n  };\n\n  const copyBackupCodes = () => {\n    if (setupData?.backupCodes) {\n      navigator.clipboard.writeText(setupData.backupCodes.join('\\n'));\n      setCopiedCodes(true);\n      setTimeout(() => setCopiedCodes(false), 2000);\n      toast({ title: \"Copied!\", description: \"Backup codes copied to clipboard.\" });\n    }\n  };\n\n  if (isLoading) {\n    return <div className=\"p-4 text-center text-slate-500 dark:text-slate-400\">Checking 2FA status...</div>;\n  }\n\n  return (\n    <div className=\"dashboard-surface dashboard-surface-hover overflow-hidden\">\n      <div className=\"flex items-center gap-3 border-b border-slate-200/60 bg-slate-50/70 px-6 py-5 dark:border-slate-800/70 dark:bg-slate-900/60\">\n        <div className={`p-2 rounded-lg ${isEnabled ? 'bg-green-100/70 text-green-600 dark:bg-green-900/30 dark:text-green-300' : 'bg-slate-100/70 text-slate-600 dark:bg-slate-800 dark:text-slate-300'}`}>\n          <Shield className=\"w-5 h-5\" />\n        </div>\n        <div>\n          <h3 className=\"font-semibold text-slate-900 dark:text-white\">Two-Factor Authentication</h3>\n          <p className=\"text-xs text-slate-500 dark:text-slate-400\">Add an extra layer of security to your account</p>\n        </div>\n        {isEnabled && (\n          <div className=\"ml-auto px-2 py-1 bg-green-100/70 text-green-700 text-xs font-medium rounded-full flex items-center gap-1 border border-green-200/70 dark:bg-green-900/30 dark:text-green-200 dark:border-green-900/40\">\n            <CheckCircle2 className=\"w-3 h-3\" /> Enabled\n          </div>\n        )}\n      </div>\n\n      <div className=\"p-6\">\n        {/* State: Not Enabled */}\n        {!isEnabled && setupStep === 0 && (\n          <div className=\"flex flex-col md:flex-row items-center justify-between gap-6\">\n            <div className=\"space-y-2\">\n              <p className=\"text-slate-600 text-sm dark:text-slate-300\">\n                Protect your account by requiring a code from your mobile device when logging in.\n              </p>\n              <div className=\"flex flex-col gap-2\">\n                <div className=\"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400\">\n                  <CheckCircle2 className=\"w-4 h-4 text-blue-500 dark:text-blue-400\" /> Use Google Authenticator or Authy\n                </div>\n                <div className=\"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400\">\n                  <CheckCircle2 className=\"w-4 h-4 text-blue-500 dark:text-blue-400\" /> Secure your account against password theft\n                </div>\n              </div>\n            </div>\n            <Button onClick={handleStartSetup} className=\"shrink-0 bg-indigo-600 hover:bg-indigo-700 text-white\">\n              Enable 2FA\n            </Button>\n          </div>\n        )}\n\n        {/* State: Setup - Step 1: QR Code */}\n        {!isEnabled && setupStep === 1 && setupData && (\n          <div className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-slate-900 dark:text-slate-100 flex items-center gap-2\">\n                  <span className=\"flex items-center justify-center w-6 h-6 rounded-full bg-slate-100 text-xs border border-slate-200 text-slate-600 dark:bg-slate-800/70 dark:border-slate-700 dark:text-slate-200\">1</span>\n                  Scan QR Code\n                </h4>\n                <p className=\"text-sm text-slate-600 dark:text-slate-300\">\n                  Open your authenticator app (e.g. Google Authenticator) and scan this code.\n                </p>\n                <div className=\"bg-white p-4 border border-slate-200/70 rounded-xl inline-block shadow-sm dark:bg-slate-950/60 dark:border-slate-800/70\">\n                  <img src={setupData.qrCodeUrl} alt=\"2FA QR Code\" className=\"w-40 h-40\" />\n                </div>\n                <div className=\"text-xs text-slate-500 dark:text-slate-400\">\n                  <p className=\"mb-1\">Can&apos;t scan?</p>\n                  <code className=\"bg-slate-100/70 px-2 py-1 rounded text-slate-700 select-all block w-full break-all dark:bg-slate-800/60 dark:text-slate-200\">\n                    {setupData.secret}\n                  </code>\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-slate-900 dark:text-slate-100 flex items-center gap-2\">\n                  <span className=\"flex items-center justify-center w-6 h-6 rounded-full bg-slate-100 text-xs border border-slate-200 text-slate-600 dark:bg-slate-800/70 dark:border-slate-700 dark:text-slate-200\">2</span>\n                  Verify Code\n                </h4>\n                <p className=\"text-sm text-slate-600 dark:text-slate-300\">\n                  Enter the 6-digit code from your app to verify setup.\n                </p>\n                <div className=\"space-y-3\">\n                  <Label htmlFor=\"verificationCode\">Authentication Code</Label>\n                  <Input\n                    id=\"verificationCode\"\n                    placeholder=\"000000\"\n                    value={verificationCode}\n                    onChange={(e) => setVerificationCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\n                    className=\"text-center text-lg tracking-widest font-mono h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60 dark:text-slate-100\"\n                    autoComplete=\"off\"\n                  />\n                  <Button\n                    onClick={handleVerify}\n                    disabled={verificationCode.length !== 6 || isVerifying}\n                    className=\"w-full bg-indigo-600 hover:bg-indigo-700\"\n                  >\n                    {isVerifying ? 'Verifying...' : 'Verify & Enable'}\n                  </Button>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"pt-4 border-t border-slate-200/60 dark:border-slate-800/70\">\n              <Button variant=\"ghost\" onClick={() => setSetupStep(0)} className=\"text-slate-500 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-100 dark:hover:bg-slate-900/40\">\n                Cancel Setup\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* State: Setup - Step 2: Backup Codes */}\n        {isEnabled && setupStep === 2 && setupData && (\n          <div className=\"space-y-6\">\n            <div className=\"bg-green-50 border border-green-200/70 rounded-xl p-4 flex items-start gap-3 dark:bg-green-900/20 dark:border-green-900/40\">\n              <CheckCircle2 className=\"w-5 h-5 text-green-600 mt-0.5 dark:text-green-300\" />\n              <div>\n                <h4 className=\"text-green-800 font-medium dark:text-green-200\">2FA Successfully Enabled!</h4>\n                <p className=\"text-green-700 text-sm mt-1 dark:text-green-200/80\">\n                  Your account is now more secure. Please save these backup codes in a safe place.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"bg-slate-50 border border-slate-200/70 rounded-xl p-6 dark:bg-slate-950/40 dark:border-slate-800/70\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h4 className=\"font-semibold text-slate-800 dark:text-slate-100 flex items-center gap-2\">\n                  <Lock className=\"w-4 h-4 text-slate-500 dark:text-slate-400\" />\n                  Backup Codes\n                </h4>\n                <Button size=\"sm\" variant=\"outline\" onClick={copyBackupCodes}>\n                  {copiedCodes ? <Check className=\"w-4 h-4 mr-2\" /> : <Copy className=\"w-4 h-4 mr-2\" />}\n                  {copiedCodes ? 'Copied' : 'Copy All'}\n                </Button>\n              </div>\n              <div className=\"grid grid-cols-2 gap-3\">\n                {setupData.backupCodes.map((code, idx) => (\n                  <div key={idx} className=\"font-mono text-sm bg-white border border-slate-200/70 px-3 py-2 rounded text-center text-slate-600 dark:bg-slate-900/70 dark:border-slate-800/70 dark:text-slate-200\">\n                    {code}\n                  </div>\n                ))}\n              </div>\n              <p className=\"text-xs text-slate-500 dark:text-slate-400 mt-4 flex items-center gap-2\">\n                <AlertTriangle className=\"w-3 h-3 text-amber-500\" />\n                If you lose your device, these codes are the only way to access your account.\n              </p>\n            </div>\n\n            <div className=\"flex justify-end\">\n              <Button onClick={() => setSetupStep(0)}>I have saved my codes</Button>\n            </div>\n          </div>\n        )}\n\n        {/* State: Enabled (Idle) */}\n        {isEnabled && setupStep === 0 && (\n          <div className=\"flex flex-col gap-4\">\n            <div className=\"p-4 bg-slate-50 rounded-xl border border-slate-200/70 dark:bg-slate-950/40 dark:border-slate-800/70\">\n              <div className=\"flex items-start gap-4\">\n                <div className=\"p-3 bg-white rounded-full border border-slate-200/70 shadow-sm dark:bg-slate-900/70 dark:border-slate-800/70\">\n                  <Smartphone className=\"w-6 h-6 text-slate-400 dark:text-slate-300\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h4 className=\"font-medium text-slate-900 dark:text-slate-100\">Authenticator App</h4>\n                  <p className=\"text-sm text-slate-500 dark:text-slate-400 mt-1\">\n                    Use an app like Google Authenticator or Authy to generate verification codes.\n                  </p>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  className=\"text-red-600 border-red-200 hover:bg-red-50 dark:text-red-300 dark:border-red-900/60 dark:hover:bg-red-900/30\"\n                  onClick={() => setShowDisableDialog(true)}\n                >\n                  Disable\n                </Button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Disable Confirmation Dialog */}\n      <Dialog open={showDisableDialog} onOpenChange={setShowDisableDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Disable Two-Factor Authentication?</DialogTitle>\n            <DialogDescription>\n              This will remove the extra layer of security from your account. You will need to re-configure 2FA if you want to use it again.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowDisableDialog(false)}>Cancel</Button>\n            <Button variant=\"destructive\" onClick={handleDisable}>Yes, Disable 2FA</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nexport default TwoFactorSettings;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/UserApprovalManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { Button } from '@/components/ui/button';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { useToast } from '@/components/ui/use-toast';\nimport { Loader2, CheckCircle, UserCheck, ShieldCheck, ChevronLeft, ChevronRight, RefreshCw } from 'lucide-react';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nconst ITEMS_PER_PAGE_OPTIONS = [5, 10, 25, 50];\n\nconst UserApprovalManager = () => {\n    const [requests, setRequests] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [activeTab, setActiveTab] = useState('pending');\n    const [processingId, setProcessingId] = useState(null);\n    const [rejectReason, setRejectReason] = useState('');\n    const [selectedRequest, setSelectedRequest] = useState(null);\n    const [dialogOpen, setDialogOpen] = useState(false);\n\n    // Pagination state\n    const [currentPage, setCurrentPage] = useState(1);\n    const [itemsPerPage, setItemsPerPage] = useState(10);\n    const [totalItems, setTotalItems] = useState(0);\n\n    const { isPlatformAdmin, isFullAccess } = usePermissions();\n    const { toast } = useToast();\n\n    const isSuperAdmin = isPlatformAdmin || isFullAccess;\n\n    // Reset page when tab changes\n    useEffect(() => {\n        setCurrentPage(1);\n    }, [activeTab]);\n\n\n\n    const fetchRequests = useCallback(async () => {\n        setLoading(true);\n        try {\n            let query = supabase\n                .from('account_requests')\n                .select('*', { count: 'exact' })\n                .order('created_at', { ascending: false });\n\n            // Filter by status based on tab\n            if (activeTab === 'pending') {\n                if (isSuperAdmin) {\n                    query = query.in('status', ['pending_admin', 'pending_super_admin']);\n                } else {\n                    query = query.eq('status', 'pending_admin');\n                }\n            } else {\n                query = query.eq('status', activeTab);\n            }\n\n            // Apply pagination\n            const from = (currentPage - 1) * itemsPerPage;\n            const to = from + itemsPerPage - 1;\n            query = query.range(from, to);\n\n            const { data, error, count } = await query;\n            if (error) throw error;\n\n            setRequests(data || []);\n            setTotalItems(count || 0);\n        } catch (error) {\n            console.error('Error fetching requests:', error);\n            toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to load requests.\" });\n        } finally {\n            setLoading(false);\n        }\n    }, [activeTab, currentPage, itemsPerPage, isSuperAdmin, toast]);\n\n    useEffect(() => {\n        fetchRequests();\n    }, [activeTab, currentPage, itemsPerPage, fetchRequests]);\n\n    const handleApprove = async (request) => {\n        setProcessingId(request.id);\n        try {\n            let action = '';\n            if (request.status === 'pending_admin') {\n                action = 'approve_application_admin';\n            } else if (request.status === 'pending_super_admin') {\n                action = 'approve_application_super_admin';\n            } else {\n                throw new Error('Invalid status for approval');\n            }\n\n            const { data, error } = await supabase.functions.invoke('manage-users', {\n                body: { action, request_id: request.id }\n            });\n\n            if (error) {\n                // Attempt to retrieve the specific error message from the response body\n                let detailedMessage = error.message;\n                if (error.context && typeof error.context.json === 'function') {\n                    try {\n                        const body = await error.context.json();\n                        if (body && body.error) {\n                            detailedMessage = body.error;\n                        }\n                    } catch (e) {\n                        console.warn('Failed to parse error context JSON:', e);\n                    }\n                }\n                throw new Error(detailedMessage);\n            }\n            if (data?.error) throw new Error(data.error);\n\n            toast({ title: \"Success\", description: data.message });\n            fetchRequests();\n        } catch (error) {\n            console.error('Approval error:', error);\n            toast({ variant: \"destructive\", title: \"Action Failed\", description: error.message });\n        } finally {\n            setProcessingId(null);\n        }\n    };\n\n    const handleReject = async () => {\n        if (!selectedRequest) return;\n        setProcessingId(selectedRequest.id);\n        try {\n            const { data, error } = await supabase.functions.invoke('manage-users', {\n                body: {\n                    action: 'reject_application',\n                    request_id: selectedRequest.id,\n                    reason: rejectReason\n                }\n            });\n\n            if (error) throw error;\n            if (data?.error) throw new Error(data.error);\n\n            toast({ title: \"Application Rejected\", description: \"The request has been rejected.\" });\n            setDialogOpen(false);\n            setRejectReason('');\n            fetchRequests();\n        } catch (error) {\n            console.error('Rejection error:', error);\n            toast({ variant: \"destructive\", title: \"Action Failed\", description: error.message });\n        } finally {\n            setProcessingId(null);\n        }\n    };\n\n    const getStatusBadge = (status) => {\n        switch (status) {\n            case 'pending_admin': return <Badge className=\"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-900/40 dark:text-amber-300 dark:border-amber-800\">Pending Admin</Badge>;\n            case 'pending_super_admin': return <Badge className=\"bg-primary/10 text-primary border-primary/20\">Pending Platform Admin</Badge>;\n            case 'completed': return <Badge className=\"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/40 dark:text-green-300 dark:border-green-800\">Approved & Invited</Badge>;\n            case 'rejected': return <Badge variant=\"destructive\">Rejected</Badge>;\n            default: return <Badge variant=\"secondary\" className=\"text-secondary-foreground\">{status}</Badge>;\n        }\n    };\n\n    const totalPages = Math.ceil(totalItems / itemsPerPage);\n\n    const PaginationControls = () => (\n        <div className=\"flex items-center justify-between pt-4 border-t border-border\">\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <span>Rows per page:</span>\n                <Select value={String(itemsPerPage)} onValueChange={(v) => { setItemsPerPage(Number(v)); setCurrentPage(1); }}>\n                    <SelectTrigger className=\"w-16 h-8 bg-background border-input\">\n                        <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                        {ITEMS_PER_PAGE_OPTIONS.map(opt => (\n                            <SelectItem key={opt} value={String(opt)}>{opt}</SelectItem>\n                        ))}\n                    </SelectContent>\n                </Select>\n                <span className=\"ml-4\">\n                    {totalItems > 0 ? `${(currentPage - 1) * itemsPerPage + 1}-${Math.min(currentPage * itemsPerPage, totalItems)} of ${totalItems}` : '0 items'}\n                </span>\n            </div>\n            <div className=\"flex items-center gap-1\">\n                <Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground\" onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage <= 1}>\n                    <ChevronLeft className=\"w-4 h-4\" />\n                </Button>\n                <span className=\"px-2 text-sm text-foreground\">Page {currentPage} of {totalPages || 1}</span>\n                <Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground\" onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage >= totalPages}>\n                    <ChevronRight className=\"w-4 h-4\" />\n                </Button>\n            </div>\n        </div>\n    );\n\n    const renderTable = (showActions = false) => (\n        <>\n            {loading ? (\n                <div className=\"flex items-center justify-center p-8\">\n                    <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                </div>\n            ) : requests.length === 0 ? (\n                <div className=\"text-center p-8 text-muted-foreground border border-dashed border-border rounded-lg bg-muted/20\">\n                    No requests found\n                </div>\n            ) : (\n                <Table>\n                    <TableHeader>\n                        <TableRow>\n                            <TableHead>Date</TableHead>\n                            <TableHead>Full Name</TableHead>\n                            <TableHead>Email</TableHead>\n                            <TableHead>Status</TableHead>\n                            {activeTab === 'rejected' && <TableHead>Reason</TableHead>}\n                            {showActions && <TableHead className=\"text-right\">Actions</TableHead>}\n                        </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                        {requests.map((req) => (\n                            <TableRow key={req.id}>\n                                <TableCell className=\"text-slate-500 text-sm\">\n                                    {new Date(req.created_at).toLocaleDateString()}\n                                </TableCell>\n                                <TableCell className=\"font-medium\">{req.full_name}</TableCell>\n                                <TableCell>{req.email}</TableCell>\n                                <TableCell>{getStatusBadge(req.status)}</TableCell>\n                                {activeTab === 'rejected' && (\n                                    <TableCell className=\"text-red-600 italic max-w-xs truncate\">{req.rejection_reason || '-'}</TableCell>\n                                )}\n                                {showActions && (\n                                    <TableCell className=\"text-right space-x-2\">\n                                        {req.status === 'pending_admin' && (\n                                            <Button size=\"sm\" onClick={() => handleApprove(req)} disabled={processingId === req.id}>\n                                                {processingId === req.id ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <CheckCircle className=\"w-4 h-4 mr-1\" />}\n                                                Approve\n                                            </Button>\n                                        )}\n                                        {req.status === 'pending_super_admin' && isSuperAdmin && (\n                                            <Button size=\"sm\" className=\"bg-blue-600 hover:bg-blue-700 text-white\" onClick={() => handleApprove(req)} disabled={processingId === req.id}>\n                                                {processingId === req.id ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <ShieldCheck className=\"w-4 h-4 mr-1\" />}\n                                                Final Approve\n                                            </Button>\n                                        )}\n                                        <Button variant=\"destructive\" size=\"sm\" onClick={() => { setSelectedRequest(req); setDialogOpen(true); }} disabled={processingId === req.id}>\n                                            Reject\n                                        </Button>\n                                    </TableCell>\n                                )}\n                            </TableRow>\n                        ))}\n                    </TableBody>\n                </Table>\n            )}\n            <PaginationControls />\n        </>\n    );\n\n    return (\n        <AdminPageLayout requiredPermission=\"platform.approvals.read\">\n            <PageHeader\n                title=\"Account Approvals\"\n                description=\"Manage user registration and approval requests.\"\n                icon={UserCheck}\n                breadcrumbs={[{ label: 'Approvals', icon: UserCheck }]}\n                actions={(\n                    <Button variant=\"ghost\" size=\"icon\" onClick={fetchRequests} title=\"Refresh\">\n                        <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n                    </Button>\n                )}\n            />\n\n            <Card className=\"w-full\">\n                <CardContent className=\"pt-6\">\n                    <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-4\">\n                        <TabsList>\n                            <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n                            <TabsTrigger value=\"completed\">Approved</TabsTrigger>\n                            <TabsTrigger value=\"rejected\">Rejected</TabsTrigger>\n                        </TabsList>\n\n                        <TabsContent value=\"pending\" className=\"space-y-4\">\n                            {renderTable(true)}\n                        </TabsContent>\n\n                        <TabsContent value=\"completed\">\n                            {renderTable(false)}\n                        </TabsContent>\n\n                        <TabsContent value=\"rejected\">\n                            {renderTable(false)}\n                        </TabsContent>\n                    </Tabs>\n                </CardContent>\n\n                {/* Reject Dialog */}\n                <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n                    <DialogContent>\n                        <DialogHeader>\n                            <DialogTitle>Reject Application</DialogTitle>\n                            <DialogDescription>\n                                Provide a reason for rejecting this application.\n                            </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"py-4\">\n                            <Textarea\n                                placeholder=\"Reason for rejection...\"\n                                value={rejectReason}\n                                onChange={(e) => setRejectReason(e.target.value)}\n                            />\n                        </div>\n                        <DialogFooter>\n                            <Button variant=\"outline\" onClick={() => setDialogOpen(false)}>Cancel</Button>\n                            <Button variant=\"destructive\" onClick={handleReject} disabled={!rejectReason || processingId}>\n                                {processingId ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : null}\n                                Confirm Rejection\n                            </Button>\n                        </DialogFooter>\n                    </DialogContent>\n                </Dialog>\n            </Card>\n        </AdminPageLayout>\n    );\n};\n\nexport default UserApprovalManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/UserEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRoles'. Either include it or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":62,"suggestions":[{"desc":"Update the dependencies array to be: [currentTenant.id, fetchRoles, formData.tenant_id, isPlatformAdmin]","fix":{"range":[1797,1853],"text":"[currentTenant.id, fetchRoles, formData.tenant_id, isPlatformAdmin]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { Save, X, User, Mail, Lock, Shield, Building } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\n\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext';\n\nfunction UserEditor({ user, onClose, onSave }) {\n  const { toast } = useToast();\n  const { tenantId: userTenantId, isPlatformAdmin } = usePermissions();\n  const { currentTenant } = useTenant();\n  const [loading, setLoading] = useState(false);\n  const [roles, setRoles] = useState([]);\n  const [tenants, setTenants] = useState([]);\n  const [inviteUser, setInviteUser] = useState(false);\n\n  const [formData, setFormData] = useState({\n    full_name: '',\n    email: '',\n    password: '',\n    role_id: '',\n    tenant_id: ''\n  });\n\n  const isEditing = !!user;\n\n  useEffect(() => {\n    fetchTenants(); // Always fetch tenants - visibility depends on role, not admin status\n    if (isEditing) {\n      setFormData({\n        full_name: user.full_name || '',\n        email: user.email || '',\n        password: '', // Password not editable here for security\n        role_id: user.role_id || '',\n        tenant_id: user.tenant_id || ''\n      });\n    } else {\n      // Default to current tenant for new users\n      setFormData(prev => ({ ...prev, tenant_id: currentTenant?.id || userTenantId || '' }));\n    }\n  }, [user, currentTenant?.id, userTenantId, isEditing]);\n\n  useEffect(() => {\n    fetchRoles();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentTenant?.id, formData.tenant_id, isPlatformAdmin]);\n\n  const resolveRoleTenantId = () => {\n    const fallbackTenantId = currentTenant?.id || userTenantId || null;\n    const selectedTenantId = formData.tenant_id === '' ? null : formData.tenant_id;\n\n    if (isPlatformAdmin) {\n      return selectedTenantId ?? null;\n    }\n\n    return selectedTenantId || fallbackTenantId;\n  };\n\n  const fetchRoles = async () => {\n    const roleTenantId = resolveRoleTenantId();\n    let query = supabase\n      .from('roles')\n      .select('id, name, scope, tenant_id, is_platform_admin, is_full_access, is_public, is_guest')\n      .is('deleted_at', null)\n      .order('name');\n\n    if (roleTenantId) {\n      if (isPlatformAdmin) {\n        query = query.or(`tenant_id.eq.${roleTenantId},tenant_id.is.null`);\n      } else {\n        query = query.eq('tenant_id', roleTenantId);\n      }\n    } else {\n      query = query.is('tenant_id', null);\n    }\n\n    const { data } = await query;\n    if (data) setRoles(data);\n  };\n\n  const fetchTenants = async () => {\n    const { data } = await supabase\n      .from('tenants')\n      .select('id, name')\n      .is('deleted_at', null)\n      .order('name');\n    if (data) setTenants(data);\n  };\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n\n    // If role changes, check if it's a global role and clear tenant\n    if (name === 'role_id') {\n      const selectedRole = roles.find(r => r.id === value);\n      const isGlobalRole = Boolean(selectedRole && (selectedRole.scope === 'platform' || selectedRole.is_platform_admin || selectedRole.is_full_access));\n\n      if (isGlobalRole) {\n        // Clear tenant_id for global roles\n        setFormData(prev => ({ ...prev, [name]: value, tenant_id: '' }));\n        return;\n      }\n    }\n\n    if (name === 'tenant_id') {\n      setFormData(prev => ({ ...prev, tenant_id: value, role_id: '' }));\n      return;\n    }\n\n    setFormData(prev => ({ ...prev, [name]: value }));\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      // Check if selected role is a platform role\n      const selectedRole = roles.find(r => r.id === formData.role_id);\n      const isGlobalRole = Boolean(selectedRole && (selectedRole.scope === 'platform' || selectedRole.is_platform_admin || selectedRole.is_full_access));\n\n      if (isEditing) {\n        // Update existing user (Public Table Only)\n        const updatePayload = {\n          full_name: formData.full_name,\n          role_id: formData.role_id,\n          updated_at: new Date().toISOString()\n        };\n\n        // Always include tenant_id in update:\n        // - For platform roles: set to null\n        // - For tenant-scoped roles: use the selected tenant\n        if (isGlobalRole) {\n          updatePayload.tenant_id = null;\n        } else if (formData.tenant_id) {\n          updatePayload.tenant_id = formData.tenant_id;\n        }\n\n        console.log('Updating user with payload:', updatePayload);\n\n        const { error } = await supabase\n          .from('users')\n          .update(updatePayload)\n          .eq('id', user.id);\n\n        if (error) throw error;\n\n        toast({\n          title: \"Success\",\n          description: \"User updated successfully\"\n        });\n      } else {\n        // Create new user (Requires Edge Function for Auth)\n        if (!inviteUser && (!formData.password || formData.password.length < 6)) {\n          throw new Error(\"Password is required and must be at least 6 characters\");\n        }\n\n        console.log('Calling manage-users edge function with:', {\n          action: inviteUser ? 'invite' : 'create',\n          email: formData.email,\n          full_name: formData.full_name,\n          role_id: formData.role_id\n        });\n\n        const { data, error } = await supabase.functions.invoke('manage-users', {\n          body: {\n            action: inviteUser ? 'invite' : 'create',\n            email: formData.email,\n            password: inviteUser ? undefined : formData.password,\n            full_name: formData.full_name,\n            role_id: formData.role_id,\n            tenant_id: formData.tenant_id || null // Pass null if empty (Global)\n          }\n        });\n\n        console.log('Edge function response:', { data, error });\n\n        if (error) {\n          console.error('Edge function error details:', error);\n          throw new Error(error.message || 'Failed to send a request to the Edge Function');\n        }\n\n        if (data && data.error) {\n          console.error('Edge function returned error:', data.error);\n          throw new Error(data.error);\n        }\n\n        toast({\n          title: \"Success\",\n          description: inviteUser ? \"Invitation sent successfully\" : \"New user created successfully\"\n        });\n      }\n      onSave();\n    } catch (error) {\n      console.error('Error saving user:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to save user details\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 overflow-y-auto\"\n    >\n      <motion.div\n        initial={{ scale: 0.95, y: 20 }}\n        animate={{ scale: 1, y: 0 }}\n        className=\"bg-white/95 rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col border border-slate-200/70 dark:bg-slate-950/90 dark:border-slate-800/70\"\n      >\n        <div className=\"px-6 py-5 border-b border-slate-200/70 flex justify-between items-center bg-slate-50/70 dark:bg-slate-900/60 dark:border-slate-800/70\">\n          <div>\n            <h3 className=\"text-xl font-bold text-slate-900 dark:text-white\">\n              {isEditing ? 'Edit User' : 'Create New User'}\n            </h3>\n            <p className=\"text-slate-500 text-xs mt-0.5 dark:text-slate-400\">\n              {isEditing ? 'Update user details and access level' : 'Add a new user to the system'}\n            </p>\n          </div>\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"rounded-full hover:bg-slate-200/70 dark:hover:bg-slate-800\">\n            <X className=\"w-5 h-5 text-slate-500 dark:text-slate-400\" />\n          </Button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-5\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"full_name\" className=\"flex items-center gap-2 text-slate-700 dark:text-slate-300\">\n              <User className=\"w-4 h-4 text-slate-400\" /> Full Name\n            </Label>\n            <Input\n              id=\"full_name\"\n              name=\"full_name\"\n              value={formData.full_name}\n              onChange={handleChange}\n              placeholder=\"e.g. John Doe\"\n              required\n              className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus-visible:ring-indigo-500/40 dark:border-slate-700/70 dark:bg-slate-950/60 dark:text-white dark:placeholder-slate-500\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\" className=\"flex items-center gap-2 text-slate-700 dark:text-slate-300\">\n              <Mail className=\"w-4 h-4 text-slate-400\" /> Email Address\n            </Label>\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              value={formData.email}\n              onChange={handleChange}\n              placeholder=\"john@example.com\"\n              required\n              disabled={isEditing}\n              className={`h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus-visible:ring-indigo-500/40 dark:border-slate-700/70 dark:bg-slate-950/60 dark:text-white dark:placeholder-slate-500 ${isEditing ? 'bg-slate-100 text-slate-500 cursor-not-allowed dark:bg-slate-900 dark:text-slate-500' : ''}`}\n            />\n            {isEditing && <p className=\"text-xs text-slate-400\">Email cannot be changed after creation.</p>}\n          </div>\n\n          {!isEditing && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center space-x-2\">\n                <input\n                  type=\"checkbox\"\n                  id=\"inviteUser\"\n                  checked={inviteUser}\n                  onChange={(e) => setInviteUser(e.target.checked)}\n                  className=\"rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 w-4 h-4 cursor-pointer\"\n                />\n                <Label htmlFor=\"inviteUser\" className=\"text-sm font-medium text-slate-700 cursor-pointer dark:text-slate-300\">\n                  Send email invitation (skip password)\n                </Label>\n              </div>\n\n              {!inviteUser && (\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"password\" className=\"flex items-center gap-2 text-slate-700 dark:text-slate-300\">\n                    <Lock className=\"w-4 h-4 text-slate-400\" /> Password\n                  </Label>\n                  <Input\n                    id=\"password\"\n                    name=\"password\"\n                    type=\"password\"\n                    value={formData.password}\n                    onChange={handleChange}\n                    placeholder=\"\"\n                    required={!inviteUser}\n                    minLength={6}\n                    className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus-visible:ring-indigo-500/40 dark:border-slate-700/70 dark:bg-slate-950/60 dark:text-white dark:placeholder-slate-500\"\n                  />\n                  <p className=\"text-xs text-slate-500 dark:text-slate-400\">Must be at least 6 characters long.</p>\n                </div>\n              )}\n            </div>\n          )}\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"role_id\" className=\"flex items-center gap-2 text-slate-700 dark:text-slate-300\">\n              <Shield className=\"w-4 h-4 text-slate-400\" /> Assign Role\n            </Label>\n            <select\n              id=\"role_id\"\n              name=\"role_id\"\n              value={formData.role_id}\n              onChange={handleChange}\n              required\n              className=\"flex h-11 w-full items-center justify-between rounded-xl border border-slate-200/70 bg-white/90 px-3 py-2 text-sm placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/40 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-slate-950/60 dark:text-slate-200 dark:border-slate-700/70\"\n            >\n              <option value=\"\" disabled>Select a role...</option>\n              {roles\n                .filter(role => {\n                  // Exclude system roles that should not be assignable\n                  if (role.is_public || role.is_guest) return false;\n\n                  // Security: Non-Platform Admins cannot assign Platform Roles\n                  if (!isPlatformAdmin && (role.scope === 'platform' || role.is_platform_admin || role.is_full_access)) {\n                    return false;\n                  }\n\n                  return true;\n                })\n                .map(role => (\n                  <option key={role.id} value={role.id}>{role.name}</option>\n                ))}\n            </select>\n          </div>\n\n          {/* Tenant Selector - Shows for tenant-scoped roles */}\n          {(() => {\n            const selectedRole = roles.find(r => r.id === formData.role_id);\n            const isGlobalRole = Boolean(selectedRole && (selectedRole.scope === 'platform' || selectedRole.is_platform_admin || selectedRole.is_full_access));\n\n            // Don't show tenant selector for platform roles\n            if (isGlobalRole) return null;\n\n            // For tenant-scoped roles, always show and require tenant selection\n            return (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tenant_id\" className=\"flex items-center gap-2 text-slate-700 dark:text-slate-300\">\n                  <Building className=\"w-4 h-4 text-slate-400\" /> Assign Tenant\n                  <span className=\"text-red-500 ml-1\">*</span>\n                </Label>\n                <select\n                  id=\"tenant_id\"\n                  name=\"tenant_id\"\n                  value={formData.tenant_id}\n                  onChange={handleChange}\n                  required\n                  className=\"flex h-11 w-full items-center justify-between rounded-xl border border-slate-200/70 bg-white/90 px-3 py-2 text-sm placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/40 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-slate-950/60 dark:text-slate-200 dark:border-slate-700/70\"\n                >\n                  <option value=\"\" disabled>Select a tenant...</option>\n                  {tenants.map(tenant => (\n                    <option key={tenant.id} value={tenant.id}>{tenant.name}</option>\n                  ))}\n                </select>\n                <p className=\"text-xs text-slate-500\">This role requires a tenant assignment.</p>\n              </div>\n            );\n          })()}\n          {/* Form Actions - Inside form for proper submit behavior */}\n          <div className=\"pt-4 border-t border-slate-200 flex justify-end gap-3 dark:border-slate-800\">\n            <Button type=\"button\" variant=\"ghost\" onClick={onClose} disabled={loading} className=\"dark:text-slate-300 dark:hover:text-white dark:hover:bg-slate-800\">\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={loading} className=\"bg-indigo-600 hover:bg-indigo-700\">\n              <Save className=\"w-4 h-4 mr-2\" />\n              {loading ? 'Saving...' : (isEditing ? 'Update User' : 'Create User')}\n            </Button>\n          </div>\n        </form>\n      </motion.div>\n    </motion.div>\n  );\n}\n\nexport default UserEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/UserProfile.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { User, Mail, Lock, Shield, Save, Key, AlertCircle, CheckCircle2, Crown, Camera } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport TwoFactorSettings from '@/components/dashboard/TwoFactorSettings';\nimport { ImageUpload } from '@/components/ui/ImageUpload';\n\nfunction UserProfile() {\n  const { user } = useAuth();\n  const { userRole, permissions, isPlatformAdmin, isFullAccess } = usePermissions();\n  const { toast } = useToast();\n\n  const [loading, setLoading] = useState(false);\n  const [passLoading, setPassLoading] = useState(false);\n\n  const [profileData, setProfileData] = useState({\n    full_name: '',\n    email: '',\n    avatar_url: ''\n  });\n\n  const [passwordData, setPasswordData] = useState({\n    password: '',\n    confirmPassword: ''\n  });\n\n  // Initialize data\n  useEffect(() => {\n    if (user) {\n      const fetchProfile = async () => {\n        try {\n          // Explicitly specify the relationship to avoid PGRST200 error\n          const { data, error } = await supabase\n            .from('users')\n            .select(`\n              full_name, \n              email, \n              avatar_url,\n              roles:roles!users_role_id_fkey (\n                name,\n                description,\n                is_platform_admin,\n                is_full_access\n              )\n            `)\n            .eq('id', user.id)\n            .maybeSingle();\n\n          if (error) {\n            console.error('Error fetching profile:', error);\n          }\n\n          setProfileData({\n            full_name: data?.full_name || user.user_metadata?.full_name || '',\n            email: user.email || '',\n            avatar_url: data?.avatar_url || user.user_metadata?.avatar_url || '',\n            role_name: data?.roles?.name || '',\n            role_description: data?.roles?.description || '',\n            role_is_platform_admin: Boolean(data?.roles?.is_platform_admin),\n            role_is_full_access: Boolean(data?.roles?.is_full_access)\n          });\n        } catch (err) {\n          console.error('Unexpected error in fetchProfile:', err);\n        }\n      };\n      fetchProfile();\n    }\n  }, [user]);\n\n  const handleProfileUpdate = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      // 1. Update public.users table\n      const { error: dbError } = await supabase\n        .from('users')\n        .update({\n          full_name: profileData.full_name,\n          avatar_url: profileData.avatar_url,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', user.id);\n\n      if (dbError) throw dbError;\n\n      // 2. Update Auth Metadata\n      const { error: authError } = await supabase.auth.updateUser({\n        data: {\n          full_name: profileData.full_name,\n          avatar_url: profileData.avatar_url\n        }\n      });\n\n      if (authError) throw authError;\n\n      // 3. Handle Email Change if changed\n      if (profileData.email !== user.email) {\n        const { error: emailError } = await supabase.auth.updateUser({\n          email: profileData.email\n        });\n        if (emailError) throw emailError;\n\n        toast({\n          title: \"Check your email\",\n          description: \"Confirmation link sent to your new email address.\"\n        });\n      }\n\n      toast({\n        title: \"Profile Updated\",\n        description: \"Your profile information has been saved successfully.\"\n      });\n    } catch (error) {\n      console.error('Update error:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update profile.\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePasswordChange = async (e) => {\n    e.preventDefault();\n    if (passwordData.password !== passwordData.confirmPassword) {\n      toast({\n        variant: \"destructive\",\n        title: \"Passwords do not match\",\n        description: \"Please ensure both password fields match.\"\n      });\n      return;\n    }\n\n    if (passwordData.password.length < 6) {\n      toast({\n        variant: \"destructive\",\n        title: \"Password too short\",\n        description: \"Password must be at least 6 characters long.\"\n      });\n      return;\n    }\n\n    setPassLoading(true);\n    try {\n      const { error } = await supabase.auth.updateUser({\n        password: passwordData.password\n      });\n\n      if (error) throw error;\n\n      toast({\n        title: \"Password Updated\",\n        description: \"Your password has been changed successfully.\"\n      });\n\n      setPasswordData({ password: '', confirmPassword: '' });\n    } catch (error) {\n      console.error(\"Password update error:\", error);\n\n      let errorMessage = error.message || \"Failed to change password.\";\n\n      // Handle specific error cases\n      if (errorMessage.includes(\"New password should be different\") || error.code === \"same_password\") {\n        errorMessage = \"Your new password cannot be the same as your old password.\";\n      } else if (errorMessage.includes(\"Gateway Timeout\") || error.status === 504) {\n        errorMessage = \"Server is busy. Please wait a moment and try again.\";\n      } else if (errorMessage.includes(\"fetch\") || errorMessage.includes(\"network\") || error.name === \"TypeError\") {\n        errorMessage = \"Network error. Please check your connection and try again.\";\n      } else if (error.status === 429) {\n        errorMessage = \"Too many requests. Please wait a few minutes before trying again.\";\n      }\n\n      toast({\n        variant: \"destructive\",\n        title: \"Update Failed\",\n        description: errorMessage\n      });\n    } finally {\n      setPassLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"w-full space-y-8 pb-12\">\n      <div className=\"flex flex-col gap-1\">\n        <h2 className=\"text-3xl font-semibold text-slate-900 dark:text-white tracking-tight\">My Profile</h2>\n        <p className=\"text-slate-500 dark:text-slate-400\">Manage your account settings and security preferences</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 items-stretch\">\n        {/* Left Column: Profile, Password, 2FA */}\n        <div className=\"lg:col-span-2 space-y-6\">\n\n          {/* Personal Information Card */}\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"dashboard-surface dashboard-surface-hover overflow-hidden\"\n          >\n            <div className=\"flex items-center gap-3 border-b border-slate-200/60 bg-slate-50/70 px-6 py-5 dark:border-slate-800/70 dark:bg-slate-900/60\">\n              <div className=\"rounded-xl bg-blue-100/70 p-2 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300\">\n                <User className=\"w-5 h-5\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-slate-900 dark:text-white\">Personal Information</h3>\n                <p className=\"text-xs text-slate-500 dark:text-slate-400\">Update your personal details</p>\n              </div>\n            </div>\n\n            <div className=\"p-6\">\n              <form onSubmit={handleProfileUpdate} className=\"space-y-6\">\n                <div className=\"grid gap-6 md:grid-cols-[200px,1fr]\">\n                  <div className=\"flex flex-col items-center gap-3 md:items-start md:text-left\">\n                    <div className=\"relative group\">\n                      <div className=\"w-28 h-28 rounded-full overflow-hidden border-4 border-slate-200/70 bg-slate-100 shadow-md dark:border-slate-800 dark:bg-slate-900\">\n                        {profileData.avatar_url ? (\n                          <img\n                            src={profileData.avatar_url}\n                            alt=\"Profile\"\n                            className=\"w-full h-full object-cover\"\n                          />\n                        ) : (\n                          <div className=\"w-full h-full flex items-center justify-center bg-blue-100/70 dark:bg-blue-900/30\">\n                            <User className=\"w-10 h-10 text-blue-400 dark:text-blue-300\" />\n                          </div>\n                        )}\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={() => document.getElementById('avatar-upload-trigger').click()}\n                        className=\"absolute bottom-1 right-1 p-2 bg-blue-600 rounded-full text-white shadow-lg ring-2 ring-white transition-colors hover:bg-blue-700 dark:ring-slate-900\"\n                      >\n                        <Camera className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n                    <div className=\"text-center text-xs text-slate-500 dark:text-slate-400 md:text-left\">\n                      JPG/PNG up to 2MB\n                    </div>\n                  </div>\n                  <div className=\"space-y-4 rounded-2xl border border-slate-200/70 bg-white/80 p-4 shadow-sm dark:border-slate-800/70 dark:bg-slate-900/50\">\n                    <ImageUpload\n                      id=\"avatar-upload-trigger\"\n                      value={profileData.avatar_url}\n                      onChange={(url) => setProfileData({ ...profileData, avatar_url: url })}\n                      className=\"h-auto\"\n                      hidePreview\n                    />\n                    <p className=\"text-xs text-slate-500 dark:text-slate-400\">Use Media Library or paste an external URL.</p>\n                  </div>\n                </div>\n\n                <div className=\"grid gap-4 md:grid-cols-2\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"full_name\" className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">Full Name</Label>\n                    <div className=\"relative\">\n                      <User className=\"absolute left-3 top-3 h-4 w-4 text-slate-400\" />\n                      <Input\n                        id=\"full_name\"\n                        value={profileData.full_name}\n                        onChange={(e) => setProfileData({ ...profileData, full_name: e.target.value })}\n                        className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 pl-9 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                        placeholder=\"Your full name\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"email\" className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">Email Address</Label>\n                    <div className=\"relative\">\n                      <Mail className=\"absolute left-3 top-3 h-4 w-4 text-slate-400\" />\n                      <Input\n                        id=\"email\"\n                        type=\"email\"\n                        value={profileData.email}\n                        onChange={(e) => setProfileData({ ...profileData, email: e.target.value })}\n                        className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 pl-9 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                        placeholder=\"your.email@example.com\"\n                      />\n                    </div>\n                    <p className=\"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1\">\n                      <AlertCircle className=\"w-3 h-3\" />\n                      Changing email will require re-verification.\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"pt-2 flex justify-end\">\n                  <Button type=\"submit\" disabled={loading} className=\"bg-indigo-600 hover:bg-indigo-700 text-white\">\n                    {loading ? (\n                      <span className=\"flex items-center gap-2\">Saving...</span>\n                    ) : (\n                      <span className=\"flex items-center gap-2\"><Save className=\"w-4 h-4\" /> Save Changes</span>\n                    )}\n                  </Button>\n                </div>\n              </form>\n            </div>\n          </motion.div>\n\n          {/* 2FA Settings Component */}\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.1 }}\n          >\n            <TwoFactorSettings />\n          </motion.div>\n\n          {/* Security Card (Password) */}\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.2 }}\n            className=\"dashboard-surface dashboard-surface-hover overflow-hidden\"\n          >\n            <div className=\"flex items-center gap-3 border-b border-slate-200/60 bg-slate-50/70 px-6 py-5 dark:border-slate-800/70 dark:bg-slate-900/60\">\n              <div className=\"p-2 bg-orange-100/70 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg\">\n                <Lock className=\"w-5 h-5\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-slate-900 dark:text-white\">Password</h3>\n                <p className=\"text-xs text-slate-500 dark:text-slate-400\">Manage your password</p>\n              </div>\n            </div>\n\n            <div className=\"p-6\">\n              <form onSubmit={handlePasswordChange} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"password\" className=\"text-slate-700 dark:text-slate-300\">New Password</Label>\n                    <div className=\"relative\">\n                      <Key className=\"absolute left-3 top-2.5 h-4 w-4 text-slate-400\" />\n                      <Input\n                        id=\"password\"\n                        type=\"password\"\n                        value={passwordData.password}\n                        onChange={(e) => setPasswordData({ ...passwordData, password: e.target.value })}\n                        className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 pl-9 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                        placeholder=\"\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"confirmPassword\" className=\"text-slate-700 dark:text-slate-300\">Confirm Password</Label>\n                    <div className=\"relative\">\n                      <Key className=\"absolute left-3 top-2.5 h-4 w-4 text-slate-400\" />\n                      <Input\n                        id=\"confirmPassword\"\n                        type=\"password\"\n                        value={passwordData.confirmPassword}\n                        onChange={(e) => setPasswordData({ ...passwordData, confirmPassword: e.target.value })}\n                        className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 pl-9 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                        placeholder=\"\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"pt-2 flex justify-end\">\n                  <Button type=\"submit\" variant=\"outline\" disabled={passLoading || !passwordData.password} className=\"border-orange-200 text-orange-700 hover:bg-orange-50 hover:text-orange-800 dark:border-orange-800 dark:text-orange-400 dark:hover:bg-orange-900/20\">\n                    {passLoading ? 'Updating...' : 'Update Password'}\n                  </Button>\n                </div>\n              </form>\n            </div>\n          </motion.div>\n        </div>\n\n        {/* Right Column: Roles & Permissions */}\n        <div className=\"lg:col-span-1 flex flex-col space-y-6\">\n          <motion.div\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ delay: 0.3 }}\n            className=\"dashboard-surface dashboard-surface-hover overflow-hidden flex flex-col flex-1 min-h-0\"\n          >\n            <div className=\"flex items-center gap-3 border-b border-slate-200/60 bg-slate-50/70 px-6 py-5 dark:border-slate-800/70 dark:bg-slate-900/60\">\n              <div className=\"p-2 bg-purple-100/70 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg\">\n                <Shield className=\"w-5 h-5\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-slate-900 dark:text-white\">Access Control</h3>\n                <p className=\"text-xs text-slate-500 dark:text-slate-400\">Your assigned role and permissions</p>\n              </div>\n            </div>\n\n            <div className=\"p-6 space-y-6 flex-1 flex flex-col min-h-0\">\n              <div>\n                <h4 className=\"text-xs font-bold text-slate-400 dark:text-slate-500 mb-3 uppercase tracking-wider\">Current Role</h4>\n                <div className={`inline-flex items-center px-3 py-1.5 rounded-full font-semibold text-sm border ${(profileData.role_is_platform_admin || profileData.role_is_full_access || isPlatformAdmin || isFullAccess)\n                  ? 'bg-purple-100/70 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 border-purple-200/70 dark:border-purple-800'\n                  : 'bg-slate-100/70 dark:bg-slate-800 text-slate-700 dark:text-slate-300 border-slate-200/70 dark:border-slate-700'\n                  }`}>\n                  {(profileData.role_is_platform_admin || profileData.role_is_full_access || isPlatformAdmin || isFullAccess)\n                    ? <Crown className=\"w-3.5 h-3.5 mr-2 text-purple-600 dark:text-purple-400\" />\n                    : <Shield className=\"w-3.5 h-3.5 mr-2\" />}\n                  {(profileData.role_name || userRole) ? (profileData.role_name || userRole).replace(/_/g, ' ') : 'Guest'}\n                </div>\n                {profileData.role_description && (\n                  <p className=\"text-sm text-slate-500 dark:text-slate-400 mt-2 italic\">\n                    &quot;{profileData.role_description}&quot;\n                  </p>\n                )}\n              </div>\n\n              <div className=\"flex-1 flex flex-col min-h-0\">\n                <h4 className=\"text-xs font-bold text-slate-400 dark:text-slate-500 mb-3 uppercase tracking-wider flex items-center justify-between\">\n                  Active Permissions\n                  <span className=\"text-xs normal-case bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded-full text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700\">\n                    {permissions?.length || 0}\n                  </span>\n                </h4>\n\n                {permissions && permissions.length > 0 ? (\n                  <div className=\"flex-1 min-h-0 rounded-2xl border border-slate-200/70 bg-white/80 p-3 shadow-sm dark:border-slate-800/70 dark:bg-slate-900/50\">\n                    <div className=\"max-h-[400px] overflow-y-auto pr-2 custom-scrollbar space-y-2\">\n                      {permissions.map((perm, index) => (\n                        <div key={index} className=\"flex items-center gap-2 rounded-xl border border-transparent p-2 text-sm text-slate-600 transition-colors group hover:bg-slate-50/70 hover:border-slate-100 dark:text-slate-400 dark:hover:bg-slate-800/50 dark:hover:border-slate-700\">\n                          <CheckCircle2 className=\"w-4 h-4 text-green-500 dark:text-green-400 shrink-0\" />\n                          <span className=\"group-hover:text-slate-900 dark:group-hover:text-slate-200\">{perm.replace(/_/g, ' ')}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"flex-1 text-sm text-slate-400 italic p-6 bg-slate-50 dark:bg-slate-900/50 rounded-lg text-center border border-slate-100 dark:border-slate-800/70 flex flex-col items-center justify-center gap-2\">\n                    <Shield className=\"w-8 h-8 text-slate-200 dark:text-slate-600\" />\n                    No specific permissions assigned.\n                  </div>\n                )}\n              </div>\n            </div>\n          </motion.div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default UserProfile;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/UsersManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport ContentTable from '@/components/dashboard/ContentTable';\nimport UserEditor from '@/components/dashboard/UserEditor';\nimport UserApprovalManager from '@/components/dashboard/UserApprovalManager';\nimport { AdminPageLayout, PageHeader, PageTabs, TabsContent } from '@/templates/flowbite-admin';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { sanitizeHTML } from '@/utils/sanitize';\nimport { useToast } from '@/components/ui/use-toast';\nimport { udm } from '@/lib/data/UnifiedDataManager';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Button } from '@/components/ui/button';\nimport { Plus, RefreshCw, User, ShieldAlert, Trash2, Crown } from 'lucide-react';\nimport { useSearch } from '@/hooks/useSearch';\nimport MinCharSearchInput from '@/components/common/MinCharSearchInput';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useTranslation } from 'react-i18next';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\n\n/**\n * UsersManager - Manages users and registration approvals.\n * Refactored to use awadmintemplate01 components for consistent UI and i18n.\n */\nfunction UsersManager() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const { hasPermission, isPlatformAdmin } = usePermissions();\n  const { currentTenant } = useTenant();\n\n  // State declarations\n  const [users, setUsers] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  // Search\n  const {\n    query,\n    setQuery,\n    debouncedQuery,\n    isValid: isSearchValid,\n    message: searchMessage,\n    loading: searchLoading,\n    minLength,\n    clearSearch\n  } = useSearch({ context: 'admin' });\n\n  const [currentPage, setCurrentPage] = useState(1);\n  const [itemsPerPage, setItemsPerPage] = useState(10);\n  const [totalItems, setTotalItems] = useState(0);\n  const [showEditor, setShowEditor] = useState(false);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [userToDelete, setUserToDelete] = useState(null);\n  const [activeTab, setActiveTab] = useState('users');\n\n  // Permission checks\n  const canView = hasPermission('tenant.user.read');\n  const canCreate = hasPermission('tenant.user.create');\n  const canEdit = hasPermission('tenant.user.update');\n  const canDelete = hasPermission('tenant.user.delete');\n\n  // Tab definitions\n  const tabs = [\n    { value: 'users', label: t('users.tabs.active_users'), icon: User, color: 'blue' },\n    { value: 'approvals', label: t('users.tabs.approvals'), icon: ShieldAlert, color: 'amber' },\n  ];\n\n  // Breadcrumbs\n  const breadcrumbs = [\n    { label: t('users.breadcrumbs.users'), href: activeTab !== 'users' ? '/cmspanel/users' : undefined, icon: User },\n    ...(activeTab === 'approvals' ? [{ label: t('users.breadcrumbs.approvals') }] : []),\n  ];\n\n  const fetchUsers = useCallback(async () => {\n    if (!canView) return;\n    setLoading(true);\n    try {\n      let q = udm.from('users')\n        .select('*, roles!users_role_id_fkey(name, is_platform_admin, is_full_access), tenant:tenants(name)', { count: 'exact' })\n        .is('deleted_at', null);\n\n      // Strict Multi-Tenancy\n      if (!isPlatformAdmin && currentTenant?.id) {\n        q = q.eq('tenant_id', currentTenant.id);\n      }\n\n      if (debouncedQuery) {\n        q = q.ilike('email', `%${debouncedQuery}%`);\n      }\n\n      const from = (currentPage - 1) * itemsPerPage;\n      const to = from + itemsPerPage - 1;\n\n      const { data, count, error } = await q\n        .range(from, to)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setUsers(data || []);\n      setTotalItems(count || 0);\n    } catch (err) {\n      console.error(err);\n      toast({ variant: 'destructive', title: t('common.error'), description: t('common.no_data') }); // Fallback error msg\n    } finally {\n      setLoading(false);\n    }\n  }, [canView, isPlatformAdmin, currentTenant, debouncedQuery, currentPage, itemsPerPage, toast, t]);\n\n  // Actions for header\n  const headerActions = (\n    <div className=\"flex items-center gap-2\">\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        onClick={fetchUsers}\n        title={t('common.refresh')}\n        className=\"h-10 w-10 border-slate-200/70 bg-white/70 hover:bg-white shadow-sm\"\n      >\n        <RefreshCw className=\"h-4 w-4\" />\n      </Button>\n      {canCreate ? (\n        <Button\n          onClick={() => { setSelectedUser(null); setShowEditor(true); }}\n          className=\"bg-indigo-600 text-white hover:bg-indigo-700 shadow-sm\"\n        >\n          <Plus className=\"mr-2 h-4 w-4\" />\n          {t('users.create_user')}\n        </Button>\n      ) : null}\n    </div>\n  );\n\n  useEffect(() => {\n    if (activeTab === 'users') {\n      fetchUsers();\n    }\n  }, [activeTab, fetchUsers]);\n\n  const handleEdit = (user) => {\n    setSelectedUser(user);\n    setShowEditor(true);\n  };\n\n  const handleSave = () => {\n    setShowEditor(false);\n    setSelectedUser(null);\n    fetchUsers();\n  };\n\n  const openDeleteDialog = (user) => {\n    setUserToDelete(user);\n    setDeleteDialogOpen(true);\n  };\n\n  const handleConfirmDelete = async () => {\n    if (!userToDelete) return;\n\n    setLoading(true);\n    setDeleteDialogOpen(false);\n\n    try {\n      if (navigator.onLine) {\n        const { data, error } = await supabase.functions.invoke('manage-users', {\n          body: { action: 'delete', user_id: userToDelete.id }\n        });\n\n        if (error) throw error;\n        if (data && data.error) throw new Error(data.error);\n      } else {\n        await udm.from('users').update({ deleted_at: new Date().toISOString() }).eq('id', userToDelete.id);\n        toast({ title: 'Offline', description: 'User marked for deletion. Will sync when online.' });\n      }\n\n      toast({ title: t('common.success'), description: t('common.move_to_trash_confirm', { resource: t('users.breadcrumbs.users') }) });\n      fetchUsers();\n    } catch (err) {\n      console.error('Delete error:', err);\n      toast({\n        variant: 'destructive',\n        title: t('common.error'),\n        description: err.message || 'Could not delete user'\n      });\n    } finally {\n      setLoading(false);\n      setUserToDelete(null);\n    }\n  };\n\n  const columns = [\n    { key: 'email', label: t('users.columns.email') },\n    { key: 'full_name', label: t('users.columns.full_name') },\n    {\n      key: 'roles',\n      label: t('users.columns.role'),\n      render: (r) => {\n        if (!r?.name) return <span className=\"text-muted-foreground text-xs\">{t('users.guest')}</span>;\n        if (r.is_platform_admin || r.is_full_access) {\n          return (\n            <span className=\"flex items-center gap-1 bg-amber-500/10 px-2 py-1 rounded-full text-xs font-bold text-amber-600 dark:text-amber-500 border border-amber-500/20\">\n              <Crown className=\"w-3 h-3 fill-amber-500 text-amber-500\" />\n              {t('roles.badges.tenant_root')}\n            </span>\n          );\n        }\n        return (\n          <span className=\"capitalize bg-secondary px-2 py-1 rounded-full text-xs font-medium text-secondary-foreground\">\n            {r.name.replace('_', ' ')}\n          </span>\n        );\n      }\n    },\n    // Tenant column - only for Platform Admins\n    ...(isPlatformAdmin ? [{\n      key: 'tenant',\n      label: t('users.columns.tenant'),\n      render: (_, item) => item.tenant?.name ? (\n        <span className=\"bg-primary/10 text-primary px-2 py-1 rounded-full text-xs font-medium border border-primary/20\">\n          {item.tenant.name}\n        </span>\n      ) : <span className=\"text-muted-foreground bg-muted px-2 py-1 rounded-full text-xs font-medium border border-border\">{t('common.global')}</span>\n    }] : []),\n    { key: 'created_at', label: t('users.joined'), type: 'date' }\n  ];\n\n  if (showEditor) {\n    return (\n      <UserEditor\n        user={selectedUser}\n        onClose={() => { setShowEditor(false); setSelectedUser(null); }}\n        onSave={handleSave}\n      />\n    );\n  }\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.user.read\">\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2\">\n              <Trash2 className=\"w-5 h-5 text-red-500\" />\n              {t('users.delete.title')}\n            </AlertDialogTitle>\n            <AlertDialogDescription asChild>\n              <div className=\"space-y-3\">\n                <p dangerouslySetInnerHTML={{ __html: sanitizeHTML(t('users.delete.confirm', { name: userToDelete?.full_name || userToDelete?.email })) }} />\n                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3 text-amber-800 text-sm\">\n                  <p className=\"font-medium mb-1\"> {t('users.delete.warning_role')}</p>\n                </div>\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3 text-red-700 text-sm\">\n                  <p className=\"font-medium\"> {t('common.error')}:</p>\n                  <p>{t('users.delete.warning_restore')}</p>\n                </div>\n              </div>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{t('common.cancel')}</AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirmDelete} className=\"bg-red-600 hover:bg-red-700\">\n              {t('common.move_to_trash')}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Page Header */}\n      <PageHeader\n        title={t('users.title')}\n        description={t('users.subtitle')}\n        icon={User}\n        breadcrumbs={breadcrumbs}\n        actions={activeTab === 'users' ? headerActions : []}\n      />\n\n      {/* Tabs Navigation */}\n      <PageTabs value={activeTab} onValueChange={setActiveTab} tabs={tabs}>\n        <TabsContent value=\"users\" className=\"space-y-6 mt-0\">\n          {/* Search Bar */}\n          <div className=\"bg-card p-4 rounded-xl border border-border shadow-sm flex flex-col gap-3 md:flex-row md:items-center\">\n            <div className=\"flex-1 max-w-sm\">\n              <MinCharSearchInput\n                value={query}\n                onChange={e => setQuery(e.target.value)}\n                onClear={clearSearch}\n                loading={loading || searchLoading}\n                isValid={isSearchValid}\n                message={searchMessage}\n                minLength={minLength}\n                placeholder={t('common.search_resource', { resource: t('users.breadcrumbs.users') })}\n              />\n            </div>\n            <div className=\"flex-1\"></div>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={fetchUsers}\n              title={t('common.refresh')}\n              disabled={loading}\n              className=\"text-muted-foreground hover:text-foreground disabled:opacity-50\"\n            >\n              <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n            </Button>\n          </div>\n\n          {/* Users Table */}\n          <ContentTable\n            data={users}\n            columns={columns}\n            loading={loading}\n            onEdit={canEdit ? handleEdit : null}\n            onDelete={canDelete ? openDeleteDialog : null}\n            pagination={{\n              currentPage,\n              totalPages: Math.ceil(totalItems / itemsPerPage),\n              totalItems,\n              itemsPerPage,\n              onPageChange: setCurrentPage,\n              onLimitChange: setItemsPerPage\n            }}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"approvals\" className=\"mt-0\">\n          <UserApprovalManager />\n        </TabsContent>\n      </PageTabs>\n    </AdminPageLayout>\n  );\n}\n\nexport default UsersManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/VideoGalleryManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport GenericContentManager from '@/components/dashboard/GenericContentManager';\nimport { Video } from 'lucide-react';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\nfunction VideoGalleryManager() {\n    const columns = [\n        { key: 'title', label: 'Title' },\n        {\n            key: 'status',\n            label: 'Status',\n            render: (value) => (\n                <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${value === 'published' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :\n                    value === 'draft' ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400' :\n                        'bg-muted text-muted-foreground'\n                    }`}>\n                    {value || 'draft'}\n                </span>\n            )\n        },\n        {\n            key: 'published_at',\n            label: 'Publish Date',\n            type: 'date',\n            render: (value) => value ? new Date(value).toLocaleDateString() : '-'\n        }\n    ];\n\n    const formFields = [\n        { key: 'title', label: 'Title', required: true },\n        { key: 'slug', label: 'Slug', description: 'URL-friendly name (auto-generated if empty)' },\n        { key: 'youtube_playlist_url', label: 'YouTube Video URL', description: 'Link to the video on YouTube' },\n        { key: 'thumbnail_image', label: 'Custom Thumbnail', type: 'image', description: 'Optional custom cover image' },\n        { key: 'description', label: 'Description', type: 'richtext' },\n        { key: 'category_id', label: 'Category', type: 'relation', table: 'categories', filter: { type: 'video_gallery' } },\n        { key: 'published_at', label: 'Publish Date', type: 'datetime', description: 'Schedule for future release (optional)' },\n        {\n            key: 'status', label: 'Status', type: 'select', options: [\n                { value: 'draft', label: 'Draft' },\n                { value: 'published', label: 'Published' }\n            ]\n        }\n    ];\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.video_gallery.read\">\n            <PageHeader\n                title=\"Video Gallery\"\n                description=\"Manage video content and YouTube integrations.\"\n                icon={Video}\n                breadcrumbs={[{ label: 'Video Gallery', icon: Video }]}\n            />\n\n            <GenericContentManager\n                tableName=\"video_gallery\"\n                resourceName=\"Video Gallery\"\n                columns={columns}\n                formFields={formFields}\n                permissionPrefix=\"video_gallery\"\n                showBreadcrumbs={false}\n            />\n        </AdminPageLayout>\n    );\n}\n\nexport default VideoGalleryManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/VisitorStatisticsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":33,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { format } from 'date-fns';\nimport { LineChart, RefreshCw, Search } from 'lucide-react';\n\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { useToast } from '@/components/ui/use-toast';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\n\nconst SUMMARY_DAYS = 30;\nconst RECENT_DAYS = 7;\nconst EVENTS_PER_PAGE = 50;\n\nconst formatNumber = (value) => new Intl.NumberFormat().format(value || 0);\n\nconst capitalize = (value) =>\n  value\n    ? value\n        .toString()\n        .replace(/_/g, ' ')\n        .replace(/\\b\\w/g, (char) => char.toUpperCase())\n    : 'Unknown';\n\nconst getReferrerLabel = (referrer) => {\n  if (!referrer) return 'Direct';\n  try {\n    return new URL(referrer).hostname || referrer;\n  } catch (error) {\n    return referrer;\n  }\n};\n\nconst buildTopList = (map, limit = 5) =>\n  Array.from(map.entries())\n    .map(([label, count]) => ({ label, count }))\n    .sort((a, b) => b.count - a.count)\n    .slice(0, limit);\n\nconst incrementMap = (map, key) => {\n  const nextKey = key || 'Unknown';\n  map.set(nextKey, (map.get(nextKey) || 0) + 1);\n};\n\nfunction VisitorStatisticsManager() {\n  const { toast } = useToast();\n  const { hasPermission, isPlatformAdmin, isFullAccess } = usePermissions();\n  const { currentTenant } = useTenant();\n\n  const [summaryLoading, setSummaryLoading] = useState(false);\n  const [eventsLoading, setEventsLoading] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [events, setEvents] = useState([]);\n  const [page, setPage] = useState(1);\n  const [totalCount, setTotalCount] = useState(0);\n  const [summary, setSummary] = useState({\n    pageViews: 0,\n    uniqueVisitors: 0,\n    uniqueSessions: 0,\n    topPages: [],\n    topReferrers: [],\n    topDevices: [],\n    topCountries: [],\n    consentStates: [],\n  });\n\n  const canView = hasPermission('tenant.analytics.read') || isPlatformAdmin || isFullAccess;\n\n  const totalPages = useMemo(() => {\n    if (!totalCount) return 1;\n    return Math.max(1, Math.ceil(totalCount / EVENTS_PER_PAGE));\n  }, [totalCount]);\n\n  const fetchSummary = useCallback(async () => {\n    if (!canView) return;\n    if (!currentTenant?.id && !isPlatformAdmin && !isFullAccess) return;\n\n    setSummaryLoading(true);\n    try {\n      const startDate = new Date();\n      startDate.setDate(startDate.getDate() - SUMMARY_DAYS + 1);\n      const startDateIso = startDate.toISOString().slice(0, 10);\n\n      let dailyQuery = supabase\n        .from('analytics_daily')\n        .select('path, page_views, unique_visitors, unique_sessions, date')\n        .gte('date', startDateIso);\n\n      if (currentTenant?.id) {\n        dailyQuery = dailyQuery.eq('tenant_id', currentTenant.id);\n      }\n\n      const { data: dailyData, error: dailyError } = await dailyQuery;\n\n      if (dailyError) throw dailyError;\n\n      const pageMap = new Map();\n      const totals = {\n        pageViews: 0,\n        uniqueVisitors: 0,\n        uniqueSessions: 0,\n      };\n\n      (dailyData || []).forEach((row) => {\n        if (row.path === '__all__') {\n          totals.pageViews += row.page_views || 0;\n          totals.uniqueVisitors += row.unique_visitors || 0;\n          totals.uniqueSessions += row.unique_sessions || 0;\n          return;\n        }\n\n        const path = row.path || '/';\n        pageMap.set(path, (pageMap.get(path) || 0) + (row.page_views || 0));\n      });\n\n      const recentStart = new Date();\n      recentStart.setDate(recentStart.getDate() - RECENT_DAYS + 1);\n\n      let recentQuery = supabase\n        .from('analytics_events')\n        .select('referrer, device_type, country, consent_state, created_at')\n        .gte('created_at', recentStart.toISOString())\n        .order('created_at', { ascending: false })\n        .limit(1500);\n\n      if (currentTenant?.id) {\n        recentQuery = recentQuery.eq('tenant_id', currentTenant.id);\n      }\n\n      const { data: recentEvents, error: recentError } = await recentQuery;\n\n      if (recentError) throw recentError;\n\n      const referrerMap = new Map();\n      const deviceMap = new Map();\n      const countryMap = new Map();\n      const consentMap = new Map();\n\n      (recentEvents || []).forEach((event) => {\n        incrementMap(referrerMap, getReferrerLabel(event.referrer));\n        incrementMap(deviceMap, capitalize(event.device_type));\n        incrementMap(countryMap, event.country || 'Unknown');\n        incrementMap(consentMap, capitalize(event.consent_state || 'unknown'));\n      });\n\n      setSummary({\n        pageViews: totals.pageViews,\n        uniqueVisitors: totals.uniqueVisitors,\n        uniqueSessions: totals.uniqueSessions,\n        topPages: buildTopList(pageMap),\n        topReferrers: buildTopList(referrerMap),\n        topDevices: buildTopList(deviceMap),\n        topCountries: buildTopList(countryMap),\n        consentStates: buildTopList(consentMap),\n      });\n    } catch (error) {\n      console.error('Error fetching visitor summary:', error);\n      toast({\n        variant: 'destructive',\n        title: 'Error',\n        description: 'Failed to load visitor statistics',\n      });\n    } finally {\n      setSummaryLoading(false);\n    }\n  }, [canView, currentTenant?.id, isFullAccess, isPlatformAdmin, toast]);\n\n  const fetchEvents = useCallback(async () => {\n    if (!canView) return;\n    if (!currentTenant?.id && !isPlatformAdmin && !isFullAccess) return;\n\n    setEventsLoading(true);\n    try {\n      const from = (page - 1) * EVENTS_PER_PAGE;\n      const to = from + EVENTS_PER_PAGE - 1;\n\n      let query = supabase\n        .from('analytics_events')\n        .select(\n          'id, path, ip_address, visitor_id, session_id, referrer, device_type, country, consent_state, created_at, tenant_id',\n          { count: 'exact' },\n        )\n        .order('created_at', { ascending: false })\n        .range(from, to);\n\n      if (currentTenant?.id) {\n        query = query.eq('tenant_id', currentTenant.id);\n      }\n\n      if (searchQuery) {\n        query = query.or(\n          `path.ilike.%${searchQuery}%,ip_address.ilike.%${searchQuery}%,referrer.ilike.%${searchQuery}%`,\n        );\n      }\n\n      const { data, count, error } = await query;\n\n      if (error) throw error;\n\n      setEvents(data || []);\n      setTotalCount(count || 0);\n    } catch (error) {\n      console.error('Error fetching visitor events:', error);\n      toast({\n        variant: 'destructive',\n        title: 'Error',\n        description: 'Failed to load visitor events',\n      });\n    } finally {\n      setEventsLoading(false);\n    }\n  }, [canView, currentTenant?.id, isFullAccess, isPlatformAdmin, page, searchQuery, toast]);\n\n  useEffect(() => {\n    if (canView && (currentTenant?.id || isPlatformAdmin || isFullAccess)) {\n      fetchSummary();\n    }\n  }, [canView, currentTenant?.id, fetchSummary, isFullAccess, isPlatformAdmin]);\n\n  useEffect(() => {\n    if (canView && (currentTenant?.id || isPlatformAdmin || isFullAccess)) {\n      fetchEvents();\n    }\n  }, [canView, currentTenant?.id, fetchEvents, isFullAccess, isPlatformAdmin]);\n\n  if (!canView) {\n    return (\n      <div className=\"p-8 text-center\">\n        <p className=\"text-muted-foreground\">Access Denied</p>\n      </div>\n    );\n  }\n\n  return (\n    <AdminPageLayout requiredPermission=\"tenant.analytics.read\">\n      <PageHeader\n        title=\"Visitor Statistics\"\n        description=\"Monitor visits, page views, and traffic sources.\"\n        icon={LineChart}\n        breadcrumbs={[{ label: 'Visitor Statistics', icon: LineChart }]}\n        actions={(\n          <Button\n            variant=\"outline\"\n            onClick={() => {\n              fetchSummary();\n              fetchEvents();\n            }}\n            disabled={summaryLoading || eventsLoading}\n          >\n            <RefreshCw\n              className={`w-4 h-4 mr-2 ${summaryLoading || eventsLoading ? 'animate-spin' : ''}`}\n            />\n            Refresh\n          </Button>\n        )}\n      />\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Page Views (30d)</CardDescription>\n            <CardTitle className=\"text-2xl\">\n              {summaryLoading ? '...' : formatNumber(summary.pageViews)}\n            </CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Unique Visitors (30d)</CardDescription>\n            <CardTitle className=\"text-2xl\">\n              {summaryLoading ? '...' : formatNumber(summary.uniqueVisitors)}\n            </CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Sessions (30d)</CardDescription>\n            <CardTitle className=\"text-2xl\">\n              {summaryLoading ? '...' : formatNumber(summary.uniqueSessions)}\n            </CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-4 lg:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Top Pages</CardTitle>\n            <CardDescription>Most viewed pages in the last 30 days.</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {summary.topPages.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">No page view data yet.</p>\n            ) : (\n              summary.topPages.map((item) => (\n                <div key={item.label} className=\"flex items-center justify-between text-sm\">\n                  <span className=\"font-medium text-foreground\">{item.label}</span>\n                  <span className=\"text-muted-foreground\">{formatNumber(item.count)} views</span>\n                </div>\n              ))\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Top Referrers</CardTitle>\n            <CardDescription>Leading sources over the last week.</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {summary.topReferrers.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">No referrer data yet.</p>\n            ) : (\n              summary.topReferrers.map((item) => (\n                <div key={item.label} className=\"flex items-center justify-between text-sm\">\n                  <span className=\"font-medium text-foreground\">{item.label}</span>\n                  <span className=\"text-muted-foreground\">{formatNumber(item.count)}</span>\n                </div>\n              ))\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-4 lg:grid-cols-3\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Device Mix</CardTitle>\n            <CardDescription>Recent device breakdown.</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {summary.topDevices.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">No device data yet.</p>\n            ) : (\n              summary.topDevices.map((item) => (\n                <div key={item.label} className=\"flex items-center justify-between text-sm\">\n                  <span className=\"font-medium text-foreground\">{item.label}</span>\n                  <span className=\"text-muted-foreground\">{formatNumber(item.count)}</span>\n                </div>\n              ))\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Top Countries</CardTitle>\n            <CardDescription>Most active regions.</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {summary.topCountries.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">No country data yet.</p>\n            ) : (\n              summary.topCountries.map((item) => (\n                <div key={item.label} className=\"flex items-center justify-between text-sm\">\n                  <span className=\"font-medium text-foreground\">{item.label}</span>\n                  <span className=\"text-muted-foreground\">{formatNumber(item.count)}</span>\n                </div>\n              ))\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Consent Status</CardTitle>\n            <CardDescription>Latest consent responses.</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {summary.consentStates.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">No consent data yet.</p>\n            ) : (\n              summary.consentStates.map((item) => (\n                <div key={item.label} className=\"flex items-center justify-between text-sm\">\n                  <span className=\"font-medium text-foreground\">{item.label}</span>\n                  <span className=\"text-muted-foreground\">{formatNumber(item.count)}</span>\n                </div>\n              ))\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card className=\"border-border\">\n        <CardHeader>\n          <CardTitle>Recent Visits</CardTitle>\n          <CardDescription>Latest visitor events with IP and page path.</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between\">\n            <div className=\"relative flex-1 max-w-md\">\n              <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search by path, IP, or referrer\"\n                className=\"pl-9\"\n                value={searchQuery}\n                onChange={(event) => {\n                  setSearchQuery(event.target.value);\n                  setPage(1);\n                }}\n              />\n            </div>\n          </div>\n\n          <div className=\"mt-4 overflow-x-auto\">\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-muted/50 border-b border-border\">\n                <tr>\n                  <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Time</th>\n                  <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Page</th>\n                  <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">IP</th>\n                  <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Visitor</th>\n                  <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Device</th>\n                  <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Country</th>\n                  <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Referrer</th>\n                  <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Consent</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-border\">\n                {eventsLoading ? (\n                  <tr>\n                    <td colSpan=\"8\" className=\"px-4 py-6 text-center text-muted-foreground\">\n                      Loading visitor events...\n                    </td>\n                  </tr>\n                ) : events.length === 0 ? (\n                  <tr>\n                    <td colSpan=\"8\" className=\"px-4 py-6 text-center text-muted-foreground\">\n                      No visitor events found.\n                    </td>\n                  </tr>\n                ) : (\n                  events.map((event) => (\n                    <tr key={event.id} className=\"hover:bg-muted/50 transition-colors\">\n                      <td className=\"px-4 py-3 text-muted-foreground whitespace-nowrap\">\n                        {format(new Date(event.created_at), 'MMM dd, yyyy HH:mm')}\n                      </td>\n                      <td className=\"px-4 py-3 font-medium text-foreground\">{event.path}</td>\n                      <td className=\"px-4 py-3 font-mono text-xs text-muted-foreground\">\n                        {event.ip_address || '-'}\n                      </td>\n                      <td className=\"px-4 py-3 font-mono text-xs text-muted-foreground\">\n                        {event.visitor_id ? `${event.visitor_id.slice(0, 8)}...` : '-'}\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {capitalize(event.device_type)}\n                        </Badge>\n                      </td>\n                      <td className=\"px-4 py-3 text-muted-foreground\">\n                        {event.country || '-'}\n                      </td>\n                      <td className=\"px-4 py-3 text-muted-foreground\">\n                        {getReferrerLabel(event.referrer)}\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {capitalize(event.consent_state || 'unknown')}\n                        </Badge>\n                      </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n\n          <div className=\"mt-4 flex flex-wrap items-center justify-between gap-2 text-sm text-muted-foreground\">\n            <span>\n              Showing {events.length} of {formatNumber(totalCount)} visits\n            </span>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setPage((prev) => Math.max(1, prev - 1))}\n                disabled={page <= 1}\n              >\n                Previous\n              </Button>\n              <span className=\"text-xs\">\n                Page {page} of {totalPages}\n              </span>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setPage((prev) => Math.min(totalPages, prev + 1))}\n                disabled={page >= totalPages}\n              >\n                Next\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </AdminPageLayout>\n  );\n}\n\nexport default VisitorStatisticsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/VisualPagesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport PagesManager from './PagesManager';\nimport ThemeLayoutManager from './ThemeLayoutManager';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Layers, Palette, ShieldAlert } from 'lucide-react';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { AdminPageLayout, PageHeader } from '@/templates/flowbite-admin';\n\n/**\n * VisualPagesManager\n * Manages both regular visual pages and system theme layouts.\n */\nconst VisualPagesManager = () => {\n    const { hasPermission } = usePermissions();\n\n    if (!hasPermission('tenant.visual_pages.read')) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-white rounded-xl border border-slate-200 p-12 text-center\">\n                <div className=\"p-4 bg-red-50 rounded-full mb-4\">\n                    <ShieldAlert className=\"w-12 h-12 text-red-500\" />\n                </div>\n                <h3 className=\"text-xl font-bold text-slate-800\">Access Denied</h3>\n                <p className=\"text-slate-500 mt-2\">You do not have permission to view this page.</p>\n            </div>\n        );\n    }\n\n    return (\n        <AdminPageLayout requiredPermission=\"tenant.visual_pages.read\">\n            <PageHeader\n                title=\"Visual Builder\"\n                description=\"Manage your visual pages and system theme templates.\"\n                icon={Layers}\n                breadcrumbs={[{ label: 'Visual Pages', icon: Layers }]}\n            />\n\n            <Tabs defaultValue=\"pages\" className=\"w-full\">\n                <div className=\"bg-slate-100 dark:bg-slate-800 p-1 rounded-lg inline-flex mb-6\">\n                    <TabsList className=\"bg-transparent dark:text-slate-200\">\n                        <TabsTrigger value=\"pages\" className=\"flex items-center gap-2 px-4 data-[state=active]:bg-white dark:data-[state=active]:bg-slate-950 dark:data-[state=active]:text-slate-100\">\n                            <Layers className=\"w-4 h-4\" /> Content Pages\n                        </TabsTrigger>\n                        <TabsTrigger value=\"layouts\" className=\"flex items-center gap-2 px-4 data-[state=active]:bg-white dark:data-[state=active]:bg-slate-950 dark:data-[state=active]:text-slate-100\">\n                            <Palette className=\"w-4 h-4\" /> Theme Layouts\n                        </TabsTrigger>\n                    </TabsList>\n                </div>\n\n                <TabsContent value=\"pages\" className=\"mt-0\">\n                    {/* Render regular pages (page_type = regular) */}\n                    <PagesManager onlyVisual={true} defaultFilters={{ page_type: 'regular' }} />\n                </TabsContent>\n\n                <TabsContent value=\"layouts\" className=\"mt-0\">\n                    <ThemeLayoutManager />\n                </TabsContent>\n            </Tabs>\n        </AdminPageLayout>\n    );\n};\n\nexport default VisualPagesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/__tests__/AccessControl.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'perm' is defined but never used.","line":78,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"perm"},"fix":{"range":[2536,2540],"text":""},"desc":"Remove unused variable 'perm'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'perm' is defined but never used.","line":116,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":116,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"perm"},"fix":{"range":[4004,4008],"text":""},"desc":"Remove unused variable 'perm'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { render, screen, waitFor } from '@testing-library/react';\nimport SeoManager from '../SeoManager';\nimport WidgetsManager from '../widgets/WidgetsManager';\n// Note: We import mocked hooks but verify them in the test\nimport { usePermissions } from '@/contexts/PermissionContext';\n\n// --- MOCKS ---\nvi.mock('@/contexts/PermissionContext', () => ({\n    usePermissions: vi.fn(),\n}));\n\nvi.mock('@/contexts/SupabaseAuthContext', () => ({\n    useAuth: vi.fn(() => ({ user: { id: '123' } })),\n}));\n\nvi.mock('@/contexts/TenantContext', () => ({\n    useTenant: vi.fn(() => ({ currentTenant: { id: 'tenant-1' } })),\n}));\n\nvi.mock('react-i18next', () => ({\n    useTranslation: () => ({ t: (key) => key }),\n}));\n\nvi.mock('react-helmet-async', () => ({\n    Helmet: ({ children }) => <>{children}</>\n}));\n\n// Mock Supabase client\nvi.mock('@/lib/customSupabaseClient', () => ({\n    supabase: {\n        from: vi.fn(() => ({\n            select: vi.fn().mockReturnThis(),\n            eq: vi.fn().mockReturnThis(),\n            is: vi.fn().mockReturnThis(),\n            single: vi.fn().mockResolvedValue({ data: {}, error: null }),\n            maybeSingle: vi.fn().mockResolvedValue({ data: null, error: null }),\n            in: vi.fn().mockReturnThis(),\n            order: vi.fn().mockReturnThis(),\n            range: vi.fn().mockReturnThis(),\n            delete: vi.fn().mockReturnThis(),\n            update: vi.fn().mockReturnThis(),\n            insert: vi.fn().mockReturnThis(),\n        }))\n    }\n}));\n\n// Mock AdminPageLayout to capture props\nvi.mock('@/templates/flowbite-admin', () => ({\n    AdminPageLayout: ({ children, requiredPermission }) => (\n        <div data-testid=\"admin-layout\" data-required-permission={requiredPermission}>\n            {children}\n        </div>\n    ),\n    PageHeader: ({ title }) => <h1>{title}</h1>,\n}));\n\n// Mock UI components that might be used\nvi.mock('@/components/ui/use-toast', () => ({\n    useToast: () => ({ toast: vi.fn() })\n}));\n\n// Mock UI button/shadcn\nvi.mock('@/components/ui/button', () => ({\n    Button: ({ children, ...props }) => <button {...props}>{children}</button>\n}));\n// --- END MOCKS ---\n\ndescribe('Access Control', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    describe('SeoManager', () => {\n        it('renders Access Denied when \"tenant.seo.read\" is missing', async () => {\n            // Setup: User has NO permissions\n            usePermissions.mockReturnValue({\n                hasPermission: (perm) => false,\n                userRole: 'editor',\n                loading: false\n            });\n\n            render(<SeoManager />);\n\n            // Expect Access Denied UI\n            await waitFor(() => {\n                expect(screen.getByText('seo_manager.access_denied')).toBeInTheDocument();\n            });\n            // Expect AdminPageLayout NOT to be rendered\n            expect(screen.queryByTestId('admin-layout')).not.toBeInTheDocument();\n        });\n\n        it('renders AdminPageLayout with correct requiredPermission when granted', async () => {\n            // Setup: User HAS \"tenant.seo.read\"\n            usePermissions.mockReturnValue({\n                hasPermission: (perm) => perm === 'tenant.seo.read',\n                userRole: 'editor',\n                loading: false\n            });\n\n            render(<SeoManager />);\n\n            // Expect AdminLayout\n            await waitFor(() => {\n                const layout = screen.getByTestId('admin-layout');\n                expect(layout).toBeInTheDocument();\n                // Verify verification: The layout prop must match the new granular permission\n                expect(layout).toHaveAttribute('data-required-permission', 'tenant.seo.read');\n            });\n        });\n    });\n\n    describe('WidgetsManager', () => {\n        it('renders Access Denied when \"tenant.widgets.read\" is missing', async () => {\n            usePermissions.mockReturnValue({\n                hasPermission: (perm) => false,\n                userRole: 'editor',\n                loading: false\n            });\n\n            render(<WidgetsManager />);\n\n            await waitFor(() => {\n                expect(screen.getByText('common.access_denied')).toBeInTheDocument();\n            });\n        });\n\n        it('renders content when \"tenant.widgets.read\" is granted', async () => {\n            usePermissions.mockReturnValue({\n                hasPermission: (perm) => perm === 'tenant.widgets.read',\n                userRole: 'editor',\n                loading: false\n            });\n\n            render(<WidgetsManager />);\n\n            // If granted, it should NOT show Access Denied.\n            await waitFor(() => {\n                expect(screen.queryByText('common.access_denied')).not.toBeInTheDocument();\n            });\n        });\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/__tests__/TwoFactorSettings.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/dynamic/DynamicResourceManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport AdminPageLayout from '@/templates/flowbite-admin/layouts/AdminPageLayout';\nimport { PageHeader } from '@/templates/flowbite-admin';\nimport SchemaForm from './SchemaForm';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport * as Icons from 'lucide-react';\n\nconst DynamicResourceManager = () => {\n    const { resourceKey } = useParams();\n    const [resource, setResource] = useState(null);\n    const [schema, setSchema] = useState(null);\n    const [data, setData] = useState({});\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    const [error, setError] = useState(null);\n    const [success, setSuccess] = useState(null);\n\n    const fetchResourceAndSchema = useCallback(async () => {\n        setLoading(true);\n        setError(null);\n        try {\n            // 1. Fetch Resource Definition\n            const { data: resData, error: resError } = await supabase\n                .from('resources_registry')\n                .select('*')\n                .eq('key', resourceKey)\n                .single();\n\n            if (resError) throw new Error(`Resource '${resourceKey}' not found: ${resError.message}`);\n            setResource(resData);\n\n            // 2. Fetch UI Schema (default form)\n            const { data: schemaData, error: schemaError } = await supabase\n                .from('ui_configs')\n                .select('schema')\n                .eq('resource_key', resourceKey)\n                .eq('type', 'form')\n                .limit(1)\n                .maybeSingle();\n\n            if (schemaError) console.warn('Schema fetch error:', schemaError);\n\n            if (schemaData) {\n                setSchema(schemaData.schema);\n            } else {\n                // Fallback or empty schema\n                setSchema({ fields: [] });\n            }\n\n            // 3. Fetch Data (Strategy depends on resource type)\n            if (resData.type === 'settings') {\n                const { data: settingsData } = await supabase\n                    .from('settings')\n                    .select('value')\n                    .eq('key', resourceKey)\n                    .maybeSingle();\n\n                if (settingsData?.value) {\n                    setData(settingsData.value);\n                }\n            } else {\n                // For entities, we might show a table first, but if this is an 'edit' route...\n                // For now, let's assume this Dynamic Manager handles 'settings' primarily.\n            }\n\n        } catch (err) {\n            setError(err.message);\n        } finally {\n            setLoading(false);\n        }\n    }, [resourceKey]);\n\n    useEffect(() => {\n        fetchResourceAndSchema();\n    }, [fetchResourceAndSchema]);\n\n    const handleSave = async (formData) => {\n        setSaving(true);\n        setSuccess(null);\n        setError(null);\n\n        try {\n            if (resource.type === 'settings') {\n                const { error: saveError } = await supabase\n                    .from('settings')\n                    .upsert({\n                        key: resourceKey,\n                        value: formData,\n                        group: resourceKey, // often the group is same as key for simple modules\n                        updated_at: new Date()\n                    });\n\n                if (saveError) throw saveError;\n                setSuccess('Settings saved successfully!');\n            } else {\n                throw new Error('Saving non-settings resources not yet implemented in generic handler');\n            }\n        } catch (err) {\n            setError('Failed to save: ' + err.message);\n        } finally {\n            setSaving(false);\n        }\n    };\n\n    if (loading) {\n        return (\n            <AdminPageLayout>\n                <div className=\"flex justify-center p-12\">\n                    <Icons.Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n                </div>\n            </AdminPageLayout>\n        );\n    }\n\n    if (error && !resource) {\n        return (\n            <AdminPageLayout>\n                <Alert variant=\"destructive\">\n                    <AlertTitle>Failed to load resource</AlertTitle>\n                    <AlertDescription>{error}</AlertDescription>\n                </Alert>\n            </AdminPageLayout>\n        );\n    }\n\n    // Dynamic Icon\n    const IconComponent = Icons[resource?.icon] || Icons.Box;\n    const permissionPrefix = resource?.permission_prefix || `${resource.scope}.${resource.key}`;\n\n    return (\n        <AdminPageLayout requiredPermission={`${permissionPrefix}.read`}>\n            <PageHeader\n                title={resource.label}\n                description={`Manage ${resource.label}`}\n                icon={IconComponent}\n                breadcrumbs={[{ label: resource.label, icon: IconComponent }]}\n            />\n\n            {error && (\n                <div className=\"mb-4\">\n                    <Alert variant=\"destructive\">\n                        <AlertTitle>Action failed</AlertTitle>\n                        <AlertDescription>{error}</AlertDescription>\n                    </Alert>\n                </div>\n            )}\n            {success && (\n                <div className=\"mb-4\">\n                    <Alert className=\"border-emerald-200 bg-emerald-50 text-emerald-700\">\n                        <AlertTitle>Saved</AlertTitle>\n                        <AlertDescription>{success}</AlertDescription>\n                    </Alert>\n                </div>\n            )}\n\n            {schema && schema.fields?.length > 0 ? (\n                <SchemaForm\n                    schema={schema}\n                    initialData={data}\n                    onSubmit={handleSave}\n                    loading={saving}\n                />\n            ) : (\n                <Alert className=\"border-amber-200 bg-amber-50 text-amber-700\">\n                    <AlertTitle>Schema missing</AlertTitle>\n                    <AlertDescription>\n                        No UI Schema defined for this resource. Please ask an admin to configure the <code>ui_configs</code> table.\n                    </AlertDescription>\n                </Alert>\n            )}\n        </AdminPageLayout>\n    );\n};\n\nexport default DynamicResourceManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/dynamic/SchemaForm.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  26 |     useEffect(() => {\n  27 |         if (initialData) {\n> 28 |             setFormData(initialData);\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  29 |         }\n  30 |     }, [initialData]);\n  31 |","line":28,"column":13,"nodeType":null,"endLine":28,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Loader2, Save } from 'lucide-react';\n\n/**\n * Renders a form based on a JSON schema.\n * \n * Schema Format:\n * {\n *   \"fields\": [\n *     { \"name\": \"title\", \"label\": \"Title\", \"type\": \"text\", \"required\": true },\n *     { \"name\": \"description\", \"label\": \"Description\", \"type\": \"textarea\" },\n *     { \"name\": \"category\", \"label\": \"Category\", \"type\": \"select\", \"options\": [{\"value\": \"a\", \"label\": \"A\"}] }\n *   ]\n * }\n */\nconst SchemaForm = ({ schema, initialData = {}, onSubmit, loading = false }) => {\n    const [formData, setFormData] = useState({});\n\n    useEffect(() => {\n        if (initialData) {\n            setFormData(initialData);\n        }\n    }, [initialData]);\n\n    const handleChange = (name, value) => {\n        setFormData(prev => ({ ...prev, [name]: value }));\n    };\n\n    const handleSubmit = (e) => {\n        e.preventDefault();\n        onSubmit(formData);\n    };\n\n    if (!schema?.fields) return <div>Invalid Schema</div>;\n\n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <Card>\n                <CardContent className=\"flex flex-col gap-4 p-6\">\n                    {schema.fields.map((field) => {\n                        const value = formData[field.name];\n                        const inputValue = value ?? '';\n\n                        return (\n                            <div key={field.name}>\n                                <div className=\"mb-2 flex items-center gap-1\">\n                                    <Label htmlFor={field.name}>{field.label}</Label>\n                                    {field.required && <span className=\"text-destructive\">*</span>}\n                                </div>\n\n                                {/* TEXT INPUT */}\n                                {field.type === 'text' && (\n                                    <Input\n                                        id={field.name}\n                                        type=\"text\"\n                                        placeholder={field.placeholder}\n                                        required={field.required}\n                                        value={inputValue}\n                                        onChange={(e) => handleChange(field.name, e.target.value)}\n                                    />\n                                )}\n\n                                {/* NUMBER INPUT */}\n                                {field.type === 'number' && (\n                                    <Input\n                                        id={field.name}\n                                        type=\"number\"\n                                        placeholder={field.placeholder}\n                                        required={field.required}\n                                        value={inputValue}\n                                        onChange={(e) => handleChange(field.name, e.target.value)}\n                                    />\n                                )}\n\n                                {/* TEXTAREA */}\n                                {field.type === 'textarea' && (\n                                    <Textarea\n                                        id={field.name}\n                                        placeholder={field.placeholder}\n                                        required={field.required}\n                                        rows={4}\n                                        value={inputValue}\n                                        onChange={(e) => handleChange(field.name, e.target.value)}\n                                    />\n                                )}\n\n                                {/* SELECT */}\n                                {field.type === 'select' && (\n                                    <Select\n                                        value={value || undefined}\n                                        onValueChange={(selected) => handleChange(field.name, selected)}\n                                    >\n                                        <SelectTrigger id={field.name}>\n                                            <SelectValue placeholder=\"Select an option...\" />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            {field.options?.map((opt) => (\n                                                <SelectItem key={opt.value} value={opt.value}>\n                                                    {opt.label}\n                                                </SelectItem>\n                                            ))}\n                                        </SelectContent>\n                                    </Select>\n                                )}\n\n                                {/* BOOLEAN / CHECKBOX */}\n                                {field.type === 'boolean' && (\n                                    <div className=\"flex items-center gap-2\">\n                                        <Checkbox\n                                            id={field.name}\n                                            checked={!!value}\n                                            onCheckedChange={(checked) => handleChange(field.name, Boolean(checked))}\n                                        />\n                                        <Label htmlFor={field.name}>{field.helpText || 'Enabled'}</Label>\n                                    </div>\n                                )}\n                            </div>\n                        );\n                    })}\n                </CardContent>\n            </Card>\n\n            <div className=\"flex justify-end\">\n                <Button type=\"submit\" disabled={loading}>\n                    {loading ? (\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    ) : (\n                        <Save className=\"mr-2 h-4 w-4\" />\n                    )}\n                    {loading ? 'Saving...' : 'Save Changes'}\n                </Button>\n            </div>\n        </form>\n    );\n};\n\nexport default SchemaForm;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/media/FileStats.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { motion } from 'framer-motion';\nimport { FileText, Image, Film, HardDrive } from 'lucide-react';\nimport { formatBytes } from '@/lib/utils';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nfunction StatCard({ title, value, subValue, icon: Icon, color, loading }) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"bg-white rounded-xl p-6 border border-slate-200 shadow-sm flex items-start justify-between\"\n    >\n      <div className=\"space-y-1\">\n        <p className=\"text-sm font-medium text-slate-500\">{title}</p>\n        {loading ? (\n          <Skeleton className=\"h-8 w-24\" />\n        ) : (\n          <h3 className=\"text-2xl font-bold text-slate-900\">{value}</h3>\n        )}\n        {subValue && !loading && (\n          <p className=\"text-xs text-slate-400\">{subValue}</p>\n        )}\n        {loading && subValue && (\n          <Skeleton className=\"h-3 w-16 mt-1\" />\n        )}\n      </div>\n      <div className={`p-3 rounded-lg bg-${color}-50 text-${color}-600`}>\n        <Icon className=\"w-5 h-5\" />\n      </div>\n    </motion.div>\n  );\n}\n\nexport function FileStats({ stats, loading }) {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n      <StatCard\n        title=\"Total Storage\"\n        value={formatBytes(stats.total_size)}\n        icon={HardDrive}\n        color=\"blue\"\n        loading={loading}\n      />\n      <StatCard\n        title=\"Total Files\"\n        value={stats.total_files}\n        icon={FileText}\n        color=\"indigo\"\n        loading={loading}\n      />\n      <StatCard\n        title=\"Images\"\n        value={stats.image_count}\n        icon={Image}\n        color=\"pink\"\n        loading={loading}\n      />\n      <StatCard\n        title=\"Videos & Docs\"\n        value={stats.video_count + stats.doc_count}\n        subValue={`${stats.video_count} videos, ${stats.doc_count} docs`}\n        icon={Film}\n        color=\"orange\"\n        loading={loading}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/media/FileUploader.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useCallback } from 'react';\nimport { Upload, Loader2 } from 'lucide-react';\nimport { useDropzone } from 'react-dropzone';\nimport { Progress } from '@/components/ui/progress';\n\nimport { useToast } from '@/components/ui/use-toast';\n\nexport function FileUploader({ onUpload, uploading, progress = 0 }) {\n  const { toast } = useToast();\n\n  const onDrop = useCallback((acceptedFiles, fileRejections) => {\n    // Handle rejections\n    if (fileRejections?.length > 0) {\n      fileRejections.forEach(({ file, errors }) => {\n        errors.forEach(e => {\n          if (e.code === 'file-too-large') {\n            toast({ variant: 'destructive', title: 'File Too Large', description: `${file.name} exceeds the 50MB limit.` });\n          } else if (e.code === 'file-invalid-type') {\n            toast({ variant: 'destructive', title: 'Invalid File Type', description: `${file.name} is not supported.` });\n          } else {\n            toast({ variant: 'destructive', title: 'Upload Failed', description: `${file.name}: ${e.message}` });\n          }\n        });\n      });\n    }\n\n    if (acceptedFiles?.length > 0) {\n      onUpload(acceptedFiles);\n    }\n  }, [onUpload, toast]);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    maxSize: 50 * 1024 * 1024, // 50MB\n    accept: {\n      'image/*': [],\n      'video/*': [],\n      'application/pdf': []\n    }\n  });\n\n  return (\n    <div className=\"w-full\">\n      <div\n        {...getRootProps()}\n        className={`border-2 border-dashed rounded-xl p-8 text-center transition-colors cursor-pointer\n          ${isDragActive ? 'border-blue-500 bg-blue-50' : 'border-slate-200 hover:border-slate-300 hover:bg-slate-50'}\n          ${uploading ? 'opacity-50 pointer-events-none' : ''}\n        `}\n      >\n        <input {...getInputProps()} />\n\n        {uploading ? (\n          <div className=\"flex flex-col items-center justify-center py-4\">\n            <Loader2 className=\"w-10 h-10 text-blue-500 animate-spin mb-4\" />\n            <p className=\"text-sm font-medium text-slate-700\">Uploading files...</p>\n            {progress > 0 && <Progress value={progress} className=\"w-64 mt-4\" />}\n          </div>\n        ) : (\n          <div className=\"flex flex-col items-center justify-center py-4\">\n            <div className=\"bg-blue-100 p-4 rounded-full mb-4\">\n              <Upload className=\"w-6 h-6 text-blue-600\" />\n            </div>\n            <p className=\"text-lg font-medium text-slate-700 mb-1\">\n              {isDragActive ? 'Drop files here' : 'Drag & drop files here'}\n            </p>\n            <p className=\"text-sm text-slate-500 mb-4\">or click to browse</p>\n            <div className=\"text-xs text-slate-400\">\n              Supports images, videos, documents up to 10MB\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/media/MediaLibrary.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useToast } from '@/components/ui/use-toast';\nimport { Upload, File, Trash2, Copy, Search, Loader2, Grid, List, RefreshCw, Info, Link2, ChevronLeft, ChevronRight } from 'lucide-react';\nimport { Card } from '@/components/ui/card';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogTrigger } from '@/components/ui/dialog';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useMedia } from '@/hooks/useMedia'; // Import useMedia\nimport { supabase } from '@/lib/customSupabaseClient'; // Keep for usage analysis only if needed, or move to hook\n\nconst formatFileSize = (bytes) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n};\n\nconst MediaLibrary = ({ onSelect, selectionMode = false, refreshTrigger = 0, isTrashView = false, categoryId = null }) => {\n    const { toast } = useToast();\n    const { checkAccess, isPlatformAdmin } = usePermissions();\n\n    // Use the hook\n    const {\n        fetchFiles: hookFetchFiles,\n        uploadFile,\n        softDeleteFile,\n        bulkSoftDelete,\n        restoreFile,\n        getFileUrl,\n        uploading: hookUploading\n    } = useMedia();\n\n    const canUpload = checkAccess('create', 'files');\n    const canDelete = checkAccess('delete', 'files');\n\n    const [files, setFiles] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [query, setQuery] = useState('');\n    const [viewMode, setViewMode] = useState('grid');\n    const [usageData, setUsageData] = useState({});\n    const [deleteConfirm, setDeleteConfirm] = useState({ open: false, fileId: null, fileName: '', isBulk: false });\n    const [selectedFiles, setSelectedFiles] = useState(new Set());\n\n    // Pagination state\n    const [currentPage, setCurrentPage] = useState(1);\n    const [itemsPerPage, setItemsPerPage] = useState(12);\n    const [totalItems, setTotalItems] = useState(0);\n    const totalPages = Math.ceil(totalItems / itemsPerPage);\n\n    const fetchFiles = useCallback(async () => {\n        setLoading(true);\n        try {\n            const { data, count } = await hookFetchFiles({\n                page: currentPage,\n                limit: itemsPerPage,\n                query,\n                isTrash: isTrashView,\n                categoryId // Pass categoryId to hook\n            });\n\n            setFiles(data);\n            setTotalItems(count);\n\n            // Fetch usage data for files (keep existing logic or move to hook later)\n            if (!isTrashView && data?.length > 0) {\n                fetchUsageData();\n            }\n        } catch (err) {\n            console.error('Error fetching files:', err);\n        } finally {\n            setLoading(false);\n        }\n    }, [hookFetchFiles, query, isTrashView, currentPage, itemsPerPage, categoryId]);\n\n    const fetchUsageData = async () => {\n        try {\n            const { data: usage, error } = await supabase.rpc('analyze_file_usage');\n            if (!error && usage) {\n                const usageMap = {};\n                usage.forEach(u => {\n                    usageMap[u.file_path] = {\n                        count: u.usage_count || 0,\n                        modules: u.modules || [],\n                        details: u.details || []\n                    };\n                });\n                setUsageData(usageMap);\n            }\n        } catch (err) {\n            console.warn('Usage analysis not available:', err);\n        }\n    };\n\n    useEffect(() => {\n        fetchFiles();\n    }, [fetchFiles, refreshTrigger]);\n\n    const onDrop = useCallback(async (acceptedFiles, fileRejections) => {\n        // Handle rejections\n        if (fileRejections?.length > 0) {\n            fileRejections.forEach(({ file, errors }) => {\n                errors.forEach(e => {\n                    if (e.code === 'file-too-large') {\n                        toast({ variant: 'destructive', title: 'File Too Large', description: `${file.name} exceeds the 50MB limit.` });\n                    } else if (e.code === 'file-invalid-type') {\n                        toast({ variant: 'destructive', title: 'Invalid File Type', description: `${file.name} is not supported.` });\n                    } else {\n                        toast({ variant: 'destructive', title: 'Upload Failed', description: `${file.name}: ${e.message}` });\n                    }\n                });\n            });\n        }\n\n        if (acceptedFiles.length === 0) return;\n\n        let successCount = 0;\n\n        for (const file of acceptedFiles) {\n            try {\n                if (!canUpload) {\n                    throw new Error('Permission denied: Cannot upload files.');\n                }\n\n                await uploadFile(file);\n                successCount++;\n            } catch (err) {\n                console.error(`Failed to upload ${file.name}: `, err);\n                toast({ variant: 'destructive', title: 'Upload Failed', description: `Could not upload ${file.name} ` });\n            }\n        }\n\n        if (successCount > 0) {\n            toast({ title: 'Upload Complete', description: `${successCount} files uploaded successfully.` });\n            fetchFiles();\n        }\n    }, [fetchFiles, toast, canUpload, uploadFile]);\n\n    // ... dropzone ...\n    const { getRootProps, getInputProps, isDragActive } = useDropzone({\n        onDrop,\n        noClick: selectionMode,\n        maxSize: 50 * 1024 * 1024, // 50MB\n        accept: {\n            'image/*': [],\n            'video/*': [],\n            'application/pdf': []\n        }\n    });\n\n    // Open delete confirmation dialog\n    const handleDelete = (id, fileName = 'this file') => {\n        setDeleteConfirm({ open: true, fileId: id, fileName });\n    };\n\n    // Perform actual delete after confirmation\n    const confirmDelete = async () => {\n        if (!canDelete) {\n            toast({ variant: 'destructive', title: 'Permission Denied', description: 'You do not have permission to delete files.' });\n            return;\n        }\n        if (isTrashView) {\n            toast({ variant: 'destructive', title: 'Action Disabled', description: 'Permanent delete is disabled. Restore files instead.' });\n            return;\n        }\n        const id = deleteConfirm.fileId;\n        if (!id) return;\n\n        setDeleteConfirm({ open: false, fileId: null, fileName: '' });\n\n        const success = await softDeleteFile(id);\n        if (success) {\n            fetchFiles();\n            setSelectedFiles(new Set());\n        }\n    };\n\n    // ... selection helpers ...\n    const toggleSelect = (fileId) => {\n        setSelectedFiles(prev => {\n            const newSet = new Set(prev);\n            if (newSet.has(fileId)) {\n                newSet.delete(fileId);\n            } else {\n                newSet.add(fileId);\n            }\n            return newSet;\n        });\n    };\n\n    const selectAll = () => {\n        setSelectedFiles(new Set(files.map(f => f.id)));\n    };\n\n    const clearSelection = () => {\n        setSelectedFiles(new Set());\n    };\n\n    const isAllSelected = files.length > 0 && selectedFiles.size === files.length;\n    const hasSelection = selectedFiles.size > 0;\n\n    // Bulk delete handler\n    const handleBulkDelete = () => {\n        if (isTrashView) {\n            toast({ variant: 'destructive', title: 'Action Disabled', description: 'Permanent delete is disabled. Restore files instead.' });\n            return;\n        }\n        const count = selectedFiles.size;\n        setDeleteConfirm({\n            open: true,\n            fileId: null,\n            fileName: `${count} file${count > 1 ? 's' : ''}`,\n            isBulk: true\n        });\n    };\n\n    // Bulk delete confirmation\n    const confirmBulkDelete = async () => {\n        if (!canDelete) {\n            toast({ variant: 'destructive', title: 'Permission Denied', description: 'You do not have permission to delete files.' });\n            return;\n        }\n\n        const ids = Array.from(selectedFiles);\n        setDeleteConfirm({ open: false, fileId: null, fileName: '', isBulk: false });\n\n        const { success } = await bulkSoftDelete(ids);\n\n        if (success > 0) {\n            setSelectedFiles(new Set());\n            fetchFiles();\n        }\n    };\n\n    const handleRestore = async (id) => {\n        const success = await restoreFile(id);\n        if (success) fetchFiles();\n    };\n\n    const copyToClipboard = (url) => {\n        navigator.clipboard.writeText(url);\n        toast({ title: 'Copied', description: 'URL copied to clipboard' });\n    };\n\n    // Pass uploading state from hook\n    const uploading = hookUploading;\n\n    return (\n        <div className=\"space-y-6 p-4\">\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n                <div className=\"flex items-center gap-2 w-full md:w-auto\">\n                    <div className=\"relative flex-1 md:w-64\">\n                        <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-slate-400\" />\n                        <Input\n                            className=\"pl-9\"\n                            placeholder=\"Search files...\"\n                            value={query}\n                            onChange={e => setQuery(e.target.value)}\n                        />\n                    </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <Button variant={viewMode === 'grid' ? 'secondary' : 'ghost'} size=\"icon\" onClick={() => setViewMode('grid')}>\n                        <Grid className=\"w-4 h-4\" />\n                    </Button>\n                    <Button variant={viewMode === 'list' ? 'secondary' : 'ghost'} size=\"icon\" onClick={() => setViewMode('list')}>\n                        <List className=\"w-4 h-4\" />\n                    </Button>\n                </div>\n            </div>\n\n            {/* Selection Toolbar */}\n            {!selectionMode && files.length > 0 && (\n                <div className=\"flex items-center justify-between bg-slate-50 rounded-lg px-4 py-2 border border-slate-200\">\n                    <div className=\"flex items-center gap-3\">\n                        <Checkbox\n                            checked={isAllSelected}\n                            onCheckedChange={(checked) => checked ? selectAll() : clearSelection()}\n                            id=\"select-all\"\n                        />\n                        <label htmlFor=\"select-all\" className=\"text-sm text-slate-600 cursor-pointer\">\n                            {isAllSelected ? 'Deselect All' : 'Select All'} ({files.length} files)\n                        </label>\n                        {hasSelection && (\n                            <span className=\"text-sm font-medium text-blue-600\">\n                                {selectedFiles.size} selected\n                            </span>\n                        )}\n                    </div>\n                    {hasSelection && (\n                        <div className=\"flex items-center gap-2\">\n                            <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={clearSelection}\n                                className=\"text-slate-500\"\n                            >\n                                Clear Selection\n                            </Button>\n                            {!isTrashView && canDelete && (\n                                <Button\n                                    variant=\"destructive\"\n                                    size=\"sm\"\n                                    onClick={handleBulkDelete}\n                                    className=\"gap-1\"\n                                >\n                                    <Trash2 className=\"w-4 h-4\" />\n                                    Delete Selected ({selectedFiles.size})\n                                </Button>\n                            )}\n                        </div>\n                    )}\n                </div>\n            )}\n\n\n\n            {!selectionMode && !isTrashView && canUpload && (\n                <div {...getRootProps()} className={`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-colors ${isDragActive ? 'border-blue-500 bg-blue-50' : 'border-slate-300 hover:border-blue-400'} `}>\n                    <input {...getInputProps()} />\n                    {uploading ? (\n                        <div className=\"flex flex-col items-center gap-2 text-blue-600\">\n                            <Loader2 className=\"w-8 h-8 animate-spin\" />\n                            <p>Uploading files...</p>\n                        </div>\n                    ) : (\n                        <div className=\"flex flex-col items-center gap-2 text-slate-500\">\n                            <Upload className=\"w-8 h-8 text-slate-400\" />\n                            <p className=\"font-medium\">Drag & drop files here, or click to select files</p>\n                            <p className=\"text-sm text-slate-400\">Supports images, documents, and videos</p>\n                        </div>\n                    )}\n                </div>\n            )}\n\n            {loading ? (\n                <div className=\"text-center py-12 text-slate-500\">Loading library...</div>\n            ) : files.length === 0 ? (\n                <div className=\"text-center py-12 text-slate-400\">\n                    {isTrashView ? 'Trash is empty.' : 'No files found. Upload some!'}\n                </div>\n            ) : viewMode === 'grid' ? (\n                <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4\">\n                    {files.map(file => (\n                        <Card key={file.id} className={`overflow-hidden group relative hover:shadow-md transition-shadow ${selectedFiles.has(file.id) ? 'ring-2 ring-blue-500' : ''}`}>\n                            {/* Selection Checkbox */}\n                            {!selectionMode && (\n                                <div className=\"absolute top-2 left-2 z-10\">\n                                    <Checkbox\n                                        checked={selectedFiles.has(file.id)}\n                                        onCheckedChange={() => toggleSelect(file.id)}\n                                        className=\"bg-white/90 border-slate-300\"\n                                    />\n                                </div>\n                            )}\n                            <div className=\"aspect-square bg-slate-100 flex items-center justify-center relative overflow-hidden\">\n                                {file.file_type.startsWith('image/') ? (\n                                    <img src={getFileUrl(file)} alt={file.name} className=\"w-full h-full object-cover\" />\n                                ) : (\n                                    <File className=\"w-10 h-10 text-slate-400\" />\n                                )}\n                                <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2\">\n                                    {!selectionMode && (\n                                        <>\n                                            <Button size=\"icon\" variant=\"secondary\" className=\"h-8 w-8\" onClick={() => copyToClipboard(getFileUrl(file))} title=\"Copy URL\">\n                                                <Copy className=\"w-4 h-4\" />\n                                            </Button>\n                                            {isTrashView ? (\n                                                <Button size=\"icon\" variant=\"secondary\" className=\"h-8 w-8 text-green-600\" onClick={() => handleRestore(file.id)} title=\"Restore\">\n                                                    <RefreshCw className=\"w-4 h-4\" />\n                                                </Button>\n                                            ) : null}\n                                            {!isTrashView && canDelete && (\n                                                <Button\n                                                    type=\"button\"\n                                                    size=\"icon\"\n                                                    variant=\"destructive\"\n                                                    className=\"h-8 w-8\"\n                                                    onClick={(e) => {\n                                                        e.preventDefault();\n                                                        e.stopPropagation();\n                                                        handleDelete(file.id, file.name);\n                                                    }}\n                                                    title=\"Move to Trash\"\n                                                >\n                                                    <Trash2 className=\"w-4 h-4\" />\n                                                </Button>\n                                            )}\n                                        </>\n                                    )}\n                                    {selectionMode && (\n                                        <Button size=\"sm\" onClick={() => onSelect(file)}>Select</Button>\n                                    )}\n                                </div>\n                            </div>\n                            <div className=\"p-2\">\n                                {isPlatformAdmin && (\n                                    <span className=\"text-[9px] font-medium text-slate-600 bg-slate-100 px-1.5 py-0.5 rounded mb-1 inline-block\">\n                                        {file.tenant?.name || '(Unknown)'}\n                                    </span>\n                                )}\n                                <p className=\"text-xs font-medium truncate\" title={file.name}>{file.name}</p>\n                                <p className=\"text-[10px] text-slate-500\">{formatFileSize(file.file_size)}</p>\n                            </div>\n                        </Card>\n                    ))}\n                </div>\n            ) : (\n                <div className=\"bg-white rounded-lg border border-slate-200\">\n                    {files.map(file => {\n                        const usage = usageData[file.file_path] || usageData[getFileUrl(file)] || { count: 0, modules: [] };\n\n                        return (\n                            <div key={file.id} className={`flex items-center justify-between p-3 border-b border-slate-100 last:border-0 hover:bg-slate-50 ${selectedFiles.has(file.id) ? 'bg-blue-50' : ''}`}>\n                                {/* Selection Checkbox */}\n                                {!selectionMode && (\n                                    <div className=\"flex-shrink-0 mr-3\">\n                                        <Checkbox\n                                            checked={selectedFiles.has(file.id)}\n                                            onCheckedChange={() => toggleSelect(file.id)}\n                                        />\n                                    </div>\n                                )}\n                                <div className=\"flex items-center gap-3 overflow-hidden flex-1\">\n                                    <div className=\"w-10 h-10 rounded bg-slate-100 flex items-center justify-center flex-shrink-0 overflow-hidden\">\n                                        {file.file_type.startsWith('image/') ? (\n                                            <img src={getFileUrl(file)} alt=\"\" className=\"w-full h-full object-cover rounded\" />\n                                        ) : (\n                                            <File className=\"w-5 h-5 text-slate-400\" />\n                                        )}\n                                    </div>\n                                    <div className=\"min-w-0 flex-1\">\n                                        <p className=\"text-sm font-medium truncate\">{file.name}</p>\n                                        <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                                            {isPlatformAdmin && (\n                                                <>\n                                                    <span className=\"text-[10px] font-medium text-slate-600 bg-slate-100 px-1.5 py-0.5 rounded\">\n                                                        {file.tenant?.name || '(Unknown)'}\n                                                    </span>\n                                                    <span></span>\n                                                </>\n                                            )}\n                                            <span>{formatFileSize(file.file_size)}</span>\n                                            <span></span>\n                                            <span>{new Date(file.created_at).toLocaleDateString()}</span>\n                                            {file.users && (\n                                                <>\n                                                    <span></span>\n                                                    <span className=\"text-slate-400\">by {file.users.full_name || file.users.email}</span>\n                                                </>\n                                            )}\n                                        </div>\n                                    </div>\n                                    {/* Usage Badge */}\n                                    {!isTrashView && (\n                                        <TooltipProvider>\n                                            <Tooltip>\n                                                <TooltipTrigger asChild>\n                                                    <div className={`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${usage.count > 0\n                                                        ? 'bg-green-100 text-green-700'\n                                                        : 'bg-slate-100 text-slate-500'\n                                                        }`}>\n                                                        <Link2 className=\"w-3 h-3\" />\n                                                        <span>{usage.count || 0}</span>\n                                                    </div>\n                                                </TooltipTrigger>\n                                                <TooltipContent>\n                                                    <p>{usage.count > 0\n                                                        ? `Used in ${usage.count} place(s): ${usage.modules.join(', ') || 'Unknown'}`\n                                                        : 'Not used anywhere'}</p>\n                                                </TooltipContent>\n                                            </Tooltip>\n                                        </TooltipProvider>\n                                    )}\n                                </div>\n                                <div className=\"flex items-center gap-2 ml-2\">\n                                    {!selectionMode && (\n                                        <>\n                                            {/* Details Button */}\n                                            <Dialog>\n                                                <DialogTrigger asChild>\n                                                    <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8\" title=\"View Details\">\n                                                        <Info className=\"w-4 h-4\" />\n                                                    </Button>\n                                                </DialogTrigger>\n                                                <DialogContent className=\"max-w-md\">\n                                                    <DialogHeader>\n                                                        <DialogTitle>File Details</DialogTitle>\n                                                        <DialogDescription>Information about this file and where it&apos;s used.</DialogDescription>\n                                                    </DialogHeader>\n                                                    <div className=\"space-y-4 mt-4\">\n                                                        {/* Preview */}\n                                                        <div className=\"aspect-video bg-slate-100 rounded-lg overflow-hidden flex items-center justify-center\">\n                                                            {file.file_type.startsWith('image/') ? (\n                                                                <img src={getFileUrl(file)} alt={file.name} className=\"max-w-full max-h-full object-contain\" />\n                                                            ) : (\n                                                                <File className=\"w-16 h-16 text-slate-300\" />\n                                                            )}\n                                                        </div>\n                                                        {/* Details */}\n                                                        <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                                                            <div>\n                                                                <p className=\"text-slate-500\">File Name</p>\n                                                                <p className=\"font-medium truncate\">{file.name}</p>\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"text-slate-500\">Size</p>\n                                                                <p className=\"font-medium\">{formatFileSize(file.file_size)}</p>\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"text-slate-500\">Type</p>\n                                                                <p className=\"font-medium\">{file.file_type}</p>\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"text-slate-500\">Uploaded</p>\n                                                                <p className=\"font-medium\">{new Date(file.created_at).toLocaleDateString()}</p>\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"text-slate-500\">Uploaded By</p>\n                                                                <p className=\"font-medium\">{file.users?.full_name || file.users?.email || 'Unknown'}</p>\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"text-slate-500\">Usage Count</p>\n                                                                <p className=\"font-medium\">{usage.count || 0} location(s)</p>\n                                                            </div>\n                                                        </div>\n                                                        {/* Usage Details */}\n                                                        {usage.count > 0 && (\n                                                            <div>\n                                                                <p className=\"text-slate-500 text-sm mb-2\">Used In:</p>\n                                                                <div className=\"flex flex-wrap gap-2\">\n                                                                    {(usage.modules || []).map((mod, idx) => (\n                                                                        <span key={idx} className=\"bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-medium\">\n                                                                            {mod}\n                                                                        </span>\n                                                                    ))}\n                                                                </div>\n                                                            </div>\n                                                        )}\n                                                        {/* URL */}\n                                                        <div>\n                                                            <p className=\"text-slate-500 text-sm mb-1\">Public URL</p>\n                                                            <div className=\"flex gap-2\">\n                                                                <Input value={getFileUrl(file)} readOnly className=\"text-xs\" />\n                                                                <Button size=\"sm\" onClick={() => copyToClipboard(getFileUrl(file))}>\n                                                                    <Copy className=\"w-3 h-3\" />\n                                                                </Button>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </DialogContent>\n                                            </Dialog>\n                                            <Button size=\"sm\" variant=\"ghost\" onClick={() => copyToClipboard(getFileUrl(file))}>Copy URL</Button>\n                                            {isTrashView && (\n                                                <Button size=\"icon\" variant=\"ghost\" className=\"text-green-600\" onClick={() => handleRestore(file.id)} title=\"Restore\">\n                                                    <RefreshCw className=\"w-4 h-4\" />\n                                                </Button>\n                                            )}\n                                            {!isTrashView && canDelete && (\n                                                <Button\n                                                    type=\"button\"\n                                                    size=\"sm\"\n                                                    variant=\"ghost\"\n                                                    className=\"text-red-500 hover:text-red-700 hover:bg-red-50 gap-1\"\n                                                    onClick={(e) => {\n                                                        e.preventDefault();\n                                                        e.stopPropagation();\n                                                        handleDelete(file.id, file.name);\n                                                    }}\n                                                >\n                                                    <Trash2 className=\"w-4 h-4\" />\n                                                    Delete\n                                                </Button>\n                                            )}\n                                        </>\n                                    )}\n                                    {selectionMode && (\n                                        <Button size=\"sm\" onClick={() => onSelect(file)}>Select</Button>\n                                    )}\n                                </div>\n                            </div>\n                        );\n                    })}\n                </div>\n            )}\n\n            {/* Pagination Controls */}\n            {files.length > 0 && (\n                <div className=\"flex items-center justify-between px-4 py-3 border-t border-slate-200 bg-slate-50/50 mt-4 rounded-b-lg\">\n                    <div className=\"flex items-center gap-2 text-sm text-slate-600\">\n                        <span>Showing {Math.min(((currentPage - 1) * itemsPerPage) + 1, totalItems)} - {Math.min(currentPage * itemsPerPage, totalItems)} of {totalItems} files</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <select\n                            value={itemsPerPage}\n                            onChange={(e) => { setItemsPerPage(Number(e.target.value)); setCurrentPage(1); }}\n                            className=\"h-9 rounded-md border border-slate-200 bg-white px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 outline-none dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                        >\n                            <option value={12}>12 / page</option>\n                            <option value={24}>24 / page</option>\n                            <option value={48}>48 / page</option>\n                            <option value={96}>96 / page</option>\n                        </select>\n                        <div className=\"flex items-center gap-1\">\n                            <Button\n                                variant=\"outline\"\n                                size=\"icon\"\n                                onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n                                disabled={currentPage === 1}\n                                className=\"h-9 w-9\"\n                            >\n                                <ChevronLeft className=\"w-4 h-4\" />\n                            </Button>\n                            <span className=\"px-3 py-1 text-sm font-medium text-slate-700\">\n                                {currentPage} / {totalPages || 1}\n                            </span>\n                            <Button\n                                variant=\"outline\"\n                                size=\"icon\"\n                                onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\n                                disabled={currentPage >= totalPages}\n                                className=\"h-9 w-9\"\n                            >\n                                <ChevronRight className=\"w-4 h-4\" />\n                            </Button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Delete Confirmation Dialog */}\n            <AlertDialog open={deleteConfirm.open} onOpenChange={(open) => !open && setDeleteConfirm({ open: false, fileId: null, fileName: '', isBulk: false })}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>\n                            Move to Trash?\n                        </AlertDialogTitle>\n                        <AlertDialogDescription>\n                            {deleteConfirm.isBulk\n                                ? `This will move ${deleteConfirm.fileName} to the trash bin. You can restore them later.`\n                                : `This will move \"${deleteConfirm.fileName}\" to the trash bin. You can restore it later.`\n                            }\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction\n                            onClick={deleteConfirm.isBulk ? confirmBulkDelete : confirmDelete}\n                        >\n                            Move to Trash\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    );\n};\n\nexport default MediaLibrary;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/notifications/NotificationDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { ArrowLeft, CheckCircle, Clock, Info, Users, AlertTriangle, XCircle, Trash2, Mail } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useNotifications } from '@/hooks/useNotifications';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { format } from 'date-fns';\nimport { useToast } from '@/components/ui/use-toast';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n    AlertDialogTrigger\n} from '@/components/ui/alert-dialog';\n\nfunction NotificationDetail({ id: propId }) {\n    const { id: paramId } = useParams();\n    const navigate = useNavigate();\n    const { markAsRead, deleteNotification } = useNotifications();\n    const { hasPermission, isPlatformAdmin, isFullAccess } = usePermissions();\n    const [notification, setNotification] = useState(null);\n    const [readers, setReaders] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n    const { toast } = useToast();\n\n    // Prioritize propId (passed from Dashboard) over paramId (from Router)\n    const id = propId || paramId;\n\n    const isSuperAdmin = isPlatformAdmin || isFullAccess;\n    const canViewReaders = isSuperAdmin || hasPermission('tenant.notification.read');\n    const canDelete = isSuperAdmin || hasPermission('tenant.notification.delete');\n\n    useEffect(() => {\n        if (!id || id === 'undefined') {\n            navigate('/cmspanel/notifications');\n            return;\n        }\n\n        const fetchDetail = async () => {\n            try {\n                // Fetch Notification\n                // Use maybeSingle() to avoid PGRST116 if notification doesn't exist\n                const { data, error } = await supabase\n                    .from('notifications')\n                    .select('*, sender:created_by(full_name, email)')\n                    .eq('id', id)\n                    .is('deleted_at', null)\n                    .maybeSingle();\n\n                if (error) throw error;\n\n                if (!data) {\n                    toast({ variant: 'destructive', title: 'Error', description: 'Notification not found' });\n                    navigate('/cmspanel/notifications');\n                    return;\n                }\n\n                setNotification(data);\n\n                // Mark as read immediately\n                markAsRead(id);\n\n                // Fetch Readers (if permitted)\n                if (canViewReaders) {\n                    const { data: readersData, error: readersError } = await supabase\n                        .from('notification_readers')\n                        .select('read_at, user:user_id(full_name, email, avatar_url)')\n                        .eq('notification_id', id)\n                        .order('read_at', { ascending: false });\n\n                    if (!readersError) {\n                        setReaders(readersData);\n                    }\n                }\n            } catch (err) {\n                console.error(err);\n                toast({ variant: 'destructive', title: 'Error', description: 'Failed to load notification details' });\n                navigate('/cmspanel/notifications');\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchDetail();\n    }, [id, navigate, markAsRead, canViewReaders, toast]);\n\n    if (loading) {\n        return <div className=\"p-8 space-y-4\">\n            <Skeleton className=\"h-8 w-1/3\" />\n            <Skeleton className=\"h-32 w-full\" />\n        </div>;\n    }\n\n    if (!notification) return null;\n\n    const getIcon = (type) => {\n        switch (type) {\n            case 'success': return <CheckCircle className=\"w-6 h-6 text-green-500\" />;\n            case 'warning': return <AlertTriangle className=\"w-6 h-6 text-yellow-500\" />;\n            case 'error': return <XCircle className=\"w-6 h-6 text-red-500\" />;\n            default: return <Info className=\"w-6 h-6 text-blue-500\" />;\n        }\n    };\n\n    const handleDelete = async () => {\n        await deleteNotification(id);\n        navigate('/cmspanel/notifications');\n    };\n\n    return (\n        <div className=\"max-w-4xl mx-auto space-y-6 pb-12\">\n            <div className=\"flex items-center gap-4 mb-6\">\n                <Button variant=\"outline\" onClick={() => navigate(-1)} className=\"border-slate-200/70 bg-white/70 hover:bg-white\">\n                    <ArrowLeft className=\"w-4 h-4 mr-2\" /> Back\n                </Button>\n                <div className=\"flex-1\"></div>\n                {canDelete && (\n                    <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n                        <AlertDialogTrigger asChild>\n                            <Button variant=\"destructive\" size=\"sm\">\n                                <Trash2 className=\"w-4 h-4 mr-2\" /> Delete\n                            </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent>\n                            <AlertDialogHeader>\n                                <AlertDialogTitle>Delete this notification?</AlertDialogTitle>\n                                <AlertDialogDescription>\n                                    This action will remove the notification from the inbox. This cannot be undone.\n                                </AlertDialogDescription>\n                            </AlertDialogHeader>\n                            <AlertDialogFooter>\n                                <AlertDialogCancel>Cancel</AlertDialogCancel>\n                                <AlertDialogAction onClick={handleDelete} className=\"bg-red-600 hover:bg-red-700\">\n                                    Delete Notification\n                                </AlertDialogAction>\n                            </AlertDialogFooter>\n                        </AlertDialogContent>\n                    </AlertDialog>\n                )}\n            </div>\n\n            <Card className=\"dashboard-surface dashboard-surface-hover border-t-4 border-t-blue-500\">\n                <CardHeader className=\"pb-4\">\n                    <div className=\"flex items-start justify-between\">\n                        <div className=\"space-y-1\">\n                            <div className=\"flex items-center gap-3 mb-2\">\n                                {getIcon(notification.type)}\n                                <Badge variant=\"outline\" className=\"uppercase text-[10px] tracking-wide\">\n                                    {notification.priority || 'Normal'} Priority\n                                </Badge>\n                                <Badge className=\"bg-slate-100 text-slate-600 hover:bg-slate-200 border-0\">\n                                    {notification.category || 'General'}\n                                </Badge>\n                            </div>\n                            <CardTitle className=\"text-2xl font-bold text-slate-900\">\n                                {notification.title}\n                            </CardTitle>\n                        </div>\n                    </div>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                    <div className=\"prose prose-slate max-w-none bg-slate-50/70 p-6 rounded-xl border border-slate-200/70\">\n                        <p className=\"text-slate-700 whitespace-pre-wrap leading-relaxed\">{notification.message}</p>\n                        {notification.link && (\n                            <div className=\"mt-4 pt-4 border-t border-slate-200\">\n                                <Button onClick={() => navigate(notification.link)} variant=\"outline\" className=\"text-indigo-600 border-slate-200/70 bg-white/70 hover:bg-white\">\n                                    Open Related Link\n                                </Button>\n                            </div>\n                        )}\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm\">\n                        <div className=\"space-y-3\">\n                            <h4 className=\"font-semibold text-slate-900 flex items-center gap-2\">\n                                <Info className=\"w-4 h-4 text-slate-500\" /> Metadata\n                            </h4>\n                            <div className=\"grid grid-cols-2 gap-2 text-slate-600\">\n                                <span>Sent By:</span>\n                                <span className=\"font-medium text-slate-900\">{notification.sender?.full_name || 'System'}</span>\n                                <span>Date:</span>\n                                <span className=\"font-medium text-slate-900\">{format(new Date(notification.created_at), 'PPP p')}</span>\n                                <span>Target:</span>\n                                <span className=\"font-medium text-slate-900\">{notification.user_id ? 'Private' : 'Broadcast'}</span>\n                            </div>\n                        </div>\n\n                        {canViewReaders && (\n                            <div className=\"space-y-3\">\n                                <h4 className=\"font-semibold text-slate-900 flex items-center gap-2\">\n                                    <Users className=\"w-4 h-4 text-slate-500\" /> Read Statistics\n                                </h4>\n                                <div className=\"bg-white border border-slate-200/70 rounded-xl p-3\">\n                                    <div className=\"flex justify-between items-center mb-2\">\n                                        <span className=\"text-slate-500\">Read Count</span>\n                                        <Badge variant=\"secondary\">{readers.length}</Badge>\n                                    </div>\n                                    <p className=\"text-xs text-slate-400\">\n                                        Total users who have opened this notification.\n                                    </p>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    {canViewReaders && readers.length > 0 && (\n                        <div className=\"pt-6 border-t border-slate-200\">\n                            <h4 className=\"font-semibold text-slate-900 mb-4 flex items-center gap-2\">\n                                <Users className=\"w-4 h-4\" /> Read By ({readers.length})\n                            </h4>\n                            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3\">\n                                {readers.map((reader, idx) => (\n                                    <div key={idx} className=\"flex items-center gap-3 p-3 rounded-xl bg-white border border-slate-200/70 shadow-sm hover:shadow-md transition-all\">\n                                        <Avatar className=\"h-8 w-8\">\n                                            <AvatarImage src={reader.user?.avatar_url} />\n                                            <AvatarFallback className=\"bg-blue-100 text-blue-600 text-xs font-bold\">\n                                                {reader.user?.full_name?.charAt(0) || 'U'}\n                                            </AvatarFallback>\n                                        </Avatar>\n                                        <div className=\"flex flex-col overflow-hidden\">\n                                            <span className=\"font-medium text-slate-900 truncate text-sm\">\n                                                {reader.user?.full_name || 'Unknown User'}\n                                            </span>\n                                            <span className=\"text-[10px] text-slate-500 flex items-center gap-1 truncate\">\n                                                <Mail className=\"w-3 h-3\" />\n                                                {reader.user?.email}\n                                            </span>\n                                            <span className=\"text-[10px] text-slate-400 flex items-center gap-1 mt-1\">\n                                                <Clock className=\"w-3 h-3\" />\n                                                {format(new Date(reader.read_at), 'MMM d, HH:mm')}\n                                            </span>\n                                        </div>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n\nexport default NotificationDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/notifications/NotificationDropdown.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { Bell, Check, Info, CheckCircle, AlertTriangle, XCircle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuLabel,\n    DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useNotifications } from '@/hooks/useNotifications';\nimport { formatDistanceToNow } from 'date-fns';\nimport { cn } from '@/lib/utils';\nimport { useNavigate } from 'react-router-dom';\n\nconst getIcon = (type) => {\n    switch (type) {\n        case 'success': return <CheckCircle className=\"w-4 h-4 text-green-500\" />;\n        case 'warning': return <AlertTriangle className=\"w-4 h-4 text-yellow-500\" />;\n        case 'error': return <XCircle className=\"w-4 h-4 text-red-500\" />;\n        default: return <Info className=\"w-4 h-4 text-blue-500\" />;\n    }\n};\n\nexport function NotificationDropdown() {\n    const { notifications, unreadCount, markAsRead, markAllAsRead } = useNotifications();\n    const navigate = useNavigate();\n\n    return (\n        <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" className=\"text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 relative\">\n                    <Bell className=\"w-5 h-5\" />\n                    {unreadCount > 0 && (\n                        <span className=\"absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white dark:border-slate-900 flex items-center justify-center\">\n                            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\n                        </span>\n                    )}\n                </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-80 sm:w-96 bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 shadow-xl z-[100]\">\n                <div className=\"flex items-center justify-between px-4 py-3 border-b border-slate-100 dark:border-slate-800\">\n                    <DropdownMenuLabel className=\"p-0 text-slate-900 dark:text-slate-100 font-semibold\">Notifications ({unreadCount})</DropdownMenuLabel>\n                    {unreadCount > 0 && (\n                        <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-auto text-xs text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 p-0 hover:bg-transparent\"\n                            onClick={() => markAllAsRead()}\n                        >\n                            Mark all as read\n                        </Button>\n                    )}\n                </div>\n\n                <ScrollArea className=\"h-[400px]\">\n                    {notifications.length === 0 ? (\n                        <div className=\"flex flex-col items-center justify-center h-40 text-slate-500 dark:text-slate-400\">\n                            <Bell className=\"w-8 h-8 mb-2 opacity-20\" />\n                            <span className=\"text-sm\">No notifications yet</span>\n                        </div>\n                    ) : (\n                        <div className=\"flex flex-col py-1\">\n                            {notifications.map((notification) => (\n                                <DropdownMenuItem\n                                    key={notification.id}\n                                    className={cn(\n                                        \"flex items-start gap-3 p-4 cursor-default focus:bg-slate-50 dark:focus:bg-slate-800 relative group border-b border-slate-50 dark:border-slate-800/50 last:border-0\",\n                                        !notification.is_read ? \"bg-blue-50/50 dark:bg-blue-900/10\" : \"dark:hover:bg-slate-800/50\"\n                                    )}\n                                >\n                                    <div className=\"mt-1 flex-shrink-0\">\n                                        {getIcon(notification.type)}\n                                    </div>\n                                    <div className=\"flex-1 space-y-1 w-full min-w-0\">\n                                        <div className=\"flex justify-between items-start\">\n                                            <p className={cn(\"text-sm font-medium truncate pr-2\", !notification.is_read ? \"text-slate-900 dark:text-slate-100\" : \"text-slate-600 dark:text-slate-300\")}>\n                                                {notification.title}\n                                            </p>\n                                            <span className=\"text-[10px] text-slate-400 dark:text-slate-500 whitespace-nowrap ml-1 flex-shrink-0\">\n                                                {formatDistanceToNow(new Date(notification.created_at), { addSuffix: true })}\n                                            </span>\n                                        </div>\n                                        <p className=\"text-xs text-slate-500 dark:text-slate-400 line-clamp-2 break-words\">\n                                            {notification.message}\n                                        </p>\n                                        <div className=\"flex gap-2 pt-1\">\n                                            {notification.link && (\n                                                <Button\n                                                    variant=\"link\"\n                                                    className=\"h-auto p-0 text-xs text-blue-600 dark:text-blue-400\"\n                                                    onClick={(e) => {\n                                                        e.stopPropagation();\n                                                        markAsRead(notification.id);\n                                                        navigate(notification.link);\n                                                    }}\n                                                >\n                                                    Open Link\n                                                </Button>\n                                            )}\n                                            <Button\n                                                variant=\"link\"\n                                                className=\"h-auto p-0 text-xs text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200\"\n                                                onClick={(e) => {\n                                                    e.preventDefault();\n                                                    navigate(`/cmspanel/notifications/${notification.id}`);\n                                                }}\n                                            >\n                                                View Details\n                                            </Button>\n                                        </div>\n                                    </div>\n                                    {!notification.is_read && (\n                                        <div className=\"absolute right-2 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                            <Button\n                                                variant=\"ghost\"\n                                                size=\"icon\"\n                                                className=\"h-8 w-8 text-blue-500 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm shadow-sm hover:bg-white dark:hover:bg-slate-800\"\n                                                title=\"Mark as read\"\n                                                onClick={(e) => {\n                                                    e.preventDefault();\n                                                    markAsRead(notification.id);\n                                                }}\n                                            >\n                                                <Check className=\"w-4 h-4\" />\n                                            </Button>\n                                        </div>\n                                    )}\n                                </DropdownMenuItem>\n                            ))}\n                        </div>\n                    )}\n                </ScrollArea>\n\n                <div className=\"p-2 border-t border-slate-100 dark:border-slate-800\">\n                    <Button\n                        variant=\"outline\"\n                        className=\"w-full text-xs h-8 border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 dark:hover:bg-slate-800\"\n                        onClick={() => navigate('/cmspanel/notifications')}\n                    >\n                        View All Notifications\n                    </Button>\n                </div>\n            </DropdownMenuContent>\n        </DropdownMenu>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/notifications/NotificationsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { useNotifications } from '@/hooks/useNotifications';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Button } from '@/components/ui/button';\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n    AlertDialogTrigger\n} from '@/components/ui/alert-dialog';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Send, Users, User, CheckCircle2, Search, Filter, CheckCheck } from 'lucide-react';\nimport ContentTable from '@/components/dashboard/ContentTable';\nimport { useToast } from '@/components/ui/use-toast';\nimport { Helmet } from 'react-helmet-async';\nimport { useNavigate } from 'react-router-dom';\nimport { Badge } from '@/components/ui/badge';\nimport { usePermissions } from '@/contexts/PermissionContext';\n\nfunction NotificationsManager() {\n    // Hooks\n    const {\n        notifications,\n        totalCount,\n        loading,\n        deleteNotification,\n        sendNotification,\n        fetchNotifications,\n        markAllAsRead,\n        markAsRead\n    } = useNotifications();\n    const { hasPermission, tenantId, isPlatformAdmin, isFullAccess } = usePermissions();\n    const { toast } = useToast();\n    const navigate = useNavigate();\n\n    // State\n    const [isOpen, setIsOpen] = useState(false);\n    const [markAllOpen, setMarkAllOpen] = useState(false);\n    const [users, setUsers] = useState([]);\n    const [sending, setSending] = useState(false);\n\n    // Pagination & Filters State\n    const [page, setPage] = useState(1);\n    const [limit, setLimit] = useState(10);\n    const [filterQuery, setFilterQuery] = useState('');\n    const [filterType, setFilterType] = useState('all');\n\n    // NOTE: 'unread'/'read' status filtering requires client-side Logic \n    // OR deeper query changes if we want server-side filtering.\n    // For now we'll fetch then filter IF status is selected, \n    // but better to fetch all and filter locally or improve API if needed. \n    // Given the current hook implementation, it fetches strict range.\n    // Let's keep status filtering client-side for the current page for simplicity,\n    // or we'd need to update the hook to support filtering by status (which is complex due to join).\n    const [filterStatus, setFilterStatus] = useState('all');\n\n    const [formData, setFormData] = useState({\n        title: '',\n        message: '',\n        type: 'info',\n        priority: 'normal',\n        category: 'general',\n        target: 'all',\n        link: ''\n    });\n\n    const canCreate = hasPermission('tenant.notification.create') || isPlatformAdmin || isFullAccess;\n    const canDelete = hasPermission('tenant.notification.delete') || isPlatformAdmin || isFullAccess;\n\n    // Initial Fetch & Refetch on filters change\n    useEffect(() => {\n        fetchNotifications({\n            page,\n            limit,\n            filters: {\n                search: filterQuery,\n                type: filterType\n            }\n        });\n    }, [page, limit, filterQuery, filterType, fetchNotifications]);\n\n    // Fetch users for target selection\n    useEffect(() => {\n        if (canCreate && isOpen && users.length === 0) {\n            const fetchUsers = async () => {\n                // If tenant admin, only fetch tenant users\n                let query = supabase.from('users').select('id, full_name, email, tenant:tenants(name)');\n\n                // If not platform admin, restricting to own tenant users usually happens via RLS\n                // but explicit filter is good practice if RLS is permissive on read.\n                if (tenantId && !isPlatformAdmin && !isFullAccess) {\n                    // query = query.eq('tenant_id', tenantId); // Assuming users table has tenant_id or relying on RLS\n                }\n\n                const { data } = await query;\n                if (data) setUsers(data);\n            };\n            fetchUsers();\n        }\n    }, [canCreate, isOpen, users.length, tenantId, isPlatformAdmin, isFullAccess]);\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        setSending(true);\n        try {\n            await sendNotification({\n                userId: formData.target === 'all' ? null : formData.target,\n                title: formData.title,\n                message: formData.message,\n                type: formData.type,\n                priority: formData.priority,\n                category: formData.category,\n                link: formData.link,\n                tenantId: tenantId\n            });\n\n            toast({ title: 'Success', description: 'Notification sent successfully' });\n            setIsOpen(false);\n            setFormData({ title: '', message: '', type: 'info', priority: 'normal', category: 'general', target: 'all', link: '' });\n            fetchNotifications({ page, limit }); // Refresh\n        } catch (err) {\n            toast({ variant: 'destructive', title: 'Error', description: err.message });\n        } finally {\n            setSending(false);\n        }\n    };\n\n    const handleMarkAllRead = async () => {\n        await markAllAsRead();\n        setMarkAllOpen(false);\n    };\n\n    // Client-side filtering for status ONLY (since we assume we fetched mixed status)\n    // If user wants to see ONLY unread, using limit/range on server is tricky without advanced query\n    // So we apply it to the result. \n    // This is a trade-off: The total count might be off for the status filter.\n    const displayedNotifications = notifications.filter(n => {\n        if (filterStatus === 'all') return true;\n        if (filterStatus === 'read') return n.is_read;\n        if (filterStatus === 'unread') return !n.is_read;\n        return true;\n    });\n\n    const columns = [\n        { key: 'title', label: 'Title', className: 'w-1/4' },\n        ...((isPlatformAdmin || isFullAccess) ? [{\n            key: 'tenant',\n            label: 'Tenant',\n            render: (_, item) => item.tenant?.name ? (\n                <Badge variant=\"secondary\" className=\"text-[10px] whitespace-nowrap\">\n                    {item.tenant.name}\n                </Badge>\n            ) : <span className=\"text-slate-400 text-xs\">-</span>\n        }] : []),\n        {\n            key: 'priority',\n            label: 'Priority',\n            render: (p) => {\n                const colors = { high: 'bg-red-100 text-red-800', normal: 'bg-slate-100 text-slate-800', low: 'bg-green-100 text-green-800' };\n                return <span className={`px-2 py-0.5 rounded text-[10px] uppercase font-bold ${colors[p] || colors.normal}`}>{p || 'normal'}</span>;\n            }\n        },\n        { key: 'message', label: 'Message', className: 'w-1/3', render: (text) => <span className=\"truncate block max-w-xs text-slate-600\">{text}</span> },\n        {\n            key: 'type',\n            label: 'Type',\n            render: (type) => (\n                <Badge variant=\"outline\" className={`capitalize\n                ${type === 'error' ? 'border-red-200 text-red-700 bg-red-50' :\n                        type === 'warning' ? 'border-yellow-200 text-yellow-700 bg-yellow-50' :\n                            type === 'success' ? 'border-green-200 text-green-700 bg-green-50' : 'border-blue-200 text-blue-700 bg-blue-50'}`}>\n                    {type}\n                </Badge>\n            )\n        },\n        {\n            key: 'is_read',\n            label: 'Status',\n            render: (read) => read ?\n                <span className=\"text-green-600 flex items-center text-xs font-medium\"><CheckCircle2 className=\"w-3 h-3 mr-1\" /> Read</span> :\n                <span className=\"text-blue-600 flex items-center text-xs font-medium\"><div className=\"w-2 h-2 rounded-full bg-blue-500 mr-2\"></div> Unread</span>\n        },\n        { key: 'created_at', label: 'Date', type: 'date' }\n    ];\n\n    const extraActions = (item) => (\n        !item.is_read && (\n            <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => markAsRead(item.id)}\n                className=\"h-8 w-8 text-blue-500 hover:text-blue-700 hover:bg-blue-50\"\n                title=\"Mark as read\"\n            >\n                <CheckCheck className=\"w-4 h-4\" />\n            </Button>\n        )\n    );\n\n    return (\n        <div className=\"space-y-6\">\n            <Helmet>\n                <title>Notifications - CMS</title>\n            </Helmet>\n\n            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n                <div>\n                    <h1 className=\"text-2xl font-semibold tracking-tight text-slate-900\">Notifications</h1>\n                    <p className=\"text-slate-500\">View and manage system notifications.</p>\n                </div>\n\n                <div className=\"flex gap-2\">\n                    <AlertDialog open={markAllOpen} onOpenChange={setMarkAllOpen}>\n                        <AlertDialogTrigger asChild>\n                            <Button variant=\"outline\" className=\"border-slate-200/70 bg-white/70 hover:bg-white\">\n                                <CheckCheck className=\"w-4 h-4 mr-2\" />\n                                Mark All Read\n                            </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent>\n                            <AlertDialogHeader>\n                                <AlertDialogTitle>Mark all notifications as read?</AlertDialogTitle>\n                                <AlertDialogDescription>\n                                    This will mark all notifications in your inbox as read. You can still filter for unread notifications later.\n                                </AlertDialogDescription>\n                            </AlertDialogHeader>\n                            <AlertDialogFooter>\n                                <AlertDialogCancel>Cancel</AlertDialogCancel>\n                                <AlertDialogAction onClick={handleMarkAllRead} className=\"bg-indigo-600 hover:bg-indigo-700\">\n                                    Mark All Read\n                                </AlertDialogAction>\n                            </AlertDialogFooter>\n                        </AlertDialogContent>\n                    </AlertDialog>\n\n                    {canCreate && (\n                        <Dialog open={isOpen} onOpenChange={setIsOpen}>\n                            <DialogTrigger asChild>\n                                <Button className=\"bg-indigo-600 hover:bg-indigo-700\">\n                                    <Send className=\"w-4 h-4 mr-2\" />\n                                    Send Notification\n                                </Button>\n                            </DialogTrigger>\n                            <DialogContent className=\"sm:max-w-lg\">\n                                <DialogHeader>\n                                    <DialogTitle>Send Notification</DialogTitle>\n                                    <DialogDescription>Send a new notification to a specific user or all users.</DialogDescription>\n                                </DialogHeader>\n                                <form onSubmit={handleSubmit} className=\"space-y-4 py-4\">\n                                    <div className=\"space-y-2\">\n                                        <Label>Target Audience</Label>\n                                        <Select\n                                            value={formData.target}\n                                            onValueChange={(val) => setFormData({ ...formData, target: val })}\n                                        >\n                                            <SelectTrigger className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\">\n                                                <SelectValue placeholder=\"Select target\" />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                <SelectItem value=\"all\">\n                                                    <div className=\"flex items-center\"><Users className=\"w-4 h-4 mr-2\" /> All Users (Broadcast)</div>\n                                                </SelectItem>\n                                                {users.map(u => (\n                                                    <SelectItem key={u.id} value={u.id}>\n                                                        <div className=\"flex items-center\">\n                                                            <User className=\"w-4 h-4 mr-2\" />\n                                                            <span>{u.full_name || u.email}</span>\n                                                            {u.tenant?.name && (\n                                                                <Badge variant=\"outline\" className=\"ml-2 text-[10px] h-5\">\n                                                                    {u.tenant.name}\n                                                                </Badge>\n                                                            )}\n                                                        </div>\n                                                    </SelectItem>\n                                                ))}\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n\n                                    <div className=\"grid grid-cols-2 gap-4\">\n                                        <div className=\"space-y-2\">\n                                            <Label>Type</Label>\n                                            <Select\n                                                value={formData.type}\n                                                onValueChange={(val) => setFormData({ ...formData, type: val })}\n                                            >\n                                                <SelectTrigger className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\">\n                                                    <SelectValue />\n                                                </SelectTrigger>\n                                                <SelectContent>\n                                                    <SelectItem value=\"info\">Info</SelectItem>\n                                                    <SelectItem value=\"success\">Success</SelectItem>\n                                                    <SelectItem value=\"warning\">Warning</SelectItem>\n                                                    <SelectItem value=\"error\">Error</SelectItem>\n                                                </SelectContent>\n                                            </Select>\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                            <Label>Priority</Label>\n                                            <Select\n                                                value={formData.priority}\n                                                onValueChange={(val) => setFormData({ ...formData, priority: val })}\n                                            >\n                                                <SelectTrigger className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\">\n                                                    <SelectValue />\n                                                </SelectTrigger>\n                                                <SelectContent>\n                                                    <SelectItem value=\"low\">Low</SelectItem>\n                                                    <SelectItem value=\"normal\">Normal</SelectItem>\n                                                    <SelectItem value=\"high\">High</SelectItem>\n                                                </SelectContent>\n                                            </Select>\n                                        </div>\n                                    </div>\n\n                                    <div className=\"space-y-2\">\n                                        <Label>Title</Label>\n                                        <Input\n                                            required\n                                            placeholder=\"Notification Title\"\n                                            value={formData.title}\n                                            onChange={e => setFormData({ ...formData, title: e.target.value })}\n                                            className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\"\n                                        />\n                                    </div>\n\n                                    <div className=\"space-y-2\">\n                                        <Label>Message</Label>\n                                        <Textarea\n                                            required\n                                            placeholder=\"Type your message here...\"\n                                            rows={3}\n                                            value={formData.message}\n                                            onChange={e => setFormData({ ...formData, message: e.target.value })}\n                                            className=\"rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\"\n                                        />\n                                    </div>\n\n                                    <div className=\"space-y-2\">\n                                        <Label>Link (Optional)</Label>\n                                        <Input\n                                            placeholder=\"/cmspanel/blogs/123\"\n                                            value={formData.link}\n                                            onChange={e => setFormData({ ...formData, link: e.target.value })}\n                                            className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\"\n                                        />\n                                    </div>\n\n                                    <div className=\"flex justify-end gap-3 mt-4\">\n                                        <Button type=\"button\" variant=\"outline\" onClick={() => setIsOpen(false)}>Cancel</Button>\n                                        <Button type=\"submit\" disabled={sending} className=\"bg-indigo-600 hover:bg-indigo-700\">\n                                            {sending ? 'Sending...' : 'Send Notification'}\n                                        </Button>\n                                    </div>\n                                </form>\n                            </DialogContent>\n                        </Dialog>\n                    )}\n                </div>\n            </div>\n\n            <div className=\"dashboard-surface dashboard-surface-hover flex flex-wrap gap-4 items-center p-4\">\n                <div className=\"relative flex-1 min-w-[200px]\">\n                    <Search className=\"absolute left-3 top-3 h-4 w-4 text-slate-400\" />\n                    <Input\n                        placeholder=\"Search notifications...\"\n                        className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 pl-9 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\"\n                        value={filterQuery}\n                        onChange={e => setFilterQuery(e.target.value)}\n                    />\n                </div>\n                <div className=\"flex gap-2 w-full sm:w-auto\">\n                    <Select value={filterType} onValueChange={setFilterType}>\n                        <SelectTrigger className=\"w-[150px] h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm\">\n                            <div className=\"flex items-center gap-2 text-slate-600\">\n                                <Filter className=\"w-4 h-4\" />\n                                <SelectValue placeholder=\"Type\" />\n                            </div>\n                        </SelectTrigger>\n                        <SelectContent>\n                            <SelectItem value=\"all\">All Types</SelectItem>\n                            <SelectItem value=\"info\">Info</SelectItem>\n                            <SelectItem value=\"success\">Success</SelectItem>\n                            <SelectItem value=\"warning\">Warning</SelectItem>\n                            <SelectItem value=\"error\">Error</SelectItem>\n                        </SelectContent>\n                    </Select>\n\n                    <Select value={filterStatus} onValueChange={setFilterStatus}>\n                        <SelectTrigger className=\"w-[150px] h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm\">\n                            <SelectValue placeholder=\"Status\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                            <SelectItem value=\"all\">All Status</SelectItem>\n                            <SelectItem value=\"read\">Read</SelectItem>\n                            <SelectItem value=\"unread\">Unread</SelectItem>\n                        </SelectContent>\n                    </Select>\n                </div>\n            </div>\n\n            <Card className=\"dashboard-surface dashboard-surface-hover overflow-hidden\">\n                <CardHeader className=\"border-b border-slate-200/60 bg-slate-50/70\">\n                    <CardTitle>Inbox</CardTitle>\n                    <CardDescription>Your notifications history.</CardDescription>\n                </CardHeader>\n                <CardContent>\n                    <ContentTable\n                        data={displayedNotifications}\n                        columns={columns}\n                        loading={loading}\n                        onDelete={canDelete ? deleteNotification : null}\n                        onView={(item) => item.id && navigate(`/cmspanel/notifications/${item.id}`)}\n                        extraActions={extraActions}\n                        pagination={{\n                            currentPage: page,\n                            totalPages: Math.ceil(totalCount / limit),\n                            itemsPerPage: limit,\n                            totalItems: totalCount,\n                            onPageChange: setPage,\n                            onLimitChange: setLimit\n                        }}\n                    />\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n\nexport default NotificationsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/slug/SlugGenerator.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/templates/TemplateAssignments.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\nimport { useTemplates } from '@/hooks/useTemplates';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { hooks } from '@/lib/hooks';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { Monitor, Smartphone, Cpu } from 'lucide-react';\n\nconst BASE_ROUTES = [\n    { type: 'home', label: 'Home Page' },\n    { type: 'search', label: 'Search Results' },\n    { type: 'archive', label: 'Archive (Default)' },\n    { type: 'single', label: 'Single Post (Default)' },\n    { type: '404', label: '404 Not Found' },\n    { type: 'maintenance', label: 'Maintenance Mode' },\n];\n\nconst CHANNELS = [\n    { value: 'web', label: 'Web (SSR/SSG)', icon: Monitor },\n    { value: 'mobile', label: 'Mobile App', icon: Smartphone },\n    { value: 'esp32', label: 'IoT (ESP32)', icon: Cpu },\n];\n\nconst TemplateAssignments = () => {\n    const { assignments, templates, updateAssignment, loading } = useTemplates();\n    const { hasPermission } = usePermissions();\n    const [selectedChannel, setSelectedChannel] = useState('web');\n\n    // Merge base routes with extension-registered page types\n    const SYSTEM_ROUTES = useMemo(() => {\n        return hooks.applyFilters('template_assignment_routes', [...BASE_ROUTES]);\n    }, []);\n\n    const getAssignedTemplateId = (routeType) => {\n        // assignments is now an array\n        const assignment = assignments.find(a => a.route_type === routeType && a.channel === selectedChannel);\n        return assignment?.template_id || 'default';\n    };\n\n    const handleAssignmentChange = async (routeType, value) => {\n        if (!hasPermission('tenant.setting.update')) return;\n        // If value is default, we could delete? Or just set to null/default key? Use 'default' string for now.\n        await updateAssignment(routeType, value, selectedChannel);\n    };\n\n    if (loading) return <div>Loading assignments...</div>;\n\n    const pageTemplates = templates.filter(t => t.type === 'page' || !t.type);\n\n    return (\n        <div className=\"space-y-6 max-w-3xl\">\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800\">\n                Define default templates for system routes per channel.\n                Individual pages can override the &apos;Single Post&apos; assignment via their own settings.\n            </div>\n\n            {/* Channel Selector */}\n            <div className=\"flex gap-4 border-b pb-6\">\n                {CHANNELS.map(channel => (\n                    <button\n                        key={channel.value}\n                        onClick={() => setSelectedChannel(channel.value)}\n                        className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors border ${selectedChannel === channel.value\n                            ? 'bg-indigo-50 border-indigo-200 text-indigo-700 font-medium'\n                            : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50'\n                            }`}\n                    >\n                        <channel.icon className=\"w-4 h-4\" />\n                        {channel.label}\n                    </button>\n                ))}\n            </div>\n\n            <div className=\"grid gap-4\">\n                {SYSTEM_ROUTES.map(route => {\n                    const assignedId = getAssignedTemplateId(route.type);\n\n                    return (\n                        <div key={route.type} className=\"flex items-center justify-between p-4 bg-white border border-slate-200 rounded-lg shadow-sm\">\n                            <div>\n                                <h4 className=\"font-medium text-slate-900\">{route.label}</h4>\n                                <p className=\"text-xs text-slate-500 font-mono mt-1\">Route: {route.type}</p>\n                            </div>\n\n                            <div className=\"w-64\">\n                                <Select\n                                    value={assignedId || ''}\n                                    onValueChange={(val) => handleAssignmentChange(route.type, val)}\n                                    disabled={!hasPermission('tenant.setting.update')}\n                                >\n                                    <SelectTrigger>\n                                        <SelectValue placeholder=\"Select a template\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        <SelectItem value=\"default\">\n                                            <span className=\"text-slate-400 italic\">System Default</span>\n                                        </SelectItem>\n                                        {pageTemplates.map(t => (\n                                            <SelectItem key={t.id} value={t.id}>\n                                                {t.name}\n                                            </SelectItem>\n                                        ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                        </div>\n                    );\n                })}\n            </div>\n        </div>\n    );\n};\n\nexport default TemplateAssignments;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/templates/TemplateEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  38 |             const template = templates.find(t => t.id === id);\n  39 |             if (template) {\n> 40 |                 setFormData({\n     |                 ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  41 |                     name: template.name || '',\n  42 |                     slug: template.slug || '',\n  43 |                     description: template.description || '',","line":40,"column":17,"nodeType":null,"endLine":40,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useTemplates } from '@/hooks/useTemplates';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { ArrowLeft, Save, Eye } from 'lucide-react';\n\nconst TemplateEditor = () => {\n    const { id } = useParams();\n    const navigate = useNavigate();\n    const { templates, templateParts, updateTemplate, loading } = useTemplates();\n\n    const [formData, setFormData] = useState({\n        name: '',\n        slug: '',\n        description: '',\n        type: 'page',\n        is_active: false,\n        parts: {\n            header: null,\n            footer: null,\n        }\n    });\n\n    // Load template data\n    useEffect(() => {\n        if (templates.length > 0 && id) {\n            const template = templates.find(t => t.id === id);\n            if (template) {\n                setFormData({\n                    name: template.name || '',\n                    slug: template.slug || '',\n                    description: template.description || '',\n                    type: template.type || 'page',\n                    is_active: template.is_active || false,\n                    parts: template.parts || { header: null, footer: null }\n                });\n            }\n        }\n    }, [templates, id]);\n\n    const handleChange = (field, value) => {\n        setFormData(prev => ({ ...prev, [field]: value }));\n    };\n\n    const handlePartChange = (partKey, value) => {\n        setFormData(prev => ({\n            ...prev,\n            parts: { ...prev.parts, [partKey]: value === 'none' ? null : value }\n        }));\n    };\n\n    const handleSave = async () => {\n        await updateTemplate(id, formData);\n        navigate('/cmspanel/templates');\n    };\n\n    // Filter parts by type\n    const headers = templateParts.filter(p => p.type === 'header');\n    const footers = templateParts.filter(p => p.type === 'footer');\n\n    if (loading) return <div className=\"p-6\">Loading...</div>;\n\n    return (\n        <div className=\"p-6 max-w-4xl mx-auto space-y-8\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-4\">\n                    <Button variant=\"ghost\" onClick={() => navigate('/cmspanel/templates')}>\n                        <ArrowLeft className=\"w-4 h-4 mr-2\" /> Back\n                    </Button>\n                    <h1 className=\"text-2xl font-bold\">Edit Template</h1>\n                </div>\n                <div className=\"flex gap-2\">\n                    <Button variant=\"outline\" onClick={() => navigate(`/cmspanel/visual-editor?templateId=${id}`)}>\n                        <Eye className=\"w-4 h-4 mr-2\" /> Visual Editor\n                    </Button>\n                    <Button onClick={handleSave}>\n                        <Save className=\"w-4 h-4 mr-2\" /> Save\n                    </Button>\n                </div>\n            </div>\n\n            {/* Form */}\n            <div className=\"grid gap-6 bg-white p-6 rounded-lg border shadow-sm\">\n                <div className=\"grid gap-2\">\n                    <Label>Template Name</Label>\n                    <Input\n                        value={formData.name}\n                        onChange={e => handleChange('name', e.target.value)}\n                        placeholder=\"e.g., Default Page Layout\"\n                    />\n                </div>\n\n                <div className=\"grid gap-2\">\n                    <Label>Slug</Label>\n                    <Input\n                        value={formData.slug}\n                        onChange={e => handleChange('slug', e.target.value)}\n                        placeholder=\"e.g., default-page\"\n                    />\n                </div>\n\n                <div className=\"grid gap-2\">\n                    <Label>Description</Label>\n                    <Textarea\n                        value={formData.description}\n                        onChange={e => handleChange('description', e.target.value)}\n                        placeholder=\"Brief description of the template...\"\n                        rows={3}\n                    />\n                </div>\n\n                <div className=\"grid gap-2\">\n                    <Label>Type</Label>\n                    <Select value={formData.type} onValueChange={v => handleChange('type', v)}>\n                        <SelectTrigger className=\"w-[200px]\">\n                            <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                            <SelectItem value=\"page\">Page</SelectItem>\n                            <SelectItem value=\"archive\">Archive</SelectItem>\n                            <SelectItem value=\"single\">Single Post</SelectItem>\n                            <SelectItem value=\"error\">Error Page</SelectItem>\n                        </SelectContent>\n                    </Select>\n                </div>\n\n                <div className=\"flex items-center space-x-2\">\n                    <Switch\n                        id=\"is_active\"\n                        checked={formData.is_active}\n                        onCheckedChange={v => handleChange('is_active', v)}\n                    />\n                    <Label htmlFor=\"is_active\">Active</Label>\n                </div>\n            </div>\n\n            {/* Template Parts Assignment */}\n            <div className=\"bg-white p-6 rounded-lg border shadow-sm space-y-4\">\n                <h2 className=\"text-lg font-semibold\">Template Parts</h2>\n                <p className=\"text-sm text-muted-foreground\">\n                    Assign reusable headers and footers to this template.\n                </p>\n\n                <div className=\"grid md:grid-cols-2 gap-6\">\n                    <div className=\"grid gap-2\">\n                        <Label>Header</Label>\n                        <Select\n                            value={formData.parts.header || 'none'}\n                            onValueChange={v => handlePartChange('header', v)}\n                        >\n                            <SelectTrigger>\n                                <SelectValue placeholder=\"Select header...\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                                <SelectItem value=\"none\">No Header</SelectItem>\n                                {headers.map(h => (\n                                    <SelectItem key={h.id} value={h.id}>{h.name}</SelectItem>\n                                ))}\n                            </SelectContent>\n                        </Select>\n                    </div>\n\n                    <div className=\"grid gap-2\">\n                        <Label>Footer</Label>\n                        <Select\n                            value={formData.parts.footer || 'none'}\n                            onValueChange={v => handlePartChange('footer', v)}\n                        >\n                            <SelectTrigger>\n                                <SelectValue placeholder=\"Select footer...\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                                <SelectItem value=\"none\">No Footer</SelectItem>\n                                {footers.map(f => (\n                                    <SelectItem key={f.id} value={f.id}>{f.name}</SelectItem>\n                                ))}\n                            </SelectContent>\n                        </Select>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default TemplateEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/templates/TemplateLanguageManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\n// import { useTranslation } from 'react-i18next';\nimport { Plus, Search, Trash2, Save } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from '@/components/ui/table';\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Label } from '@/components/ui/label';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useTemplates } from '@/hooks/useTemplates';\n\nconst TemplateLanguageManager = () => {\n    const { templateStrings, updateTemplateString, deleteTemplateString } = useTemplates();\n    const [searchQuery, setSearchQuery] = useState('');\n    const [isAddOpen, setIsAddOpen] = useState(false);\n\n    // Filters\n    const filteredStrings = templateStrings.filter(s =>\n        s.key.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        s.value?.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <div>\n                    <h3 className=\"text-lg font-medium\">Template Translations</h3>\n                    <p className=\"text-sm text-muted-foreground\">Manage text strings used in templates.</p>\n                </div>\n                <div className=\"flex gap-2\">\n                    <Dialog open={isAddOpen} onOpenChange={setIsAddOpen}>\n                        <DialogTrigger asChild>\n                            <Button>\n                                <Plus className=\"w-4 h-4 mr-2\" /> Add Translation\n                            </Button>\n                        </DialogTrigger>\n                        <DialogContent>\n                            <AddTranslationForm onClose={() => setIsAddOpen(false)} onSave={updateTemplateString} />\n                        </DialogContent>\n                    </Dialog>\n                </div>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n                <div className=\"relative flex-1 max-w-sm\">\n                    <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                        placeholder=\"Search keys...\"\n                        value={searchQuery}\n                        onChange={(e) => setSearchQuery(e.target.value)}\n                        className=\"pl-8\"\n                    />\n                </div>\n            </div>\n\n            <div className=\"border rounded-md\">\n                <Table>\n                    <TableHeader>\n                        <TableRow>\n                            <TableHead>Key</TableHead>\n                            <TableHead>Locale</TableHead>\n                            <TableHead>Value</TableHead>\n                            <TableHead className=\"w-[100px]\">Actions</TableHead>\n                        </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                        {filteredStrings.length === 0 ? (\n                            <TableRow>\n                                <TableCell colSpan={4} className=\"text-center py-8 text-muted-foreground\">\n                                    No translations found.\n                                </TableCell>\n                            </TableRow>\n                        ) : (\n                            filteredStrings.map((item) => (\n                                <TranslationRow\n                                    key={item.id}\n                                    item={item}\n                                    onUpdate={updateTemplateString}\n                                    onDelete={deleteTemplateString}\n                                />\n                            ))\n                        )}\n                    </TableBody>\n                </Table>\n            </div>\n        </div>\n    );\n};\n\nconst TranslationRow = ({ item, onUpdate, onDelete }) => {\n    const [isEditing, setIsEditing] = useState(false);\n    const [value, setValue] = useState(item.value || '');\n\n    const handleSave = async () => {\n        await onUpdate(item.id, { value });\n        setIsEditing(false);\n    };\n\n    return (\n        <TableRow>\n            <TableCell className=\"font-mono text-xs\">{item.key}</TableCell>\n            <TableCell>\n                <span className={`px-2 py-1 rounded text-xs font-medium ${item.locale === 'en' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}`}>\n                    {item.locale?.toUpperCase()}\n                </span>\n            </TableCell>\n            <TableCell>\n                {isEditing ? (\n                    <div className=\"flex gap-2\">\n                        <Input\n                            value={value}\n                            onChange={e => setValue(e.target.value)}\n                            className=\"h-8\"\n                        />\n                        <Button size=\"sm\" onClick={handleSave}><Save className=\"w-4 h-4\" /></Button>\n                    </div>\n                ) : (\n                    <div className=\"cursor-pointer hover:bg-slate-50 p-1 rounded\" onClick={() => setIsEditing(true)}>\n                        {item.value || <span className=\"text-muted-foreground italic\">Empty</span>}\n                    </div>\n                )}\n            </TableCell>\n            <TableCell>\n                <Button variant=\"ghost\" size=\"sm\" className=\"text-red-500 hover:text-red-700\" onClick={() => onDelete(item.id)}>\n                    <Trash2 className=\"w-4 h-4\" />\n                </Button>\n            </TableCell>\n        </TableRow>\n    );\n};\n\nconst AddTranslationForm = ({ onClose, onSave }) => {\n    const [key, setKey] = useState('');\n    const [locale, setLocale] = useState('en');\n    const [value, setValue] = useState('');\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        await onSave('new', { key, locale, value });\n        onClose();\n    };\n\n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <DialogHeader>\n                <DialogTitle>Add Translation</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-2\">\n                <Label>Key</Label>\n                <Input\n                    placeholder=\"e.g., home.welcome_message\"\n                    value={key}\n                    onChange={e => setKey(e.target.value)}\n                    required\n                />\n            </div>\n            <div className=\"space-y-2\">\n                <Label>Locale</Label>\n                <Select value={locale} onValueChange={setLocale}>\n                    <SelectTrigger>\n                        <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"en\">English (en)</SelectItem>\n                        <SelectItem value=\"id\">Indonesian (id)</SelectItem>\n                    </SelectContent>\n                </Select>\n            </div>\n            <div className=\"space-y-2\">\n                <Label>Value</Label>\n                <Input\n                    placeholder=\"Translated text...\"\n                    value={value}\n                    onChange={e => setValue(e.target.value)}\n                    required\n                />\n            </div>\n            <div className=\"pt-4 flex justify-end gap-2\">\n                <Button type=\"button\" variant=\"outline\" onClick={onClose}>Cancel</Button>\n                <Button type=\"submit\">Save</Button>\n            </div>\n        </form>\n    );\n};\n\nexport default TemplateLanguageManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/templates/TemplatePartEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  36 |             const part = templateParts.find(p => p.id === id);\n  37 |             if (part) {\n> 38 |                 setFormData({\n     |                 ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  39 |                     name: part.name || '',\n  40 |                     type: part.type || 'header',\n  41 |                 });","line":38,"column":17,"nodeType":null,"endLine":38,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useTemplates } from '@/hooks/useTemplates';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { ArrowLeft, Save, Paintbrush } from 'lucide-react';\n\nconst PART_TYPES = [\n    { value: 'header', label: 'Header' },\n    { value: 'footer', label: 'Footer' },\n    { value: 'sidebar', label: 'Sidebar' },\n    { value: 'widget_area', label: 'Widget Area' },\n];\n\nconst TemplatePartEditor = () => {\n    const { id } = useParams();\n    const navigate = useNavigate();\n    const { templateParts, updateTemplatePart, loading } = useTemplates();\n\n    const [formData, setFormData] = useState({\n        name: '',\n        type: 'header',\n    });\n\n    // Load part data\n    useEffect(() => {\n        if (templateParts.length > 0 && id) {\n            const part = templateParts.find(p => p.id === id);\n            if (part) {\n                setFormData({\n                    name: part.name || '',\n                    type: part.type || 'header',\n                });\n            }\n        }\n    }, [templateParts, id]);\n\n    const handleChange = (field, value) => {\n        setFormData(prev => ({ ...prev, [field]: value }));\n    };\n\n    const handleSave = async () => {\n        await updateTemplatePart(id, formData);\n        navigate('/cmspanel/templates');\n    };\n\n    if (loading) return <div className=\"p-6\">Loading...</div>;\n\n    return (\n        <div className=\"p-6 max-w-2xl mx-auto space-y-8\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-4\">\n                    <Button variant=\"ghost\" onClick={() => navigate('/cmspanel/templates')}>\n                        <ArrowLeft className=\"w-4 h-4 mr-2\" /> Back\n                    </Button>\n                    <h1 className=\"text-2xl font-bold\">Edit Template Part</h1>\n                </div>\n                <div className=\"flex gap-2\">\n                    <Button variant=\"outline\" onClick={() => navigate(`/cmspanel/visual-editor?partId=${id}`)}>\n                        <Paintbrush className=\"w-4 h-4 mr-2\" /> Design Content\n                    </Button>\n                    <Button onClick={handleSave}>\n                        <Save className=\"w-4 h-4 mr-2\" /> Save\n                    </Button>\n                </div>\n            </div>\n\n            {/* Form */}\n            <div className=\"grid gap-6 bg-white p-6 rounded-lg border shadow-sm\">\n                <div className=\"grid gap-2\">\n                    <Label>Part Name</Label>\n                    <Input\n                        value={formData.name}\n                        onChange={e => handleChange('name', e.target.value)}\n                        placeholder=\"e.g., Main Header\"\n                    />\n                </div>\n\n                <div className=\"grid gap-2\">\n                    <Label>Type</Label>\n                    <Select value={formData.type} onValueChange={v => handleChange('type', v)}>\n                        <SelectTrigger className=\"w-[200px]\">\n                            <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                            {PART_TYPES.map(t => (\n                                <SelectItem key={t.value} value={t.value}>{t.label}</SelectItem>\n                            ))}\n                        </SelectContent>\n                    </Select>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default TemplatePartEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/templates/TemplatePartsList.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Plus, Edit, Trash2, MoreVertical, Puzzle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTemplates } from '@/hooks/useTemplates';\n\nconst TemplatePartsList = () => {\n    const navigate = useNavigate();\n    const { templateParts, loading, createPart, deletePart } = useTemplates();\n    const [searchTerm, setSearchTerm] = useState('');\n    const [partToDelete, setPartToDelete] = useState(null);\n    const [isCreateOpen, setIsCreateOpen] = useState(false);\n    const [newPartName, setNewPartName] = useState('');\n    const [newPartType, setNewPartType] = useState('widget_area');\n    const { hasPermission } = usePermissions();\n\n    const handleCreate = async () => {\n        if (!newPartName) return;\n\n        try {\n            const data = await createPart({\n                name: newPartName,\n                type: newPartType,\n                is_active: true,\n                content: { content: [], root: {} } // Empty puck content\n            });\n            setIsCreateOpen(false);\n            setNewPartName('');\n            setNewPartType('widget_area');\n\n            // Navigate to Visual Editor with partId\n            navigate(`/cmspanel/visual-editor?partId=${data.id}`);\n        } catch (error) {\n            console.error(error);\n        }\n    };\n\n    const filteredParts = templateParts.filter(p =>\n        p.name.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    const getIcon = (type) => {\n        switch (type) {\n            case 'header': return <div className=\"h-3 w-8 bg-indigo-200 border border-indigo-300 rounded-sm\" />;\n            case 'footer': return <div className=\"h-3 w-8 bg-slate-200 border border-slate-300 rounded-sm mt-auto\" />;\n            case 'sidebar': return <div className=\"h-8 w-3 bg-blue-200 border border-blue-300 rounded-sm\" />;\n            default: return <Puzzle className=\"w-5 h-5 text-slate-400\" />;\n        }\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <div className=\"relative max-w-md w-full\">\n                    <Input\n                        placeholder=\"Search parts...\"\n                        value={searchTerm}\n                        onChange={e => setSearchTerm(e.target.value)}\n                    />\n                </div>\n\n                {hasPermission('tenant.setting.update') && (\n                    <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n                        <DialogTrigger asChild>\n                            <Button className=\"bg-indigo-600 hover:bg-indigo-700\">\n                                <Plus className=\"w-4 h-4 mr-2\" /> New Part\n                            </Button>\n                        </DialogTrigger>\n                        <DialogContent>\n                            <DialogHeader>\n                                <DialogTitle>Create Template Part</DialogTitle>\n                                <DialogDescription>\n                                    Create a reusable header, footer, or sidebar.\n                                </DialogDescription>\n                            </DialogHeader>\n                            <div className=\"grid gap-4 py-4\">\n                                <div className=\"grid grid-cols-4 items-center gap-4\">\n                                    <Label htmlFor=\"name\" className=\"text-right\">Name</Label>\n                                    <Input id=\"name\" value={newPartName} onChange={e => setNewPartName(e.target.value)} className=\"col-span-3\" />\n                                </div>\n                                <div className=\"grid grid-cols-4 items-center gap-4\">\n                                    <Label htmlFor=\"type\" className=\"text-right\">Type</Label>\n                                    <Select value={newPartType} onValueChange={setNewPartType}>\n                                        <SelectTrigger className=\"col-span-3\">\n                                            <SelectValue />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            <SelectItem value=\"header\">Header</SelectItem>\n                                            <SelectItem value=\"footer\">Footer</SelectItem>\n                                            <SelectItem value=\"sidebar\">Sidebar</SelectItem>\n                                            <SelectItem value=\"widget_area\">Widget Area</SelectItem>\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                            </div>\n                            <DialogFooter>\n                                <Button onClick={handleCreate}>Create</Button>\n                            </DialogFooter>\n                        </DialogContent>\n                    </Dialog>\n                )}\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {loading ? (\n                    <div className=\"col-span-full text-center text-slate-500\">Loading parts...</div>\n                ) : filteredParts.length === 0 ? (\n                    <div className=\"col-span-full text-center py-20 border border-dashed rounded-lg bg-slate-50 text-slate-500\">\n                        No template parts found. Create one to get started.\n                    </div>\n                ) : (\n                    filteredParts.map(part => (\n                        <div key={part.id} className=\"bg-white p-4 rounded-lg border border-slate-200 flex items-center justify-between hover:shadow-sm transition-shadow\">\n                            <div className=\"flex items-center gap-4\">\n                                <div className=\"h-12 w-12 bg-slate-100 rounded-md flex items-center justify-center\">\n                                    {getIcon(part.type)}\n                                </div>\n                                <div>\n                                    <h4 className=\"font-medium text-slate-900\">{part.name}</h4>\n                                    <span className=\"text-xs text-slate-500 uppercase tracking-wider\">{part.type}</span>\n                                </div>\n                            </div>\n\n                            <DropdownMenu>\n                                <DropdownMenuTrigger asChild>\n                                    <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                                        <MoreVertical className=\"w-4 h-4 text-slate-400\" />\n                                    </Button>\n                                </DropdownMenuTrigger>\n                                <DropdownMenuContent align=\"end\">\n                                    <DropdownMenuItem onClick={() => navigate(`/cmspanel/visual-editor?partId=${part.id}`)}>\n                                        <Edit className=\"w-4 h-4 mr-2\" /> Edit Content\n                                    </DropdownMenuItem>\n                                    <DropdownMenuSeparator />\n                                    <DropdownMenuItem onClick={() => setPartToDelete(part.id)} className=\"text-red-600\">\n                                        <Trash2 className=\"w-4 h-4 mr-2\" /> Delete\n                                    </DropdownMenuItem>\n                                </DropdownMenuContent>\n                            </DropdownMenu>\n                        </div>\n                    ))\n                )}\n            </div>\n\n            <AlertDialog open={!!partToDelete} onOpenChange={(open) => !open && setPartToDelete(null)}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Delete Part?</AlertDialogTitle>\n                        <AlertDialogDescription>This action cannot be undone.</AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={() => { deletePart(partToDelete); setPartToDelete(null); }} className=\"bg-red-600\">Delete</AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    );\n};\n\nexport default TemplatePartsList;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/templates/TemplatesList.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { LayoutTemplate, Plus, Edit, Trash2, Copy, Search, MoreVertical } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuLabel,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTemplates } from '@/hooks/useTemplates';\n\nconst TemplatesList = () => {\n    const navigate = useNavigate();\n    const { templates, loading, createTemplate, deleteTemplate, duplicateTemplate } = useTemplates();\n    const [searchTerm, setSearchTerm] = useState('');\n    const [templateToDelete, setTemplateToDelete] = useState(null);\n    const { hasPermission } = usePermissions();\n\n    const handleCreate = async () => {\n        const fallbackId = crypto.randomUUID();\n        const defaultTemplate = {\n            id: fallbackId,\n            name: \"New Template\",\n            slug: \"template-\" + Date.now(),\n            description: \"A new blank template.\",\n            is_active: true,\n            type: 'page',\n            parts: {},\n            data: {\n                content: [],\n                root: { props: { title: 'New Template' } }\n            }\n        };\n\n        try {\n            const newTemplateData = await createTemplate(defaultTemplate);\n            // Navigate to Visual Editor\n            navigate(`/cmspanel/visual-editor?templateId=${newTemplateData?.id || fallbackId}`);\n        } catch (error) {\n            console.error(\"Failed to create template\", error);\n        }\n    };\n\n    const filteredTemplates = templates.filter(t =>\n        t.name.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n                <div className=\"relative max-w-md w-full\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400\" />\n                    <Input\n                        placeholder=\"Search templates...\"\n                        className=\"pl-9\"\n                        value={searchTerm}\n                        onChange={e => setSearchTerm(e.target.value)}\n                    />\n                </div>\n\n                {hasPermission('tenant.setting.update') && (\n                    <Button onClick={handleCreate} className=\"bg-indigo-600 hover:bg-indigo-700 w-full sm:w-auto\">\n                        <Plus className=\"w-4 h-4 mr-2\" /> New Template\n                    </Button>\n                )}\n            </div>\n\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                {loading ? (\n                    [...Array(4)].map((_, i) => (\n                        <div key={i} className=\"h-48 bg-slate-100 rounded-xl animate-pulse\"></div>\n                    ))\n                ) : filteredTemplates.length === 0 ? (\n                    <div className=\"col-span-full py-20 text-center text-slate-500 bg-white rounded-xl border border-dashed border-slate-300\">\n                        <LayoutTemplate className=\"w-12 h-12 mx-auto mb-4 opacity-20\" />\n                        <p>No templates found.</p>\n                    </div>\n                ) : (\n                    filteredTemplates.map(template => (\n                        <div key={template.id} className=\"group bg-white rounded-xl border border-slate-200 hover:border-slate-300 hover:shadow-lg transition-all duration-200 overflow-hidden flex flex-col\">\n                            <div className=\"h-32 bg-slate-50 border-b border-slate-100 flex items-center justify-center relative\">\n                                {template.thumbnail ? (\n                                    <img src={template.thumbnail} alt={template.name} className=\"w-full h-full object-cover\" />\n                                ) : (\n                                    <LayoutTemplate className=\"w-10 h-10 text-slate-300\" />\n                                )}\n                                <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                    <Button size=\"icon\" variant=\"secondary\" className=\"h-8 w-8 rounded-full shadow-sm\" onClick={() => navigate(`/cmspanel/visual-editor?templateId=${template.id}`)}>\n                                        <Edit className=\"w-4 h-4 text-slate-700\" />\n                                    </Button>\n                                </div>\n                            </div>\n\n                            <div className=\"p-4 flex-1 flex flex-col\">\n                                <div className=\"flex justify-between items-start mb-2\">\n                                    <div>\n                                        <h3 className=\"font-semibold text-slate-900 truncate pr-2\" title={template.name}>{template.name}</h3>\n                                        <div className=\"flex items-center gap-2 mt-1\">\n                                            <span className=\"text-xs bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded capitalize\">{template.type || 'page'}</span>\n                                            {template.is_active && <span className=\"text-xs bg-green-100 text-green-600 px-1.5 py-0.5 rounded\">Active</span>}\n                                        </div>\n                                    </div>\n\n                                    <DropdownMenu>\n                                        <DropdownMenuTrigger asChild>\n                                            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                                                <MoreVertical className=\"w-4 h-4 text-slate-400\" />\n                                            </Button>\n                                        </DropdownMenuTrigger>\n                                        <DropdownMenuContent align=\"end\">\n                                            <DropdownMenuLabel>Actions</DropdownMenuLabel>\n                                            <DropdownMenuSeparator />\n                                            <DropdownMenuItem onClick={() => duplicateTemplate(template)}>\n                                                <Copy className=\"w-4 h-4 mr-2\" /> Duplicate\n                                            </DropdownMenuItem>\n                                            <DropdownMenuSeparator />\n                                            <DropdownMenuItem\n                                                onClick={() => setTemplateToDelete(template.id)}\n                                                className=\"text-red-600 focus:text-red-700 focus:bg-red-50\"\n                                            >\n                                                <Trash2 className=\"w-4 h-4 mr-2\" /> Delete\n                                            </DropdownMenuItem>\n                                        </DropdownMenuContent>\n                                    </DropdownMenu>\n                                </div>\n                            </div>\n                        </div>\n                    ))\n                )}\n            </div>\n\n            <AlertDialog open={!!templateToDelete} onOpenChange={(open) => !open && setTemplateToDelete(null)}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Delete Template?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            This will move the template to trash.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={() => { deleteTemplate(templateToDelete); setTemplateToDelete(null); }} className=\"bg-red-600 hover:bg-red-700\">Delete</AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    );\n};\n\nexport default TemplatesList;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/ActivityFeed.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { FileEdit } from 'lucide-react';\nimport { formatDistanceToNow } from 'date-fns';\n\nexport function ActivityFeed({ activities }) {\n  const { t } = useTranslation();\n  return (\n    <Card className=\"dashboard-surface dashboard-surface-hover\">\n      <CardHeader>\n        <CardTitle>{t('dashboard.recent_activity')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          {activities && activities.length > 0 ? (\n            activities.map((activity, index) => (\n              <div key={index} className=\"flex items-start gap-4 pb-4 border-b border-slate-100/50 dark:border-slate-700/50 last:border-0 last:pb-0 hover:bg-white/40 dark:hover:bg-slate-700/40 p-2 -mx-2 rounded-lg transition-colors\">\n                <div className=\"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full shrink-0\">\n                  <FileEdit className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\n                </div>\n                <div className=\"space-y-1 min-w-0\">\n                  <p className=\"text-sm font-medium text-slate-900 dark:text-white truncate\">\n                    <span className=\"font-bold\">{activity.user}</span> {activity.action} a {activity.type}\n                  </p>\n                  <p className=\"text-sm text-slate-600 dark:text-slate-300 truncate\">\n                    &quot;{activity.title}&quot;\n                  </p>\n                  <p className=\"text-xs text-slate-400 font-medium\">\n                    {formatDistanceToNow(new Date(activity.time), { addSuffix: true })}\n                  </p>\n                </div>\n              </div>\n            ))\n          ) : (\n            <div className=\"text-center text-slate-500 dark:text-slate-400 py-8\">\n              {t('dashboard.no_activity')}\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/ContentDistribution.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend } from 'recharts';\n\nexport function ContentDistribution({ data }) {\n  const chartData = [\n    { name: 'Blogs', value: data?.blogs || 0, color: '#3b82f6' },\n    { name: 'Pages', value: data?.pages || 0, color: '#a855f7' },\n    { name: 'Products', value: data?.products || 0, color: '#f97316' },\n    { name: 'Users', value: data?.users || 0, color: '#22c55e' },\n  ].filter(item => item.value > 0);\n\n  return (\n    <Card className=\"dashboard-surface dashboard-surface-hover col-span-1 min-w-0\">\n      <CardHeader>\n        <CardTitle>Content Overview</CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-6\">\n        {chartData.length > 0 ? (\n          <div className=\"w-full h-[300px] relative\" style={{ minHeight: '300px' }}>\n            {/* minWidth/minHeight added to suppress Recharts warning during initial render/animation */}\n            <ResponsiveContainer width=\"100%\" height=\"100%\" minWidth={100} minHeight={100}>\n              <PieChart>\n                <Pie\n                  data={chartData}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  innerRadius={60}\n                  outerRadius={80}\n                  paddingAngle={5}\n                  dataKey=\"value\"\n                >\n                  {chartData.map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={entry.color} strokeWidth={0} />\n                  ))}\n                </Pie>\n                <Tooltip\n                  contentStyle={{\n                    backgroundColor: 'rgba(255, 255, 255, 0.95)',\n                    borderRadius: '12px',\n                    border: 'none',\n                    boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',\n                    padding: '8px 12px'\n                  }}\n                  itemStyle={{ color: '#1e293b', fontWeight: 500, fontSize: '13px' }}\n                  cursor={false}\n                />\n                <Legend\n                  verticalAlign=\"bottom\"\n                  height={36}\n                  iconType=\"circle\"\n                  formatter={(value) => <span className=\"text-sm font-medium text-slate-600 dark:text-slate-300 ml-1\">{value}</span>}\n                />\n              </PieChart>\n            </ResponsiveContainer>\n          </div>\n        ) : (\n          <div className=\"flex items-center justify-center h-full text-slate-400 dark:text-slate-500\">\n            No data available\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/MyApprovals.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { CheckCircle, ArrowRight, FileText } from 'lucide-react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { Link } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { formatDistanceToNow } from 'date-fns';\n\nexport function MyApprovals() {\n    const { hasPermission } = usePermissions();\n    const [approvals, setApprovals] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    const canApprove = hasPermission('tenant.post.publish'); // Simpler check for now\n\n    useEffect(() => {\n        if (canApprove) {\n            fetchPendingApprovals();\n        } else {\n            setLoading(false);\n        }\n    }, [canApprove]);\n\n    const fetchPendingApprovals = async () => {\n        try {\n            // Fetch posts in 'reviewed' state\n            const { data: posts, error } = await supabase\n                .from('blogs') // Updated to 'blogs' table\n                .select('id, title, updated_at, author:users!created_by(email)')\n                .eq('workflow_state', 'reviewed')\n                .limit(5);\n\n            if (error) throw error;\n            setApprovals(posts || []);\n        } catch (err) {\n            console.error('Error fetching approvals:', err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (!canApprove) return null;\n\n    if (loading) return <div className=\"h-[200px] bg-slate-100/80 dark:bg-slate-800/70 animate-pulse rounded-2xl\" />;\n\n    return (\n        <Card className=\"dashboard-surface dashboard-surface-hover flex flex-col\">\n            <CardContent className=\"p-6 flex-1 flex flex-col\">\n                <div className=\"flex items-center justify-between mb-4\">\n                    <h3 className=\"font-bold text-slate-800 dark:text-white flex items-center gap-2\">\n                        <CheckCircle className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n                        Pending Approvals\n                        {approvals.length > 0 && (\n                            <span className=\"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs px-2 py-0.5 rounded-full\">\n                                {approvals.length}\n                            </span>\n                        )}\n                    </h3>\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto space-y-3\">\n                    {approvals.length > 0 ? (\n                        approvals.map(item => (\n                            <div key={item.id} className=\"p-3 bg-slate-50 dark:bg-slate-700/50 border border-slate-100 dark:border-slate-600 rounded-lg group hover:border-blue-200 dark:hover:border-blue-800 transition-colors\">\n                                <div className=\"flex justify-between items-start mb-1\">\n                                    <h4 className=\"font-medium text-slate-900 dark:text-white line-clamp-1\">{item.title}</h4>\n                                    <span className=\"text-xs text-slate-400 whitespace-nowrap\">\n                                        {formatDistanceToNow(new Date(item.updated_at), { addSuffix: true })}\n                                    </span>\n                                </div>\n                                <div className=\"flex items-center justify-between mt-2\">\n                                    <span className=\"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1\">\n                                        <FileText className=\"w-3 h-3\" />\n                                        by {item.author?.email || 'Unknown'}\n                                    </span>\n                                    <Button asChild size=\"sm\" variant=\"ghost\" className=\"h-6 text-xs text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/30\">\n                                        <Link to={`/cmspanel/blogs?edit=${item.id}`}>Review</Link>\n                                    </Button>\n                                </div>\n                            </div>\n                        ))\n                    ) : (\n                        <div className=\"flex flex-col items-center justify-center h-40 text-slate-400\">\n                            <CheckCircle className=\"w-8 h-8 mb-2 opacity-20\" />\n                            <p className=\"text-sm\">No items waiting for review</p>\n                        </div>\n                    )}\n                </div>\n\n                <div className=\"mt-4 pt-3 border-t border-slate-100 dark:border-slate-700\">\n                    <Link to=\"/cmspanel/blogs?status=reviewed\" className=\"text-sm text-slate-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 flex items-center justify-center w-full\">\n                        View All Queue <ArrowRight className=\"w-4 h-4 ml-1\" />\n                    </Link>\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/PlatformOverview.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { usePlatformStats } from '@/hooks/usePlatformStats';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Building2, Users, Database, ShieldCheck, TrendingUp, Activity } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { Badge } from '@/components/ui/badge';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport function PlatformOverview() {\n    const { t } = useTranslation();\n    const { stats, loading } = usePlatformStats();\n\n    if (loading) {\n        return <Skeleton className=\"h-48 w-full rounded-2xl bg-slate-100/70 dark:bg-slate-800/70 backdrop-blur-sm mb-8\" />;\n    }\n\n    const formatBytes = (bytes) => {\n        if (bytes === 0) return '0 B';\n        const k = 1024;\n        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    };\n\n    return (\n        <div className=\"space-y-8 mb-10 overflow-hidden\">\n            <div className=\"flex items-center gap-3 mb-6\">\n                <div className=\"p-2 rounded-lg bg-indigo-500/10 text-indigo-600\">\n                    <ShieldCheck className=\"w-6 h-6\" />\n                </div>\n                <h2 className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-slate-700 dark:from-white dark:to-slate-300\">\n                    {t('dashboard.platform.overview')}\n                </h2>\n            </div>\n\n            {/* Top Stats - Neo Glass */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n                <Card className=\"dashboard-surface dashboard-surface-hover\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium text-slate-600 dark:text-slate-400\">{t('dashboard.platform.total_tenants')}</CardTitle>\n                        <Building2 className=\"h-4 w-4 text-indigo-500\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-3xl font-extrabold text-slate-900 dark:text-white\">{stats.totalTenants}</div>\n                        <div className=\"mt-2 text-xs flex gap-2\">\n                            <Badge variant=\"outline\" className=\"bg-blue-50/50 text-blue-700 border-blue-200\">\n                                {stats.tenantsByTier.pro} {t('dashboard.platform.tier_pro')}\n                            </Badge>\n                            <Badge variant=\"outline\" className=\"bg-purple-50/50 text-purple-700 border-purple-200\">\n                                {stats.tenantsByTier.enterprise} {t('dashboard.platform.tier_ent')}\n                            </Badge>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card className=\"dashboard-surface dashboard-surface-hover\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium text-slate-600 dark:text-slate-400\">{t('dashboard.platform.system_users')}</CardTitle>\n                        <Users className=\"h-4 w-4 text-emerald-500\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-3xl font-extrabold text-slate-900 dark:text-white\">{stats.totalUsers}</div>\n                        <p className=\"text-xs text-slate-500 dark:text-slate-400 mt-1 font-medium\">{t('dashboard.platform.active_across_data')}</p>\n                    </CardContent>\n                </Card>\n\n                <Card className=\"dashboard-surface dashboard-surface-hover\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium text-slate-600 dark:text-slate-400\">{t('dashboard.platform.system_storage')}</CardTitle>\n                        <Database className=\"h-4 w-4 text-orange-500\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-3xl font-extrabold text-slate-900 dark:text-white\">{formatBytes(stats.totalStorage)}</div>\n                        {/* Visual Progress Bar */}\n                        <div className=\"w-full bg-slate-200/50 dark:bg-slate-700/50 rounded-full h-1.5 mt-3 overflow-hidden\">\n                            <div className=\"bg-gradient-to-r from-orange-400 to-red-500 h-1.5 rounded-full\" style={{ width: '45%' }}></div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card className=\"bg-gradient-to-br from-indigo-500 to-purple-600 text-white border-0 shadow-lg shadow-indigo-500/25 relative overflow-hidden group\">\n                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10 transition-transform duration-700 group-hover:scale-150\"></div>\n\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2 relative z-10\">\n                        <CardTitle className=\"text-sm font-medium text-indigo-100\">{t('dashboard.platform.health')}</CardTitle>\n                        <Activity className=\"h-4 w-4 text-indigo-200 animate-pulse\" />\n                    </CardHeader>\n                    <CardContent className=\"relative z-10\">\n                        <div className=\"text-3xl font-extrabold text-white\">100%</div>\n                        <p className=\"text-xs text-indigo-100 mt-1\">{t('dashboard.platform.systems_operational')}</p>\n                    </CardContent>\n                </Card>\n            </div>\n\n            {/* Recent Tenants Table - Glass Pane */}\n            <Card className=\"dashboard-surface dashboard-surface-hover\">\n                <CardHeader>\n                    <CardTitle className=\"text-lg font-bold text-slate-800 dark:text-white flex items-center gap-2\">\n                        <TrendingUp className=\"w-5 h-5 text-slate-400\" />\n                        {t('dashboard.platform.recent_registrations')}\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"space-y-4\">\n                        {stats.recentTenants.map(tenant => (\n                            <div key={tenant.id} className=\"group flex items-center justify-between border-b border-slate-100/50 dark:border-slate-700/50 last:border-0 pb-4 last:pb-0 hover:bg-white/50 dark:hover:bg-slate-700/50 p-2 rounded-lg transition-colors\">\n                                <div className=\"flex items-center gap-4\">\n                                    <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 flex items-center justify-center text-slate-600 dark:text-slate-300 shadow-inner\">\n                                        <Building2 className=\"w-5 h-5\" />\n                                    </div>\n                                    <div>\n                                        <p className=\"font-bold text-sm text-slate-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\">{tenant.name}</p>\n                                        <p className=\"text-xs text-slate-500 dark:text-slate-400 font-medium\">{t('dashboard.platform.joined')} {format(new Date(tenant.created_at), 'MMM d, yyyy')}</p>\n                                    </div>\n                                </div>\n                                <div className=\"flex items-center gap-3\">\n                                    <Badge variant={tenant.subscription_tier === 'free' ? 'secondary' : 'default'}\n                                        className={`uppercase text-[10px] tracking-wider font-bold ${tenant.subscription_tier === 'enterprise' ? 'bg-purple-100 text-purple-700 hover:bg-purple-200' :\n                                            tenant.subscription_tier === 'pro' ? 'bg-blue-100 text-blue-700 hover:bg-blue-200' :\n                                                'bg-slate-100 text-slate-700 hover:bg-slate-200'\n                                            }`}>\n                                        {tenant.subscription_tier}\n                                    </Badge>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/PluginWidgets.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/StatCards.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FileText, Layers, ShoppingBag, Users, HardDrive } from 'lucide-react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport function StatCards({ data, loading, className = '' }) {\n  const { t } = useTranslation();\n  const stats = [\n    {\n      title: t('dashboard.total_blogs'),\n      value: data?.blogs,\n      icon: FileText,\n      gradient: \"from-blue-500 to-blue-600\",\n      shadow: \"shadow-blue-500/20\",\n    },\n    {\n      title: t('dashboard.total_pages'),\n      value: data?.pages,\n      icon: Layers,\n      gradient: \"from-purple-500 to-purple-600\",\n      shadow: \"shadow-purple-500/20\",\n    },\n    {\n      title: t('dashboard.products'),\n      value: data?.products,\n      icon: ShoppingBag,\n      gradient: \"from-orange-500 to-orange-600\",\n      shadow: \"shadow-orange-500/20\",\n    },\n    {\n      title: t('dashboard.active_users'),\n      value: data?.users,\n      icon: Users,\n      gradient: \"from-emerald-500 to-emerald-600\",\n      shadow: \"shadow-emerald-500/20\",\n    },\n    {\n      title: t('dashboard.total_orders'),\n      value: data?.orders,\n      icon: ShoppingBag,\n      gradient: \"from-teal-500 to-teal-600\",\n      shadow: \"shadow-teal-500/20\",\n    },\n    {\n      title: t('dashboard.storage_used'),\n      value: data?.storage,\n      icon: HardDrive,\n      gradient: \"from-slate-600 to-slate-700\",\n      shadow: \"shadow-slate-500/20\",\n    }\n  ];\n\n  if (loading) {\n    return (\n      <div className={`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 ${className}`}>\n        {[1, 2, 3, 4, 5, 6].map((i) => (\n          <Card key={i} className=\"dashboard-surface dashboard-surface-hover overflow-hidden h-32\">\n            <CardContent className=\"p-6 flex flex-col justify-between h-full\">\n              <Skeleton className=\"h-4 w-24 bg-slate-200/60 dark:bg-slate-700/60\" />\n              <div className=\"flex justify-between items-end\">\n                <Skeleton className=\"h-8 w-16 bg-slate-200/60 dark:bg-slate-700/60\" />\n                <Skeleton className=\"h-10 w-10 rounded-xl bg-slate-200/60 dark:bg-slate-700/60\" />\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n      <div className={`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 ${className}`}>\n        {stats.map((stat, index) => {\n          const Icon = stat.icon;\n          return (\n            <Card\n              key={index}\n              className=\"dashboard-surface dashboard-surface-hover group relative overflow-hidden hover:shadow-lg transition-all duration-300 hover:-translate-y-1\"\n            >\n            {/* Subtle Gradient Glow Background */}\n            <div className={`absolute -right-6 -top-6 w-24 h-24 rounded-full bg-gradient-to-br ${stat.gradient} opacity-10 blur-2xl group-hover:opacity-20 transition-opacity`}></div>\n\n            <CardContent className=\"p-5 flex flex-col justify-between h-full relative z-10\">\n              <span className=\"text-sm font-medium text-slate-500 dark:text-slate-400 group-hover:text-slate-700 dark:group-hover:text-slate-300 transition-colors\">\n                {stat.title}\n              </span>\n\n              <div className=\"flex items-end justify-between mt-4\">\n                <div className=\"text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight\">\n                  {stat.value}\n                </div>\n\n                <div className={`p-2.5 rounded-xl bg-gradient-to-br ${stat.gradient} text-white shadow-lg ${stat.shadow} transform group-hover:scale-110 transition-transform duration-300`}>\n                  <Icon className=\"h-5 w-5\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        );\n      })}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/SystemHealth.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { CheckCircle2, AlertTriangle, XCircle, Activity } from 'lucide-react';\n\nconst StatusItem = ({ label, status }) => {\n  let Icon = CheckCircle2;\n  let color = \"text-emerald-500\";\n  let bg = \"bg-emerald-500/10\";\n  let pulse = true;\n\n  if (status === 'warning') {\n    Icon = AlertTriangle;\n    color = \"text-amber-500\";\n    bg = \"bg-amber-500/10\";\n    pulse = false;\n  } else if (status === 'error' || status === 'down') {\n    Icon = XCircle;\n    color = \"text-red-500\";\n    bg = \"bg-red-500/10\";\n    pulse = false;\n  }\n\n  return (\n    <div className=\"flex items-center justify-between p-4 bg-white/50 dark:bg-slate-700/50 rounded-xl border border-slate-100 dark:border-slate-600 hover:bg-white/80 dark:hover:bg-slate-700/80 transition-colors group\">\n      <span className=\"text-sm font-semibold text-slate-700 dark:text-slate-300 group-hover:text-slate-900 dark:group-hover:text-white transition-colors\">{label}</span>\n      <div className=\"flex items-center gap-3\">\n        <span className={`text-[10px] uppercase tracking-wider font-bold ${color} opacity-80`}>{status}</span>\n        <div className={`p-1.5 rounded-full ${bg} relative`}>\n          {pulse && <div className={`absolute inset-0 rounded-full ${bg} animate-ping opacity-50`}></div>}\n          <Icon className={`w-4 h-4 ${color} relative z-10`} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport function SystemHealth({ health }) {\n  return (\n    <Card className=\"dashboard-surface dashboard-surface-hover col-span-1 min-w-0\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"flex items-center gap-2 text-slate-800 dark:text-white\">\n          <Activity className=\"w-5 h-5 text-indigo-500\" />\n          System Health\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        <StatusItem label=\"Database Connection\" status={health?.database || 'unknown'} />\n        <StatusItem label=\"Storage Service\" status={health?.storage || 'unknown'} />\n        <StatusItem label=\"API Status\" status={health?.api || 'unknown'} />\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/TopBlogsWidget.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ArrowRight } from 'lucide-react';\nimport { Link } from 'react-router-dom';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport function TopBlogsWidget({ data, loading }) {\n    return (\n        <Card className=\"dashboard-surface dashboard-surface-hover hover:shadow-lg\">\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2 space-y-0\">\n                <CardTitle className=\"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2\">\n                    <span className=\"w-1 h-6 bg-gradient-to-b from-blue-500 to-indigo-600 rounded-full\"></span>\n                    Top Performing Blogs\n                </CardTitle>\n                <Link to=\"/cmspanel/blogs\" className=\"text-sm text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 font-medium flex items-center gap-1 group px-3 py-1.5 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-colors\">\n                    View All <ArrowRight className=\"w-4 h-4 transition-transform group-hover:translate-x-1\" />\n                </Link>\n            </CardHeader>\n            <CardContent className=\"space-y-3 pt-4\">\n                {loading ? (\n                    [...Array(3)].map((_, i) => (\n                        <div key={i} className=\"flex items-center justify-between p-4 bg-white/60 dark:bg-slate-800/50 rounded-xl border border-slate-200/60 dark:border-slate-700/60\">\n                            <div className=\"space-y-3 w-full\">\n                                <Skeleton className=\"h-4 w-3/4 bg-slate-200/60 dark:bg-slate-600/60\" />\n                                <Skeleton className=\"h-3 w-1/3 bg-slate-200/60 dark:bg-slate-600/60\" />\n                            </div>\n                        </div>\n                    ))\n                ) : data && data.length > 0 ? (\n                    data.map((blog, i) => (\n                        <div key={i} className=\"group flex items-center justify-between p-4 bg-white/40 dark:bg-slate-700/40 rounded-xl border border-white/20 dark:border-slate-600/20 hover:bg-white/80 dark:hover:bg-slate-700/80 hover:border-indigo-100 dark:hover:border-indigo-800 transition-all duration-200\">\n                            <div className=\"flex flex-col gap-1\">\n                                <span className=\"font-semibold text-slate-800 dark:text-white truncate max-w-[180px] sm:max-w-md group-hover:text-indigo-700 dark:group-hover:text-indigo-400 transition-colors\">\n                                    {blog.title}\n                                </span>\n                                <span className=\"text-xs text-slate-500 dark:text-slate-400\">Published in {blog.category || 'General'}</span>\n                            </div>\n                            <div className=\"flex items-center gap-4 text-sm\">\n                                <span className=\"text-slate-500 dark:text-slate-400 font-medium bg-slate-100/50 dark:bg-slate-600/50 px-2 py-1 rounded-md\">{blog.views || 0} views</span>\n                                <span className={`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide border ${blog.status === 'published'\n                                    ? 'bg-emerald-100/50 text-emerald-700 border-emerald-200'\n                                    : 'bg-amber-100/50 text-amber-700 border-amber-200'\n                                    }`}>\n                                    {blog.status}\n                                </span>\n                            </div>\n                        </div>\n                    ))\n                ) : (\n                    <div className=\"text-center py-10 bg-slate-50/50 dark:bg-slate-800/50 rounded-xl border border-dashed border-slate-200 dark:border-slate-700\">\n                        <p className=\"text-slate-400 dark:text-slate-500\">No blogs found.</p>\n                    </div>\n                )}\n            </CardContent>\n        </Card>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/UsageWidget.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { Progress } from \"@/components/ui/progress\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Loader2, Database, Users, TrendingUp } from \"lucide-react\";\n\n// Limits must match SQL enforcement logic\nconst TIERS = {\n    free: { max_users: 5, max_storage: 104857600, label: 'Free Plan' },\n    pro: { max_users: 50, max_storage: 10737418240, label: 'Pro Plan' },\n    enterprise: { max_users: -1, max_storage: -1, label: 'Enterprise' }\n};\n\nexport function UsageWidget() {\n    const { tenantId } = usePermissions();\n    const [usage, setUsage] = useState({ users: 0, storage: 0 });\n    const [tier, setTier] = useState('free');\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        if (!tenantId) {\n            setLoading(false);\n            return;\n        }\n\n        const fetchData = async () => {\n            setLoading(true);\n            try {\n                // 1. Get Tenant Tier\n                const { data: tenant } = await supabase\n                    .from('tenants')\n                    .select('subscription_tier')\n                    .eq('id', tenantId)\n                    .single();\n\n                const currentTier = tenant?.subscription_tier || 'free';\n                setTier(currentTier);\n\n                // 2. Get User Count (RLS automatically restricts to tenant)\n                const { count: userCount } = await supabase\n                    .from('users')\n                    .select('*', { count: 'exact', head: true });\n\n                // 3. Get Storage Usage (Sum file_size)\n                const { data: files } = await supabase\n                    .from('files')\n                    .select('file_size')\n                    .is('deleted_at', null);\n\n                const totalSize = files?.reduce((acc, f) => acc + (f.file_size || 0), 0) || 0;\n\n                setUsage({ users: userCount || 0, storage: totalSize });\n\n            } catch (error) {\n                console.error(\"Error fetching usage:\", error);\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchData();\n    }, [tenantId]);\n\n    const formatBytes = (bytes) => {\n        if (bytes === 0) return '0 B';\n        const k = 1024;\n        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    };\n\n    if (loading) {\n        return (\n            <Card className=\"dashboard-surface dashboard-surface-hover\">\n                <CardContent className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                </CardContent>\n            </Card>\n        );\n    }\n\n    if (!tenantId) return null;\n\n    const limits = TIERS[tier] || TIERS.free;\n    const storagePercent = limits.max_storage === -1 ? 0 : Math.min((usage.storage / limits.max_storage) * 100, 100);\n    const usersPercent = limits.max_users === -1 ? 0 : Math.min((usage.users / limits.max_users) * 100, 100);\n\n    return (\n        <Card className=\"dashboard-surface dashboard-surface-hover\">\n            <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                    <TrendingUp className=\"h-4 w-4\" />\n                    Resource Usage\n                    <span className=\"ml-auto text-xs font-normal text-muted-foreground bg-primary/10 px-2 py-0.5 rounded\">\n                        {limits.label}\n                    </span>\n                </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n                {/* Users Usage */}\n                <div className=\"space-y-2\">\n                    <div className=\"flex justify-between text-sm\">\n                        <span className=\"flex items-center gap-2 text-muted-foreground\">\n                            <Users className=\"h-4 w-4\" /> Users\n                        </span>\n                        <span className=\"font-medium\">\n                            {usage.users} / {limits.max_users === -1 ? '' : limits.max_users}\n                        </span>\n                    </div>\n                    {limits.max_users !== -1 && (\n                        <Progress\n                            value={usersPercent}\n                            className=\"h-2\"\n                        />\n                    )}\n                </div>\n\n                {/* Storage Usage */}\n                <div className=\"space-y-2\">\n                    <div className=\"flex justify-between text-sm\">\n                        <span className=\"flex items-center gap-2 text-muted-foreground\">\n                            <Database className=\"h-4 w-4\" /> Storage\n                        </span>\n                        <span className=\"font-medium\">\n                            {formatBytes(usage.storage)} / {limits.max_storage === -1 ? '' : formatBytes(limits.max_storage)}\n                        </span>\n                    </div>\n                    {limits.max_storage !== -1 && (\n                        <Progress\n                            value={storagePercent}\n                            className=\"h-2\"\n                        />\n                    )}\n                </div>\n\n                {tier === 'free' && (\n                    <div className=\"pt-2 border-t dark:border-slate-700\">\n                        <button className=\"text-xs text-primary hover:underline\">\n                            Upgrade to Pro \n                        </button>\n                    </div>\n                )}\n            </CardContent>\n        </Card>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/WidgetEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":115,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":115,"endColumn":49}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'onChange'. Either include it or remove the dependency array. If 'onChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":24,"column":8,"nodeType":"ArrayExpression","endLine":24,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [localConfig, onChange]","fix":{"range":[955,968],"text":"[localConfig, onChange]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { CORE_WIDGETS } from '@/lib/widgetRegistry';\n\nconst WidgetEditor = ({ type, config, onChange, onSave, onCancel }) => {\n    const { t } = useTranslation();\n    // Clone config to local state\n    const [localConfig, setLocalConfig] = useState(config || {});\n\n    // Helper to update local config\n    const updateField = (key, value) => {\n        setLocalConfig(prev => ({ ...prev, [key]: value }));\n    };\n\n    // Notify parent on change if needed (for live preview?)\n    useEffect(() => {\n        onChange && onChange(localConfig);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [localConfig]);\n\n    // Render form based on type\n    const renderFields = () => {\n        switch (type) {\n            case 'core/text':\n                return (\n                    <div className=\"space-y-4\">\n                        <div className=\"grid gap-2\">\n                            <Label>{t('widgets_manager.editor.content_label')}</Label>\n                            <Textarea\n                                value={localConfig.content || ''}\n                                onChange={e => updateField('content', e.target.value)}\n                                rows={8}\n                            />\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                            <Switch\n                                id=\"isHtml\"\n                                checked={localConfig.isHtml || false}\n                                onCheckedChange={checked => updateField('isHtml', checked)}\n                            />\n                            <Label htmlFor=\"isHtml\">{t('widgets_manager.editor.render_html_label')}</Label>\n                        </div>\n                    </div>\n                );\n            case 'core/image':\n                return (\n                    <div className=\"space-y-4\">\n                        <div className=\"grid gap-2\">\n                            <Label>{t('widgets_manager.editor.image_url_label')}</Label>\n                            <Input\n                                value={localConfig.url || ''}\n                                onChange={e => updateField('url', e.target.value)}\n                            />\n                        </div>\n                        <div className=\"grid gap-2\">\n                            <Label>{t('widgets_manager.editor.alt_text_label')}</Label>\n                            <Input\n                                value={localConfig.alt || ''}\n                                onChange={e => updateField('alt', e.target.value)}\n                            />\n                        </div>\n                    </div>\n                );\n            case 'core/button':\n                return (\n                    <div className=\"space-y-4\">\n                        <div className=\"grid gap-2\">\n                            <Label>{t('widgets_manager.editor.button_text_label')}</Label>\n                            <Input\n                                value={localConfig.text || ''}\n                                onChange={e => updateField('text', e.target.value)}\n                            />\n                        </div>\n                        <div className=\"grid gap-2\">\n                            <Label>{t('widgets_manager.editor.url_label')}</Label>\n                            <Input\n                                value={localConfig.url || '#'}\n                                onChange={e => updateField('url', e.target.value)}\n                            />\n                        </div>\n                    </div>\n                );\n            case 'core/menu':\n                return (\n                    <div className=\"space-y-4\">\n                        <div className=\"grid gap-2\">\n                            <Label>{t('widgets_manager.editor.menu_id_label')}</Label>\n                            <Input\n                                value={localConfig.menuId || ''}\n                                onChange={e => updateField('menuId', e.target.value)}\n                                placeholder={t('widgets_manager.editor.placeholder_uuid')}\n                            />\n                            <p className=\"text-xs text-muted-foreground\">{t('widgets_manager.editor.menu_help')}</p>\n                        </div>\n                    </div>\n                );\n            default:\n                return (\n                    <div className=\"space-y-4\">\n                        <div className=\"p-4 bg-yellow-50 text-yellow-800 rounded text-sm\">\n                            {t('widgets_manager.editor.generic_notice')}\n                        </div>\n                        <div className=\"grid gap-2\">\n                            <Label>{t('widgets_manager.editor.config_json_label')}</Label>\n                            <Textarea\n                                value={JSON.stringify(localConfig, null, 2)}\n                                onChange={e => {\n                                    try {\n                                        setLocalConfig(JSON.parse(e.target.value));\n                                    } catch (err) {\n                                        // ignore parse error while typing\n                                    }\n                                }}\n                                rows={10}\n                                className=\"font-mono text-xs\"\n                            />\n                        </div>\n                    </div>\n                );\n        }\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"border-b pb-4 mb-4\">\n                <h3 className=\"font-medium text-lg\">\n                    {t('widgets_manager.editor.edit_prefix')} {CORE_WIDGETS.find(w => w.type === type)?.name || type}\n                </h3>\n            </div>\n\n            {renderFields()}\n\n            <div className=\"flex justify-end gap-2 pt-4 border-t mt-4\">\n                <Button variant=\"outline\" onClick={onCancel}>{t('common.cancel')}</Button>\n                <Button onClick={() => onSave(localConfig)}>{t('widgets_manager.editor.save_button')}</Button>\n            </div>\n        </div>\n    );\n};\n\nexport default WidgetEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/dashboard/widgets/WidgetsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":152,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":152,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"index"},"fix":{"range":[6951,6958],"text":""},"desc":"Remove unused variable 'index'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Layers, Plus, Settings, Trash2, GripVertical, ShieldAlert } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport {\n    Dialog,\n    DialogContent,\n    DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { useTemplates } from '@/hooks/useTemplates';\nimport { useWidgets } from '@/hooks/useWidgets';\nimport { getWidgets as getRegistryWidgets } from '@/lib/widgetRegistry';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport WidgetEditor from './WidgetEditor';\n\nconst WidgetsManager = () => {\n    const { templateParts } = useTemplates();\n    const { t } = useTranslation();\n    const { hasPermission, isPlatformAdmin } = usePermissions();\n\n    // Filter only widget areas\n    const widgetAreas = templateParts.filter(p => p.type === 'widget_area');\n\n    const [selectedAreaId, setSelectedAreaId] = useState(null);\n\n    // Initial load: select first area if available and none selected\n    React.useEffect(() => {\n        if (!selectedAreaId && widgetAreas.length > 0) {\n            setSelectedAreaId(widgetAreas[0].id);\n        }\n    }, [widgetAreas, selectedAreaId]);\n\n    if (!hasPermission('tenant.widgets.read')) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-white rounded-xl border border-slate-200 p-12 text-center\">\n                <div className=\"p-4 bg-red-50 rounded-full mb-4\">\n                    <ShieldAlert className=\"w-12 h-12 text-red-500\" />\n                </div>\n                <h3 className=\"text-xl font-bold text-slate-800\">{t('common.access_denied')}</h3>\n                <p className=\"text-slate-500 mt-2\">{t('widgets_manager.access_denied_desc')}</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"p-6 space-y-8\">\n            <div>\n                <h1 className=\"text-3xl font-bold text-slate-900 flex items-center gap-2\">\n                    <Layers className=\"w-8 h-8 text-indigo-600\" /> {t('widgets_manager.title')}\n                </h1>\n                <p className=\"text-slate-500 mt-1\">{t('widgets_manager.subtitle')}</p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n                {/* Sidebar: Area Selector */}\n                <div className=\"md:col-span-1 space-y-4\">\n                    <h3 className=\"font-semibold text-slate-900\">{t('widgets_manager.areas_title')}</h3>\n                    {widgetAreas.length === 0 ? (\n                        <p className=\"text-sm text-slate-500\">{t('widgets_manager.no_areas')}</p>\n                    ) : (\n                        <div className=\"space-y-1\">\n                            {widgetAreas.map(area => (\n                                <button\n                                    key={area.id}\n                                    onClick={() => setSelectedAreaId(area.id)}\n                                    className={`w-full text-left px-4 py-2 rounded-md text-sm font-medium transition-colors ${selectedAreaId === area.id\n                                        ? 'bg-indigo-50 text-indigo-700'\n                                        : 'text-slate-600 hover:bg-slate-50'\n                                        }`}\n                                >\n                                    {area.name}\n                                </button>\n                            ))}\n                        </div>\n                    )}\n                </div>\n\n                {/* Main: Widgets List */}\n                <div className=\"md:col-span-3\">\n                    {selectedAreaId ? (\n                        <AreaEditor areaId={selectedAreaId} areaName={widgetAreas.find(a => a.id === selectedAreaId)?.name} isPlatformAdmin={isPlatformAdmin} />\n                    ) : (\n                        <div className=\"h-64 flex items-center justify-center border-2 border-dashed rounded-lg bg-slate-50 text-slate-400\">\n                            {t('widgets_manager.select_area_prompt')}\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst AreaEditor = ({ areaId, areaName, isPlatformAdmin }) => {\n    const { t } = useTranslation();\n    const { widgets, loading, addWidget, updateWidget, deleteWidget } = useWidgets(areaId);\n    const availableWidgets = getRegistryWidgets();\n    const [editingWidget, setEditingWidget] = useState(null);\n    const [isAddOpen, setIsAddOpen] = useState(false);\n\n    const handleAdd = async (type) => {\n        const widgetDef = availableWidgets.find(w => w.type === type);\n        await addWidget(type, widgetDef?.defaultConfig || {});\n        setIsAddOpen(false);\n    };\n\n    const handleSaveEdit = async (config) => {\n        if (editingWidget) {\n            await updateWidget(editingWidget.id, { config });\n            setEditingWidget(null);\n        }\n    };\n\n    if (loading) return <div>{t('common.loading')}</div>;\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center border-b pb-4\">\n                <h2 className=\"text-xl font-semibold\">{areaName}</h2>\n\n                <Dialog open={isAddOpen} onOpenChange={setIsAddOpen}>\n                    <DialogTrigger asChild>\n                        <Button>\n                            <Plus className=\"w-4 h-4 mr-2\" /> {t('widgets_manager.add_button')}\n                        </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                        <div className=\"grid gap-4 py-4\">\n                            <h3 className=\"font-semibold mb-2\">{t('widgets_manager.select_type_title')}</h3>\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                {availableWidgets.map(w => (\n                                    <button\n                                        key={w.type}\n                                        onClick={() => handleAdd(w.type)}\n                                        className=\"flex flex-col items-center justify-center p-4 border rounded-lg hover:bg-slate-50 hover:border-indigo-200 transition-all\"\n                                    >\n                                        <w.icon className=\"w-8 h-8 text-slate-500 mb-2\" />\n                                        <span className=\"text-sm font-medium\">{w.name}</span>\n                                    </button>\n                                ))}\n                            </div>\n                        </div>\n                    </DialogContent>\n                </Dialog>\n            </div>\n\n            <div className=\"space-y-4\">\n                {widgets.length === 0 ? (\n                    <div className=\"py-12 text-center text-slate-500 bg-slate-50 rounded-lg\">\n                        {t('widgets_manager.empty_area')}\n                    </div>\n                ) : (\n                    widgets.map((widget, index) => {\n                        const def = availableWidgets.find(w => w.type === widget.type);\n                        const Icon = def?.icon || Settings;\n\n                        return (\n                            <div key={widget.id} className=\"bg-white border rounded-lg p-4 shadow-sm flex items-center justify-between group\">\n                                <div className=\"flex items-center gap-4\">\n                                    <div className=\"cursor-move text-slate-300 hover:text-slate-500\">\n                                        <GripVertical className=\"w-5 h-5\" />\n                                    </div>\n                                    <div className=\"p-2 bg-slate-100 rounded\">\n                                        <Icon className=\"w-5 h-5 text-slate-600\" />\n                                    </div>\n                                    <div>\n                                        <div className=\"font-medium text-slate-900\">{def?.name || widget.type}</div>\n                                        {isPlatformAdmin && (\n                                            <span className=\"text-[10px] font-medium text-slate-600 bg-slate-100 px-1.5 py-0.5 rounded mr-2\">\n                                                {widget.tenant?.name || t('widgets_manager.unknown_tenant')}\n                                            </span>\n                                        )}\n                                        <div className=\"text-xs text-slate-500 truncate max-w-[300px]\">\n                                            {/* Preview config values */}\n                                            {Object.values(widget.config || {}).filter(v => typeof v === 'string').join(', ') || 'No content'}\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div className=\"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                    <Dialog open={editingWidget?.id === widget.id} onOpenChange={(open) => !open && setEditingWidget(null)}>\n                                        <DialogTrigger asChild>\n                                            <Button variant=\"ghost\" size=\"sm\" onClick={() => setEditingWidget(widget)}>\n                                                <Settings className=\"w-4 h-4\" />\n                                            </Button>\n                                        </DialogTrigger>\n                                        <DialogContent className=\"sm:max-w-[600px]\">\n                                            <WidgetEditor\n                                                type={widget.type}\n                                                config={widget.config}\n                                                onSave={handleSaveEdit}\n                                                onCancel={() => setEditingWidget(null)}\n                                            />\n                                        </DialogContent>\n                                    </Dialog>\n\n                                    <Button variant=\"ghost\" size=\"sm\" className=\"text-red-600 hover:text-red-700 hover:bg-red-50\" onClick={() => deleteWidget(widget.id)}>\n                                        <Trash2 className=\"w-4 h-4\" />\n                                    </Button>\n                                </div>\n                            </div>\n                        );\n                    })\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default WidgetsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/editors/SeoMetadataPanel.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":7,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[245,251],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * SeoMetadataPanel - Reusable collapsible SEO metadata editing panel.\n * \n * Provides fields for meta title, description, keywords, OG image, and canonical URL.\n * Used by both UnifiedContentEditor, PagesManager, and BlogEditor.\n */\nimport React, { useState } from 'react';\nimport { ChevronDown, ChevronUp, Globe, Share2 } from 'lucide-react';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { ImageUpload } from '@/components/ui/ImageUpload';\nimport { Switch } from '@/components/ui/switch';\nimport { Separator } from '@/components/ui/separator';\n\n/**\n * SeoMetadataPanel Component\n * \n * @param {Object} props\n * @param {Object} props.formData - Current form data with SEO fields\n * @param {Function} props.onChange - Callback when any field changes (receives partial update)\n * @param {boolean} props.defaultExpanded - Whether panel starts expanded\n */\nfunction SeoMetadataPanel({ formData, onChange, defaultExpanded = true }) {\n    const [expanded, setExpanded] = useState(defaultExpanded);\n\n    const handleChange = (field, value) => {\n        onChange({ [field]: value });\n    };\n\n    return (\n        <div className=\"space-y-4\">\n            <button\n                type=\"button\"\n                onClick={() => setExpanded(!expanded)}\n                className=\"flex items-center justify-between w-full font-semibold text-slate-800 text-sm hover:text-indigo-600 transition-colors\"\n            >\n                <span className=\"flex items-center gap-2\">\n                    <Globe className=\"w-4 h-4 text-emerald-500\" />\n                    SEO & Visibility\n                </span>\n                {expanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n            </button>\n\n            {expanded && (\n                <div className=\"space-y-6 bg-white/50 p-4 rounded-xl border border-white/60 shadow-sm animate-in slide-in-from-top-2 duration-200\">\n                    {/* Visibility Toggle */}\n                    <div className=\"flex items-center justify-between\">\n                        <div className=\"space-y-0.5\">\n                            <Label className=\"text-sm\">Publicly Visible</Label>\n                            <p className=\"text-[10px] text-slate-500\">Visible to all visitors</p>\n                        </div>\n                        <Switch\n                            checked={formData.is_public}\n                            onCheckedChange={(c) => handleChange('is_public', c)}\n                        />\n                    </div>\n\n                    <Separator className=\"bg-slate-100\" />\n\n                    {/* Meta Title */}\n                    <div className=\"space-y-2\">\n                        <Label className=\"text-xs text-slate-500\">Meta Title</Label>\n                        <Input\n                            value={formData.meta_title || ''}\n                            onChange={(e) => handleChange('meta_title', e.target.value)}\n                            className=\"h-8 text-xs\"\n                            placeholder=\"SEO Title (60 characters recommended)\"\n                            maxLength={70}\n                        />\n                        <div className=\"text-[10px] text-slate-400 text-right\">\n                            {(formData.meta_title?.length || 0)}/70\n                        </div>\n                    </div>\n\n                    {/* Meta Description */}\n                    <div className=\"space-y-2\">\n                        <Label className=\"text-xs text-slate-500\">Meta Description</Label>\n                        <Textarea\n                            value={formData.meta_description || ''}\n                            onChange={(e) => handleChange('meta_description', e.target.value)}\n                            className=\"min-h-[60px] text-xs resize-none\"\n                            placeholder=\"SEO Description (160 characters recommended)\"\n                            maxLength={200}\n                        />\n                        <div className=\"text-[10px] text-slate-400 text-right\">\n                            {(formData.meta_description?.length || 0)}/200\n                        </div>\n                    </div>\n\n                    {/* Meta Keywords */}\n                    <div className=\"space-y-2\">\n                        <Label className=\"text-xs text-slate-500\">Meta Keywords</Label>\n                        <Input\n                            value={formData.meta_keywords || ''}\n                            onChange={(e) => handleChange('meta_keywords', e.target.value)}\n                            className=\"h-8 text-xs\"\n                            placeholder=\"keyword1, keyword2, keyword3\"\n                        />\n                    </div>\n\n                    {/* Canonical URL */}\n                    <div className=\"space-y-2\">\n                        <Label className=\"text-xs text-slate-500\">Canonical URL</Label>\n                        <Input\n                            value={formData.canonical_url || ''}\n                            onChange={(e) => handleChange('canonical_url', e.target.value)}\n                            className=\"h-8 text-xs\"\n                            placeholder=\"https://example.com/canonical-page\"\n                        />\n                    </div>\n\n                    <Separator className=\"bg-slate-100\" />\n\n                    {/* Social / OG Section */}\n                    <div className=\"space-y-4\">\n                        <h5 className=\"flex items-center gap-2 font-medium text-slate-700 text-xs\">\n                            <Share2 className=\"w-3 h-3 text-sky-500\" />\n                            Social Preview\n                        </h5>\n\n                        {/* OG Image */}\n                        <div className=\"space-y-2\">\n                            <Label className=\"text-xs text-slate-500\">OG Image</Label>\n                            <ImageUpload\n                                value={formData.og_image || ''}\n                                onChange={(url) => handleChange('og_image', url)}\n                                className=\"h-24 w-full\"\n                            />\n                            <p className=\"text-[10px] text-slate-400\">Recommended: 1200x630px</p>\n                        </div>\n\n                        {/* OG Title - Falls back to meta_title */}\n                        <div className=\"space-y-2\">\n                            <Label className=\"text-xs text-slate-500\">OG Title (optional)</Label>\n                            <Input\n                                value={formData.og_title || ''}\n                                onChange={(e) => handleChange('og_title', e.target.value)}\n                                className=\"h-8 text-xs\"\n                                placeholder={formData.meta_title || 'Uses Meta Title if empty'}\n                            />\n                        </div>\n\n                        {/* OG Description - Falls back to meta_description */}\n                        <div className=\"space-y-2\">\n                            <Label className=\"text-xs text-slate-500\">OG Description (optional)</Label>\n                            <Textarea\n                                value={formData.og_description || ''}\n                                onChange={(e) => handleChange('og_description', e.target.value)}\n                                className=\"min-h-[50px] text-xs resize-none\"\n                                placeholder={formData.meta_description || 'Uses Meta Description if empty'}\n                            />\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n\nexport default SeoMetadataPanel;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/editors/UnifiedContentEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":7,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[271,277],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tableName' is assigned a value but never used.","line":73,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"tableName"},"fix":{"range":[2636,2661],"text":""},"desc":"Remove unused variable 'tableName'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * UnifiedContentEditor - A multi-mode content editor supporting Visual, RichText, and Markdown modes.\n * \n * This component serves as the core editor for both pages and blogs,\n * providing a consistent editing experience with mode switching capabilities.\n */\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { createPortal } from 'react-dom';\nimport { motion } from 'framer-motion';\nimport {\n    X, ChevronLeft, Eye, Send, Image as ImageIcon, MoreVertical,\n    Layout, FileText, Code2, Loader2\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/components/ui/use-toast';\nimport { useContent } from '@/hooks/useContent'; // Import new hook\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { ImageUpload } from '@/components/ui/ImageUpload';\nimport RichTextEditor from '@/components/ui/RichTextEditor';\nimport VisualPageBuilder from '@/components/visual-builder/VisualPageBuilder';\nimport TagInput from '@/components/ui/TagInput';\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n    Tooltip,\n    TooltipContent,\n    TooltipProvider,\n    TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n    Select, SelectContent, SelectItem, SelectTrigger, SelectValue\n} from \"@/components/ui/select\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport SeoMetadataPanel from './SeoMetadataPanel';\n\n// Editor mode types\nconst EDITOR_MODES = {\n    VISUAL: 'visual',\n    RICHTEXT: 'richtext',\n    MARKDOWN: 'markdown'\n};\n\n/**\n * UnifiedContentEditor Component\n * \n * @param {Object} props\n * @param {Object} props.content - The content object (page or blog)\n * @param {'page' | 'blog'} props.contentType - Type of content being edited\n * @param {Function} props.onClose - Callback when editor is closed\n * @param {Function} props.onSuccess - Callback on successful save\n * @param {string} props.tableName - Database table name ('pages' or 'blogs')\n * @param {string} props.permissionPrefix - Permission prefix for ABAC checks\n */\nfunction UnifiedContentEditor({\n    content,\n    contentType = 'page',\n    onClose,\n    onSuccess,\n    tableName = 'pages',\n    permissionPrefix = 'pages'\n}) {\n    const { toast } = useToast();\n    const { hasPermission } = usePermissions();\n    \n    // Use the new content hook\n    const { fetchCategories, saveContent, loading: contentLoading } = useContent(contentType);\n    \n    const [categories, setCategories] = useState([]);\n\n    // Determine initial editor mode\n    const getInitialMode = () => {\n        if (content?.editor_type === 'visual') return EDITOR_MODES.VISUAL;\n        if (content?.editor_type === 'markdown') return EDITOR_MODES.MARKDOWN;\n        return EDITOR_MODES.RICHTEXT;\n    };\n\n    const [editorMode, setEditorMode] = useState(getInitialMode());\n    const [showModeSwitch, setShowModeSwitch] = useState(false);\n    const [pendingMode, setPendingMode] = useState(null);\n    const [showMobileSettings, setShowMobileSettings] = useState(false);\n\n    // Form state\n    const [formData, setFormData] = useState({\n        title: content?.title || '',\n        slug: content?.slug || '',\n        content: content?.content || '',\n        excerpt: content?.excerpt || '',\n        featured_image: content?.featured_image || '',\n        status: content?.status || 'draft',\n        workflow_state: content?.workflow_state || 'draft',\n        is_active: content?.is_active ?? true,\n        is_public: content?.is_public ?? false,\n        editor_type: content?.editor_type || 'richtext',\n        category_id: content?.category_id || '',\n        tags: content?.tags || [],\n        // SEO fields\n        meta_title: content?.meta_title || '',\n        meta_description: content?.meta_description || '',\n        meta_keywords: content?.meta_keywords || '',\n        og_image: content?.og_image || '',\n        canonical_url: content?.canonical_url || ''\n    });\n\n    const isEditMode = !!content?.id;\n\n    // Permissions\n    const canEdit = hasPermission(`tenant.${permissionPrefix}.update`);\n    const canPublish = hasPermission(`tenant.${permissionPrefix}.publish`);\n\n    // Fetch categories on mount\n    useEffect(() => {\n        const loadCategories = async () => {\n            const cats = await fetchCategories();\n            setCategories(cats);\n        };\n        loadCategories();\n    }, [fetchCategories]);\n\n    const generateSlug = useCallback((text) => {\n        return text\n            .toLowerCase()\n            .replace(/[^a-z0-9]+/g, '-')\n            .replace(/(^-|-$)/g, '');\n    }, []);\n\n    const handleModeSwitch = (newMode) => {\n        if (newMode === editorMode) return;\n        setPendingMode(newMode);\n        setShowModeSwitch(true);\n    };\n\n    const confirmModeSwitch = () => {\n        setEditorMode(pendingMode);\n        setFormData(prev => ({ ...prev, editor_type: pendingMode }));\n        setShowModeSwitch(false);\n        setPendingMode(null);\n    };\n\n    const handleSave = async (publish = false) => {\n        // Permission checks are also handled in useContent, but we keep UI checks here for immediate feedback\n        if (!canEdit) {\n            toast({ variant: 'destructive', title: 'Permission Denied' });\n            return;\n        }\n\n        const finalStatus = publish ? 'published' : formData.status;\n\n        if (publish && !canPublish) {\n            toast({ variant: 'destructive', title: 'Publishing Restricted' });\n            return;\n        }\n\n        const dataToSave = {\n            title: formData.title,\n            slug: formData.slug || generateSlug(formData.title),\n            content: formData.content,\n            excerpt: formData.excerpt,\n            featured_image: formData.featured_image,\n            status: finalStatus,\n            workflow_state: publish ? 'published' : formData.workflow_state,\n            is_active: formData.is_active,\n            is_public: formData.is_public,\n            editor_type: editorMode,\n            category_id: formData.category_id || null,\n            // SEO\n            meta_title: formData.meta_title,\n            meta_description: formData.meta_description,\n            meta_keywords: formData.meta_keywords,\n            og_image: formData.og_image,\n            canonical_url: formData.canonical_url,\n            tags: formData.tags\n        };\n\n        const savedId = await saveContent(dataToSave, isEditMode, content?.id);\n\n        if (savedId) {\n            if (onSuccess) onSuccess();\n            if (!isEditMode) onClose();\n        }\n    };\n\n    // If visual mode, render VisualPageBuilder directly\n    if (editorMode === EDITOR_MODES.VISUAL) {\n        return createPortal(\n            <VisualPageBuilder\n                page={content}\n                onClose={onClose}\n                onSuccess={onSuccess}\n                mode={contentType}\n            />,\n            document.body\n        );\n    }\n\n    const renderEditor = () => (\n        <motion.div\n            initial={{ opacity: 0, scale: 0.98 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.98 }}\n            transition={{ duration: 0.2 }}\n            className=\"fixed inset-0 z-[100] flex flex-col bg-slate-50/50 backdrop-blur-sm\"\n        >\n            {/* Header */}\n            <div className=\"h-16 px-6 border-b border-white/60 bg-white/80 backdrop-blur-xl flex items-center justify-between shadow-sm z-50\">\n                <div className=\"flex items-center gap-4\">\n                    <Button variant=\"ghost\" onClick={onClose} className=\"hover:bg-slate-100/50 gap-2 pr-4 text-slate-600 rounded-full\">\n                        <ChevronLeft className=\"w-5 h-5\" />\n                        <span className=\"font-medium hidden sm:inline-block\">Back</span>\n                    </Button>\n                    <Separator orientation=\"vertical\" className=\"h-6\" />\n                    <div>\n                        <Input\n                            value={formData.title}\n                            onChange={(e) => setFormData(prev => ({\n                                ...prev,\n                                title: e.target.value,\n                                slug: !isEditMode ? generateSlug(e.target.value) : prev.slug\n                            }))}\n                            className=\"border-none shadow-none bg-transparent text-lg font-bold px-0 h-auto focus-visible:ring-0 placeholder:text-slate-400 min-w-[300px]\"\n                            placeholder={`Untitled ${contentType}`}\n                        />\n                        <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                            <Badge variant=\"outline\" className=\"px-1.5 py-0 rounded-sm font-normal uppercase tracking-wider text-[10px]\">\n                                {formData.status}\n                            </Badge>\n                            <span></span>\n                            <span>{formData.slug || 'slug-placeholder'}</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                    {/* Editor Mode Tabs */}\n                    <Tabs value={editorMode} className=\"hidden md:block\">\n                        <TabsList className=\"bg-slate-100 h-8\">\n                            <TabsTrigger\n                                value={EDITOR_MODES.RICHTEXT}\n                                onClick={() => handleModeSwitch(EDITOR_MODES.RICHTEXT)}\n                                className=\"text-xs h-6 px-2 data-[state=active]:bg-white\"\n                            >\n                                <FileText className=\"w-3 h-3 mr-1\" />\n                                Rich Text\n                            </TabsTrigger>\n                            <TabsTrigger\n                                value={EDITOR_MODES.MARKDOWN}\n                                onClick={() => handleModeSwitch(EDITOR_MODES.MARKDOWN)}\n                                className=\"text-xs h-6 px-2 data-[state=active]:bg-white\"\n                            >\n                                <Code2 className=\"w-3 h-3 mr-1\" />\n                                Markdown\n                            </TabsTrigger>\n                            <TabsTrigger\n                                value={EDITOR_MODES.VISUAL}\n                                onClick={() => handleModeSwitch(EDITOR_MODES.VISUAL)}\n                                className=\"text-xs h-6 px-2 data-[state=active]:bg-white\"\n                            >\n                                <Layout className=\"w-3 h-3 mr-1\" />\n                                Visual\n                            </TabsTrigger>\n                        </TabsList>\n                    </Tabs>\n\n                    <Separator orientation=\"vertical\" className=\"h-6 hidden md:block\" />\n\n                    <TooltipProvider>\n                        <Tooltip>\n                            <TooltipTrigger asChild>\n                                <Button variant=\"ghost\" size=\"icon\" className=\"text-slate-500\">\n                                    <Eye className=\"w-4 h-4\" />\n                                </Button>\n                            </TooltipTrigger>\n                            <TooltipContent>Preview</TooltipContent>\n                        </Tooltip>\n                    </TooltipProvider>\n\n                    <Button variant=\"ghost\" size=\"icon\" className=\"lg:hidden text-slate-500\" onClick={() => setShowMobileSettings(true)}>\n                        <MoreVertical className=\"w-5 h-5\" />\n                    </Button>\n\n                    <Button variant=\"ghost\" onClick={onClose} className=\"hidden sm:flex text-slate-500\">\n                        Cancel\n                    </Button>\n\n                    <Button\n                        onClick={() => handleSave(formData.status !== 'published')}\n                        className=\"bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg\"\n                        disabled={contentLoading}\n                    >\n                        {contentLoading ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : <Send className=\"w-4 h-4 mr-2\" />}\n                        {formData.status === 'published' ? 'Save' : 'Publish'}\n                    </Button>\n                </div>\n            </div>\n\n            {/* Main Content Area */}\n            <div className=\"flex-1 overflow-hidden\">\n                <div className=\"h-full flex flex-col lg:flex-row max-w-[1600px] mx-auto\">\n                    {/* Editor Area */}\n                    <ScrollArea className=\"flex-1 h-full\">\n                        <div className=\"p-8 lg:p-12 max-w-4xl mx-auto space-y-8 pb-32\">\n                            {/* Featured Image */}\n                            <div className=\"group relative rounded-2xl overflow-hidden bg-slate-100 border border-slate-200 aspect-video max-h-[300px] hover:shadow-md transition-all\">\n                                {formData.featured_image ? (\n                                    <img src={formData.featured_image} alt=\"Cover\" className=\"w-full h-full object-cover\" />\n                                ) : (\n                                    <div className=\"flex flex-col items-center justify-center h-full text-slate-400\">\n                                        <ImageIcon className=\"w-10 h-10 mb-2 opacity-50\" />\n                                        <span className=\"text-sm font-medium\">Add Cover Image</span>\n                                    </div>\n                                )}\n                                <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100\">\n                                    <ImageUpload\n                                        value={formData.featured_image}\n                                        onChange={(url) => setFormData(prev => ({ ...prev, featured_image: url }))}\n                                        className=\"h-full w-full opacity-0 absolute inset-0 cursor-pointer\"\n                                    />\n                                    <Button variant=\"secondary\" className=\"pointer-events-none\">Change Cover</Button>\n                                </div>\n                            </div>\n\n                            {/* Excerpt */}\n                            <div className=\"space-y-2\">\n                                <Label className=\"text-slate-500 uppercase tracking-widest text-[11px] font-semibold pl-1\">Excerpt</Label>\n                                <Textarea\n                                    value={formData.excerpt}\n                                    onChange={(e) => setFormData(p => ({ ...p, excerpt: e.target.value }))}\n                                    className=\"bg-transparent border-none focus-visible:ring-0 px-0 text-lg text-slate-600 resize-none min-h-[80px] placeholder:text-slate-300\"\n                                    placeholder=\"Add a short introduction...\"\n                                />\n                            </div>\n\n                            <Separator className=\"bg-slate-100\" />\n\n                            {/* Content Editor */}\n                            <div className=\"min-h-[500px]\">\n                                {editorMode === EDITOR_MODES.MARKDOWN ? (\n                                    <Textarea\n                                        value={formData.content}\n                                        onChange={(e) => setFormData(p => ({ ...p, content: e.target.value }))}\n                                        className=\"min-h-[500px] font-mono text-sm bg-slate-900 text-slate-100 rounded-lg p-4 resize-none\"\n                                        placeholder=\"# Write your content in Markdown...\"\n                                    />\n                                ) : (\n                                    <RichTextEditor\n                                        value={formData.content}\n                                        onChange={(val) => setFormData(p => ({ ...p, content: val }))}\n                                        placeholder=\"Start writing...\"\n                                        className=\"prose-lg max-w-none\"\n                                    />\n                                )}\n                            </div>\n                        </div>\n                    </ScrollArea>\n\n                    {/* Settings Sidebar */}\n                    <div className={`w-full lg:w-[380px] border-l border-white/60 bg-white/60 backdrop-blur-md h-full overflow-y-auto ${showMobileSettings ? 'fixed inset-0 z-[110] bg-white' : 'hidden lg:block'}`}>\n                        {showMobileSettings && (\n                            <div className=\"flex items-center justify-between p-4 border-b lg:hidden\">\n                                <span className=\"font-semibold\">Settings</span>\n                                <Button variant=\"ghost\" size=\"icon\" onClick={() => setShowMobileSettings(false)}>\n                                    <X className=\"w-5 h-5\" />\n                                </Button>\n                            </div>\n                        )}\n                        <div className=\"p-6 space-y-8\">\n                            {/* Category & Tags */}\n                            <div className=\"space-y-4\">\n                                <h4 className=\"font-semibold text-slate-800 text-sm\">Organization</h4>\n                                <div className=\"space-y-4 bg-white/50 p-4 rounded-xl border border-white/60 shadow-sm\">\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs text-slate-500\">Category</Label>\n                                        <Select\n                                            value={formData.category_id}\n                                            onValueChange={(val) => setFormData({ ...formData, category_id: val })}\n                                        >\n                                            <SelectTrigger className=\"w-full bg-white/80 border-slate-200\">\n                                                <SelectValue placeholder=\"Select Category...\" />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                {categories.map(cat => (\n                                                    <SelectItem key={cat.id} value={cat.id}>{cat.name}</SelectItem>\n                                                ))}\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                    <div className=\"space-y-2\">\n                                        <Label className=\"text-xs text-slate-500\">Tags</Label>\n                                        <TagInput\n                                            value={formData.tags}\n                                            onChange={(tags) => setFormData(p => ({ ...p, tags }))}\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* SEO Panel */}\n                            <SeoMetadataPanel\n                                formData={formData}\n                                onChange={(updates) => setFormData(prev => ({ ...prev, ...updates }))}\n                            />\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Mode Switch Confirmation */}\n            <AlertDialog open={showModeSwitch} onOpenChange={setShowModeSwitch}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Switch Editor Mode?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Switching modes may affect content formatting. Visual mode will open a new editor.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel onClick={() => setPendingMode(null)}>Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={confirmModeSwitch} className=\"bg-indigo-600 hover:bg-indigo-700\">\n                            Switch\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </motion.div>\n    );\n\n    return createPortal(renderEditor(), document.body);\n}\n\nexport default UnifiedContentEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/editors/index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/esp32/DeviceCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/esp32/SensorChart.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/AnnouncementCard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { motion } from 'framer-motion';\nimport { Calendar, Tag, AlertTriangle, Info, ArrowRight } from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\nimport { Link } from 'react-router-dom';\n\nconst AnnouncementCard = ({ item, index }) => {\n  const getPriorityStyles = (priority) => {\n      switch(priority) {\n          case 'urgent': return { color: 'bg-red-50 border-red-100', icon: AlertTriangle, badge: 'bg-red-100 text-red-700' };\n          case 'high': return { color: 'bg-orange-50 border-orange-100', icon: AlertTriangle, badge: 'bg-orange-100 text-orange-700' };\n          default: return { color: 'bg-blue-50 border-blue-100', icon: Info, badge: 'bg-blue-100 text-blue-700' };\n      }\n  };\n\n  const styles = getPriorityStyles(item.priority);\n  const Icon = styles.icon;\n\n  return (\n    <motion.div \n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: index * 0.1 }}\n        className={`p-6 rounded-2xl shadow-sm border hover:shadow-md transition-shadow flex gap-6 items-start ${styles.color}`}\n    >\n        <div className={`hidden md:flex flex-col items-center justify-center w-12 h-12 rounded-xl shrink-0 bg-white/60 border border-white/50`}>\n            <Icon className=\"w-6 h-6 text-slate-600\" />\n        </div>\n        \n        <div className=\"flex-1\">\n          <div className=\"flex flex-wrap gap-2 mb-2 items-center\">\n              <Badge variant=\"outline\" className={`uppercase tracking-wider ${styles.badge}`}>\n                  {item.priority}\n              </Badge>\n              \n              <span className=\"text-xs text-slate-500 flex items-center gap-1 ml-2\">\n                  <Calendar className=\"w-3 h-3\" />\n                  {new Date(item.created_at).toLocaleDateString()}\n              </span>\n              {item.categories && (\n                  <Badge variant=\"secondary\" className=\"flex items-center gap-1 bg-white/50 text-slate-600 border-slate-200\">\n                      <Tag className=\"w-3 h-3\" />\n                      {item.categories.name}\n                  </Badge>\n              )}\n          </div>\n          <h3 className=\"font-bold text-xl text-slate-900 mb-2\">\n            <Link to={`/announcements/${item.id}`} className=\"hover:underline\">\n              {item.title}\n            </Link>\n          </h3>\n          <div className=\"text-slate-700 line-clamp-3 mb-3 leading-relaxed\">{item.content}</div>\n          \n          <Link to={`/announcements/${item.id}`} className=\"text-sm font-medium text-slate-600 hover:text-blue-600 flex items-center gap-1\">\n             Read details <ArrowRight className=\"w-3 h-3\" />\n          </Link>\n        </div>\n    </motion.div>\n  );\n};\n\nexport default AnnouncementCard;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/CategoryFilter.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { cn } from '@/lib/utils';\n\nconst CategoryFilter = ({ categories, activeCategory, onSelect, vertical = false }) => {\n  if (!categories || categories.length === 0) return null;\n\n  return (\n    <div className={cn(\"flex flex-wrap gap-2\", vertical ? \"flex-col items-start\" : \"flex-row\")}>\n      <button\n        onClick={() => onSelect(null)}\n        className={cn(\n          \"px-4 py-2 rounded-full text-sm font-medium transition-colors w-full md:w-auto text-left\",\n          !activeCategory\n            ? 'bg-slate-900 text-white'\n            : 'bg-white text-slate-600 hover:bg-slate-100 border border-slate-200'\n        )}\n      >\n        All Categories\n      </button>\n      {categories.map(cat => (\n        <button\n          key={cat.id}\n          onClick={() => onSelect(cat.id)}\n          className={cn(\n            \"px-4 py-2 rounded-full text-sm font-medium transition-colors w-full md:w-auto text-left\",\n            activeCategory === cat.id\n              ? 'bg-blue-600 text-white'\n              : 'bg-white text-slate-600 hover:bg-slate-100 border border-slate-200'\n          )}\n        >\n          {cat.name}\n        </button>\n      ))}\n    </div>\n  );\n};\n\nexport default CategoryFilter;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/Checkout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/DynamicTemplate.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'context.tenant'. Either include it or remove the dependency array.","line":72,"column":8,"nodeType":"ArrayExpression","endLine":72,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [type, canViewDrafts, context.tenant.id, context.tenant]","fix":{"range":[3077,3118],"text":"[type, canViewDrafts, context.tenant.id, context.tenant]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/ProductCatalog.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/PublicFooter.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchFooterMenus'. Either include it or remove the dependency array.","line":18,"column":6,"nodeType":"ArrayExpression","endLine":18,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [fetchFooterMenus, tenant?.id]","fix":{"range":[597,609],"text":"[fetchFooterMenus, tenant?.id]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useTranslation } from 'react-i18next';\nimport { Facebook, Twitter, Instagram, Linkedin, MapPin, Phone, Mail } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\nfunction PublicFooter({ tenant }) {\n  const [menus, setMenus] = useState([]);\n  const { t, i18n } = useTranslation();\n\n  useEffect(() => {\n    if (tenant?.id) {\n      fetchFooterMenus();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [tenant?.id]);\n\n  useEffect(() => {\n    setMenus(prevMenus => [...prevMenus]);\n  }, [i18n.language]);\n\n  const getTranslatedLabel = (label) => {\n    const lowerLabel = label.toLowerCase();\n    const keyMap = {\n      'home': 'menu.home',\n      'beranda': 'menu.home',\n      'blogs': 'menu.blogs',\n      'blog': 'menu.blogs',\n      'articles': 'menu.blogs',\n      'artikel': 'menu.blogs',\n      'products': 'menu.products',\n      'produk': 'menu.products',\n      'portfolio': 'menu.portfolio',\n      'portofolio': 'menu.portfolio',\n      'contact': 'menu.contacts',\n      'kontak': 'menu.contacts',\n      'about': 'menu.about',\n      'tentang': 'menu.about',\n      'services': 'menu.services',\n      'layanan': 'menu.services'\n    };\n    if (keyMap[lowerLabel]) return t(keyMap[lowerLabel]);\n    const directKey = `menu.${lowerLabel}`;\n    if (i18n.exists(directKey)) return t(directKey);\n    return label;\n  };\n\n  const fetchFooterMenus = async () => {\n    try {\n      const { data, error } = await supabase.from('menus')\n        .select('*')\n        .eq('is_active', true)\n        .eq('is_public', true)\n        .eq('tenant_id', tenant.id) // Explicit Filter\n        .is('deleted_at', null)\n        .order('order', { ascending: true });\n\n      if (error) return;\n\n      if (data) {\n        const menuMap = {};\n        data.forEach(m => menuMap[m.id] = { ...m, children: [] });\n        const roots = [];\n        data.forEach(m => {\n          if (m.parent_id && menuMap[m.parent_id]) {\n            menuMap[m.parent_id].children.push(menuMap[m.id]);\n          } else {\n            roots.push(menuMap[m.id]);\n          }\n        });\n        roots.sort((a, b) => a.order - b.order);\n        roots.forEach(r => r.children.sort((a, b) => a.order - b.order));\n        setMenus(roots);\n      }\n    } catch (e) {\n      console.error(\"Error in footer menu fetch:\", e);\n    }\n  };\n\n  return (\n    <footer className=\"bg-muted/80 text-muted-foreground py-16 border-t border-border font-sans\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12\">\n          {/* Brand Column */}\n          <div className=\"space-y-6\">\n            <div className=\"flex items-center gap-2\">\n              <img src=\"/logo.svg\" alt=\"AWCMS\" className=\"h-8 w-auto object-contain opacity-80\" />\n              <span className=\"text-lg font-bold text-foreground\">AWCMS</span>\n            </div>\n            <p className=\"text-sm leading-relaxed opacity-80\">\n              {t('public.footer_desc')}\n            </p>\n            <div className=\"flex gap-2\">\n              <Button variant=\"ghost\" size=\"icon\" className=\"hover:bg-background rounded-full\"><Facebook className=\"w-4 h-4\" /></Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"hover:bg-background rounded-full\"><Twitter className=\"w-4 h-4\" /></Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"hover:bg-background rounded-full\"><Instagram className=\"w-4 h-4\" /></Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"hover:bg-background rounded-full\"><Linkedin className=\"w-4 h-4\" /></Button>\n            </div>\n          </div>\n\n          {/* Dynamic Footer Columns */}\n          {menus.slice(0, 2).map(menu => (\n            <div key={menu.id}>\n              <h4 className=\"font-bold text-foreground mb-6 text-lg tracking-wide\">{getTranslatedLabel(menu.label)}</h4>\n              {menu.children && menu.children.length > 0 && (\n                <ul className=\"space-y-3 text-sm\">\n                  {menu.children.map(child => (\n                    <li key={child.id}>\n                      <Link to={child.url} className=\"hover:text-primary transition-colors\">\n                        {getTranslatedLabel(child.label)}\n                      </Link>\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </div>\n          ))}\n\n          {/* Contact Info */}\n          <div>\n            <h4 className=\"font-bold text-foreground mb-6 text-lg tracking-wide\">{t('public.contact_us')}</h4>\n            <ul className=\"space-y-4 text-sm\">\n              <li className=\"flex items-start gap-3\">\n                <MapPin className=\"w-5 h-5 text-primary shrink-0 mt-0.5\" />\n                <span>123 Digital Avenue,<br />Tech City, Jakarta 10220</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <Phone className=\"w-5 h-5 text-primary shrink-0\" />\n                <span>+62895 1338 0400</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <Mail className=\"w-5 h-5 text-primary shrink-0\" />\n                <span>hello@ahliweb.com</span>\n              </li>\n            </ul>\n          </div>\n        </div>\n\n        <div className=\"pt-8 border-t border-border/50 flex flex-col md:flex-row justify-between items-center gap-4 text-xs opacity-70\">\n          <p>\n             {new Date().getFullYear()} AhliWeb. {t('public.all_rights_reserved')}\n          </p>\n          <div className=\"flex gap-6\">\n            <Link to=\"/privacy-policy\" className=\"hover:text-foreground transition-colors\">{t('public.privacy_policy')}</Link>\n            <Link to=\"/terms\" className=\"hover:text-foreground transition-colors\">{t('public.terms_of_service')}</Link>\n            <Link to=\"/sitemap\" className=\"hover:text-foreground transition-colors\">{t('public.sitemap')}</Link>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\nexport default PublicFooter;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/PublicHeader.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMenus'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [user, tenant?.id, fetchMenus]","fix":{"range":[1250,1268],"text":"[user, tenant?.id, fetchMenus]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { LogIn, Menu as MenuIcon, X, ChevronDown, LayoutDashboard } from 'lucide-react';\nimport LanguageSelector from '@/components/ui/LanguageSelector';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { Button } from '@/components/ui/button';\n\n// Pass tenant as prop from DynamicTemplate or Layout\nconst PublicHeader = ({ tenant }) => {\n  const location = useLocation();\n  const { t, i18n } = useTranslation();\n  const { user } = useAuth();\n\n  const [menus, setMenus] = useState([]);\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [scrolled, setScrolled] = useState(false);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      setScrolled(window.scrollY > 20);\n    };\n    window.addEventListener('scroll', handleScroll);\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n  useEffect(() => {\n    if (tenant?.id) {\n      fetchMenus();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user, tenant?.id]);\n\n  // Force re-render of menu items when language changes\n  useEffect(() => {\n    setMenus(prevMenus => [...prevMenus]);\n  }, [i18n.language]);\n\n  const getTranslatedLabel = (label) => {\n    // ... (keep translation logic same)\n    const lowerLabel = label.toLowerCase();\n    const keyMap = {\n      'home': 'menu.home',\n      'beranda': 'menu.home',\n      'blogs': 'menu.blogs',\n      'blog': 'menu.blogs',\n      'articles': 'menu.blogs',\n      'artikel': 'menu.blogs',\n      'products': 'menu.products',\n      'produk': 'menu.products',\n      'portfolio': 'menu.portfolio',\n      'portofolio': 'menu.portfolio',\n      'contact': 'menu.contacts',\n      'kontak': 'menu.contacts',\n      'about': 'menu.about',\n      'tentang': 'menu.about',\n      'services': 'menu.services',\n      'layanan': 'menu.services'\n    };\n\n    if (keyMap[lowerLabel]) return t(keyMap[lowerLabel]);\n    const directKey = `menu.${lowerLabel}`;\n    if (i18n.exists(directKey)) return t(directKey);\n    return label;\n  };\n\n  const fetchMenus = async () => {\n    try {\n      let roleData = { name: 'public', is_public: true };\n      let roleId = null;\n\n      if (user) {\n          const { data: userData } = await supabase\n            .from('users')\n            .select('role_id, roles(name, deleted_at, is_public, is_guest, is_platform_admin, is_full_access)')\n            .eq('id', user.id)\n            .maybeSingle();\n\n          if (userData && userData.roles && !userData.roles.deleted_at) {\n            roleData = userData.roles;\n            roleId = userData.role_id;\n          }\n        }\n\n        if (!roleId && roleData?.is_public) {\n          const { data: publicRole } = await supabase\n            .from('roles')\n            .select('id')\n            .eq('is_public', true)\n            .is('deleted_at', null)\n            .maybeSingle();\n          if (publicRole) roleId = publicRole.id;\n        }\n\n      // CRITICAL: Filter by Tenant ID\n      let query = supabase\n        .from('menus')\n        .select('*')\n        .eq('is_active', true)\n        .is('deleted_at', null)\n        .eq('tenant_id', tenant.id) // Explicit Filter\n        .order('order', { ascending: true });\n\n      const { data: allMenus } = await query;\n\n      if (!allMenus) {\n        setMenus([]);\n        return;\n      }\n\n      let allowedMenuIds = new Set();\n      if (roleId) {\n        // PERMISSIONS: Also filter permissions by tenant implicitly via roles\n        const { data: perms } = await supabase\n          .from('menu_permissions')\n          .select('menu_id')\n          .eq('role_id', roleId)\n          .eq('can_view', true);\n\n        if (perms) {\n          perms.forEach(p => allowedMenuIds.add(p.menu_id));\n        }\n      }\n\n        const visibleMenus = allMenus.filter(m => {\n        if (roleData?.is_platform_admin || roleData?.is_full_access) return true;\n        if (allowedMenuIds.has(m.id)) return true;\n        if (roleData?.is_public && m.is_public) return true;\n        return false;\n      });\n\n      const menuMap = {};\n      visibleMenus.forEach(m => menuMap[m.id] = { ...m, children: [] });\n      const rootMenus = [];\n      visibleMenus.forEach(m => {\n        if (m.parent_id && menuMap[m.parent_id]) {\n          menuMap[m.parent_id].children.push(menuMap[m.id]);\n        } else {\n          rootMenus.push(menuMap[m.id]);\n        }\n      });\n\n      rootMenus.forEach(root => root.children.sort((a, b) => a.order - b.order));\n      setMenus(rootMenus);\n\n    } catch (err) {\n      console.error(\"Menu fetch error\", err);\n    }\n  };\n\n  return (\n    <header className={`sticky top-0 z-50 transition-all duration-300 border-b ${scrolled\n      ? 'bg-background/95 backdrop-blur-md border-border shadow-sm'\n      : 'bg-background/80 backdrop-blur-sm border-transparent'\n      }`}>\n      <div className=\"container mx-auto px-4 h-20 flex items-center justify-between\">\n        <Link to=\"/\" className=\"flex items-center gap-2 group\">\n          <img\n            src=\"/logo.svg\"\n            alt=\"AWCMS\"\n            className=\"h-10 w-auto object-contain\"\n          />\n          <span className=\"text-xl font-bold text-foreground\">AWCMS</span>\n        </Link>\n\n        {/* Desktop Nav */}\n        <nav className=\"hidden lg:flex items-center gap-1\">\n          {menus.map((item) => {\n            const hasChildren = item.children && item.children.length > 0;\n            const isActive = location.pathname === item.url || item.children?.some(c => location.pathname === c.url);\n            const translatedLabel = getTranslatedLabel(item.label);\n\n            if (hasChildren) {\n              return (\n                <div key={item.id} className=\"relative group px-1\">\n                  <button className={`flex items-center gap-1 px-3 py-2 rounded-full text-sm font-medium transition-all ${isActive ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:bg-accent hover:text-accent-foreground'\n                    }`}>\n                    {translatedLabel}\n                    <ChevronDown className=\"w-3.5 h-3.5 opacity-70\" />\n                  </button>\n                  <div className=\"absolute top-full left-0 mt-2 w-48 bg-popover rounded-xl shadow-xl border border-border overflow-hidden opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all transform translate-y-2 group-hover:translate-y-0 z-50\">\n                    <div className=\"p-1\">\n                      {item.children.map(child => (\n                        <Link\n                          key={child.id}\n                          to={child.url}\n                          className=\"block px-3 py-2 text-sm text-popover-foreground hover:bg-accent hover:text-accent-foreground rounded-lg transition-colors\"\n                        >\n                          {getTranslatedLabel(child.label)}\n                        </Link>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              );\n            }\n\n            return (\n              <Link\n                key={item.id}\n                to={item.url}\n                className={`mx-1 px-3 py-2 rounded-full text-sm font-medium transition-all ${isActive\n                  ? 'bg-primary/10 text-primary'\n                  : 'text-muted-foreground hover:bg-accent hover:text-accent-foreground'\n                  }`}\n              >\n                {translatedLabel}\n              </Link>\n            );\n          })}\n        </nav>\n\n        <div className=\"flex items-center gap-3\">\n          <LanguageSelector />\n\n          {user ? (\n            <Link to=\"/cmspanel\">\n              <Button className=\"hidden sm:inline-flex rounded-full gap-2\">\n                <LayoutDashboard className=\"w-4 h-4\" />\n                <span className=\"hidden md:inline\">{t('menu.dashboard')}</span>\n              </Button>\n            </Link>\n          ) : (\n            <Link to=\"/cmspanel/login\">\n              <Button variant=\"outline\" className=\"hidden sm:inline-flex rounded-full gap-2\">\n                <LogIn className=\"w-4 h-4\" />\n                <span className=\"hidden md:inline\">{t('auth.login')}</span>\n              </Button>\n            </Link>\n          )}\n\n          <button\n            className=\"lg:hidden p-2 text-foreground hover:bg-accent rounded-full transition-colors\"\n            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n          >\n            {mobileMenuOpen ? <X className=\"w-6 h-6\" /> : <MenuIcon className=\"w-6 h-6\" />}\n          </button>\n        </div>\n      </div>\n\n      {/* Mobile Menu */}\n      <AnimatePresence>\n        {mobileMenuOpen && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"lg:hidden bg-background border-b border-border px-4 py-4 overflow-hidden\"\n          >\n            <nav className=\"flex flex-col space-y-2\">\n              {menus.map(item => (\n                <div key={item.id}>\n                  <Link\n                    to={item.url}\n                    className={`block py-2 px-2 rounded-lg text-base font-medium ${location.pathname === item.url\n                      ? 'bg-primary/10 text-primary'\n                      : 'text-foreground hover:bg-accent'\n                      }`}\n                    onClick={() => setMobileMenuOpen(false)}\n                  >\n                    {getTranslatedLabel(item.label)}\n                  </Link>\n                  {item.children && item.children.length > 0 && (\n                    <div className=\"pl-4 space-y-1 mt-1 border-l-2 border-border ml-2\">\n                      {item.children.map(child => (\n                        <Link\n                          key={child.id}\n                          to={child.url}\n                          className=\"block py-2 px-2 rounded-lg text-sm text-muted-foreground hover:bg-accent hover:text-primary\"\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          {getTranslatedLabel(child.label)}\n                        </Link>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              ))}\n              <div className=\"pt-4 mt-4 border-t border-border\">\n                <Link\n                  to={user ? \"/cmspanel\" : \"/cmspanel/login\"}\n                  onClick={() => setMobileMenuOpen(false)}\n                >\n                  <Button className=\"w-full gap-2\">\n                    {user ? <LayoutDashboard className=\"w-4 h-4\" /> : <LogIn className=\"w-4 h-4\" />}\n                    {user ? t('menu.dashboard') : t('auth.login')}\n                  </Button>\n                </Link>\n              </div>\n            </nav>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </header>\n  );\n}\n\nexport default PublicHeader;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/PublicLayout.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { Outlet } from 'react-router-dom';\nimport PublicHeader from './PublicHeader';\nimport PublicFooter from './PublicFooter';\n\nimport DynamicTemplate from './DynamicTemplate';\n\nimport { usePublicTenant } from '@/hooks/usePublicTenant';\n\nfunction PublicLayout() {\n  const { tenant } = usePublicTenant();\n\n  // Optionally show loader while resolving tenant\n  // if (loading) return <div className=\"h-screen flex items-center justify-center\">Loading site...</div>;\n\n  return (\n    <div className=\"flex flex-col min-h-screen bg-white\">\n      <DynamicTemplate type=\"header\" fallback={PublicHeader} context={{ tenant }} />\n      <main className=\"flex-1\">\n        <Outlet context={{ tenant }} />\n      </main>\n      <DynamicTemplate type=\"footer\" fallback={PublicFooter} context={{ tenant }} />\n    </div>\n  );\n}\n\nexport default PublicLayout;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/PublicPageResolver.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport PublicPageDetail from '@/pages/public/PublicPageDetail';\nimport PublicBlogDetail from '@/pages/public/PublicBlogDetail';\nimport PublicProductDetail from '@/pages/public/PublicProductDetail';\nimport PublicPortfolioDetail from '@/pages/public/PublicPortfolioDetail';\nimport PublicPromotionDetail from '@/pages/public/PublicPromotionDetail';\nimport { FileQuestion, Loader2 } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { Button } from '@/components/ui/button';\nimport { usePermissions } from '@/contexts/PermissionContext';\n\nconst PublicPageResolver = () => {\n    const { slug } = useParams();\n    const [contentType, setContentType] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const { hasAnyPermission, isPlatformAdmin, isFullAccess } = usePermissions();\n\n    // Check if user has permission to view drafts\n    // We check a broad set of permissions to cover admins, editors, etc.\n    const canViewDrafts = isPlatformAdmin || isFullAccess || hasAnyPermission([\n        'edit_pages', 'edit_visual_pages', 'manage_pages',\n        'edit_blogs', 'manage_blogs'\n    ]);\n\n    useEffect(() => {\n        const resolveSlug = async () => {\n            setLoading(true);\n            try {\n                const statusFilter = canViewDrafts ? ['published', 'draft'] : ['published'];\n\n                // Priority 1: Pages (Most likely for root slugs)\n                const { data: page } = await supabase\n                    .from('pages')\n                    .select('id, status')\n                    .eq('slug', slug)\n                    .in('status', statusFilter)\n                    .maybeSingle();\n\n                if (page) {\n                    setContentType('page');\n                    return;\n                }\n\n                // Priority 2: Blogs\n                const { data: blog } = await supabase\n                    .from('blogs')\n                    .select('id, status')\n                    .eq('slug', slug)\n                    .in('status', statusFilter)\n                    .maybeSingle();\n\n                if (blog) {\n                    setContentType('blog');\n                    return;\n                }\n\n                // Priority 3: Products\n                const { data: product } = await supabase\n                    .from('products')\n                    .select('id, status')\n                    .eq('slug', slug)\n                    .in('status', statusFilter)\n                    .maybeSingle();\n\n                if (product) {\n                    setContentType('product');\n                    return;\n                }\n\n                // Priority 4: Portfolio\n                const { data: portfolio } = await supabase\n                    .from('portfolio')\n                    .select('id, status')\n                    .eq('slug', slug)\n                    .in('status', statusFilter)\n                    .maybeSingle();\n\n                if (portfolio) {\n                    setContentType('portfolio');\n                    return;\n                }\n\n                // Priority 5: Promotions\n                // Promotions usually use 'active' vs 'inactive', but we'll check if they support 'draft' too\n                // For now, assuming permissions allows seeing everything if needed, but keeping simple\n                const promotionStatus = canViewDrafts ? ['active', 'draft', 'inactive'] : ['active'];\n                const { data: promotion } = await supabase\n                    .from('promotions')\n                    .select('id, status')\n                    .eq('slug', slug)\n                    .in('status', promotionStatus)\n                    .maybeSingle();\n\n                if (promotion) {\n                    setContentType('promotion');\n                    return;\n                }\n\n                setContentType('not_found');\n\n            } catch (error) {\n                console.error('Error resolving slug:', error);\n                setContentType('error');\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        if (slug) {\n            resolveSlug();\n        }\n    }, [slug, canViewDrafts]);\n\n    if (loading) {\n        return (\n            <div className=\"min-h-screen flex items-center justify-center bg-white\">\n                <Loader2 className=\"w-8 h-8 text-blue-600 animate-spin\" />\n            </div>\n        );\n    }\n\n    switch (contentType) {\n        case 'page':\n            return <PublicPageDetail />;\n        case 'blog':\n            return <PublicBlogDetail />;\n        case 'product':\n            return <PublicProductDetail />;\n        case 'portfolio':\n            return <PublicPortfolioDetail />;\n        case 'promotion':\n            return <PublicPromotionDetail />;\n        case 'not_found':\n        default:\n            return (\n                <div className=\"min-h-screen flex flex-col items-center justify-center bg-slate-50 px-4 text-center\">\n                    <SeoHelmet title=\"Page Not Found\" />\n                    <div className=\"bg-white p-12 rounded-3xl shadow-xl border border-slate-100 max-w-lg\">\n                        <div className=\"w-20 h-20 bg-amber-50 text-amber-500 rounded-full flex items-center justify-center mx-auto mb-6\">\n                            <FileQuestion className=\"w-10 h-10\" />\n                        </div>\n                        <h2 className=\"text-3xl font-bold text-slate-900 mb-3\">Page Not Found</h2>\n                        <p className=\"text-slate-600 mb-8 text-lg\">\n                            We couldn&apos;t find any content matching this URL.<br />It might have been moved or doesn&apos;t exist.\n                        </p>\n                        <div className=\"flex justify-center\">\n                            <Button asChild className=\"bg-blue-600 hover:bg-blue-700\">\n                                <a href=\"/\">Go Home</a>\n                            </Button>\n                        </div>\n                    </div>\n                </div>\n            );\n    }\n};\n\nexport default PublicPageResolver;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/SeoHelmet.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { Helmet } from 'react-helmet-async';\n\n// Component to handle secure headers and SEO metadata for public pages\nfunction SeoHelmet({ \n    title, \n    description, \n    keywords, \n    image, \n    url, \n    type = 'website' \n}) {\n  const siteTitle = 'AWCMS';\n  const fullTitle = title ? `${title} | ${siteTitle}` : siteTitle;\n  const metaDescription = description || 'A secure, extensible content management system.';\n  \n  return (\n    <Helmet>\n      {/* Basic Metadata */}\n      <title>{fullTitle}</title>\n      <meta name=\"description\" content={metaDescription} />\n      {keywords && <meta name=\"keywords\" content={keywords} />}\n      \n      {/* Open Graph / Facebook */}\n      <meta property=\"og:type\" content={type} />\n      <meta property=\"og:title\" content={fullTitle} />\n      <meta property=\"og:description\" content={metaDescription} />\n      {image && <meta property=\"og:image\" content={image} />}\n      {url && <meta property=\"og:url\" content={url} />}\n      \n      {/* Twitter */}\n      <meta name=\"twitter:card\" content=\"summary_large_image\" />\n      <meta name=\"twitter:title\" content={fullTitle} />\n      <meta name=\"twitter:description\" content={metaDescription} />\n      {image && <meta name=\"twitter:image\" content={image} />}\n\n      {/* Security Headers (Simulated via Meta tags where possible, real enforcement needs Server/Edge config) */}\n      <meta httpEquiv=\"X-Content-Type-Options\" content=\"nosniff\" />\n      <meta httpEquiv=\"X-Frame-Options\" content=\"SAMEORIGIN\" />\n      <meta httpEquiv=\"X-XSS-Protection\" content=\"1; mode=block\" />\n      <meta httpEquiv=\"Referrer-Policy\" content=\"strict-origin-when-cross-origin\" />\n      \n      {/* Content Security Policy - Basic strict policy */}\n      {/* Note: This is a strict policy, might need adjustment for external images/scripts */}\n      {/* <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'self' https://*.supabase.co; img-src 'self' https: data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';\" /> */}\n    </Helmet>\n  );\n}\n\nexport default SeoHelmet;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/ShareButtons.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { Facebook, Twitter, Linkedin, Link as LinkIcon, Mail } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/components/ui/use-toast';\n\nconst ShareButtons = ({ url, title, description }) => {\n  const { toast } = useToast();\n  const encodedUrl = encodeURIComponent(url);\n  const encodedTitle = encodeURIComponent(title);\n  const encodedDesc = encodeURIComponent(description || '');\n\n  const handleCopyLink = () => {\n    navigator.clipboard.writeText(url);\n    toast({ title: \"Link copied\", description: \"Page URL copied to clipboard.\" });\n  };\n\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        className=\"rounded-full hover:text-blue-600 hover:bg-blue-50 border-slate-200\"\n        onClick={() => window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`, '_blank')}\n        title=\"Share on Facebook\"\n      >\n        <Facebook className=\"w-4 h-4\" />\n      </Button>\n\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        className=\"rounded-full hover:text-sky-500 hover:bg-sky-50 border-slate-200\"\n        onClick={() => window.open(`https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}`, '_blank')}\n        title=\"Share on Twitter\"\n      >\n        <Twitter className=\"w-4 h-4\" />\n      </Button>\n\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        className=\"rounded-full hover:text-blue-700 hover:bg-blue-50 border-slate-200\"\n        onClick={() => window.open(`https://www.linkedin.com/shareArticle?mini=true&url=${encodedUrl}&title=${encodedTitle}&summary=${encodedDesc}`, '_blank')}\n        title=\"Share on LinkedIn\"\n      >\n        <Linkedin className=\"w-4 h-4\" />\n      </Button>\n\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        className=\"rounded-full hover:text-slate-800 hover:bg-slate-100 border-slate-200\"\n        onClick={() => window.open(`mailto:?subject=${encodedTitle}&body=Check out this page: ${encodedUrl}`, '_blank')}\n        title=\"Share via Email\"\n      >\n        <Mail className=\"w-4 h-4\" />\n      </Button>\n\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        className=\"rounded-full hover:text-slate-800 hover:bg-slate-100 border-slate-200\"\n        onClick={handleCopyLink}\n        title=\"Copy Link\"\n      >\n        <LinkIcon className=\"w-4 h-4\" />\n      </Button>\n    </div>\n  );\n};\n\nexport default ShareButtons;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/ShoppingCart.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[64,75],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Shopping Cart - Display and manage cart items\n */\nimport React from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { ShoppingCart, Trash2, Plus, Minus, ArrowLeft, CreditCard, Loader2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useCart } from '@/contexts/CartContext';\nimport { useToast } from '@/components/ui/use-toast';\n\nfunction ShoppingCartPage() {\n    const navigate = useNavigate();\n    const { toast } = useToast();\n    const { items, loading, subtotal, updateItemQuantity, removeItem, clearCart } = useCart();\n\n    const formatPrice = (price) => {\n        return new Intl.NumberFormat('id-ID', {\n            style: 'currency',\n            currency: 'IDR',\n            maximumFractionDigits: 0\n        }).format(price);\n    };\n\n    const handleQuantityChange = async (itemId, newQuantity) => {\n        if (newQuantity < 1) return;\n        await updateItemQuantity(itemId, newQuantity);\n    };\n\n    const handleRemove = async (itemId, productName) => {\n        const success = await removeItem(itemId);\n        if (success) {\n            toast({\n                title: 'Removed',\n                description: `${productName} has been removed from your cart.`\n            });\n        }\n    };\n\n    const handleClearCart = async () => {\n        if (window.confirm('Are you sure you want to clear your cart?')) {\n            await clearCart();\n            toast({\n                title: 'Cart Cleared',\n                description: 'All items have been removed from your cart.'\n            });\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center min-h-[400px]\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-blue-600\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between mb-8\">\n                <div className=\"flex items-center gap-4\">\n                    <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(-1)}>\n                        <ArrowLeft className=\"w-5 h-5\" />\n                    </Button>\n                    <div>\n                        <h1 className=\"text-2xl font-bold text-slate-900\">Shopping Cart</h1>\n                        <p className=\"text-slate-600\">{items.length} item(s)</p>\n                    </div>\n                </div>\n\n                {items.length > 0 && (\n                    <Button variant=\"outline\" onClick={handleClearCart} className=\"text-red-600 hover:text-red-700\">\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        Clear Cart\n                    </Button>\n                )}\n            </div>\n\n            {items.length === 0 ? (\n                <div className=\"text-center py-16 bg-slate-50 rounded-xl\">\n                    <ShoppingCart className=\"w-16 h-16 mx-auto text-slate-300 mb-4\" />\n                    <h3 className=\"text-xl font-medium text-slate-900 mb-2\">Your cart is empty</h3>\n                    <p className=\"text-slate-500 mb-6\">Start shopping to add items to your cart.</p>\n                    <Link to=\"/products\">\n                        <Button>Browse Products</Button>\n                    </Link>\n                </div>\n            ) : (\n                <div className=\"grid gap-6 lg:grid-cols-3\">\n                    {/* Cart Items */}\n                    <div className=\"lg:col-span-2 space-y-4\">\n                        {items.map(item => (\n                            <div key={item.id} className=\"bg-white rounded-xl border p-4 flex gap-4\">\n                                {/* Product Image */}\n                                <div className=\"w-24 h-24 flex-shrink-0 bg-slate-100 rounded-lg overflow-hidden\">\n                                    {item.product?.featured_image ? (\n                                        <img\n                                            src={item.product.featured_image}\n                                            alt={item.product.name}\n                                            className=\"w-full h-full object-cover\"\n                                        />\n                                    ) : (\n                                        <div className=\"w-full h-full flex items-center justify-center\">\n                                            <ShoppingCart className=\"w-8 h-8 text-slate-300\" />\n                                        </div>\n                                    )}\n                                </div>\n\n                                {/* Product Info */}\n                                <div className=\"flex-1 min-w-0\">\n                                    <Link to={`/products/${item.product?.slug}`}>\n                                        <h3 className=\"font-semibold text-slate-900 hover:text-blue-600 transition-colors truncate\">\n                                            {item.product?.name}\n                                        </h3>\n                                    </Link>\n\n                                    <div className=\"mt-1 text-lg font-bold text-slate-900\">\n                                        {formatPrice(item.price_snapshot)}\n                                    </div>\n\n                                    {/* Quantity Controls */}\n                                    <div className=\"mt-3 flex items-center gap-3\">\n                                        <div className=\"flex items-center border rounded-lg\">\n                                            <Button\n                                                variant=\"ghost\"\n                                                size=\"icon\"\n                                                className=\"h-8 w-8\"\n                                                onClick={() => handleQuantityChange(item.id, item.quantity - 1)}\n                                                disabled={item.quantity <= 1}\n                                            >\n                                                <Minus className=\"w-4 h-4\" />\n                                            </Button>\n                                            <Input\n                                                type=\"number\"\n                                                value={item.quantity}\n                                                onChange={(e) => handleQuantityChange(item.id, parseInt(e.target.value) || 1)}\n                                                className=\"w-16 h-8 text-center border-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                                                min=\"1\"\n                                            />\n                                            <Button\n                                                variant=\"ghost\"\n                                                size=\"icon\"\n                                                className=\"h-8 w-8\"\n                                                onClick={() => handleQuantityChange(item.id, item.quantity + 1)}\n                                                disabled={item.product?.stock && item.quantity >= item.product.stock}\n                                            >\n                                                <Plus className=\"w-4 h-4\" />\n                                            </Button>\n                                        </div>\n\n                                        <Button\n                                            variant=\"ghost\"\n                                            size=\"sm\"\n                                            className=\"text-red-500 hover:text-red-600 hover:bg-red-50\"\n                                            onClick={() => handleRemove(item.id, item.product?.name)}\n                                        >\n                                            <Trash2 className=\"w-4 h-4\" />\n                                        </Button>\n                                    </div>\n                                </div>\n\n                                {/* Item Total */}\n                                <div className=\"text-right\">\n                                    <span className=\"text-sm text-slate-500\">Total</span>\n                                    <div className=\"font-bold text-slate-900\">\n                                        {formatPrice(item.price_snapshot * item.quantity)}\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n\n                    {/* Order Summary */}\n                    <div className=\"lg:col-span-1\">\n                        <div className=\"bg-white rounded-xl border p-6 sticky top-24\">\n                            <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">Order Summary</h3>\n\n                            <div className=\"space-y-3 text-sm\">\n                                <div className=\"flex justify-between\">\n                                    <span className=\"text-slate-600\">Subtotal</span>\n                                    <span className=\"font-medium\">{formatPrice(subtotal)}</span>\n                                </div>\n                                <div className=\"flex justify-between\">\n                                    <span className=\"text-slate-600\">Shipping</span>\n                                    <span className=\"text-slate-500 italic\">Calculated at checkout</span>\n                                </div>\n                            </div>\n\n                            <div className=\"border-t my-4 pt-4\">\n                                <div className=\"flex justify-between text-lg font-bold\">\n                                    <span>Total</span>\n                                    <span className=\"text-green-600\">{formatPrice(subtotal)}</span>\n                                </div>\n                            </div>\n\n                            <Link to=\"/checkout\">\n                                <Button className=\"w-full mt-4\" size=\"lg\">\n                                    <CreditCard className=\"w-5 h-5 mr-2\" />\n                                    Proceed to Checkout\n                                </Button>\n                            </Link>\n\n                            <Link to=\"/products\" className=\"block mt-3\">\n                                <Button variant=\"outline\" className=\"w-full\">\n                                    Continue Shopping\n                                </Button>\n                            </Link>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n\nexport default ShoppingCartPage;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/TableOfContents.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  24 |     });\n  25 |\n> 26 |     setHeadings(items);\n     |     ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  27 |   }, [content]);\n  28 |\n  29 |   if (headings.length === 0) return null;","line":26,"column":5,"nodeType":null,"endLine":26,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { cn } from '@/lib/utils';\n\nconst TableOfContents = ({ content }) => {\n  const [headings, setHeadings] = useState([]);\n  const [activeId, setActiveId] = useState('');\n\n  useEffect(() => {\n    // Parse content HTML string to find headings\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(content, 'text/html');\n    const elements = doc.querySelectorAll('h2, h3');\n    \n    const items = Array.from(elements).map((element, index) => {\n      const id = element.id || `heading-${index}`;\n      // Note: In a real implementation, we'd need to inject these IDs back into the rendered content \n      // or ensure the RichTextEditor adds IDs. For now, we simulate extraction.\n      return {\n        id,\n        text: element.textContent,\n        level: Number(element.tagName.substring(1))\n      };\n    });\n\n    setHeadings(items);\n  }, [content]);\n\n  if (headings.length === 0) return null;\n\n  const handleClick = (e, id) => {\n    e.preventDefault();\n    // This assumes the rendered content has matching IDs. \n    // Since basic RichText usually doesn't add IDs automatically, \n    // this is a \"best effort\" scroll or would require modifying the content renderer.\n    // For this implementation, we will try to find by text content if ID fails.\n    const element = document.getElementById(id);\n    if (element) {\n      element.scrollIntoView({ behavior: 'smooth' });\n      setActiveId(id);\n    } else {\n        // Fallback: finding element containing text\n        const found = Array.from(document.querySelectorAll('h2, h3'))\n            .find(el => el.textContent === headings.find(h => h.id === id)?.text);\n        if (found) {\n            found.scrollIntoView({ behavior: 'smooth' });\n        }\n    }\n  };\n\n  return (\n    <div className=\"bg-slate-50/50 rounded-xl p-5 border border-slate-200\">\n      <h4 className=\"font-semibold text-slate-900 mb-4 text-sm uppercase tracking-wider\">Table of Contents</h4>\n      <nav className=\"space-y-1\">\n        {headings.map((heading) => (\n          <a\n            key={heading.id}\n            href={`#${heading.id}`}\n            onClick={(e) => handleClick(e, heading.id)}\n            className={cn(\n              \"block text-sm transition-colors py-1 hover:text-blue-600\",\n              heading.level === 3 ? \"pl-4 text-slate-500\" : \"text-slate-700 font-medium\",\n              activeId === heading.id && \"text-blue-600\"\n            )}\n          >\n            {heading.text}\n          </a>\n        ))}\n      </nav>\n    </div>\n  );\n};\n\nexport default TableOfContents;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/TagList.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Tag } from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\n\nconst TagList = ({ selectedTags = [], onSelectTag }) => {\n  const [tags, setTags] = useState([]);\n\n  useEffect(() => {\n    const fetchTags = async () => {\n      // Safely attempt to fetch tags with counts via RPC, fallback to simple select if RPC fails/missing\n      try {\n        const { data, error } = await supabase.rpc('get_tags_with_counts');\n        if (!error && data) {\n          const activeTags = data\n            .filter(t => t.total_usage > 0 && t.is_active !== false)\n            .sort((a, b) => b.total_usage - a.total_usage)\n            .slice(0, 20);\n          setTags(activeTags);\n        } else {\n          // Fallback if RPC is missing or errors\n          const { data: simpleTags, error: fallbackError } = await supabase\n            .from('tags')\n            .select('id, name, slug, color')\n            .is('deleted_at', null)\n            .eq('is_active', true)\n            .limit(20);\n          if (fallbackError) {\n            console.error(\"Fallback tag fetch error:\", fallbackError);\n            return;\n          }\n          if (simpleTags) setTags(simpleTags.map(t => ({ ...t, total_usage: 0 })));\n        }\n      } catch (e) {\n        console.error(\"Error fetching tags\", e);\n      }\n    };\n    fetchTags();\n  }, []);\n\n  if (tags.length === 0) return null;\n\n  return (\n    <div className=\"mb-8 p-6 bg-white rounded-2xl shadow-sm border border-slate-200\">\n      <h3 className=\"font-bold text-slate-900 mb-4 flex items-center gap-2\">\n        <Tag className=\"w-4 h-4\" /> Popular Tags\n      </h3>\n      <div className=\"flex flex-wrap gap-2\">\n        {tags.map((tag) => (\n          <Badge\n            key={tag.id}\n            variant={selectedTags.includes(tag.name) ? \"default\" : \"secondary\"}\n            className={`cursor-pointer transition-all hover:scale-105 ${selectedTags.includes(tag.name)\n                ? \"bg-blue-600 hover:bg-blue-700\"\n                : \"bg-slate-100 text-slate-600 hover:bg-slate-200\"\n              }`}\n            onClick={() => onSelectTag(tag.name)}\n          >\n            {tag.name}\n            {tag.total_usage > 0 && <span className=\"ml-1.5 opacity-60 text-[10px]\">({tag.total_usage})</span>}\n          </Badge>\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default TagList;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/WidgetAreaRenderer.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { sanitizeHTML } from '@/utils/sanitize';\nimport { useWidgets } from '@/hooks/useWidgets';\n\nexport const WidgetAreaRenderer = ({ slug, className }) => {\n    const [areaId, setAreaId] = useState(null);\n    const [loadingId, setLoadingId] = useState(true);\n\n    useEffect(() => {\n        const fetchId = async () => {\n            if (!slug) return;\n            setLoadingId(true);\n            try {\n                const { data } = await supabase\n                    .from('template_parts')\n                    .select('id')\n                    .eq('slug', slug)\n                    .eq('type', 'widget_area')\n                    .maybeSingle();\n\n                if (data) setAreaId(data.id);\n            } catch (e) {\n                console.error(\"Error resolving widget area:\", e);\n            } finally {\n                setLoadingId(false);\n            }\n        };\n        fetchId();\n    }, [slug]);\n\n    if (loadingId) return <div className=\"animate-pulse h-20 bg-slate-100 rounded w-full\"></div>;\n    if (!areaId) return null; // Graceful fallback if not found\n\n    return <ConnectedWidgetsList areaId={areaId} className={className} />;\n};\n\nconst ConnectedWidgetsList = ({ areaId, className }) => {\n    const { widgets, loading } = useWidgets(areaId);\n\n    if (loading) return null; // or skeleton\n\n    if (widgets.length === 0) return null;\n\n    return (\n        <div className={`space-y-6 ${className || ''}`}>\n            {widgets.map(widget => (\n                <PublicWidgetWithWrapper key={widget.id} widget={widget} />\n            ))}\n        </div>\n    );\n};\n\nconst PublicWidgetWithWrapper = ({ widget }) => {\n    return (\n        <div className=\"widget-wrapper bg-white rounded-xl shadow-sm border border-slate-200 p-6\">\n            <WidgetDispatcher type={widget.type} config={widget.config} />\n        </div>\n    );\n};\n\nconst WidgetDispatcher = ({ type, config }) => {\n    switch (type) {\n        case 'core/text':\n            return <TextWidget config={config} />;\n        // Add more cases here\n        default:\n            return <div className=\"text-sm text-red-500\">Unknown widget type: {type}</div>;\n    }\n};\n\nconst TextWidget = ({ config }) => {\n    if (config.isHtml) {\n        return <div className=\"prose prose-sm max-w-none\" dangerouslySetInnerHTML={{ __html: sanitizeHTML(config.content) }} />;\n    }\n    return <div className=\"prose prose-sm max-w-none\">{config.content}</div>;\n};\n\nexport default WidgetAreaRenderer;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/__tests__/PublicFooter.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/__tests__/PublicHeader.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/public/__tests__/PublicLayout.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'type' is defined but never used.","line":31,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"type"},"fix":{"range":[867,872],"text":""},"desc":"Remove unused variable 'type'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { render, screen } from '@testing-library/react';\nimport { MemoryRouter } from 'react-router-dom';\nimport PublicLayout from '../PublicLayout';\n\n// Mock hooks and components\nvi.mock('@/hooks/usePublicTenant', () => ({\n    usePublicTenant: vi.fn(() => ({\n        tenant: { id: 'test-tenant-123', name: 'Test Tenant' },\n        loading: false,\n    })),\n}));\n\nvi.mock('../PublicHeader', () => ({\n    default: ({ tenant }) => (\n        <header data-testid=\"public-header\">\n            Header: {tenant?.name || 'No Tenant'}\n        </header>\n    ),\n}));\n\nvi.mock('../PublicFooter', () => ({\n    default: ({ tenant }) => (\n        <footer data-testid=\"public-footer\">\n            Footer: {tenant?.name || 'No Tenant'}\n        </footer>\n    ),\n}));\n\nvi.mock('../DynamicTemplate', () => ({\n    default: ({ type, fallback: Fallback, context }) => {\n        return <Fallback {...context} />;\n    },\n}));\n\nconst renderWithRouter = (ui) => {\n    return render(\n        <MemoryRouter>\n            {ui}\n        </MemoryRouter>\n    );\n};\n\ndescribe('PublicLayout', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    it('renders header and footer', () => {\n        renderWithRouter(<PublicLayout />);\n\n        expect(screen.getByTestId('public-header')).toBeInTheDocument();\n        expect(screen.getByTestId('public-footer')).toBeInTheDocument();\n    });\n\n    it('passes tenant to header', () => {\n        renderWithRouter(<PublicLayout />);\n\n        expect(screen.getByText(/Header: Test Tenant/)).toBeInTheDocument();\n    });\n\n    it('passes tenant to footer', () => {\n        renderWithRouter(<PublicLayout />);\n\n        expect(screen.getByText(/Footer: Test Tenant/)).toBeInTheDocument();\n    });\n\n    it('has proper layout structure', () => {\n        const { container } = renderWithRouter(<PublicLayout />);\n\n        // Should have flex column layout\n        const layout = container.querySelector('.flex.flex-col');\n        expect(layout).toBeInTheDocument();\n        expect(layout).toHaveClass('min-h-screen');\n    });\n\n    it('renders main content area with flex-1', () => {\n        const { container } = renderWithRouter(<PublicLayout />);\n\n        const main = container.querySelector('main');\n        expect(main).toBeInTheDocument();\n        expect(main).toHaveClass('flex-1');\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/routing/PluginRoutes.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":8,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[185,191],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":22,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":22,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * PluginRoutes Component\n * \n * Renders dynamic routes registered by plugins via the 'admin_routes' filter.\n * Used inside AdminLayout to inject plugin-defined routes.\n */\n\nimport React, { Suspense, useMemo } from 'react';\nimport { Route } from 'react-router-dom';\nimport { usePlugins } from '@/contexts/PluginContext';\n\n// Loading fallback\nconst RouteLoader = () => (\n    <div className=\"flex items-center justify-center min-h-[calc(100vh-200px)]\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n    </div>\n);\n\n/**\n * Get plugin routes from the filter system\n */\nexport const usePluginRoutes = () => {\n    const { applyFilters, isLoading } = usePlugins();\n\n    const routes = useMemo(() => {\n        if (isLoading) return [];\n\n        // Get routes registered by plugins via 'admin_routes' filter\n        const pluginRoutes = applyFilters('admin_routes', []);\n\n        // Validate and normalize routes\n        return pluginRoutes\n            .filter(route => route.path && route.element)\n            .map(route => ({\n                path: route.path.startsWith('/') ? route.path.slice(1) : route.path,\n                element: route.element,\n                permission: route.permission || null,\n                lazy: route.lazy !== false\n            }));\n    }, [applyFilters, isLoading]);\n\n    return { routes, isLoading };\n};\n\n/**\n * PluginRoutes Component\n * Renders Route elements for each plugin-registered route\n */\nconst PluginRoutes = () => {\n    const { routes } = usePluginRoutes();\n\n    if (routes.length === 0) {\n        return null;\n    }\n\n    return (\n        <>\n            {routes.map((route) => {\n                const Element = route.element;\n\n                return (\n                    <Route\n                        key={route.path}\n                        path={route.path}\n                        element={\n                            route.lazy ? (\n                                <Suspense fallback={<RouteLoader />}>\n                                    <Element />\n                                </Suspense>\n                            ) : (\n                                <Element />\n                            )\n                        }\n                    />\n                );\n            })}\n        </>\n    );\n};\n\nexport default PluginRoutes;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/DarkModeToggle.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Moon, Sun, Monitor } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { useDarkMode } from '@/contexts/DarkModeContext';\n\n/**\n * Dark Mode Toggle Component\n * Dropdown menu with Light/Dark/System options\n */\nexport function DarkModeToggle() {\n    const { mode, isDark, setMode } = useDarkMode();\n\n    const getIcon = () => {\n        if (mode === 'system') {\n            return <Monitor className=\"h-4 w-4\" />;\n        }\n        return isDark ? <Moon className=\"h-4 w-4\" /> : <Sun className=\"h-4 w-4\" />;\n    };\n\n    return (\n        <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\">\n                    {getIcon()}\n                    <span className=\"sr-only\">Toggle theme</span>\n                </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 z-[100]\">\n                <DropdownMenuItem\n                    onClick={() => setMode('light')}\n                    className={mode === 'light' ? 'bg-accent' : ''}\n                >\n                    <Sun className=\"mr-2 h-4 w-4\" />\n                    <span>Light</span>\n                </DropdownMenuItem>\n                <DropdownMenuItem\n                    onClick={() => setMode('dark')}\n                    className={mode === 'dark' ? 'bg-accent' : ''}\n                >\n                    <Moon className=\"mr-2 h-4 w-4\" />\n                    <span>Dark</span>\n                </DropdownMenuItem>\n                <DropdownMenuItem\n                    onClick={() => setMode('system')}\n                    className={mode === 'system' ? 'bg-accent' : ''}\n                >\n                    <Monitor className=\"mr-2 h-4 w-4\" />\n                    <span>System</span>\n                </DropdownMenuItem>\n            </DropdownMenuContent>\n        </DropdownMenu>\n    );\n}\n\nexport default DarkModeToggle;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/ExtensionErrorBoundary.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/GlobalErrorBoundary.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/ImageUpload.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  26 |\n  27 |     useEffect(() => {\n> 28 |         setUrlInput(normalizedValue);\n     |         ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  29 |         setPreviewError(false);\n  30 |     }, [normalizedValue]);\n  31 |","line":28,"column":9,"nodeType":null,"endLine":28,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { X, Image as ImageIcon, FolderOpen } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogTrigger, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport MediaLibrary from '@/components/dashboard/media/MediaLibrary';\nimport { supabase } from '@/lib/customSupabaseClient';\n\n// Enhanced ImageUpload that includes FilePicker\nconst normalizeValue = (value) => {\n    if (typeof value !== 'string') return '';\n    const trimmed = value.trim();\n    if (!trimmed || trimmed === 'null' || trimmed === 'undefined') return '';\n    return trimmed;\n};\n\nexport function ImageUpload({ value, onChange, disabled, className, hidePreview = false }) {\n    const [open, setOpen] = useState(false);\n    const [urlInput, setUrlInput] = useState(value || '');\n    const [previewError, setPreviewError] = useState(false);\n    const normalizedValue = normalizeValue(value);\n    const hasPreview = Boolean(normalizedValue) && !previewError;\n\n    useEffect(() => {\n        setUrlInput(normalizedValue);\n        setPreviewError(false);\n    }, [normalizedValue]);\n\n    const handleSelect = (file) => {\n        let finalUrl = file.file_path;\n        // If file_path is already a full URL (new behavior), use it directly.\n        // Otherwise generate it from storage (legacy behavior).\n        if (!finalUrl?.startsWith('http')) {\n            const { data } = supabase.storage.from(file.bucket_name || 'cms-uploads').getPublicUrl(file.file_path);\n            finalUrl = data.publicUrl;\n        }\n\n        if (finalUrl) {\n            onChange(finalUrl);\n            setUrlInput(finalUrl);\n            setOpen(false);\n        }\n    };\n\n    const handleUrlChange = (e) => {\n        setUrlInput(e.target.value);\n        onChange(e.target.value);\n    };\n\n    return (\n        <div className={`space-y-4 ${className}`}>\n            <div className=\"flex flex-col gap-4 md:flex-row md:items-start\">\n                {!hidePreview && (\n                    <div className=\"w-36 h-36 shrink-0 rounded-2xl border border-slate-200/70 bg-slate-100/80 flex items-center justify-center overflow-hidden relative group dark:border-slate-800/70 dark:bg-slate-900/60\">\n                        {hasPreview ? (\n                            <>\n                                <img\n                                    src={normalizedValue}\n                                    alt=\"\"\n                                    className=\"w-full h-full object-cover\"\n                                    onError={() => setPreviewError(true)}\n                                />\n                                {!disabled && (\n                                    <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                                        <Button\n                                            variant=\"destructive\"\n                                            size=\"icon\"\n                                            className=\"h-8 w-8 rounded-full\"\n                                            onClick={() => { onChange(''); setUrlInput(''); }}\n                                        >\n                                            <X className=\"w-4 h-4\" />\n                                        </Button>\n                                    </div>\n                                )}\n                            </>\n                        ) : (\n                            <div className=\"flex flex-col items-center gap-2 text-slate-400\">\n                                <ImageIcon className=\"w-8 h-8\" />\n                                <span className=\"text-xs font-medium\">No image</span>\n                            </div>\n                        )}\n                    </div>\n                )}\n\n                <div className=\"flex-1 space-y-4\">\n                    <Tabs defaultValue=\"library\" className=\"w-full\">\n                        <TabsList className=\"grid w-full grid-cols-2 rounded-xl bg-slate-100/80 p-1 text-sm text-slate-500 dark:bg-slate-800/70 dark:text-slate-400\">\n                            <TabsTrigger value=\"library\" className=\"rounded-lg data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white\">Media Library</TabsTrigger>\n                            <TabsTrigger value=\"url\" className=\"rounded-lg data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white\">External URL</TabsTrigger>\n                        </TabsList>\n\n                        <TabsContent value=\"library\" className=\"space-y-3 mt-4\">\n                            <p className=\"text-sm text-slate-500 mb-2\">Select from your uploaded files or upload new ones.</p>\n                            <Dialog open={open} onOpenChange={setOpen}>\n                                <DialogTrigger asChild>\n                                    <Button type=\"button\" variant=\"outline\" className=\"w-full\" disabled={disabled}>\n                                        <FolderOpen className=\"w-4 h-4 mr-2\" />\n                                        Browse Library\n                                    </Button>\n                                </DialogTrigger>\n                                <DialogContent className=\"max-w-4xl h-[80vh] flex flex-col p-0 gap-0\">\n                                    <DialogHeader className=\"px-6 py-4 border-b\">\n                                        <DialogTitle>Select Media</DialogTitle>\n                                    </DialogHeader>\n                                    <div className=\"flex-1 min-h-0 overflow-hidden p-0\">\n                                        <MediaLibrary onSelect={handleSelect} selectionMode=\"single\" />\n                                    </div>\n                                </DialogContent>\n                            </Dialog>\n                        </TabsContent>\n\n                        <TabsContent value=\"url\" className=\"space-y-3 mt-4\">\n                            <div className=\"space-y-2\">\n                                <Label>Image URL</Label>\n                                <Input\n                                    value={urlInput}\n                                    onChange={handleUrlChange}\n                                    placeholder=\"https://...\"\n                                    disabled={disabled}\n                                    className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                                />\n                            </div>\n                        </TabsContent>\n                    </Tabs>\n                </div>\n            </div>\n        </div>\n    );\n}\n\nexport default ImageUpload;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/LanguageSelector.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Globe } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { supabase } from '@/lib/customSupabaseClient';\n\nfunction LanguageSelector({ variant = \"ghost\" }) {\n  const { i18n } = useTranslation();\n  const { user } = useAuth();\n\n  const changeLanguage = async (lng) => {\n    i18n.changeLanguage(lng);\n    localStorage.setItem('i18nextLng', lng);\n\n    // Persist to DB if user is logged in\n    if (user) {\n      try {\n        await supabase\n          .from('users')\n          .update({ language: lng })\n          .eq('id', user.id);\n      } catch (err) {\n        console.error(\"Failed to save language preference to DB:\", err);\n      }\n    }\n  };\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant={variant} size=\"icon\" className=\"rounded-full\">\n          <Globe className=\"w-5 h-5\" />\n          <span className=\"sr-only\">Switch Language</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 z-[100]\">\n        <DropdownMenuItem\n          onClick={() => changeLanguage('en')}\n          className={i18n.language === 'en' ? 'bg-slate-100 font-bold' : ''}\n        >\n           English\n        </DropdownMenuItem>\n        <DropdownMenuItem\n          onClick={() => changeLanguage('id')}\n          className={i18n.language === 'id' ? 'bg-slate-100 font-bold' : ''}\n        >\n           Indonesia\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\nexport default LanguageSelector;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/LocalizedArrayEditor.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/LocalizedInput.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport RichTextEditor from '@/components/ui/RichTextEditor';\nimport { Languages } from 'lucide-react';\n\n/**\n * LocalizedInput - Bilingual text input component for id/en fields\n * \n * @param {Object} props\n * @param {Object} props.value - { id: string, en: string }\n * @param {Function} props.onChange - Called with updated { id, en } object\n * @param {string} props.label - Field label\n * @param {string} props.type - 'text' | 'textarea' | 'richtext'\n * @param {string} props.placeholder - Placeholder text\n * @param {boolean} props.required - Whether field is required\n * @param {string} props.className - Additional className for wrapper\n */\nexport function LocalizedInput({\n    value = { id: '', en: '' },\n    onChange,\n    label,\n    type = 'text',\n    placeholder = '',\n    required = false,\n    className = '',\n    description = ''\n}) {\n    const [activeTab, setActiveTab] = useState('id');\n\n    const handleChange = (lang, newValue) => {\n        onChange({\n            ...value,\n            [lang]: newValue\n        });\n    };\n\n    const renderInput = (lang) => {\n        const currentValue = value?.[lang] || '';\n        const langPlaceholder = lang === 'id' ? `${placeholder} (Indonesia)` : `${placeholder} (English)`;\n\n        if (type === 'richtext') {\n            return (\n                <RichTextEditor\n                    value={currentValue}\n                    onChange={(content) => handleChange(lang, content)}\n                    placeholder={langPlaceholder}\n                />\n            );\n        }\n\n        if (type === 'textarea') {\n            return (\n                <Textarea\n                    value={currentValue}\n                    onChange={(e) => handleChange(lang, e.target.value)}\n                    placeholder={langPlaceholder}\n                    rows={4}\n                    className=\"min-h-[100px]\"\n                />\n            );\n        }\n\n        return (\n            <Input\n                value={currentValue}\n                onChange={(e) => handleChange(lang, e.target.value)}\n                placeholder={langPlaceholder}\n                required={required && lang === 'id'}\n            />\n        );\n    };\n\n    return (\n        <div className={`space-y-2 ${className}`}>\n            {label && (\n                <div className=\"flex items-center gap-2\">\n                    <Label className=\"text-sm font-medium\">\n                        {label}\n                        {required && <span className=\"text-destructive ml-1\">*</span>}\n                    </Label>\n                    <Languages className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                </div>\n            )}\n            {description && (\n                <p className=\"text-xs text-muted-foreground\">{description}</p>\n            )}\n            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-2 h-8\">\n                    <TabsTrigger value=\"id\" className=\"text-xs\">\n                         Indonesia\n                    </TabsTrigger>\n                    <TabsTrigger value=\"en\" className=\"text-xs\">\n                         English\n                    </TabsTrigger>\n                </TabsList>\n                <TabsContent value=\"id\" className=\"mt-2\">\n                    {renderInput('id')}\n                </TabsContent>\n                <TabsContent value=\"en\" className=\"mt-2\">\n                    {renderInput('en')}\n                </TabsContent>\n            </Tabs>\n        </div>\n    );\n}\n\nexport default LocalizedInput;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/LocationPicker.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  42 |   useEffect(() => {\n  43 |     if (lat && lng) {\n> 44 |       setPosition({ lat, lng });\n     |       ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  45 |     }\n  46 |   }, [lat, lng]);\n  47 |","line":44,"column":7,"nodeType":null,"endLine":44,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { MapContainer, TileLayer, Marker, useMapEvents } from 'react-leaflet';\nimport L from 'leaflet';\nimport icon from 'leaflet/dist/images/marker-icon.png';\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\n\n// Fix Leaflet default icon issue\nlet DefaultIcon = L.icon({\n  iconUrl: icon,\n  shadowUrl: iconShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41]\n});\nL.Marker.prototype.options.icon = DefaultIcon;\n\nfunction LocationMarker({ position, setPosition, onLocationChange }) {\n  const map = useMapEvents({\n    click(e) {\n      setPosition(e.latlng);\n      onLocationChange(e.latlng.lat, e.latlng.lng);\n    },\n  });\n\n  // Fly to position if it changes externally\n  useEffect(() => {\n    if (position) {\n      map.flyTo(position, map.getZoom());\n    }\n  }, [position, map]);\n\n  return position === null ? null : (\n    <Marker position={position}></Marker>\n  );\n}\n\nconst LocationPicker = ({ lat, lng, onChange }) => {\n  // Default to Jakarta, Indonesia coordinates if null\n  const defaultPos = { lat: -6.2088, lng: 106.8456 };\n  const [position, setPosition] = useState(lat && lng ? { lat, lng } : null);\n\n  useEffect(() => {\n    if (lat && lng) {\n      setPosition({ lat, lng });\n    }\n  }, [lat, lng]);\n\n  const handleLocationChange = (newLat, newLng) => {\n    onChange(newLat, newLng);\n  };\n\n  return (\n    <div className=\"h-[300px] w-full rounded-md overflow-hidden border border-slate-300 z-0 relative\">\n      <MapContainer\n        center={position || defaultPos}\n        zoom={13}\n        scrollWheelZoom={false}\n        style={{ height: '100%', width: '100%' }}\n      >\n        <TileLayer\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        <LocationMarker\n          position={position}\n          setPosition={setPosition}\n          onLocationChange={handleLocationChange}\n        />\n      </MapContainer>\n      <div className=\"absolute bottom-2 left-2 bg-white/90 px-2 py-1 text-xs rounded z-[1000] pointer-events-none\">\n        {position ? `${position.lat.toFixed(6)}, ${position.lng.toFixed(6)}` : 'Click map to set location'}\n      </div>\n    </div>\n  );\n};\n\nexport default LocationPicker;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/MultiImageUpload.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { Plus, X } from 'lucide-react';\nimport { Dialog, DialogContent, DialogTrigger, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport MediaLibrary from '@/components/dashboard/media/MediaLibrary';\nimport { supabase } from '@/lib/customSupabaseClient';\n\n// Multi-image upload component for galleries/portfolios\nexport function MultiImageUpload({ value = [], onChange, disabled, maxImages = 10 }) {\n    const [open, setOpen] = useState(false);\n\n    // Ensure value is always an array of objects with url property\n    const images = Array.isArray(value) ? value : [];\n\n    const handleSelect = (file) => {\n        const { data } = supabase.storage.from(file.bucket_name || 'cms-uploads').getPublicUrl(file.file_path);\n        if (data.publicUrl && images.length < maxImages) {\n            const newImages = [...images, { url: data.publicUrl, alt: file.name || '' }];\n            onChange(newImages);\n            setOpen(false);\n        }\n    };\n\n    const removeImage = (index) => {\n        const newImages = images.filter((_, i) => i !== index);\n        onChange(newImages);\n    };\n\n    const moveImage = (fromIndex, toIndex) => {\n        if (toIndex < 0 || toIndex >= images.length) return;\n        const newImages = [...images];\n        const [movedItem] = newImages.splice(fromIndex, 1);\n        newImages.splice(toIndex, 0, movedItem);\n        onChange(newImages);\n    };\n\n    return (\n        <div className=\"space-y-4\">\n            {/* Image Grid */}\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3\">\n                {images.map((img, idx) => (\n                    <div\n                        key={idx}\n                        className=\"group relative aspect-square bg-slate-100 rounded-lg border border-slate-200 overflow-hidden\"\n                    >\n                        <img\n                            src={img.url || img}\n                            alt={img.alt || `Image ${idx + 1}`}\n                            className=\"w-full h-full object-cover\"\n                        />\n\n                        {/* Always visible delete button in corner */}\n                        {!disabled && (\n                            <button\n                                type=\"button\"\n                                onClick={(e) => {\n                                    e.preventDefault();\n                                    e.stopPropagation();\n                                    removeImage(idx);\n                                }}\n                                className=\"absolute top-2 right-2 z-10 h-6 w-6 rounded-full bg-red-500 hover:bg-red-600 text-white flex items-center justify-center shadow-lg transition-all hover:scale-110\"\n                                title=\"Remove image\"\n                            >\n                                <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                        )}\n\n                        {/* Hover overlay with move controls */}\n                        {!disabled && images.length > 1 && (\n                            <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2\">\n                                <button\n                                    type=\"button\"\n                                    onClick={(e) => { e.stopPropagation(); moveImage(idx, idx - 1); }}\n                                    disabled={idx === 0}\n                                    className=\"h-8 w-8 rounded-full bg-white/90 hover:bg-white text-slate-700 flex items-center justify-center disabled:opacity-40 disabled:cursor-not-allowed transition-all\"\n                                >\n                                    \n                                </button>\n                                <button\n                                    type=\"button\"\n                                    onClick={(e) => { e.stopPropagation(); moveImage(idx, idx + 1); }}\n                                    disabled={idx === images.length - 1}\n                                    className=\"h-8 w-8 rounded-full bg-white/90 hover:bg-white text-slate-700 flex items-center justify-center disabled:opacity-40 disabled:cursor-not-allowed transition-all\"\n                                >\n                                    \n                                </button>\n                            </div>\n                        )}\n\n                        {/* Index Badge */}\n                        <div className=\"absolute bottom-2 left-2 bg-black/70 text-white text-xs px-2 py-0.5 rounded font-medium\">\n                            {idx + 1}\n                        </div>\n                    </div>\n                ))}\n\n                {/* Add Button */}\n                {images.length < maxImages && !disabled && (\n                    <Dialog open={open} onOpenChange={setOpen}>\n                        <DialogTrigger asChild>\n                            <button\n                                type=\"button\"\n                                className=\"aspect-square bg-slate-50 border-2 border-dashed border-slate-300 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-blue-400 hover:bg-blue-50 transition-colors cursor-pointer\"\n                            >\n                                <Plus className=\"w-8 h-8 text-slate-400\" />\n                                <span className=\"text-xs text-slate-500\">Add Image</span>\n                            </button>\n                        </DialogTrigger>\n                        <DialogContent className=\"max-w-4xl h-[80vh] flex flex-col p-0 gap-0\">\n                            <DialogHeader className=\"px-6 py-4 border-b\">\n                                <DialogTitle>Select Image from Library</DialogTitle>\n                            </DialogHeader>\n                            <div className=\"flex-1 min-h-0 overflow-hidden p-0\">\n                                <MediaLibrary onSelect={handleSelect} selectionMode=\"single\" />\n                            </div>\n                        </DialogContent>\n                    </Dialog>\n                )}\n            </div>\n\n            {/* Info */}\n            <p className=\"text-xs text-slate-500\">\n                {images.length} / {maxImages} images added. Drag to reorder, hover to remove.\n            </p>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/PositionArrayEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { GripVertical, Trash2, Plus, ChevronDown, ChevronUp } from 'lucide-react';\nimport ImageUpload from '@/components/ui/ImageUpload';\n\n/**\n * PositionArrayEditor - Manage an array of position objects with bilingual support\n * Used for organization structures (school, committee, OSIS, MPK)\n * \n * Each item has: position (bilingual), name (string), optional photo, optional class\n */\nexport function PositionArrayEditor({\n    value = [],\n    onChange,\n    label,\n    showPhoto = false,\n    showClass = false,\n    className = ''\n}) {\n    const [expandedIndex, setExpandedIndex] = useState(null);\n\n    const handleAdd = () => {\n        const newItem = {\n            position: { id: '', en: '' },\n            name: '',\n            ...(showPhoto && { photo: '' }),\n            ...(showClass && { class: '' })\n        };\n        onChange([...value, newItem]);\n        setExpandedIndex(value.length);\n    };\n\n    const handleRemove = (index) => {\n        const updated = value.filter((_, i) => i !== index);\n        onChange(updated);\n        if (expandedIndex === index) setExpandedIndex(null);\n    };\n\n    const handleChange = (index, field, newValue) => {\n        const updated = value.map((item, i) => {\n            if (i !== index) return item;\n            if (field === 'position_id' || field === 'position_en') {\n                const lang = field.split('_')[1];\n                return {\n                    ...item,\n                    position: { ...item.position, [lang]: newValue }\n                };\n            }\n            return { ...item, [field]: newValue };\n        });\n        onChange(updated);\n    };\n\n    const moveItem = (index, direction) => {\n        const newIndex = direction === 'up' ? index - 1 : index + 1;\n        if (newIndex < 0 || newIndex >= value.length) return;\n        const updated = [...value];\n        [updated[index], updated[newIndex]] = [updated[newIndex], updated[index]];\n        onChange(updated);\n        setExpandedIndex(newIndex);\n    };\n\n    return (\n        <div className={`space-y-3 ${className}`}>\n            <div className=\"flex items-center justify-between\">\n                {label && <Label className=\"text-base font-medium\">{label}</Label>}\n                <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={handleAdd}>\n                    <Plus className=\"h-4 w-4 mr-1\" />\n                    Add Position\n                </Button>\n            </div>\n\n            {value.length === 0 ? (\n                <Card className=\"border-dashed\">\n                    <CardContent className=\"py-8 text-center text-muted-foreground\">\n                        No positions added yet. Click &quot;Add Position&quot; to add one.\n                    </CardContent>\n                </Card>\n            ) : (\n                <div className=\"space-y-2\">\n                    {value.map((item, index) => (\n                        <Card key={index} className=\"overflow-hidden\">\n                            <div\n                                className=\"flex items-center gap-2 p-3 cursor-pointer hover:bg-muted/50\"\n                                onClick={() => setExpandedIndex(expandedIndex === index ? null : index)}\n                            >\n                                <GripVertical className=\"h-4 w-4 text-muted-foreground\" />\n                                <div className=\"flex-1 min-w-0\">\n                                    <div className=\"font-medium truncate\">\n                                        {item.name || '(No name)'}\n                                    </div>\n                                    <div className=\"text-sm text-muted-foreground truncate\">\n                                        {item.position?.id || item.position?.en || '(No position)'}\n                                    </div>\n                                </div>\n                                <div className=\"flex items-center gap-1\">\n                                    <Button\n                                        type=\"button\"\n                                        variant=\"ghost\"\n                                        size=\"icon\"\n                                        className=\"h-8 w-8\"\n                                        onClick={(e) => { e.stopPropagation(); moveItem(index, 'up'); }}\n                                        disabled={index === 0}\n                                    >\n                                        <ChevronUp className=\"h-4 w-4\" />\n                                    </Button>\n                                    <Button\n                                        type=\"button\"\n                                        variant=\"ghost\"\n                                        size=\"icon\"\n                                        className=\"h-8 w-8\"\n                                        onClick={(e) => { e.stopPropagation(); moveItem(index, 'down'); }}\n                                        disabled={index === value.length - 1}\n                                    >\n                                        <ChevronDown className=\"h-4 w-4\" />\n                                    </Button>\n                                    <Button\n                                        type=\"button\"\n                                        variant=\"ghost\"\n                                        size=\"icon\"\n                                        className=\"h-8 w-8 text-destructive hover:text-destructive\"\n                                        onClick={(e) => { e.stopPropagation(); handleRemove(index); }}\n                                    >\n                                        <Trash2 className=\"h-4 w-4\" />\n                                    </Button>\n                                </div>\n                            </div>\n\n                            {expandedIndex === index && (\n                                <CardContent className=\"border-t pt-4 space-y-4\">\n                                    <div>\n                                        <Label>Name</Label>\n                                        <Input\n                                            value={item.name || ''}\n                                            onChange={(e) => handleChange(index, 'name', e.target.value)}\n                                            placeholder=\"Full name\"\n                                        />\n                                    </div>\n\n                                    <div>\n                                        <Label>Position (Bilingual)</Label>\n                                        <Tabs defaultValue=\"id\" className=\"mt-1\">\n                                            <TabsList className=\"grid w-full grid-cols-2 h-8\">\n                                                <TabsTrigger value=\"id\" className=\"text-xs\"> Indonesia</TabsTrigger>\n                                                <TabsTrigger value=\"en\" className=\"text-xs\"> English</TabsTrigger>\n                                            </TabsList>\n                                            <TabsContent value=\"id\" className=\"mt-2\">\n                                                <Input\n                                                    value={item.position?.id || ''}\n                                                    onChange={(e) => handleChange(index, 'position_id', e.target.value)}\n                                                    placeholder=\"Jabatan (Indonesia)\"\n                                                />\n                                            </TabsContent>\n                                            <TabsContent value=\"en\" className=\"mt-2\">\n                                                <Input\n                                                    value={item.position?.en || ''}\n                                                    onChange={(e) => handleChange(index, 'position_en', e.target.value)}\n                                                    placeholder=\"Position (English)\"\n                                                />\n                                            </TabsContent>\n                                        </Tabs>\n                                    </div>\n\n                                    {showClass && (\n                                        <div>\n                                            <Label>Class</Label>\n                                            <Input\n                                                value={item.class || ''}\n                                                onChange={(e) => handleChange(index, 'class', e.target.value)}\n                                                placeholder=\"e.g., XII MIPA 1\"\n                                            />\n                                        </div>\n                                    )}\n\n                                    {showPhoto && (\n                                        <ImageUpload\n                                            label=\"Photo\"\n                                            value={item.photo}\n                                            onChange={(v) => handleChange(index, 'photo', v)}\n                                        />\n                                    )}\n                                </CardContent>\n                            )}\n                        </Card>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n}\n\n/**\n * StaffArrayEditor - Manage an array of staff members\n * Used for teaching and administrative staff lists\n * \n * Each item has: name, role (optional), subject (optional), photo\n */\nexport function StaffArrayEditor({\n    value = [],\n    onChange,\n    label,\n    showSubject = true,\n    className = ''\n}) {\n    const [expandedIndex, setExpandedIndex] = useState(null);\n\n    const handleAdd = () => {\n        const newItem = {\n            name: '',\n            role: '',\n            ...(showSubject && { subject: '' }),\n            photo: ''\n        };\n        onChange([...value, newItem]);\n        setExpandedIndex(value.length);\n    };\n\n    const handleRemove = (index) => {\n        onChange(value.filter((_, i) => i !== index));\n        if (expandedIndex === index) setExpandedIndex(null);\n    };\n\n    const handleChange = (index, field, newValue) => {\n        const updated = value.map((item, i) =>\n            i === index ? { ...item, [field]: newValue } : item\n        );\n        onChange(updated);\n    };\n\n    return (\n        <div className={`space-y-3 ${className}`}>\n            <div className=\"flex items-center justify-between\">\n                {label && <Label className=\"text-base font-medium\">{label}</Label>}\n                <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={handleAdd}>\n                    <Plus className=\"h-4 w-4 mr-1\" />\n                    Add Staff\n                </Button>\n            </div>\n\n            {value.length === 0 ? (\n                <Card className=\"border-dashed\">\n                    <CardContent className=\"py-8 text-center text-muted-foreground\">\n                        No staff members added yet.\n                    </CardContent>\n                </Card>\n            ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                    {value.map((item, index) => (\n                        <Card key={index} className=\"overflow-hidden\">\n                            <div\n                                className=\"p-3 cursor-pointer hover:bg-muted/50\"\n                                onClick={() => setExpandedIndex(expandedIndex === index ? null : index)}\n                            >\n                                <div className=\"flex items-start gap-3\">\n                                    <div className=\"w-12 h-12 bg-muted rounded-full flex items-center justify-center text-lg font-medium\">\n                                        {item.name?.charAt(0) || '?'}\n                                    </div>\n                                    <div className=\"flex-1 min-w-0\">\n                                        <div className=\"font-medium truncate\">{item.name || '(No name)'}</div>\n                                        {item.role && <div className=\"text-sm text-primary truncate\">{item.role}</div>}\n                                        {showSubject && item.subject && (\n                                            <div className=\"text-sm text-muted-foreground truncate\">{item.subject}</div>\n                                        )}\n                                    </div>\n                                    <Button\n                                        type=\"button\"\n                                        variant=\"ghost\"\n                                        size=\"icon\"\n                                        className=\"h-8 w-8 text-destructive hover:text-destructive\"\n                                        onClick={(e) => { e.stopPropagation(); handleRemove(index); }}\n                                    >\n                                        <Trash2 className=\"h-4 w-4\" />\n                                    </Button>\n                                </div>\n                            </div>\n\n                            {expandedIndex === index && (\n                                <CardContent className=\"border-t pt-4 space-y-3\">\n                                    <div>\n                                        <Label>Name</Label>\n                                        <Input\n                                            value={item.name || ''}\n                                            onChange={(e) => handleChange(index, 'name', e.target.value)}\n                                        />\n                                    </div>\n                                    <div>\n                                        <Label>Role/Position</Label>\n                                        <Input\n                                            value={item.role || ''}\n                                            onChange={(e) => handleChange(index, 'role', e.target.value)}\n                                            placeholder=\"e.g., Waka Kurikulum\"\n                                        />\n                                    </div>\n                                    {showSubject && (\n                                        <div>\n                                            <Label>Subject</Label>\n                                            <Input\n                                                value={item.subject || ''}\n                                                onChange={(e) => handleChange(index, 'subject', e.target.value)}\n                                                placeholder=\"e.g., Matematika\"\n                                            />\n                                        </div>\n                                    )}\n                                    <ImageUpload\n                                        label=\"Photo\"\n                                        value={item.photo}\n                                        onChange={(v) => handleChange(index, 'photo', v)}\n                                    />\n                                </CardContent>\n                            )}\n                        </Card>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n}\n\nexport default PositionArrayEditor;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/RegionBreadcrumb.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { buildRegionPath } from '../../lib/regionUtils';\n\n/**\n * Region Breadcrumb Component\n * Displays the full hierarchical path of a region\n */\nconst RegionBreadcrumb = ({ region, ancestors = [], className = '' }) => {\n    if (!region) return null;\n\n    const fullPath = region.full_path || buildRegionPath(ancestors, region);\n\n    return (\n        <div className={`text-sm text-gray-500 ${className}`}>\n            {fullPath}\n        </div>\n    );\n};\n\nexport default RegionBreadcrumb;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/RegionPicker.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":11,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":10,"suggestions":[{"messageId":"removeVar","data":{"varName":"value"},"fix":{"range":[327,333],"text":""},"desc":"Remove unused variable 'value'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  48 |         if (allLevels.length > 0) {\n  49 |             const filtered = allLevels.filter(l => l.order <= maxLevel);\n> 50 |             setActiveLevels(filtered);\n     |             ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  51 |         }\n  52 |     }, [allLevels, maxLevel]);\n  53 |","line":50,"column":13,"nodeType":null,"endLine":50,"endColumn":28},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  73 |             // Root level is the one with the lowest order\n  74 |             const rootLevel = activeLevels.reduce((prev, curr) => (prev.order < curr.order ? prev : curr));\n> 75 |             loadRegionsForLevel(rootLevel.key, null);\n     |             ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  76 |         }\n  77 |     }, [allLevels, activeLevels, loadRegionsForLevel]);\n  78 |","line":75,"column":13,"nodeType":null,"endLine":75,"endColumn":32}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { useRegions } from '../../hooks/useRegions';\nimport { REGION_LEVELS } from '../../lib/regionUtils'; // Fallback levels\n\n\n/**\n * Region Picker Component\n * Cascading dropdowns for selecting regions down to a specific level\n */\nconst RegionPicker = ({\n    value,\n    onChange,\n    maxLevel = 10,\n    className = ''\n}) => {\n    // value is the leaf region ID selected\n    const [selections, setSelections] = useState({});\n    const [levelsData, setLevelsData] = useState({});\n    const { getRegions, getLevels } = useRegions();\n    const [allLevels, setAllLevels] = useState([]);\n    const [activeLevels, setActiveLevels] = useState([]);\n    const [loadingLevels, setLoadingLevels] = useState(true);\n\n    // Initial load of levels structure from DB\n    useEffect(() => {\n        const fetchLevels = async () => {\n            setLoadingLevels(true);\n            const levels = await getLevels();\n            if (levels && levels.length > 0) {\n                // Map DB level_order to standard order property if needed, or just use level_order\n                // Assuming DB has 'key', 'name', 'level_order', 'id'\n                const normalizedLevels = levels.map(l => ({\n                    ...l,\n                    order: l.level_order || l.order // Handle both cases\n                }));\n                setAllLevels(normalizedLevels);\n            } else {\n                // Fallback to static if fetch fails/empty (optional, but good for safety)\n                setAllLevels(REGION_LEVELS);\n            }\n            setLoadingLevels(false);\n        };\n        fetchLevels();\n    }, [getLevels]);\n\n    // Filter levels by maxLevel whenever allLevels changes or maxLevel changes\n    useEffect(() => {\n        if (allLevels.length > 0) {\n            const filtered = allLevels.filter(l => l.order <= maxLevel);\n            setActiveLevels(filtered);\n        }\n    }, [allLevels, maxLevel]);\n\n    const loadRegionsForLevel = useCallback(async (levelKey, parentId) => {\n        // Find level object in our dynamic state\n        const levelObj = allLevels.find(l => l.key === levelKey);\n        if (!levelObj) return;\n\n        const regions = await getRegions({\n            levelId: levelObj.id, // Use the UUID from the DB\n            parentId: parentId\n        });\n\n        setLevelsData(prev => ({\n            ...prev,\n            [levelKey]: regions.data || regions // Handle {data, count} or plain array return from hook\n        }));\n    }, [getRegions, allLevels]);\n\n    // Load root level once levels are loaded\n    useEffect(() => {\n        if (allLevels.length > 0 && activeLevels.length > 0) {\n            // Root level is the one with the lowest order\n            const rootLevel = activeLevels.reduce((prev, curr) => (prev.order < curr.order ? prev : curr));\n            loadRegionsForLevel(rootLevel.key, null);\n        }\n    }, [allLevels, activeLevels, loadRegionsForLevel]);\n\n    const handleSelection = async (levelKey, regionId) => {\n        const region = levelsData[levelKey]?.find(r => r.id === regionId);\n\n        const newSelections = { ...selections, [levelKey]: region };\n\n        // Clear lower levels\n        // We need to find the index in activeLevels\n        const levelIndex = activeLevels.findIndex(l => l.key === levelKey);\n\n        // Clear subsequent selections in state\n        for (let i = levelIndex + 1; i < activeLevels.length; i++) {\n            delete newSelections[activeLevels[i].key];\n            // Also optionally clear the data for lower levels to force re-fetch? \n            // Or just keep it but it won't be shown/valid. \n            // Resetting UI is handled by rendering logic based on isVisible.\n        }\n\n        setSelections(newSelections);\n\n        // Notify parent\n        if (onChange) {\n            // Pass the most specific selected region\n            onChange(regionId ? region : (selections[activeLevels[levelIndex - 1]?.key] || null));\n        }\n\n        if (regionId) {\n            // Load next level\n            const nextLevelIndex = levelIndex + 1;\n            if (nextLevelIndex < activeLevels.length) {\n                const nextLevel = activeLevels[nextLevelIndex];\n                await loadRegionsForLevel(nextLevel.key, regionId);\n            }\n        }\n    };\n\n    if (loadingLevels) {\n        return <div className=\"text-sm text-gray-500 animate-pulse\">Loading region levels...</div>;\n    }\n\n    return (\n        <div className={`space-y-3 ${className}`}>\n            {activeLevels.map((level, index) => {\n                // Show level if it's the first one OR if the previous level has a selection\n                const prevLevel = index > 0 ? activeLevels[index - 1] : null;\n                const isVisible = !prevLevel || selections[prevLevel.key];\n\n                if (!isVisible) return null;\n\n                const options = levelsData[level.key] || [];\n\n                return (\n                    <div key={level.key} className=\"form-control w-full\">\n                        <label className=\"label\">\n                            <span className=\"label-text\">{level.name}</span>\n                        </label>\n                        <select\n                            className=\"select select-bordered w-full dark:bg-slate-800 dark:text-slate-200 dark:border-slate-600\"\n                            value={selections[level.key]?.id || ''}\n                            onChange={(e) => handleSelection(level.key, e.target.value)}\n                        >\n                            <option value=\"\">Pilih {level.name}</option>\n                            {options.map((option) => (\n                                <option key={option.id} value={option.id}>\n                                    {option.name}\n                                </option>\n                            ))}\n                        </select>\n                    </div>\n                );\n            })}\n        </div>\n    );\n};\n\nexport default RegionPicker;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/RichTextEditor.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/TagInput.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/Turnstile.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'onError', 'onExpire', and 'onVerify'. Either include them or remove the dependency array. If 'onError' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":231,"column":8,"nodeType":"ArrayExpression","endLine":231,"endColumn":74,"suggestions":[{"desc":"Update the dependencies array to be: [scriptLoaded, hasError, resolvedSiteKey, theme, size, appearance, onError, onVerify, onExpire]","fix":{"range":[8978,9044],"text":"[scriptLoaded, hasError, resolvedSiteKey, theme, size, appearance, onError, onVerify, onExpire]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/VersionBadge.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { getVersionInfo } from '@/lib/version';\nimport { Info } from 'lucide-react';\nimport {\n    Tooltip,\n    TooltipContent,\n    TooltipProvider,\n    TooltipTrigger,\n} from '@/components/ui/tooltip';\n\n/**\n * Version Badge Component\n * Displays the current application version with optional tooltip showing detailed info\n */\nfunction VersionBadge({\n    variant = 'default', // 'default', 'compact', 'full'\n    showTooltip = true,\n    className = ''\n}) {\n    const versionInfo = getVersionInfo();\n\n    const getBadgeContent = () => {\n        switch (variant) {\n            case 'compact':\n                return `v${versionInfo.version}`;\n            case 'full':\n                return versionInfo.displayVersion;\n            default:\n                return `v${versionInfo.version}`;\n        }\n    };\n\n    const badge = (\n        <div className={`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200 ${className}`}>\n            <span>{getBadgeContent()}</span>\n            {showTooltip && <Info className=\"w-3 h-3 text-slate-400\" />}\n        </div>\n    );\n\n    if (!showTooltip) {\n        return badge;\n    }\n\n    return (\n        <TooltipProvider>\n            <Tooltip>\n                <TooltipTrigger asChild>\n                    {badge}\n                </TooltipTrigger>\n                <TooltipContent side=\"top\" className=\"text-xs\">\n                    <div className=\"space-y-1\">\n                        <div className=\"font-bold\">{versionInfo.displayVersion}</div>\n                        <div className=\"text-slate-400\">Build: {versionInfo.build}</div>\n                        <div className=\"text-slate-400\">Released: {versionInfo.date}</div>\n                    </div>\n                </TooltipContent>\n            </Tooltip>\n        </TooltipProvider>\n    );\n}\n\nexport default VersionBadge;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/__tests__/Turnstile.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/alert-dialog.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'children' is defined but never used.","line":19,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":67,"suggestions":[{"messageId":"removeVar","data":{"varName":"children"},"fix":{"range":[558,568],"text":""},"desc":"Remove unused variable 'children'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = ({\n  className,\n  ...props\n}) => (\n  <AlertDialogPrimitive.Portal className={cn(className)} {...props} />\n)\nAlertDialogPortal.displayName = AlertDialogPrimitive.Portal.displayName\n\nconst AlertDialogOverlay = React.forwardRef(({ className, children, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref} />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full\",\n        className\n      )}\n      {...props} />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}) => (\n  <div\n    className={cn(\"flex flex-col space-y-2 text-center sm:text-left\", className)}\n    {...props} />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}) => (\n  <div\n    className={cn(\"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\", className)}\n    {...props} />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props} />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props} />\n))\nAlertDialogDescription.displayName = AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props} />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(buttonVariants({ variant: \"outline\" }), \"mt-2 sm:mt-0\", className)}\n    {...props} />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/alert.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/avatar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/badge.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,24],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":36,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":36,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport * as React from \"react\"\nimport { cva } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-blue-600 dark:bg-blue-500 text-white hover:bg-blue-700 dark:hover:bg-blue-600\",\n        secondary:\n          \"border-transparent bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-100 hover:bg-slate-200 dark:hover:bg-slate-700\",\n        destructive:\n          \"border-transparent bg-red-600 dark:bg-red-500 text-white hover:bg-red-700 dark:hover:bg-red-600\",\n        outline: \"border-slate-200 dark:border-slate-700 text-slate-900 dark:text-slate-100 bg-transparent\",\n        success:\n          \"border-transparent bg-green-600 dark:bg-green-500 text-white hover:bg-green-700 dark:hover:bg-green-600\",\n        warning:\n          \"border-transparent bg-amber-500 dark:bg-amber-400 text-white hover:bg-amber-600 dark:hover:bg-amber-500\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction Badge({ className, variant, ...props }) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/breadcrumb.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/button.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":47,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":47,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { cn } from '@/lib/utils';\nimport { Slot } from '@radix-ui/react-slot';\nimport { cva } from 'class-variance-authority';\nimport React from 'react';\n\nconst buttonVariants = cva(\n\t'inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 cursor-pointer',\n\t{\n\t\tvariants: {\n\t\t\tvariant: {\n\t\t\t\tdefault: 'bg-blue-600 dark:bg-blue-500 text-white hover:bg-blue-700 dark:hover:bg-blue-600',\n\t\t\t\tdestructive:\n\t\t\t\t\t'bg-red-600 dark:bg-red-500 text-white hover:bg-red-700 dark:hover:bg-red-600',\n\t\t\t\toutline:\n\t\t\t\t\t'border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800',\n\t\t\t\tsecondary:\n\t\t\t\t\t'bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-100 hover:bg-slate-200 dark:hover:bg-slate-700',\n\t\t\t\tghost: 'text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-slate-100',\n\t\t\t\tlink: 'text-blue-600 dark:text-blue-400 underline-offset-4 hover:underline',\n\t\t\t},\n\t\t\tsize: {\n\t\t\t\tdefault: 'h-10 px-4 py-2',\n\t\t\t\tsm: 'h-9 rounded-md px-3',\n\t\t\t\tlg: 'h-11 rounded-md px-8',\n\t\t\t\ticon: 'h-10 w-10',\n\t\t\t},\n\t\t},\n\t\tdefaultVariants: {\n\t\t\tvariant: 'default',\n\t\t\tsize: 'default',\n\t\t},\n\t},\n);\n\nconst Button = React.forwardRef(({ className, variant, size, asChild = false, ...props }, ref) => {\n\tconst Comp = asChild ? Slot : 'button';\n\treturn (\n\t\t<Comp\n\t\t\tclassName={cn(buttonVariants({ variant, size, className }))}\n\t\t\tref={ref}\n\t\t\t{...props}\n\t\t/>\n\t);\n});\nButton.displayName = 'Button';\n\nexport { Button, buttonVariants };\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/card.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/checkbox.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/dialog.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/dropdown-menu.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/form.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":125,"column":5,"nodeType":"Identifier","messageId":"namedExport","endLine":125,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { Controller, FormProvider, useFormContext } from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\nconst FormFieldContext = React.createContext({})\n\nconst FormField = ({\n    ...props\n}) => {\n    return (\n        <FormFieldContext.Provider value={{ name: props.name }}>\n            <Controller {...props} />\n        </FormFieldContext.Provider>\n    )\n}\n\nconst useFormField = () => {\n    const fieldContext = React.useContext(FormFieldContext)\n    const itemContext = React.useContext(FormItemContext)\n    const { getFieldState, formState } = useFormContext()\n\n    const fieldState = getFieldState(fieldContext.name, formState)\n\n    if (!fieldContext) {\n        throw new Error(\"useFormField should be used within <FormField>\")\n    }\n\n    const { id } = itemContext\n\n    return {\n        id,\n        name: fieldContext.name,\n        formItemId: `${id}-form-item`,\n        formDescriptionId: `${id}-form-item-description`,\n        formMessageId: `${id}-form-item-message`,\n        ...fieldState,\n    }\n}\n\nconst FormItemContext = React.createContext({})\n\nconst FormItem = React.forwardRef(({ className, ...props }, ref) => {\n    const id = React.useId()\n\n    return (\n        <FormItemContext.Provider value={{ id }}>\n            <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n        </FormItemContext.Provider>\n    )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef(({ className, ...props }, ref) => {\n    const { error, formItemId } = useFormField()\n\n    return (\n        <Label\n            ref={ref}\n            className={cn(error && \"text-destructive\", className)}\n            htmlFor={formItemId}\n            {...props}\n        />\n    )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef(({ ...props }, ref) => {\n    const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n    return (\n        <Slot\n            ref={ref}\n            id={formItemId}\n            aria-describedby={\n                !error\n                    ? `${formDescriptionId}`\n                    : `${formDescriptionId} ${formMessageId}`\n            }\n            aria-invalid={!!error}\n            {...props}\n        />\n    )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef(({ className, ...props }, ref) => {\n    const { formDescriptionId } = useFormField()\n\n    return (\n        <p\n            ref={ref}\n            id={formDescriptionId}\n            className={cn(\"text-sm text-muted-foreground\", className)}\n            {...props}\n        />\n    )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef(({ className, children, ...props }, ref) => {\n    const { error, formMessageId } = useFormField()\n    const body = error ? String(error?.message) : children\n\n    if (!body) {\n        return null\n    }\n\n    return (\n        <p\n            ref={ref}\n            id={formMessageId}\n            className={cn(\"text-sm font-medium text-destructive\", className)}\n            {...props}\n        />\n    )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n    useFormField,\n    Form,\n    FormItem,\n    FormLabel,\n    FormControl,\n    FormDescription,\n    FormMessage,\n    FormField,\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/input.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/label.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/pagination.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/progress.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/scroll-area.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/select.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/separator.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/skeleton.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/slider.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/switch.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/table.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/tabs.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/textarea.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/toast.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/toaster.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":10,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[187,198],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n\tToast,\n\tToastClose,\n\tToastDescription,\n\tToastProvider,\n\tToastTitle,\n\tToastViewport,\n} from '@/components/ui/toast';\nimport { useToast } from '@/components/ui/use-toast';\nimport React from 'react';\n\nexport function Toaster() {\n\tconst { toasts } = useToast();\n\n\treturn (\n\t\t<ToastProvider>\n\t\t\t{toasts.map(({ id, title, description, action, ...props }) => {\n\t\t\t\treturn (\n\t\t\t\t\t<Toast key={id} {...props}>\n\t\t\t\t\t\t<div className=\"grid gap-1\">\n\t\t\t\t\t\t\t{title && <ToastTitle>{title}</ToastTitle>}\n\t\t\t\t\t\t\t{description && (\n\t\t\t\t\t\t\t\t<ToastDescription>{description}</ToastDescription>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{action}\n\t\t\t\t\t\t<ToastClose />\n\t\t\t\t\t</Toast>\n\t\t\t\t);\n\t\t\t})}\n\t\t\t<ToastViewport />\n\t\t</ToastProvider>\n\t);\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/tooltip.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/ui/use-toast.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/Renderer.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[100,111],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Visual Page Renderer\n * Renders published visual builder content on public pages\n */\n\nimport React from 'react';\nimport { Render } from '@puckeditor/core';\nimport puckConfig from './config';\n\nconst VisualPageRenderer = ({ content }) => {\n    // If no content or empty, show placeholder\n    if (!content || !content.content || content.content.length === 0) {\n        return (\n            <div className=\"min-h-[400px] flex items-center justify-center bg-slate-50\">\n                <p className=\"text-slate-400\">No content available</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"visual-page-content\">\n            <Render config={puckConfig} data={content} />\n        </div>\n    );\n};\n\nexport default VisualPageRenderer;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/TemplateSelector.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[116,122],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Template Selector Component\n * Modal for selecting page templates when creating or editing pages\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Check, Layout, Sparkles, Loader2 } from 'lucide-react';\nimport { supabase } from '@/lib/customSupabaseClient';\n\nconst TemplateSelector = ({ open, onOpenChange, onSelect }) => {\n    const [selectedTemplate, setSelectedTemplate] = useState(null);\n    const [templates, setTemplates] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        if (open) {\n            fetchTemplates();\n        }\n    }, [open]);\n\n    const fetchTemplates = async () => {\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('templates')\n                .select('*')\n                .eq('is_active', true)\n                .order('created_at', { ascending: false });\n\n            if (error) throw error;\n            setTemplates(data || []);\n        } catch (error) {\n            console.error('Error fetching templates:', error);\n            // Fallback to empty or show error\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    // Get unique categories\n    const categories = ['All', ...new Set(templates.map(t => t.category || 'General'))];\n\n    const handleSelect = () => {\n        if (selectedTemplate) {\n            onSelect(selectedTemplate.data);\n            onOpenChange(false);\n            setSelectedTemplate(null);\n        }\n    };\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent className=\"max-w-4xl max-h-[85vh] flex flex-col p-0\">\n                <DialogHeader className=\"px-6 py-4 border-b bg-gradient-to-r from-blue-600 to-purple-600\">\n                    <DialogTitle className=\"text-white flex items-center gap-2\">\n                        <Layout className=\"w-5 h-5\" />\n                        Choose a Template\n                    </DialogTitle>\n                    <DialogDescription className=\"text-blue-100\">\n                        Start with a pre-designed layout or build from scratch\n                    </DialogDescription>\n                </DialogHeader>\n\n                {loading ? (\n                    <div className=\"flex-1 flex items-center justify-center p-12\">\n                        <Loader2 className=\"w-8 h-8 animate-spin text-blue-600\" />\n                    </div>\n                ) : (\n                    <Tabs defaultValue=\"All\" className=\"flex-1 flex flex-col overflow-hidden\">\n                        <div className=\"px-6 py-3 border-b bg-slate-50\">\n                            <TabsList className=\"bg-white shadow-sm flex-wrap w-full md:w-auto h-auto\">\n                                {categories.map(category => (\n                                    <TabsTrigger\n                                        key={category}\n                                        value={category}\n                                        className=\"px-4\"\n                                    >\n                                        {category}\n                                    </TabsTrigger>\n                                ))}\n                            </TabsList>\n                        </div>\n\n                        <div className=\"flex-1 overflow-auto p-6\">\n                            {categories.map(category => (\n                                <TabsContent key={category} value={category} className=\"m-0\">\n                                    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n                                        {templates\n                                            .filter(t => category === 'All' || (t.category || 'General') === category)\n                                            .map(template => (\n                                                <motion.div\n                                                    key={template.id}\n                                                    whileHover={{ scale: 1.02 }}\n                                                    whileTap={{ scale: 0.98 }}\n                                                    className={`\n                          relative cursor-pointer rounded-xl border-2 p-4 transition-all\n                          ${selectedTemplate?.id === template.id\n                                                            ? 'border-blue-500 bg-blue-50 shadow-lg'\n                                                            : 'border-slate-200 hover:border-slate-300 hover:shadow-md bg-white'}\n                        `}\n                                                    onClick={() => setSelectedTemplate(template)}\n                                                >\n                                                    {/* Selected indicator */}\n                                                    {selectedTemplate?.id === template.id && (\n                                                        <div className=\"absolute top-2 right-2 w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center\">\n                                                            <Check className=\"w-4 h-4 text-white\" />\n                                                        </div>\n                                                    )}\n\n                                                    {/* Template icon/thumbnail */}\n                                                    <div className=\"text-4xl mb-3 flex items-center justify-center h-20 bg-slate-50 rounded\">\n                                                        {template.thumbnail ? (\n                                                            <img src={template.thumbnail} alt={template.name} className=\"w-full h-full object-cover rounded\" />\n                                                        ) : (\n                                                            <Layout className=\"w-8 h-8 text-slate-300\" />\n                                                        )}\n                                                    </div>\n\n                                                    {/* Template info */}\n                                                    <h3 className=\"font-semibold text-slate-800 mb-1 truncate\">\n                                                        {template.name}\n                                                    </h3>\n                                                    <p className=\"text-sm text-slate-500 line-clamp-2\">\n                                                        {template.description || 'No description'}\n                                                    </p>\n\n                                                    {/* Category badge */}\n                                                    <div className=\"mt-3\">\n                                                        <span className=\"inline-block px-2 py-0.5 text-xs font-medium rounded-full bg-slate-100 text-slate-600\">\n                                                            {template.category || 'General'}\n                                                        </span>\n                                                    </div>\n                                                </motion.div>\n                                            ))}\n                                    </div>\n                                </TabsContent>\n                            ))}\n                        </div>\n                    </Tabs>\n                )}\n\n                {/* Footer */}\n                <div className=\"px-6 py-4 border-t bg-slate-50 flex items-center justify-between\">\n                    <p className=\"text-sm text-slate-500\">\n                        {selectedTemplate\n                            ? `Selected: ${selectedTemplate.name}`\n                            : 'Select a template to continue'\n                        }\n                    </p>\n                    <div className=\"flex gap-3\">\n                        <Button\n                            variant=\"outline\"\n                            onClick={() => onOpenChange(false)}\n                        >\n                            Cancel\n                        </Button>\n                        <Button\n                            onClick={handleSelect}\n                            disabled={!selectedTemplate}\n                            className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\"\n                        >\n                            <Sparkles className=\"w-4 h-4 mr-2\" />\n                            Use Template\n                        </Button>\n                    </div>\n                </div>\n            </DialogContent>\n        </Dialog>\n    );\n};\n\nexport default TemplateSelector;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/VisualPageBuilder.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'onSuccess' is defined but never used.","line":32,"column":77,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":86,"suggestions":[{"messageId":"removeVar","data":{"varName":"onSuccess"},"fix":{"range":[1414,1425],"text":""},"desc":"Remove unused variable 'onSuccess'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleClose', 'partId', 'resetHistory', and 'toast'. Either include them or remove the dependency array.","line":231,"column":8,"nodeType":"ArrayExpression","endLine":231,"endColumn":83,"suggestions":[{"desc":"Update the dependencies array to be: [templateId, pageId, initialPage, mode, currentTenant.id, isPlatformAdmin, partId, resetHistory, toast, handleClose]","fix":{"range":[10057,10132],"text":"[templateId, pageId, initialPage, mode, currentTenant.id, isPlatformAdmin, partId, resetHistory, toast, handleClose]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { useSearchParams, useNavigate } from 'react-router-dom';\nimport { Puck, Render } from '@puckeditor/core';\nimport '@puckeditor/core/puck.css';\nimport './puck-theme.css';\nimport { Save, Eye, EyeOff, ArrowLeft, Upload, Monitor, Tablet, Smartphone, Undo2, Redo2, Loader2, WifiOff } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/components/ui/use-toast';\nimport { udm } from '@/lib/data/UnifiedDataManager';\nimport editorConfig from './config';\nimport TemplateSelector from './TemplateSelector';\nimport { useHistory } from './hooks/useHistory';\nimport SlugGenerator from '@/components/dashboard/slug/SlugGenerator';\nimport ResourceSelect from '@/components/dashboard/ResourceSelect';\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogHeader,\n    DialogTitle,\n    DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { Settings } from 'lucide-react';\n\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useTenant } from '@/contexts/TenantContext'; // Added TenantContext\n\nconst VisualPageBuilder = ({ page: initialPage, mode: initialMode, onClose, onSuccess }) => {\n    // Permission Hook\n    const { hasPermission, checkAccess, isPlatformAdmin } = usePermissions();\n    const { currentTenant } = useTenant(); // Get current tenant\n    const { toast } = useToast();\n    const [searchParams] = useSearchParams();\n    const navigate = useNavigate();\n\n    // Determine mode and IDs\n    const templateId = searchParams.get('templateId');\n    const partId = searchParams.get('partId');\n    const pageId = searchParams.get('pageId'); // Optional, to support deep linking \n    const mode = initialMode || (partId ? 'part' : (templateId ? 'template' : 'page'));\n\n    // State\n    const [page, setPage] = useState(initialPage || null);\n\n    // Initial data setup\n    const initialData = initialPage?.content_draft || { content: [], root: { props: { title: '' } } };\n\n    // Use History Hook for Data Management\n    const {\n        state: data,\n        setState: setData,\n        undo,\n        redo,\n        canUndo,\n        canRedo,\n        resetHistory\n    } = useHistory(initialData);\n\n    // Use ref to keep latest data reference for closures (save handlers)\n    const dataRef = useRef(data);\n    useEffect(() => {\n        dataRef.current = data;\n    }, [data]);\n\n\n    // Page Metadata State\n    const [pageMetadata, setPageMetadata] = useState({\n        title: initialPage?.title || '',\n        slug: initialPage?.slug || '',\n        meta_description: initialPage?.meta_description || '',\n        category_id: initialPage?.category_id || null, // Added category_id\n        status: initialPage?.status || 'draft',\n        published_at: initialPage?.published_at ? new Date(initialPage.published_at).toISOString().slice(0, 16) : ''\n    });\n\n\n    const isEditorEnabled = (mode === 'template' || mode === 'part') ? hasPermission('tenant.theme.update') : checkAccess('edit', 'pages', page);\n    const canEdit = isEditorEnabled; // Alias for readability\n    const canPublish = (mode === 'template' || mode === 'part') ? false : checkAccess('publish', 'pages', page);\n\n    const [isSaving, setIsSaving] = useState(false);\n    const [isPublishing, setIsPublishing] = useState(false);\n    const [previewMode, setPreviewMode] = useState(false);\n    const [viewport] = useState('desktop');\n    const [editorKey, setEditorKey] = useState(0);\n    const [templateSelectorOpen, setTemplateSelectorOpen] = useState(false);\n    const [settingsOpen, setSettingsOpen] = useState(false);\n    const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n    const [lastSavedAt, setLastSavedAt] = useState(null);\n    const [isOffline, setIsOffline] = useState(!navigator.onLine);\n\n    // History aliases for UI to minimize code changes\n    const historyCanUndo = canUndo;\n    const historyCanRedo = canRedo;\n\n    // Monitor Online Status\n    useEffect(() => {\n        const handleStatusChange = () => setIsOffline(!navigator.onLine);\n        window.addEventListener('online', handleStatusChange);\n        window.addEventListener('offline', handleStatusChange);\n        return () => {\n            window.removeEventListener('online', handleStatusChange);\n            window.removeEventListener('offline', handleStatusChange);\n        };\n    }, []);\n\n    // Fetch data if needed\n    useEffect(() => {\n        const loadData = async () => {\n            if (initialPage) return; // Already have data from props\n\n            if (initialPage && (initialPage.id || initialPage.editor_type === 'visual')) return; // Already have data from props, possibly new Visual Blog\n            try {\n                let fetchedData = null;\n                // CHANGED: Added tenant isolation to queries\n                // If not platform admin, enforce tenant_id\n\n                const applyTenantFilter = (q) => {\n                    if (!isPlatformAdmin && currentTenant?.id) {\n                        return q.eq('tenant_id', currentTenant.id);\n                    }\n                    return q;\n                };\n\n                if (mode === 'template' && templateId) {\n                    let q = udm.from('templates').select('*').eq('id', templateId);\n                    q = applyTenantFilter(q);\n                    const { data: tpl, error } = await q.single();\n                    if (error) throw error;\n\n                    fetchedData = {\n                        id: tpl.id,\n                        ...tpl,\n                        content_draft: tpl.data || { content: [], root: { props: { title: tpl.name } } }\n                    };\n                    setPageMetadata({\n                        title: tpl.name,\n                        slug: tpl.slug,\n                        meta_description: tpl.description,\n                        category_id: tpl.category_id || null,\n                        status: tpl.is_active ? 'published' : 'draft',\n                        published_at: ''\n                    });\n\n                } else if (mode === 'part' && partId) {\n                    let q = udm.from('template_parts').select('*').eq('id', partId);\n                    q = applyTenantFilter(q);\n                    const { data: part, error } = await q.single();\n                    if (error) throw error;\n\n                    fetchedData = {\n                        id: part.id,\n                        ...part,\n                        content_draft: part.content || { content: [], root: { props: { title: part.name } } }\n                    };\n                    setPageMetadata({\n                        title: part.name,\n                        slug: part.type,\n                        meta_description: part.type,\n                        category_id: part.category_id || null,\n                        status: part.is_active ? 'published' : 'draft',\n                        published_at: ''\n                    });\n\n                } else if (mode === 'blog' && pageId) {\n                    let q = udm.from('blogs').select('*').eq('id', pageId);\n                    q = applyTenantFilter(q);\n                    const { data: art, error } = await q.single();\n                    if (error) throw error;\n                    fetchedData = {\n                        id: art.id,\n                        ...art,\n                        content_draft: typeof art.content === 'object' ? art.content : { content: [], root: { props: { title: art.title } } }\n                    };\n                    setPageMetadata({\n                        title: art.title,\n                        slug: art.slug,\n                        meta_description: art.meta_description,\n                        category_id: art.category_id || null,\n                        status: art.status,\n                        published_at: art.published_at ? new Date(art.published_at).toISOString().slice(0, 16) : ''\n                    });\n\n\n                } else if (mode === 'page' && pageId) {\n                    let q = udm.from('pages').select('*').eq('id', pageId);\n                    q = applyTenantFilter(q);\n                    const { data: pg, error } = await q.single();\n                    if (error) throw error;\n                    fetchedData = pg;\n                    setPageMetadata({\n                        title: pg.title,\n                        slug: pg.slug,\n                        meta_description: pg.meta_description,\n                        status: pg.status,\n\n                    });\n                }\n\n                if (fetchedData) {\n                    setPage(fetchedData);\n                    // For blogs, we might need to be careful if content is HTML string (legacy) vs JSON (visual)\n                    const initialContent = fetchedData.content_draft ||\n                        (typeof fetchedData.content === 'object' ? fetchedData.content : null) ||\n                        fetchedData.data ||\n                        { content: [], root: { props: { title: fetchedData.title || fetchedData.name } } };\n\n                    resetHistory(initialContent);\n                }\n            } catch (error) {\n                console.error(\"Error loading visual builder data:\", error);\n                toast({ title: \"Error\", description: error.message || \"Failed to load content, or access denied.\", variant: \"destructive\" });\n\n                if (error.code === 'PGRST116' || error.message?.includes('not found')) {\n                    setTimeout(() => handleClose(), 2000);\n                }\n            } finally {\n                // Done\n            }\n        };\n\n        // Only run if we have currentTenant (or are global/platform admin)\n        if (currentTenant?.id || isPlatformAdmin) {\n            loadData();\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [templateId, pageId, initialPage, mode, currentTenant?.id, isPlatformAdmin]);\n\n\n    const handleClose = () => {\n        if (onClose) onClose();\n        else navigate(-1); // Go back if no prop handler\n    };\n\n\n    // Apply template\n    const handleApplyTemplate = (templateData) => {\n        resetHistory(templateData);\n        setHasUnsavedChanges(true); // Template application counts as a change\n        setEditorKey(prev => prev + 1); // Force remount to show new template\n        toast({\n            title: 'Template applied',\n            description: 'The template has been applied.'\n        });\n    };\n\n    // Sanitize data (remove orphaned zones)\n    const cleanPuckData = useCallback((currentData) => {\n        if (!currentData || !currentData.zones) return currentData;\n        const validIds = new Set();\n        const collectIds = (items) => {\n            if (!items) return;\n            items.forEach(item => {\n                if (item.props && item.props.id) {\n                    validIds.add(item.props.id);\n                }\n            });\n        };\n        collectIds(currentData.content);\n        const reachableIds = new Set();\n        const traverse = (items) => {\n            if (!items) return;\n            items.forEach(item => {\n                if (item.props && item.props.id) {\n                    reachableIds.add(item.props.id);\n                    Object.keys(currentData.zones).forEach(zoneKey => {\n                        if (zoneKey.startsWith(`${item.props.id}:`)) {\n                            traverse(currentData.zones[zoneKey]);\n                        }\n                    });\n                }\n            });\n        };\n        traverse(currentData.content);\n        const newZones = {};\n        let hasChanges = false;\n        Object.keys(currentData.zones).forEach(zoneKey => {\n            const [componentId] = zoneKey.split(':');\n            if (reachableIds.has(componentId)) {\n                newZones[zoneKey] = currentData.zones[zoneKey];\n            } else {\n                hasChanges = true;\n            }\n        });\n        if (!hasChanges) return currentData;\n        return { ...currentData, zones: newZones };\n    }, []);\n\n    // Handle Puck data change\n    const handleChange = useCallback((newData) => {\n        const cleanedData = cleanPuckData(newData);\n        if (cleanedData) {\n            setData(cleanedData);\n            setHasUnsavedChanges(true);\n        } else {\n            console.error('handleChange received invalid data!', newData);\n        }\n    }, [setData, cleanPuckData]);\n\n    // Save Content Function\n    const saveContent = useCallback(async (contentData, isAutoSave = false) => {\n        if (mode === 'template' && !templateId) {\n            if (!isAutoSave) toast({ variant: 'destructive', title: 'Error', description: 'Template ID is missing. Cannot save.' });\n            return;\n        } else if (mode !== 'template' && (!page || !page.id)) {\n            if (!isAutoSave) toast({ variant: 'destructive', title: 'Error', description: 'Page data is missing. Cannot save.' });\n            return;\n        }\n\n        setIsSaving(true);\n        try {\n            let error = null;\n\n            const timestamp = new Date().toISOString();\n\n            // applyTenantFilter logic for update is handled by .eq('id', ...) RLS, \n            // but for offline safety we could check tenant match if we had full object. \n            // Assuming loaded 'page' object has tenant_id correct from loadData.\n\n            if (mode === 'template') {\n                console.log('Saving template:', templateId);\n                const { error: err } = await udm\n                    .from('templates')\n                    .update({\n                        data: contentData,\n                        updated_at: timestamp,\n                        name: pageMetadata.title,\n                        slug: pageMetadata.slug,\n                        description: pageMetadata.meta_description,\n                        category_id: pageMetadata.category_id,\n                        is_active: pageMetadata.status === 'published'\n                    })\n                    .eq('id', templateId);\n                error = err;\n            } else if (mode === 'part') {\n                console.log('Saving part:', partId);\n                const { error: err } = await udm\n                    .from('template_parts')\n                    .update({\n                        content: contentData,\n                        updated_at: timestamp,\n                        name: pageMetadata.title,\n                        type: pageMetadata.slug,\n                        category_id: pageMetadata.category_id,\n                        is_active: pageMetadata.status === 'published'\n                    })\n                    .eq('id', partId);\n                error = err;\n            } else if (mode === 'blog') {\n                console.log('Saving blog:', page?.id ? page.id : 'NEW');\n\n                const payload = {\n                    content: contentData,\n                    updated_at: timestamp,\n                    title: pageMetadata.title,\n                    slug: pageMetadata.slug,\n                    meta_description: pageMetadata.meta_description,\n                    category_id: pageMetadata.category_id,\n                    status: pageMetadata.status,\n                    published_at: pageMetadata.published_at || null,\n                    editor_type: 'visual',\n                    tenant_id: currentTenant?.id\n                };\n\n                if (page?.id) {\n                    const { error: err } = await udm\n                        .from('blogs')\n                        .update(payload)\n                        .eq('id', page.id);\n                    error = err;\n                } else {\n                    // Create new blog\n                    // If offline or just standard practice, we might want to generate ID, \n                    // but for now let's rely on UDM/Supabase to return the created record.\n                    const { data: newBlog, error: err } = await udm\n                        .from('blogs')\n                        .insert([payload])\n                        .select()\n                        .single();\n\n                    error = err;\n\n                    if (newBlog) {\n                        setPage(newBlog);\n                        // Update the URL without reloading? \n                        // Or just inform the user. Better to update state so subsequent saves are updates.\n                        // We also need to update the history object if necessary, but 'page' state is key.\n\n                        // NOTE: Changing URL search params in place is tricky without rerender, \n                        // but we can just update the internal 'page' state which the save logic uses.\n                    }\n                }\n            } else {\n                console.log('Saving page:', page.id);\n                const { error: err } = await udm\n                    .from('pages')\n                    .update({\n                        content_draft: contentData,\n                        updated_at: timestamp,\n                        title: pageMetadata.title,\n                        slug: pageMetadata.slug,\n                        meta_description: pageMetadata.meta_description,\n                        category_id: pageMetadata.category_id,\n                        status: pageMetadata.status,\n                        published_at: pageMetadata.published_at || null\n                    })\n                    .eq('id', page.id);\n                error = err;\n            }\n\n            if (error) throw error;\n\n            console.log(' Save successful');\n            setLastSavedAt(new Date());\n            setHasUnsavedChanges(false);\n\n            if (!isAutoSave) {\n                const entityName = mode === 'template' ? 'Template' : (mode === 'part' ? 'Part' : 'Page');\n                toast({\n                    title: isOffline ? 'Saved Offline' : 'Saved',\n                    description: isOffline ? `${entityName} saved to local device. Will sync when online.` : `${entityName} saved successfully.`\n                });\n            }\n        } catch (err) {\n            console.error('Save error:', err);\n            toast({ variant: 'destructive', title: 'Error', description: err.message || 'Failed to save changes.' });\n        } finally {\n            setIsSaving(false);\n        }\n    }, [mode, templateId, partId, page, toast, pageMetadata, isOffline, currentTenant?.id]);\n\n    // undo/redo wrappers\n    const handleUndo = useCallback(() => {\n        if (canUndo && historyCanUndo) {\n            undo();\n            setEditorKey(prev => prev + 1);\n        }\n    }, [canUndo, historyCanUndo, undo]);\n\n    const handleRedo = useCallback(() => {\n        if (canRedo && historyCanRedo) {\n            redo();\n            setEditorKey(prev => prev + 1);\n        }\n    }, [canRedo, historyCanRedo, redo]);\n\n    // Keyboard shortcuts for undo/redo\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n                e.preventDefault();\n                handleUndo();\n            }\n            if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {\n                e.preventDefault();\n                handleRedo();\n            }\n            if ((e.ctrlKey || e.metaKey) && e.key === 's') {\n                e.preventDefault();\n                if (dataRef.current) {\n                    saveContent(dataRef.current, false);\n                }\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [canUndo, canRedo, undo, redo, data, handleUndo, handleRedo, saveContent]);\n\n    // Handle manual save\n    const handleManualSave = async () => {\n        if (!canEdit) {\n            toast({ variant: 'destructive', title: 'Action Denied', description: 'You do not have permission to save changes.' });\n            return;\n        }\n        const currentData = dataRef.current;\n        if (!currentData) {\n            toast({ variant: 'destructive', title: 'Error', description: 'No content data available to save.' });\n            return;\n        }\n\n        await saveContent(currentData, false);\n    };\n\n    // Auto-save effect\n    useEffect(() => {\n        if (hasUnsavedChanges && !isSaving && canEdit) {\n            const timer = setTimeout(() => {\n                if (dataRef.current) {\n                    saveContent(dataRef.current, true);\n                }\n            }, 30000); // Auto-save every 30s\n            return () => clearTimeout(timer);\n        }\n    }, [hasUnsavedChanges, isSaving, data, canEdit, saveContent]);\n\n    // Publish page\n    const handlePublish = async () => {\n        if (!canPublish) {\n            toast({ variant: 'destructive', title: 'Action Denied', description: 'You do not have permission to publish pages.' });\n            return;\n        }\n        if (!page || !page.id) {\n            toast({ variant: 'destructive', title: 'Error', description: 'Page data is missing. Please reload the editor.' });\n            return;\n        }\n        setIsPublishing(true);\n        try {\n            await saveContent(data, false);\n\n            const { error } = await udm\n                .from('pages')\n                .update({\n                    status: 'published',\n                    content_published: data,\n                    published_at: new Date().toISOString()\n                })\n                .eq('id', page.id);\n\n            if (error) throw error;\n\n            setPageMetadata(prev => ({ ...prev, status: 'published' }));\n\n            toast({\n                title: isOffline ? \"Published Offline\" : \"Published Successfully\",\n                description: isOffline ? \"Changes saved locally. Status will update when online.\" : \"Your page is now live.\",\n            });\n        } catch (error) {\n            console.error('Error publishing page:', error);\n            toast({\n                title: \"Publish Failed\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        } finally {\n            setIsPublishing(false);\n        }\n    };\n\n    // Prepare config for Puck\n    const puckConfig = React.useMemo(() => ({\n        components: editorConfig.components,\n        categories: editorConfig.categories,\n        root: {\n            render: ({ children }) => {\n                return (\n                    <div className=\"min-h-screen bg-white\">\n                        {children}\n                    </div>\n                );\n            }\n        }\n    }), []);\n\n    // Viewport classes\n    const viewportClasses = {\n        desktop: 'w-full',\n        tablet: 'max-w-[768px] mx-auto',\n        mobile: 'max-w-[375px] mx-auto'\n    };\n\n    // Format time for Last Saved display\n    const formatTime = (date) => {\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    };\n\n    // Stable handler for metadata updates\n    const handleMetadataChange = useCallback((key, value) => {\n        setPageMetadata(prev => {\n            if (prev[key] === value) return prev;\n            // Deep check for objects if necessary, but here we deal with primitives\n            return { ...prev, [key]: value };\n        });\n    }, []);\n\n    const handleSlugChange = useCallback((newSlug) => {\n        handleMetadataChange('slug', newSlug);\n    }, [handleMetadataChange]);\n\n    // --- RENDER ---\n    return (\n        <div className=\"fixed inset-0 z-[100] flex flex-col bg-background\">\n            {/* Header / Toolbar */}\n            {/* Header / Toolbar */}\n            {/* Header / Toolbar */}\n            <header className=\"border-b bg-background/80 backdrop-blur-md supports-[backdrop-filter]:bg-background/60 h-16 flex items-center justify-between px-6 shrink-0 gap-6 z-50 shadow-sm transition-all duration-300\">\n                <div className=\"flex items-center gap-4\">\n                    <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => {\n                            if (hasUnsavedChanges) {\n                                if (window.confirm('You have unsaved changes. Are you sure you want to leave?')) {\n                                    handleClose();\n                                }\n                            } else {\n                                handleClose();\n                            }\n                        }}\n                        className=\"rounded-full hover:bg-slate-100/50\"\n                    >\n                        <ArrowLeft className=\"w-5 h-5 text-slate-700\" />\n                    </Button>\n                    <div className=\"flex flex-col\">\n                        <div className=\"flex items-center gap-2\">\n                            <h1 className=\"text-lg font-bold text-foreground tracking-tight leading-none bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent\">\n                                {pageMetadata.title || (mode === 'blog' ? 'Untitled Blog' : 'Untitled Page')}\n                            </h1>\n                            <span className={`px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider border ${pageMetadata.status === 'published'\n                                ? 'bg-emerald-50 text-emerald-600 border-emerald-100'\n                                : 'bg-amber-50 text-amber-600 border-amber-100'\n                                }`}>\n                                {pageMetadata.status}\n                            </span>\n                        </div>\n                        <span className=\"text-xs text-slate-400 font-medium tracking-wide font-mono\">/{pageMetadata.slug}</span>\n                    </div>\n                </div>\n\n                <div className=\"flex items-center gap-3\">\n                    {/* Offline Indicator */}\n                    {isOffline && (\n                        <div className=\"flex items-center gap-2 px-3 py-1 rounded-full bg-rose-50 text-rose-600 border border-rose-100 mr-2 shadow-sm animate-pulse\" title=\"You are offline. Changes will be saved locally.\">\n                            <WifiOff className=\"w-3.5 h-3.5\" />\n                            <span className=\"text-[10px] font-bold uppercase tracking-widest\">OFFLINE</span>\n                        </div>\n                    )}\n\n                    <div className=\"flex items-center gap-1 mr-2 p-1 bg-slate-100/50 rounded-lg border border-slate-200/60\">\n                        <Button variant=\"ghost\" size=\"icon\" onClick={handleUndo} disabled={!canUndo} className=\"h-7 w-7 rounded-md hover:bg-white hover:shadow-sm transition-all\">\n                            <Undo2 className=\"w-3.5 h-3.5 text-slate-600\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"icon\" onClick={handleRedo} disabled={!canRedo} className=\"h-7 w-7 rounded-md hover:bg-white hover:shadow-sm transition-all\">\n                            <Redo2 className=\"w-3.5 h-3.5 text-slate-600\" />\n                        </Button>\n                    </div>\n\n                    <div className=\"h-6 w-px bg-slate-200 mx-1\" />\n\n                    <div className=\"flex items-center gap-2\">\n                        <span className=\"text-xs text-slate-400 mr-2 flex items-center gap-1.5 font-medium\">\n                            {isSaving ? (\n                                <>\n                                    <Loader2 className=\"w-3 h-3 animate-spin text-indigo-500\" />\n                                    <span className=\"text-indigo-600\">Saving...</span>\n                                </>\n                            ) : hasUnsavedChanges ? (\n                                <span className=\"text-amber-500 flex items-center gap-1\">\n                                    <span className=\"w-1.5 h-1.5 rounded-full bg-amber-500 block\"></span>\n                                    Unsaved\n                                </span>\n                            ) : lastSavedAt ? (\n                                <span className=\"text-slate-400 flex items-center gap-1\">\n                                    <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-400 block\"></span>\n                                    Saved {formatTime(lastSavedAt)}\n                                </span>\n                            ) : 'Saved'}\n                        </span>\n\n                        <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setSettingsOpen(true)}\n                            className=\"h-9 px-4 border-slate-200 text-slate-600 hover:text-slate-900 hover:bg-slate-50 hover:border-slate-300 transition-all shadow-sm\"\n                        >\n                            <Settings className=\"w-3.5 h-3.5 mr-2\" />\n                            Settings\n                        </Button>\n\n                        <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setPreviewMode(!previewMode)}\n                            className={`h-9 px-4 border-slate-200 transition-all shadow-sm ${previewMode ? 'bg-indigo-50 text-indigo-600 border-indigo-200' : 'text-slate-600 hover:text-slate-900 hover:bg-slate-50'}`}\n                        >\n                            {previewMode ? <EyeOff className=\"w-3.5 h-3.5 mr-2\" /> : <Eye className=\"w-3.5 h-3.5 mr-2\" />}\n                            {previewMode ? 'Exit' : 'Preview'}\n                        </Button>\n\n                        <div className=\"flex items-center gap-1 ml-1\">\n                            <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={handleManualSave}\n                                disabled={isSaving || !canEdit}\n                                className=\"h-9 px-4 text-slate-600 hover:text-slate-900 hover:bg-slate-100 font-medium\"\n                            >\n                                <Save className=\"w-4 h-4 mr-2\" />\n                                Save\n                            </Button>\n                            <Button\n                                size=\"sm\"\n                                onClick={handlePublish}\n                                disabled={isPublishing || !canPublish}\n                                className=\"h-9 px-6 bg-gradient-to-r from-indigo-600 to-indigo-500 hover:from-indigo-700 hover:to-indigo-600 text-white shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5 active:translate-y-0\"\n                            >\n                                {isPublishing ? (\n                                    <>\n                                        <Loader2 className=\"w-3.5 h-3.5 mr-2 animate-spin\" />\n                                        Publishing...\n                                    </>\n                                ) : (\n                                    <>\n                                        <Upload className=\"w-3.5 h-3.5 mr-2\" />\n                                        Publish\n                                    </>\n                                )}\n                            </Button>\n                        </div>\n                    </div>\n                </div>\n            </header>\n\n            {/* Main Editor Area */}\n            <div className={`flex-1 overflow-hidden relative ${previewMode ? 'bg-background' : 'bg-muted/30'}`}>\n                {previewMode ? (\n                    <div className={`w-full h-full overflow-y-auto ${viewportClasses[viewport] || 'w-full'} transition-all mx-auto bg-white shadow-sm my-4 border min-h-screen`}>\n                        <div className=\"min-h-full\">\n                            <Render config={puckConfig} data={data} key={`render-${editorKey}`} />\n                        </div>\n                    </div>\n                ) : (\n                    <Puck\n                        key={`puck-${editorKey}`}\n                        config={puckConfig}\n                        data={data || { content: [], root: { props: { title: page?.title || '' } } }}\n                        onChange={handleChange}\n                        headerPath={page?.slug || '/'}\n                        overrides={{\n                            header: () => null, // Hide default header to avoid duplication\n                        }}\n                        viewports={[\n                            { width: 1280, height: 'auto', label: 'Desktop', icon: <Monitor />, id: 'desktop' },\n                            { width: 768, height: 'auto', label: 'Tablet', icon: <Tablet />, id: 'tablet' },\n                            { width: 375, height: 'auto', label: 'Mobile', icon: <Smartphone />, id: 'mobile' },\n                        ]}\n                    />\n                )}\n            </div>\n\n            <Dialog open={settingsOpen} onOpenChange={setSettingsOpen}>\n                <DialogContent className=\"sm:max-w-[500px] bg-background/95 backdrop-blur-xl border-border shadow-2xl\">\n                    <DialogHeader className=\"pb-4 border-b border-border\">\n                        <DialogTitle className=\"text-xl font-bold text-foreground tracking-tight\">\n                            {mode === 'blog' ? 'Blog Settings' : 'Page Settings'}\n                        </DialogTitle>\n                        <DialogDescription className=\"text-muted-foreground\">\n                            Configure {mode === 'blog' ? 'blog' : 'page'} properties, SEO metadata, and publication status.\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"grid gap-6 py-6\">\n                        <div className=\"space-y-4\">\n                            <h3 className=\"text-sm font-semibold text-foreground uppercase tracking-wider flex items-center gap-2\">\n                                <span className=\"w-1 h-4 bg-indigo-500 rounded-full\"></span>\n                                General Information\n                            </h3>\n                            <div className=\"grid gap-3\">\n                                <Label htmlFor=\"title\" className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n                                    {mode === 'blog' ? 'Blog Title' : 'Page Title'}\n                                </Label>\n                                <Input\n                                    id=\"title\"\n                                    value={pageMetadata.title}\n                                    onChange={(e) => handleMetadataChange('title', e.target.value)}\n                                    className=\"bg-muted/50 border-input focus:border-indigo-500 transition-colors\"\n                                    placeholder=\"e.g. Landing Page\"\n                                />\n                            </div>\n\n                            <div className=\"grid gap-3\">\n                                <Label className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider\">URL Slug</Label>\n                                <SlugGenerator\n                                    initialSlug={pageMetadata.slug}\n                                    titleValue={pageMetadata.title}\n                                    tableName=\"pages\"\n                                    recordId={page?.id}\n                                    tenantId={currentTenant?.id}\n                                    onSlugChange={handleSlugChange}\n                                />\n                            </div>\n\n                            <div className=\"grid gap-3\">\n                                <Label className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">Category</Label>\n                                <ResourceSelect\n                                    table=\"categories\"\n                                    value={pageMetadata.category_id}\n                                    onChange={(val) => handleMetadataChange('category_id', val)}\n                                    labelKey=\"name\"\n                                    valueKey=\"id\"\n                                    filter={{ type: mode === 'blog' ? 'blog' : 'page' }}\n                                    placeholder=\"No Category\"\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"space-y-4\">\n                            <h3 className=\"text-sm font-semibold text-foreground uppercase tracking-wider flex items-center gap-2\">\n                                <span className=\"w-1 h-4 bg-purple-500 rounded-full\"></span>\n                                SEO & Metadata\n                            </h3>\n                            <div className=\"grid gap-3\">\n                                <Label htmlFor=\"meta_description\" className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">Description</Label>\n                                <Textarea\n                                    id=\"meta_description\"\n                                    value={pageMetadata.meta_description}\n                                    onChange={(e) => handleMetadataChange('meta_description', e.target.value)}\n                                    placeholder=\"Brief description for search engines and social media...\"\n                                    className=\"bg-muted/50 border-input focus:border-purple-500 transition-colors resize-none min-h-[80px]\"\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"space-y-4\">\n                            <h3 className=\"text-sm font-semibold text-foreground uppercase tracking-wider flex items-center gap-2\">\n                                <span className=\"w-1 h-4 bg-emerald-500 rounded-full\"></span>\n                                Publication\n                            </h3>\n                            <div className=\"flex items-center justify-between rounded-xl border border-border p-4 bg-muted/30 hover:bg-muted/50 transition-colors\">\n                                <div className=\"space-y-1\">\n                                    <Label className=\"text-base font-semibold text-foreground\">Publish Status</Label>\n                                    <p className=\"text-xs text-muted-foreground font-medium\">\n                                        {pageMetadata.status === 'published'\n                                            ? `${mode === 'blog' ? 'Blog' : 'Page'} is live and visible to visitors.`\n                                            : `${mode === 'blog' ? 'Blog' : 'Page'} is hidden and only visible to editors.`}\n                                    </p>\n                                </div>\n                                <div className=\"flex items-center gap-3\">\n                                    <span className={`px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-widest border ${pageMetadata.status === 'published'\n                                        ? 'bg-emerald-100 text-emerald-700 border-emerald-200'\n                                        : 'bg-amber-100 text-amber-700 border-amber-200'\n                                        }`}>\n                                        {pageMetadata.status === 'published' ? 'Live' : 'Draft'}\n                                    </span>\n                                    <Switch\n                                        checked={pageMetadata.status === 'published'}\n                                        onCheckedChange={(checked) => setPageMetadata({ ...pageMetadata, status: checked ? 'published' : 'draft' })}\n                                    />\n                                </div>\n                            </div>\n\n                            <div className=\"grid gap-3\">\n                                <Label htmlFor=\"published_at\" className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">Publish Date</Label>\n                                <Input\n                                    type=\"datetime-local\"\n                                    id=\"published_at\"\n                                    value={pageMetadata.published_at || ''}\n                                    onChange={(e) => setPageMetadata({ ...pageMetadata, published_at: e.target.value })}\n                                    className=\"bg-muted/50 border-input focus:border-emerald-500 transition-colors\"\n                                />\n                            </div>\n                        </div>\n                    </div>\n                    <DialogFooter className=\"border-t border-border pt-4\">\n                        <Button variant=\"ghost\" onClick={() => setSettingsOpen(false)} className=\"hover:bg-muted text-muted-foreground\">Cancel</Button>\n                        <Button onClick={() => {\n                            setHasUnsavedChanges(true);\n                            setSettingsOpen(false);\n                            toast({ title: \"Settings Updated\", description: \"Don't forget to save your changes to apply them.\" });\n                        }} className=\"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm\">\n                            Apply Changes\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            <TemplateSelector\n                open={templateSelectorOpen}\n                onOpenChange={setTemplateSelectorOpen}\n                onSelect={handleApplyTemplate}\n            />\n        </div >\n    );\n};\n\nexport default VisualPageBuilder;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/AccordionBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":24,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":24,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { ChevronDown } from 'lucide-react';\nimport { ColorPickerField } from '../fields/ColorPickerField';\nimport { sanitizeHTML } from '@/utils/sanitize';\n\nexport const AccordionBlock = ({ items = [] }) => {\n    return (\n        <div className=\"max-w-3xl mx-auto space-y-4\">\n            {items.map((item, index) => (\n                <details key={index} className=\"group bg-white rounded-lg border border-slate-200 open:ring-1 open:ring-blue-100 overflow-hidden\">\n                    <summary className=\"flex items-center justify-between p-4 cursor-pointer select-none font-medium list-none group-open:bg-slate-50 transition-colors\" style={{ color: item.titleColor || '#0f172a' }}>\n                        <span>{item.title}</span>\n                        <ChevronDown className=\"w-5 h-5 text-slate-400 transform group-open:rotate-180 transition-transform\" />\n                    </summary>\n                    <div className=\"p-4 pt-0 leading-relaxed border-t border-transparent group-open:border-slate-100 bg-slate-50/50\" style={{ color: item.contentColor || '#475569' }}>\n                        <div className=\"mt-4\" dangerouslySetInnerHTML={sanitizeHTML(item.content)} />\n                    </div>\n                </details>\n            ))}\n        </div>\n    );\n};\n\nexport const AccordionBlockFields = {\n    items: {\n        type: 'array',\n        getItemSummary: (item) => item.title || 'Accordion Item',\n        arrayFields: {\n            title: { type: 'text', label: 'Question / Title' },\n            titleColor: { type: 'custom', label: 'Title Color', render: ColorPickerField },\n            content: { type: 'textarea', label: 'Answer / Content' },\n            contentColor: { type: 'custom', label: 'Content Color', render: ColorPickerField }\n        },\n        defaultItemProps: {\n            title: 'New Question',\n            content: 'Enter the answer here...'\n        }\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/ButtonBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[78,89],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":9,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":9,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Button Block Component\n * CTA button with styling variants\n */\n\nimport React from 'react';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nexport const ButtonBlockFields = {\n    text: { type: 'text', label: 'Button Text' },\n    textColor: { type: 'custom', label: 'Text Color (overrides variant)', render: ColorPickerField },\n    backgroundColor: { type: 'custom', label: 'Background Color (overrides variant)', render: ColorPickerField },\n    link: { type: 'text', label: 'Link URL' },\n    variant: {\n        type: 'select',\n        label: 'Style',\n        options: [\n            { label: 'Primary (Blue)', value: 'primary' },\n            { label: 'Secondary (Gray)', value: 'secondary' },\n            { label: 'Outline', value: 'outline' },\n            { label: 'Ghost', value: 'ghost' }\n        ]\n    },\n    size: {\n        type: 'select',\n        label: 'Size',\n        options: [\n            { label: 'Small', value: 'small' },\n            { label: 'Medium', value: 'medium' },\n            { label: 'Large', value: 'large' }\n        ]\n    },\n    alignment: {\n        type: 'select',\n        label: 'Alignment',\n        options: [\n            { label: 'Left', value: 'left' },\n            { label: 'Center', value: 'center' },\n            { label: 'Right', value: 'right' }\n        ]\n    }\n};\n\nexport const ButtonBlock = ({ text, textColor, backgroundColor, link, variant, size, alignment }) => {\n    const variantClasses = {\n        primary: 'bg-blue-600 hover:bg-blue-700 text-white',\n        secondary: 'bg-slate-600 hover:bg-slate-700 text-white',\n        outline: 'border-2 border-blue-600 text-blue-600 hover:bg-blue-50',\n        ghost: 'text-blue-600 hover:bg-blue-50'\n    };\n\n    const sizeClasses = {\n        small: 'px-4 py-2 text-sm',\n        medium: 'px-6 py-3 text-base',\n        large: 'px-8 py-4 text-lg'\n    };\n\n    const alignmentClasses = {\n        left: 'justify-start',\n        center: 'justify-center',\n        right: 'justify-end'\n    };\n\n    const customStyles = {};\n    if (textColor) customStyles.color = textColor;\n    if (backgroundColor) customStyles.backgroundColor = backgroundColor;\n\n    return (\n        <div className={`flex ${alignmentClasses[alignment]} py-4`}>\n            <a\n                href={link || '#'}\n                className={`inline-block font-medium rounded-lg transition-colors ${variantClasses[variant]} ${sizeClasses[size]}`}\n                style={customStyles}\n            >\n                {text}\n            </a>\n        </div>\n    );\n};\n\nexport default ButtonBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/CardBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[91,102],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":9,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":9,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card Block Component\n * Content card with image, title, and description\n */\n\nimport React from 'react';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nexport const CardBlockFields = {\n    title: { type: 'text', label: 'Title' },\n    titleColor: { type: 'custom', label: 'Title Color', render: ColorPickerField },\n    description: { type: 'textarea', label: 'Description' },\n    descriptionColor: { type: 'custom', label: 'Description Color', render: ColorPickerField },\n    image: { type: 'text', label: 'Image URL' },\n    link: { type: 'text', label: 'Link URL' },\n    variant: {\n        type: 'select',\n        label: 'Style',\n        options: [\n            { label: 'Default', value: 'default' },\n            { label: 'Bordered', value: 'bordered' },\n            { label: 'Shadow', value: 'shadow' }\n        ]\n    }\n};\n\nexport const CardBlock = ({ title, titleColor, description, descriptionColor, image, link, variant }) => {\n    const variantClasses = {\n        default: 'bg-white',\n        bordered: 'bg-white border border-slate-200',\n        shadow: 'bg-white shadow-lg'\n    };\n\n    const content = (\n        <div className={`rounded-xl overflow-hidden ${variantClasses[variant]}`}>\n            {image && (\n                <div className=\"aspect-video overflow-hidden\">\n                    <img\n                        src={image}\n                        alt={title}\n                        className=\"w-full h-full object-cover\"\n                    />\n                </div>\n            )}\n            <div className=\"p-6\">\n                <h3 className=\"text-xl font-bold mb-2\" style={{ color: titleColor || '#1e293b' }}>{title}</h3>\n                <p style={{ color: descriptionColor || '#64748b' }}>{description}</p>\n            </div>\n        </div>\n    );\n\n    if (link) {\n        return (\n            <a href={link} className=\"block hover:opacity-90 transition-opacity\">\n                {content}\n            </a>\n        );\n    }\n\n    return content;\n};\n\nexport default CardBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/ContactFormBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[95,101],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":10,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":10,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'recipientEmail' is defined but never used.","line":63,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"recipientEmail"},"fix":{"range":[1790,1810],"text":""},"desc":"Remove unused variable 'recipientEmail'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Contact Form Block Component\n * Basic contact form with configurable fields\n */\n\nimport React, { useState } from 'react';\nimport { Send, Loader2, CheckCircle } from 'lucide-react';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nexport const ContactFormBlockFields = {\n    title: { type: 'text', label: 'Form Title' },\n    titleColor: { type: 'custom', label: 'Title Color', render: ColorPickerField },\n    subtitle: { type: 'text', label: 'Subtitle' },\n    subtitleColor: { type: 'custom', label: 'Subtitle Color', render: ColorPickerField },\n    showName: {\n        type: 'radio',\n        label: 'Show Name Field',\n        options: [\n            { label: 'Yes', value: true },\n            { label: 'No', value: false }\n        ]\n    },\n    showPhone: {\n        type: 'radio',\n        label: 'Show Phone Field',\n        options: [\n            { label: 'Yes', value: true },\n            { label: 'No', value: false }\n        ]\n    },\n    showSubject: {\n        type: 'radio',\n        label: 'Show Subject Field',\n        options: [\n            { label: 'Yes', value: true },\n            { label: 'No', value: false }\n        ]\n    },\n    buttonText: { type: 'text', label: 'Submit Button Text' },\n    successMessage: { type: 'text', label: 'Success Message' },\n    recipientEmail: { type: 'text', label: 'Recipient Email (for reference)' },\n    variant: {\n        type: 'select',\n        label: 'Style',\n        options: [\n            { label: 'Default', value: 'default' },\n            { label: 'Card', value: 'card' },\n            { label: 'Minimal', value: 'minimal' }\n        ]\n    }\n};\n\nexport const ContactFormBlock = ({\n    title,\n    titleColor,\n    subtitle,\n    subtitleColor,\n    showName,\n    showPhone,\n    showSubject,\n    buttonText,\n    successMessage,\n    recipientEmail,\n    variant\n}) => {\n    const [formData, setFormData] = useState({\n        name: '',\n        email: '',\n        phone: '',\n        subject: '',\n        message: ''\n    });\n    const [isSubmitting, setIsSubmitting] = useState(false);\n    const [isSubmitted, setIsSubmitted] = useState(false);\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        setIsSubmitting(true);\n\n        // Simulate form submission\n        await new Promise(resolve => setTimeout(resolve, 1500));\n\n        setIsSubmitting(false);\n        setIsSubmitted(true);\n\n        // Reset after showing success\n        setTimeout(() => {\n            setIsSubmitted(false);\n            setFormData({ name: '', email: '', phone: '', subject: '', message: '' });\n        }, 3000);\n    };\n\n    const handleChange = (e) => {\n        setFormData(prev => ({\n            ...prev,\n            [e.target.name]: e.target.value\n        }));\n    };\n\n    const containerClasses = {\n        default: 'py-8',\n        card: 'bg-white rounded-xl shadow-lg p-8 border border-slate-100',\n        minimal: 'py-4'\n    };\n\n    const inputClasses = \"w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\";\n\n    if (isSubmitted) {\n        return (\n            <div className={`${containerClasses[variant]} text-center`}>\n                <CheckCircle className=\"w-16 h-16 text-green-500 mx-auto mb-4\" />\n                <h3 className=\"text-xl font-bold text-slate-800 mb-2\">Thank You!</h3>\n                <p className=\"text-slate-600\">{successMessage || 'Your message has been sent successfully.'}</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className={containerClasses[variant]}>\n            {(title || subtitle) && (\n                <div className=\"text-center mb-8\">\n                    {title && <h2 className=\"text-2xl font-bold mb-2\" style={{ color: titleColor || '#1e293b' }}>{title}</h2>}\n                    {subtitle && <p style={{ color: subtitleColor || '#64748b' }}>{subtitle}</p>}\n                </div>\n            )}\n\n            <form onSubmit={handleSubmit} className=\"space-y-4 max-w-xl mx-auto\">\n                {showName && (\n                    <div>\n                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Name</label>\n                        <input\n                            type=\"text\"\n                            name=\"name\"\n                            value={formData.name}\n                            onChange={handleChange}\n                            className={inputClasses}\n                            placeholder=\"Your name\"\n                            required\n                        />\n                    </div>\n                )}\n\n                <div>\n                    <label className=\"block text-sm font-medium text-slate-700 mb-1\">Email</label>\n                    <input\n                        type=\"email\"\n                        name=\"email\"\n                        value={formData.email}\n                        onChange={handleChange}\n                        className={inputClasses}\n                        placeholder=\"your@email.com\"\n                        required\n                    />\n                </div>\n\n                {showPhone && (\n                    <div>\n                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Phone</label>\n                        <input\n                            type=\"tel\"\n                            name=\"phone\"\n                            value={formData.phone}\n                            onChange={handleChange}\n                            className={inputClasses}\n                            placeholder=\"Your phone number\"\n                        />\n                    </div>\n                )}\n\n                {showSubject && (\n                    <div>\n                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Subject</label>\n                        <input\n                            type=\"text\"\n                            name=\"subject\"\n                            value={formData.subject}\n                            onChange={handleChange}\n                            className={inputClasses}\n                            placeholder=\"What is this about?\"\n                        />\n                    </div>\n                )}\n\n                <div>\n                    <label className=\"block text-sm font-medium text-slate-700 mb-1\">Message</label>\n                    <textarea\n                        name=\"message\"\n                        value={formData.message}\n                        onChange={handleChange}\n                        className={`${inputClasses} min-h-[120px] resize-y`}\n                        placeholder=\"Your message...\"\n                        required\n                    />\n                </div>\n\n                <button\n                    type=\"submit\"\n                    disabled={isSubmitting}\n                    className=\"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\n                >\n                    {isSubmitting ? (\n                        <>\n                            <Loader2 className=\"w-5 h-5 animate-spin\" />\n                            Sending...\n                        </>\n                    ) : (\n                        <>\n                            <Send className=\"w-5 h-5\" />\n                            {buttonText || 'Send Message'}\n                        </>\n                    )}\n                </button>\n            </form>\n        </div>\n    );\n};\n\nexport default ContactFormBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/DividerBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":35,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":35,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nexport const DividerBlock = ({\n    color = '#e2e8f0',\n    height = '1px',\n    width = '100%',\n    alignment = 'center',\n    style = 'solid',\n    marginTop = '24px',\n    marginBottom = '24px'\n}) => {\n    const wrapperStyle = {\n        display: 'flex',\n        justifyContent: alignment === 'left' ? 'flex-start' : alignment === 'right' ? 'flex-end' : 'center',\n        paddingTop: marginTop,\n        paddingBottom: marginBottom\n    };\n\n    const lineStyle = {\n        width,\n        height: 0,\n        borderTopWidth: height,\n        borderTopStyle: style,\n        borderTopColor: color\n    };\n\n    return (\n        <div style={wrapperStyle}>\n            <div style={lineStyle} />\n        </div>\n    );\n};\n\nexport const DividerBlockFields = {\n    color: { type: 'custom', label: 'Color', render: ColorPickerField },\n    height: {\n        type: 'select',\n        label: 'Thickness',\n        options: [\n            { label: 'Thin (1px)', value: '1px' },\n            { label: 'Medium (2px)', value: '2px' },\n            { label: 'Thick (4px)', value: '4px' }\n        ]\n    },\n    width: {\n        type: 'select',\n        label: 'Width',\n        options: [\n            { label: 'Full (100%)', value: '100%' },\n            { label: 'Large (75%)', value: '75%' },\n            { label: 'Medium (50%)', value: '50%' },\n            { label: 'Small (25%)', value: '25%' }\n        ]\n    },\n    alignment: {\n        type: 'radio',\n        label: 'Alignment',\n        options: [\n            { label: 'Left', value: 'left' },\n            { label: 'Center', value: 'center' },\n            { label: 'Right', value: 'right' }\n        ]\n    },\n    style: {\n        type: 'select',\n        label: 'Style',\n        options: [\n            { label: 'Solid', value: 'solid' },\n            { label: 'Dashed', value: 'dashed' },\n            { label: 'Dotted', value: 'dotted' }\n        ]\n    },\n    marginTop: {\n        type: 'select',\n        label: 'Margin Top',\n        options: [\n            { label: 'None', value: '0px' },\n            { label: 'Small', value: '16px' },\n            { label: 'Medium', value: '24px' },\n            { label: 'Large', value: '48px' }\n        ]\n    },\n    marginBottom: {\n        type: 'select',\n        label: 'Margin Bottom',\n        options: [\n            { label: 'None', value: '0px' },\n            { label: 'Small', value: '16px' },\n            { label: 'Medium', value: '24px' },\n            { label: 'Large', value: '48px' }\n        ]\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/FeatureBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[93,104],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":23,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":23,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Feature Block Component\n * Feature item with icon, title, and description\n */\n\nimport React from 'react';\nimport { Star, Zap, Shield, Heart, Award, Target, Users, Globe, Rocket, Check } from 'lucide-react';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nconst iconMap = {\n    star: Star,\n    zap: Zap,\n    shield: Shield,\n    heart: Heart,\n    award: Award,\n    target: Target,\n    users: Users,\n    globe: Globe,\n    rocket: Rocket,\n    check: Check\n};\n\nexport const FeatureBlockFields = {\n    icon: {\n        type: 'select',\n        label: 'Icon',\n        options: [\n            { label: 'Star', value: 'star' },\n            { label: 'Lightning', value: 'zap' },\n            { label: 'Shield', value: 'shield' },\n            { label: 'Heart', value: 'heart' },\n            { label: 'Award', value: 'award' },\n            { label: 'Target', value: 'target' },\n            { label: 'Users', value: 'users' },\n            { label: 'Globe', value: 'globe' },\n            { label: 'Rocket', value: 'rocket' },\n            { label: 'Check', value: 'check' }\n        ]\n    },\n    title: { type: 'text', label: 'Title' },\n    description: { type: 'textarea', label: 'Description' },\n    iconColor: { type: 'custom', label: 'Icon Color', render: ColorPickerField }\n};\n\nexport const FeatureBlock = ({ icon, title, description, iconColor }) => {\n    const IconComponent = iconMap[icon] || Star;\n\n    return (\n        <div className=\"flex flex-col items-center text-center p-6\">\n            <div\n                className=\"w-16 h-16 rounded-full flex items-center justify-center mb-4\"\n                style={{ backgroundColor: `${iconColor}20` }}\n            >\n                <IconComponent\n                    className=\"w-8 h-8\"\n                    style={{ color: iconColor }}\n                />\n            </div>\n            <h3 className=\"text-xl font-bold text-slate-800 mb-2\">{title}</h3>\n            <p className=\"text-slate-600\">{description}</p>\n        </div>\n    );\n};\n\nexport default FeatureBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/GalleryBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[85,91],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":9,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":9,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Gallery Block Component\n * Image gallery with grid layout options\n */\n\nimport React, { useState } from 'react';\nimport { X, ChevronLeft, ChevronRight } from 'lucide-react';\n\nexport const GalleryBlockFields = {\n    images: {\n        type: 'textarea',\n        label: 'Image URLs (one per line)',\n        description: 'Enter one image URL per line'\n    },\n    columns: {\n        type: 'select',\n        label: 'Columns',\n        options: [\n            { label: '2 Columns', value: 2 },\n            { label: '3 Columns', value: 3 },\n            { label: '4 Columns', value: 4 },\n            { label: '5 Columns', value: 5 }\n        ]\n    },\n    gap: {\n        type: 'select',\n        label: 'Gap',\n        options: [\n            { label: 'None', value: 0 },\n            { label: 'Small', value: 8 },\n            { label: 'Medium', value: 16 },\n            { label: 'Large', value: 24 }\n        ]\n    },\n    aspectRatio: {\n        type: 'select',\n        label: 'Aspect Ratio',\n        options: [\n            { label: 'Square (1:1)', value: 'square' },\n            { label: 'Landscape (16:9)', value: 'landscape' },\n            { label: 'Portrait (3:4)', value: 'portrait' },\n            { label: 'Auto', value: 'auto' }\n        ]\n    },\n    lightbox: {\n        type: 'radio',\n        label: 'Enable Lightbox',\n        options: [\n            { label: 'Yes', value: true },\n            { label: 'No', value: false }\n        ]\n    },\n    borderRadius: {\n        type: 'select',\n        label: 'Border Radius',\n        options: [\n            { label: 'None', value: 'none' },\n            { label: 'Small', value: 'sm' },\n            { label: 'Medium', value: 'md' },\n            { label: 'Large', value: 'lg' }\n        ]\n    }\n};\n\nexport const GalleryBlock = ({ images, columns, gap, aspectRatio, lightbox, borderRadius }) => {\n    const [lightboxOpen, setLightboxOpen] = useState(false);\n    const [currentIndex, setCurrentIndex] = useState(0);\n\n    // Parse images from textarea (one URL per line)\n    const imageList = images\n        ? images.split('\\n').map(url => url.trim()).filter(url => url.length > 0)\n        : [];\n\n    const aspectRatioClasses = {\n        square: 'aspect-square',\n        landscape: 'aspect-video',\n        portrait: 'aspect-[3/4]',\n        auto: ''\n    };\n\n    const radiusClasses = {\n        none: 'rounded-none',\n        sm: 'rounded-sm',\n        md: 'rounded-md',\n        lg: 'rounded-lg'\n    };\n\n    const columnClasses = {\n        2: 'grid-cols-2',\n        3: 'grid-cols-2 md:grid-cols-3',\n        4: 'grid-cols-2 md:grid-cols-3 lg:grid-cols-4',\n        5: 'grid-cols-2 md:grid-cols-3 lg:grid-cols-5'\n    };\n\n    const handleImageClick = (index) => {\n        if (lightbox) {\n            setCurrentIndex(index);\n            setLightboxOpen(true);\n        }\n    };\n\n    const handlePrev = () => {\n        setCurrentIndex((prev) => (prev === 0 ? imageList.length - 1 : prev - 1));\n    };\n\n    const handleNext = () => {\n        setCurrentIndex((prev) => (prev === imageList.length - 1 ? 0 : prev + 1));\n    };\n\n    if (imageList.length === 0) {\n        return (\n            <div className=\"flex items-center justify-center h-48 bg-slate-100 rounded-lg border-2 border-dashed border-slate-300\">\n                <p className=\"text-slate-400\">No images added. Enter image URLs in the settings.</p>\n            </div>\n        );\n    }\n\n    return (\n        <>\n            <div\n                className={`grid ${columnClasses[columns]} py-4`}\n                style={{ gap: `${gap}px` }}\n            >\n                {imageList.map((src, index) => (\n                    <div\n                        key={index}\n                        className={`${aspectRatioClasses[aspectRatio]} overflow-hidden ${radiusClasses[borderRadius]} ${lightbox ? 'cursor-pointer hover:opacity-90 transition-opacity' : ''}`}\n                        onClick={() => handleImageClick(index)}\n                    >\n                        <img\n                            src={src}\n                            alt={`Slide ${index + 1}`}\n                            className=\"w-full h-full object-cover\"\n                        />\n                    </div>\n                ))}\n            </div>\n\n            {/* Lightbox */}\n            {lightbox && lightboxOpen && (\n                <div className=\"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4\">\n                    <button\n                        onClick={() => setLightboxOpen(false)}\n                        className=\"absolute top-4 right-4 text-white hover:text-slate-300 transition-colors\"\n                    >\n                        <X className=\"w-8 h-8\" />\n                    </button>\n\n                    <button\n                        onClick={handlePrev}\n                        className=\"absolute left-4 text-white hover:text-slate-300 transition-colors\"\n                    >\n                        <ChevronLeft className=\"w-10 h-10\" />\n                    </button>\n\n                    <img\n                        src={imageList[currentIndex]}\n                        alt={`Slide ${currentIndex + 1}`}\n                        className=\"max-w-full max-h-[80vh] object-contain\"\n                    />\n\n                    <button\n                        onClick={handleNext}\n                        className=\"absolute right-4 text-white hover:text-slate-300 transition-colors\"\n                    >\n                        <ChevronRight className=\"w-10 h-10\" />\n                    </button>\n\n                    <div className=\"absolute bottom-4 text-white text-sm\">\n                        {currentIndex + 1} / {imageList.length}\n                    </div>\n                </div>\n            )}\n        </>\n    );\n};\n\nexport default GalleryBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/GridBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[73,84],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":9,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":9,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Grid Block Component\n * Multi-column layout container\n */\n\nimport React from 'react';\nimport { DropZone } from '@puckeditor/core';\n\nexport const GridBlockFields = {\n    columns: {\n        type: 'select',\n        label: 'Columns',\n        options: [\n            { label: '2 Columns', value: 2 },\n            { label: '3 Columns', value: 3 },\n            { label: '4 Columns', value: 4 }\n        ]\n    },\n    gap: {\n        type: 'select',\n        label: 'Gap',\n        options: [\n            { label: 'None', value: 0 },\n            { label: 'Small (16px)', value: 16 },\n            { label: 'Medium (24px)', value: 24 },\n            { label: 'Large (32px)', value: 32 }\n        ]\n    }\n};\n\n// Fix syntax error and ensure proper export\nexport const GridBlock = ({ columns = 2, gap = 0, padding = 0, id }) => {\n    if (!id) return null;\n\n    return (\n        <div\n            className=\"grid w-full\"\n            style={{\n                gridTemplateColumns: `repeat(${columns}, 1fr)`,\n                paddingTop: padding + 'px',\n                paddingBottom: padding + 'px',\n                gap: gap + 'px'\n            }}\n        >\n            {Array.from({ length: columns }).map((_, index) => (\n                <div key={`${id}-col-${index}`} className=\"min-h-[50px] border border-dashed border-gray-200 rounded p-2\">\n                    <DropZone zone={`column-${index}`} />\n                </div>\n            ))}\n        </div>\n    );\n};\n\nexport default GridBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/HeroBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[105,116],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":9,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":9,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Hero Block Component\n * Full-width hero section with background image, title, and CTA\n */\n\nimport React from 'react';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nexport const HeroBlockFields = {\n    title: { type: 'text', label: 'Title' },\n    titleColor: { type: 'custom', label: 'Title Color', render: ColorPickerField },\n    subtitle: { type: 'textarea', label: 'Subtitle' },\n    subtitleColor: { type: 'custom', label: 'Subtitle Color', render: ColorPickerField },\n    backgroundImage: { type: 'text', label: 'Background Image URL' },\n    buttonText: { type: 'text', label: 'Button Text' },\n    buttonLink: { type: 'text', label: 'Button Link' },\n    alignment: {\n        type: 'select',\n        label: 'Text Alignment',\n        options: [\n            { label: 'Left', value: 'left' },\n            { label: 'Center', value: 'center' },\n            { label: 'Right', value: 'right' }\n        ]\n    },\n    overlay: {\n        type: 'radio', label: 'Dark Overlay', options: [\n            { label: 'Yes', value: true },\n            { label: 'No', value: false }\n        ]\n    },\n    height: {\n        type: 'select',\n        label: 'Height',\n        options: [\n            { label: 'Small (300px)', value: 'small' },\n            { label: 'Medium (450px)', value: 'medium' },\n            { label: 'Large (600px)', value: 'large' },\n            { label: 'Full Screen', value: 'full' }\n        ]\n    }\n};\n\nexport const HeroBlock = ({ title, titleColor, subtitle, subtitleColor, backgroundImage, buttonText, buttonLink, alignment, overlay, height }) => {\n    const heightClasses = {\n        small: 'min-h-[300px]',\n        medium: 'min-h-[450px]',\n        large: 'min-h-[600px]',\n        full: 'min-h-screen'\n    };\n\n    const alignmentClasses = {\n        left: 'text-left items-start',\n        center: 'text-center items-center',\n        right: 'text-right items-end'\n    };\n\n    return (\n        <div\n            className={`relative flex flex-col justify-center ${heightClasses[height]} ${alignmentClasses[alignment]} px-8 py-16`}\n            style={{\n                backgroundImage: backgroundImage ? `url(${backgroundImage})` : undefined,\n                backgroundSize: 'cover',\n                backgroundPosition: 'center',\n                backgroundColor: backgroundImage ? undefined : '#1e293b'\n            }}\n        >\n            {overlay && backgroundImage && (\n                <div className=\"absolute inset-0 bg-black/50\" />\n            )}\n\n            <div className=\"relative z-10 max-w-4xl mx-auto\">\n                <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold mb-4\" style={{ color: titleColor || '#ffffff' }}>\n                    {title}\n                </h1>\n\n                {subtitle && (\n                    <p className=\"text-lg md:text-xl mb-8 max-w-2xl\" style={{ color: subtitleColor || 'rgba(255,255,255,0.9)' }}>\n                        {subtitle}\n                    </p>\n                )}\n\n                {buttonText && (\n                    <a\n                        href={buttonLink || '#'}\n                        className=\"inline-block px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors\"\n                    >\n                        {buttonText}\n                    </a>\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default HeroBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/ImageBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[83,94],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":8,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":8,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Image Block Component\n * Image with caption and styling options\n */\n\nimport React from 'react';\n\nexport const ImageBlockFields = {\n    src: { type: 'text', label: 'Image URL' },\n    alt: { type: 'text', label: 'Alt Text' },\n    caption: { type: 'text', label: 'Caption' },\n    width: {\n        type: 'select',\n        label: 'Width',\n        options: [\n            { label: 'Full Width', value: 'full' },\n            { label: 'Large (75%)', value: 'large' },\n            { label: 'Medium (50%)', value: 'medium' },\n            { label: 'Small (25%)', value: 'small' }\n        ]\n    },\n    borderRadius: {\n        type: 'select',\n        label: 'Border Radius',\n        options: [\n            { label: 'None', value: 'none' },\n            { label: 'Small', value: 'sm' },\n            { label: 'Medium', value: 'md' },\n            { label: 'Large', value: 'lg' },\n            { label: 'Full', value: 'full' }\n        ]\n    }\n};\n\nexport const ImageBlock = ({ src, alt, caption, width, borderRadius }) => {\n    const widthClasses = {\n        full: 'w-full',\n        large: 'w-3/4',\n        medium: 'w-1/2',\n        small: 'w-1/4'\n    };\n\n    const radiusClasses = {\n        none: 'rounded-none',\n        sm: 'rounded-sm',\n        md: 'rounded-md',\n        lg: 'rounded-lg',\n        full: 'rounded-full'\n    };\n\n    if (!src) {\n        return (\n            <div className=\"flex items-center justify-center h-48 bg-slate-100 rounded-lg border-2 border-dashed border-slate-300\">\n                <p className=\"text-slate-400\">No image selected</p>\n            </div>\n        );\n    }\n\n    return (\n        <figure className={`${widthClasses[width]} mx-auto py-4`}>\n            <img\n                src={src}\n                alt={alt || ''}\n                className={`w-full h-auto ${radiusClasses[borderRadius]}`}\n                loading=\"lazy\"\n            />\n            {caption && (\n                <figcaption className=\"text-sm text-slate-500 text-center mt-2\">\n                    {caption}\n                </figcaption>\n            )}\n        </figure>\n    );\n};\n\nexport default ImageBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/LatestBlogsBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'count' is assigned a value but never used.","line":11,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":10,"suggestions":[{"messageId":"removeVar","data":{"varName":"count"},"fix":{"range":[436,446],"text":""},"desc":"Remove unused variable 'count'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'categoryFilter' is defined but never used.","line":15,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"categoryFilter"},"fix":{"range":[509,529],"text":""},"desc":"Remove unused variable 'categoryFilter'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'titleColor' is defined but never used.","line":16,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"titleColor"},"fix":{"range":[529,545],"text":""},"desc":"Remove unused variable 'titleColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'descriptionColor' is defined but never used.","line":17,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"descriptionColor"},"fix":{"range":[545,567],"text":""},"desc":"Remove unused variable 'descriptionColor'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":136,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":136,"endColumn":36},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":171,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":171,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Calendar, ArrowRight, Image as ImageIcon } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { format } from 'date-fns';\nimport { Link } from 'react-router-dom';\nimport { SelectField } from '../fields/SelectField';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nexport const LatestBlogsBlock = ({\n    count = 3,\n    layout = 'grid',\n    showImage = true,\n    showDate = true,\n    categoryFilter,\n    titleColor,\n    descriptionColor,\n    blogs = [] // blogs are now passed as a prop\n}) => {\n    // No internal state for blogs, loading, or error as data is resolved externally\n\n    // The loading and error states are now handled by the system that calls resolveLatestBlogsData\n    // and passes the 'blogs' prop. If 'blogs' is empty, it means no blogs were found or an error occurred.\n\n    if (blogs.length === 0) {\n        return (\n            <div className=\"text-center p-8 bg-slate-50 text-slate-500 rounded-lg border border-dashed border-slate-300\">\n                No blogs found.\n            </div>\n        );\n    }\n\n    // Grid Layout\n    if (layout === 'grid') {\n        return (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                {blogs.map(blog => (\n                    <div key={blog.id} className=\"group bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 flex flex-col h-full border border-slate-100\">\n                        {showImage && (\n                            <div className=\"aspect-video w-full overflow-hidden bg-slate-100 relative\">\n                                {blog.featured_image ? (\n                                    <img\n                                        src={blog.featured_image}\n                                        alt={blog.title}\n                                        className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\n                                    />\n                                ) : (\n                                    <div className=\"w-full h-full flex items-center justify-center text-slate-300\">\n                                        <ImageIcon className=\"w-10 h-10\" />\n                                    </div>\n                                )}\n                                <div className=\"absolute top-4 left-4\">\n                                    <span className=\"bg-white/90 backdrop-blur px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-full shadow-sm text-slate-800\">\n                                        {blog.main_category?.title || 'Blog'}\n                                    </span>\n                                </div>\n                            </div>\n                        )}\n                        <div className=\"p-6 flex flex-col flex-1\">\n                            {showDate && blog.published_at && (\n                                <div className=\"flex items-center gap-2 text-xs text-slate-500 mb-3\">\n                                    <Calendar className=\"w-3 h-3\" />\n                                    {format(new Date(blog.published_at), 'MMMM dd, yyyy')}\n                                </div>\n                            )}\n                            <h3 className=\"text-xl font-bold text-slate-900 mb-3 group-hover:text-blue-600 transition-colors line-clamp-2\">\n                                <Link to={`/blog/${blog.slug}`}>{blog.title}</Link>\n                            </h3>\n                            <p className=\"text-slate-600 text-sm mb-6 line-clamp-3\">\n                                {blog.summary || blog.meta_description}\n                            </p>\n                            <div className=\"mt-auto\">\n                                <Button variant=\"link\" className=\"p-0 h-auto font-semibold text-blue-600 hover:text-blue-700 hover:no-underline group/btn\">\n                                    Read More\n                                    <ArrowRight className=\"w-4 h-4 ml-1 group-hover/btn:translate-x-1 transition-transform\" />\n                                </Button>\n                            </div>\n                        </div>\n                    </div>\n                ))}\n            </div>\n        );\n    }\n\n    // List Layout\n    return (\n        <div className=\"space-y-6 max-w-4xl mx-auto\">\n            {blogs.map(blog => (\n                <div key={blog.id} className=\"group flex flex-col md:flex-row gap-6 bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow border border-slate-100\">\n                    {showImage && (\n                        <div className=\"w-full md:w-48 aspect-video md:aspect-square shrink-0 rounded-lg overflow-hidden bg-slate-100\">\n                            {blog.featured_image ? (\n                                <img\n                                    src={blog.featured_image}\n                                    alt={blog.title}\n                                    className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\n                                />\n                            ) : (\n                                <div className=\"w-full h-full flex items-center justify-center text-slate-300\">\n                                    <ImageIcon className=\"w-8 h-8\" />\n                                </div>\n                            )}\n                        </div>\n                    )}\n                    <div className=\"flex-1 py-1\">\n                        <div className=\"flex items-center gap-3 mb-2\">\n                            <span className=\"text-xs font-bold text-blue-600 uppercase tracking-wider\">\n                                {blog.main_category?.title || 'Blog'}\n                            </span>\n                            {showDate && blog.published_at && (\n                                <>\n                                    <span className=\"w-1 h-1 rounded-full bg-slate-300\"></span>\n                                    <span className=\"text-xs text-slate-500 flex items-center gap-1\">\n                                        <Calendar className=\"w-3 h-3\" />\n                                        {format(new Date(blog.published_at), 'MMMM dd, yyyy')}\n                                    </span>\n                                </>\n                            )}\n                        </div>\n                        <h3 className=\"text-xl font-bold text-slate-900 mb-2 group-hover:text-blue-600 transition-colors\">\n                            <Link to={`/blog/${blog.slug}`}>{blog.title}</Link>\n                        </h3>\n                        <p className=\"text-slate-600 text-sm mb-4 line-clamp-2\">\n                            {blog.summary || blog.meta_description}\n                        </p>\n                        <Button variant=\"link\" className=\"p-0 h-auto font-semibold text-blue-600 hover:text-blue-700 hover:no-underline flex items-center gap-1\">\n                            Read Blog <ArrowRight className=\"w-4 h-4\" />\n                        </Button>\n                    </div>\n                </div>\n            ))}\n        </div>\n    );\n};\n\nexport const resolveLatestBlogsData = async ({ props }) => {\n    const { count = 3, categoryFilter } = props;\n    try {\n        let query = supabase\n            .from('blogs')\n            .select('*, categories(title, slug)')\n            .eq('status', 'published')\n            .order('published_at', { ascending: false })\n            .limit(count);\n\n        if (categoryFilter) {\n            query = query.eq('category_id', categoryFilter);\n        }\n\n        const { data, error } = await query;\n\n        if (error) throw error;\n\n        const blogs = data ? data.map(blog => ({\n            ...blog,\n            main_category: blog.categories\n        })) : [];\n\n        return {\n            props: {\n                ...props,\n                blogs\n            }\n        };\n    } catch (err) {\n        console.error('Error resolving blogs data:', err);\n        return { props: { ...props, blogs: [] } };\n    }\n};\n\nexport const LatestBlogsBlockFields = {\n    count: {\n        type: 'select',\n        label: 'Number of Blogs',\n        options: [\n            { label: '3', value: 3 },\n            { label: '6', value: 6 },\n            { label: '9', value: 9 },\n            { label: '12', value: 12 }\n        ]\n    },\n    layout: {\n        type: 'radio',\n        label: 'Layout',\n        options: [\n            { label: 'Grid', value: 'grid' },\n            { label: 'List', value: 'list' }\n        ]\n    },\n    showImage: {\n        type: 'radio',\n        label: 'Show Featured Image',\n        options: [{ label: 'Yes', value: true }, { label: 'No', value: false }]\n    },\n    showDate: {\n        type: 'radio',\n        label: 'Show Date',\n        options: [{ label: 'Yes', value: true }, { label: 'No', value: false }]\n    },\n    categoryFilter: {\n        type: 'custom',\n        label: 'Filter by Category',\n        fetchConfig: {\n            table: 'categories',\n            labelField: 'title',\n            valueField: 'id'\n        },\n        render: SelectField\n    },\n    titleColor: { type: 'custom', label: 'Title Color', render: ColorPickerField },\n    descriptionColor: { type: 'custom', label: 'Description Color', render: ColorPickerField }\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/NavigationBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[139,145],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":13,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":13,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'linkColor' is defined but never used.","line":67,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":67,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"linkColor"},"fix":{"range":[1923,1938],"text":""},"desc":"Remove unused variable 'linkColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'hoverColor' is defined but never used.","line":68,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":68,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"hoverColor"},"fix":{"range":[1938,1954],"text":""},"desc":"Remove unused variable 'hoverColor'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * NavigationBlock - Dynamic menu component for visual page builder\n * Fetches and displays public menus from the database\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { ChevronDown, Menu as MenuIcon } from 'lucide-react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\n// Field definitions for the Puck editor\nexport const NavigationBlockFields = {\n    style: {\n        type: 'select',\n        label: 'Style',\n        options: [\n            { label: 'Horizontal', value: 'horizontal' },\n            { label: 'Vertical', value: 'vertical' }\n        ]\n    },\n    alignment: {\n        type: 'select',\n        label: 'Alignment',\n        options: [\n            { label: 'Left', value: 'left' },\n            { label: 'Center', value: 'center' },\n            { label: 'Right', value: 'right' }\n        ]\n    },\n    showDropdowns: {\n        type: 'radio',\n        label: 'Show Dropdowns',\n        options: [\n            { label: 'Yes', value: true },\n            { label: 'No', value: false }\n        ]\n    },\n    fontSize: {\n        type: 'select',\n        label: 'Font Size',\n        options: [\n            { label: 'Small', value: 'sm' },\n            { label: 'Medium', value: 'base' },\n            { label: 'Large', value: 'lg' }\n        ]\n    },\n    gap: {\n        type: 'select',\n        label: 'Item Spacing',\n        options: [\n            { label: 'Tight', value: 4 },\n            { label: 'Normal', value: 8 },\n            { label: 'Loose', value: 16 }\n        ]\n    },\n    linkColor: { type: 'custom', label: 'Link Color', render: ColorPickerField },\n    hoverColor: { type: 'custom', label: 'Hover Color', render: ColorPickerField }\n};\n\nexport const NavigationBlock = ({\n    style = 'horizontal',\n    alignment = 'left',\n    showDropdowns = true,\n    fontSize = 'base',\n    gap = 8,\n    linkColor,\n    hoverColor\n}) => {\n    const [menus, setMenus] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [openDropdown, setOpenDropdown] = useState(null);\n\n    useEffect(() => {\n        fetchMenus();\n    }, []);\n\n    const fetchMenus = async () => {\n        try {\n            const { data, error } = await supabase\n                .from('menus')\n                .select('*')\n                .eq('is_active', true)\n                .eq('is_public', true)\n                .is('deleted_at', null)\n                .order('order', { ascending: true });\n\n            if (error) throw error;\n\n            if (data) {\n                // Build tree structure\n                const menuMap = {};\n                data.forEach(m => menuMap[m.id] = { ...m, children: [] });\n\n                const rootMenus = [];\n                data.forEach(m => {\n                    if (m.parent_id && menuMap[m.parent_id]) {\n                        menuMap[m.parent_id].children.push(menuMap[m.id]);\n                    } else {\n                        rootMenus.push(menuMap[m.id]);\n                    }\n                });\n\n                // Sort children\n                rootMenus.forEach(r => r.children.sort((a, b) => a.order - b.order));\n                setMenus(rootMenus);\n            }\n        } catch (err) {\n            console.error('Error fetching navigation menus:', err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const alignmentClass = {\n        left: 'justify-start',\n        center: 'justify-center',\n        right: 'justify-end'\n    };\n\n    const fontSizeClass = {\n        sm: 'text-sm',\n        base: 'text-base',\n        lg: 'text-lg'\n    };\n\n    if (loading) {\n        return (\n            <nav className=\"py-4\">\n                <div className={`flex ${alignmentClass[alignment]} gap-${gap}`}>\n                    <div className=\"h-4 w-20 bg-slate-200 rounded animate-pulse\"></div>\n                    <div className=\"h-4 w-16 bg-slate-200 rounded animate-pulse\"></div>\n                    <div className=\"h-4 w-24 bg-slate-200 rounded animate-pulse\"></div>\n                </div>\n            </nav>\n        );\n    }\n\n    if (menus.length === 0) {\n        return (\n            <nav className=\"py-4 text-center text-slate-400 text-sm\">\n                <MenuIcon className=\"w-5 h-5 mx-auto mb-1 opacity-50\" />\n                No menu items available\n            </nav>\n        );\n    }\n\n    // Vertical layout\n    if (style === 'vertical') {\n        return (\n            <nav className=\"py-4\">\n                <ul className={`flex flex-col ${fontSizeClass[fontSize]}`} style={{ gap: `${gap}px` }}>\n                    {menus.map(menu => (\n                        <li key={menu.id}>\n                            <Link\n                                to={menu.url}\n                                className=\"block px-3 py-2 rounded-lg text-slate-700 hover:text-blue-600 hover:bg-blue-50 transition-colors font-medium\"\n                            >\n                                {menu.label}\n                            </Link>\n                            {showDropdowns && menu.children && menu.children.length > 0 && (\n                                <ul className=\"pl-4 mt-1 space-y-1 border-l-2 border-slate-100 ml-3\">\n                                    {menu.children.map(child => (\n                                        <li key={child.id}>\n                                            <Link\n                                                to={child.url}\n                                                className=\"block px-3 py-1.5 text-slate-500 hover:text-blue-600 transition-colors\"\n                                            >\n                                                {child.label}\n                                            </Link>\n                                        </li>\n                                    ))}\n                                </ul>\n                            )}\n                        </li>\n                    ))}\n                </ul>\n            </nav>\n        );\n    }\n\n    // Horizontal layout (default)\n    return (\n        <nav className=\"py-4\">\n            <ul className={`flex flex-wrap ${alignmentClass[alignment]} ${fontSizeClass[fontSize]}`} style={{ gap: `${gap * 2}px` }}>\n                {menus.map(menu => {\n                    const hasChildren = menu.children && menu.children.length > 0;\n\n                    return (\n                        <li key={menu.id} className=\"relative group\">\n                            {hasChildren && showDropdowns ? (\n                                <>\n                                    <button\n                                        className=\"flex items-center gap-1 px-3 py-2 rounded-lg text-slate-700 hover:text-blue-600 hover:bg-blue-50 transition-colors font-medium\"\n                                        onMouseEnter={() => setOpenDropdown(menu.id)}\n                                        onMouseLeave={() => setOpenDropdown(null)}\n                                    >\n                                        {menu.label}\n                                        <ChevronDown className=\"w-3.5 h-3.5 opacity-70\" />\n                                    </button>\n                                    <div\n                                        className={`absolute top-full left-0 mt-1 w-48 bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden z-50 transition-all duration-200 ${openDropdown === menu.id ? 'opacity-100 visible translate-y-0' : 'opacity-0 invisible translate-y-2'\n                                            }`}\n                                        onMouseEnter={() => setOpenDropdown(menu.id)}\n                                        onMouseLeave={() => setOpenDropdown(null)}\n                                    >\n                                        <div className=\"p-1\">\n                                            {menu.children.map(child => (\n                                                <Link\n                                                    key={child.id}\n                                                    to={child.url}\n                                                    className=\"block px-3 py-2 text-sm text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\n                                                >\n                                                    {child.label}\n                                                </Link>\n                                            ))}\n                                        </div>\n                                    </div>\n                                </>\n                            ) : (\n                                <Link\n                                    to={menu.url}\n                                    className=\"block px-3 py-2 rounded-lg text-slate-700 hover:text-blue-600 hover:bg-blue-50 transition-colors font-medium\"\n                                >\n                                    {menu.label}\n                                </Link>\n                            )}\n                        </li>\n                    );\n                })}\n            </ul>\n        </nav>\n    );\n};\n\nexport default NavigationBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/PricingBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":50,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":50,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Check } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nexport const PricingBlock = ({ items = [] }) => {\n    return (\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto\">\n            {items.map((item, index) => (\n                <div\n                    key={index}\n                    className={`relative p-8 rounded-2xl flex flex-col ${item.isPopular ? 'bg-slate-900 text-white shadow-xl ring-2 ring-blue-500 scale-105' : 'bg-white text-slate-900 shadow-lg border border-slate-100'}`}\n                >\n                    {item.isPopular && (\n                        <span className=\"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium\">\n                            Most Popular\n                        </span>\n                    )}\n\n                    <div className=\"mb-8\">\n                        <h3 className={`text-lg font-semibold mb-2`} style={{ color: item.titleColor || (item.isPopular ? '#60a5fa' : '#64748b') }}>{item.title}</h3>\n                        <div className=\"flex items-baseline gap-1\">\n                            <span className=\"text-4xl font-bold\" style={{ color: item.priceColor || (item.isPopular ? '#ffffff' : '#0f172a') }}>{item.price}</span>\n                            <span className={`text-sm ${item.isPopular ? 'text-slate-400' : 'text-slate-500'}`}>{item.period}</span>\n                        </div>\n                        <p className={`mt-4 text-sm`} style={{ color: item.descriptionColor || (item.isPopular ? '#cbd5e1' : '#475569') }}>{item.description}</p>\n                    </div>\n\n                    <ul className=\"space-y-4 mb-8 flex-1\">\n                        {item.features?.map((feature, i) => (\n                            <li key={i} className=\"flex items-start gap-3\">\n                                <Check className={`w-5 h-5 shrink-0 ${item.isPopular ? 'text-blue-400' : 'text-blue-600'}`} />\n                                <span className={`text-sm ${item.isPopular ? 'text-slate-300' : 'text-slate-600'}`}>{feature.text}</span>\n                            </li>\n                        ))}\n                    </ul>\n\n                    <Button\n                        className={`w-full ${item.isPopular ? 'bg-blue-500 hover:bg-blue-600' : 'bg-slate-900 hover:bg-slate-800 text-white'}`}\n                        variant={item.isPopular ? 'default' : 'outline'}\n                    >\n                        {item.buttonText}\n                    </Button>\n                </div>\n            ))}\n        </div>\n    );\n};\n\nexport const PricingBlockFields = {\n    items: {\n        type: 'array',\n        getItemSummary: (item) => item.title || 'Pricing Plan',\n        arrayFields: {\n            title: { type: 'text', label: 'Plan Title' },\n            price: { type: 'text', label: 'Price (e.g. $29)' },\n            period: { type: 'text', label: 'Period (e.g. /month)' },\n            description: { type: 'textarea', label: 'Description' },\n            isPopular: {\n                type: 'radio',\n                label: 'Is Popular?',\n                options: [{ label: 'Yes', value: true }, { label: 'No', value: false }]\n            },\n            buttonText: { type: 'text', label: 'Button Text' },\n            titleColor: { type: 'custom', label: 'Title Color', render: ColorPickerField },\n            priceColor: { type: 'custom', label: 'Price Color', render: ColorPickerField },\n            descriptionColor: { type: 'custom', label: 'Description Color', render: ColorPickerField },\n            features: {\n                type: 'array',\n                getItemSummary: (item) => item.text || 'Feature',\n                arrayFields: {\n                    text: { type: 'text', label: 'Feature Text' }\n                },\n                defaultItemProps: { text: 'New feature' }\n            }\n        },\n        defaultItemProps: {\n            title: 'Basic',\n            price: '$0',\n            period: '/mo',\n            description: 'For getting started',\n            buttonText: 'Get Started',\n            features: [{ text: 'Core features' }, { text: 'Community support' }]\n        }\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/PromotionBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[108,114],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":15,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":15,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Promotion Block Component\n * Displays a selected promotion/ad from the Promotions module\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Loader2, AlertCircle, ExternalLink } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { motion } from 'framer-motion';\nimport { SelectField } from '../fields/SelectField';\nimport { sanitizeHTML } from '@/utils/sanitize';\n\nexport const PromotionBlockFields = {\n    promotionId: {\n        type: 'custom',\n        label: 'Select Promotion',\n        render: SelectField,\n        fetchConfig: {\n            table: 'promotions',\n            labelField: 'title',\n            valueField: 'id',\n            filter: { status: 'active' } // Optional: only show active ones\n        }\n    },\n    variant: {\n        type: 'select',\n        label: 'Style',\n        options: [\n            { label: 'Banner (Full Width)', value: 'banner' },\n            { label: 'Card (Compact)', value: 'card' },\n            { label: 'Hero Style', value: 'hero' }\n        ]\n    },\n    showImage: {\n        type: 'radio',\n        label: 'Show Image',\n        options: [\n            { label: 'Yes', value: true },\n            { label: 'No', value: false }\n        ]\n    }\n};\n\nexport const PromotionBlock = ({ promotionId, variant = 'banner', showImage = true }) => {\n    const [promotion, setPromotion] = useState(null);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState(null);\n    const [isOpen, setIsOpen] = useState(false);\n\n    useEffect(() => {\n        const fetchPromotion = async () => {\n            if (!promotionId) return;\n            setLoading(true);\n            setError(null);\n            try {\n                const { data, error } = await supabase\n                    .from('promotions')\n                    .select('*')\n                    .eq('id', promotionId)\n                    .maybeSingle();\n\n                if (error) throw error;\n                if (!data) throw new Error('Promotion not found');\n\n                // Check status\n                if (data.status !== 'active') {\n                    // We might still show it in editor but warn? \n                    // For now, let's show it with a warning opacity\n                }\n\n                setPromotion(data);\n            } catch (err) {\n                console.error('Error fetching promotion:', err);\n                setError(err.message);\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchPromotion();\n    }, [promotionId]);\n\n    if (!promotionId) {\n        return (\n            <div className=\"p-4 border border-dashed border-slate-300 rounded bg-slate-50 text-slate-500 text-center text-sm\">\n                Please enter a Promotion ID to display an ad.\n            </div>\n        );\n    }\n\n    if (loading) {\n        return (\n            <div className=\"p-8 flex justify-center items-center bg-slate-50 rounded\">\n                <Loader2 className=\"w-6 h-6 animate-spin text-slate-400\" />\n            </div>\n        );\n    }\n\n    if (error || !promotion) {\n        return (\n            <div className=\"p-4 border border-red-200 bg-red-50 text-red-600 rounded flex items-center gap-2 text-sm\">\n                <AlertCircle className=\"w-4 h-4\" />\n                {error || 'Promotion not found'}\n            </div>\n        );\n    }\n\n    // Render based on variant\n    const isInactive = promotion.status !== 'active';\n\n    const Container = ({ children, className = \"\" }) => (\n        <div className={`relative ${className} ${isInactive ? 'opacity-60 grayscale' : ''}`}>\n            {isInactive && (\n                <div className=\"absolute top-2 right-2 bg-amber-500 text-white text-xs px-2 py-0.5 rounded shadow z-10\">\n                    Inactive\n                </div>\n            )}\n            {children}\n        </div>\n    );\n\n    const CTA = () => (\n        promotion.link ? (\n            <Button asChild size={variant === 'card' ? 'sm' : 'default'} className=\"mt-4 bg-blue-600 hover:bg-blue-700\">\n                <a href={promotion.link} target={promotion.target || '_self'} rel=\"noopener noreferrer\">\n                    {promotion.cta_text || 'Learn More'}\n                    {promotion.target === '_blank' && <ExternalLink className=\"w-3 h-3 ml-2\" />}\n                </a>\n            </Button>\n        ) : null\n    );\n\n\n    if (variant === 'popup') {\n        // For popup, we show a button to trigger it? Or does it auto-trigger in preview?\n        // In editor, it should probably just show a placeholder or a \"Show Popup\" button.\n        // In real view, it might auto-trigger.\n        // Let's make it a \"Modal\" mode where it renders the content inside a Dialog.\n        // Effectively, if you place this block, it acts as a popup provider.\n        // But for Puck editor visualization, we might want to just show \"Popup Active: [Title]\"\n\n        // Let's implement a \"preview\" mode for the editor\n\n        // Auto-open in preview mode or real site? \n        // For now, let's just show a button \"Open [Title]\" in the block flow\n\n        return (\n            <div className=\"p-4 border border-blue-200 bg-blue-50 rounded text-center\">\n                <p className=\"text-sm text-blue-800 font-medium mb-2\">Popup Promotion Active: {promotion.title}</p>\n                <Button variant=\"outline\" size=\"sm\" onClick={() => setIsOpen(true)}>Preview Popup</Button>\n\n                <Dialog open={isOpen} onOpenChange={setIsOpen}>\n                    <DialogContent className=\"sm:max-w-md\">\n                        <DialogHeader>\n                            <DialogTitle>{promotion.title}</DialogTitle>\n                            {/* DialogDescription is required for accessibility if we have title */}\n                            <DialogDescription>\n                                Special offer details below.\n                            </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"flex flex-col items-center\">\n                            {showImage && promotion.featured_image && (\n                                <img\n                                    src={promotion.featured_image}\n                                    alt={promotion.title}\n                                    className=\"w-full h-48 object-cover rounded-md mb-4\"\n                                />\n                            )}\n                            <div className=\"text-center mb-4 prose prose-sm\" dangerouslySetInnerHTML={sanitizeHTML(promotion.description || '')} />\n                            <CTA />\n                            {promotion.code && (\n                                <div className=\"mt-4 bg-slate-100 px-3 py-1 rounded text-sm text-slate-700\">\n                                    Code: <span className=\"font-mono font-bold\">{promotion.code}</span>\n                                </div>\n                            )}\n                        </div>\n                    </DialogContent>\n                </Dialog>\n            </div>\n        );\n    }\n\n    if (variant === 'card') {\n        return (\n            <motion.div\n                whileHover={{ y: -5, transition: { duration: 0.2 } }}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.4 }}\n            >\n                <Container className=\"border border-slate-200 rounded-xl overflow-hidden bg-white shadow-sm hover:shadow-xl transition-shadow duration-300 h-full flex flex-col\">\n                    {showImage && promotion.featured_image && (\n                        <img\n                            src={promotion.featured_image}\n                            alt={promotion.title}\n                            className=\"w-full h-48 object-cover\"\n                        />\n                    )}\n                    <div className=\"p-5\">\n                        <h3 className=\"font-bold text-lg text-slate-900 mb-2\">{promotion.title}</h3>\n                        <div className=\"text-sm text-slate-600 line-clamp-3 prose prose-sm mb-4\" dangerouslySetInnerHTML={sanitizeHTML(promotion.description || '')} />\n                        <CTA />\n                        {promotion.code && (\n                            <div className=\"mt-4 pt-4 border-t border-slate-100 flex justify-between items-center text-xs\">\n                                <span className=\"text-slate-500\">Promo Code:</span>\n                                <code className=\"bg-slate-100 px-2 py-1 rounded text-slate-700 font-mono font-bold select-all\">{promotion.code}</code>\n                            </div>\n                        )}\n                    </div>\n                </Container>\n            </motion.div>\n        );\n    }\n\n    if (variant === 'hero') {\n        return (\n            <motion.div\n                initial={{ opacity: 0, scale: 0.95 }}\n                animate={{ opacity: 1, scale: 1 }}\n                transition={{ duration: 0.5 }}\n            >\n                <Container className=\"relative rounded-2xl overflow-hidden bg-slate-900 text-white min-h-[400px] flex items-center shadow-2xl\">\n                    {showImage && promotion.featured_image && (\n                        <div className=\"absolute inset-0 z-0\">\n                            <img\n                                src={promotion.featured_image}\n                                alt={promotion.title}\n                                className=\"w-full h-full object-cover opacity-60\"\n                            />\n                            <div className=\"absolute inset-0 bg-gradient-to-r from-black/80 via-black/40 to-transparent\"></div>\n                        </div>\n                    )}\n                    <div className=\"relative z-10 p-8 md:p-12 max-w-2xl\">\n                        {promotion.discount_percentage > 0 && (\n                            <span className=\"inline-block bg-white/20 backdrop-blur text-white px-3 py-1 rounded-full text-sm font-medium mb-4\">\n                                Save {promotion.discount_percentage}%\n                            </span>\n                        )}\n                        <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">{promotion.title}</h2>\n                        <div className=\"text-lg text-slate-200 mb-6 max-w-lg\" dangerouslySetInnerHTML={sanitizeHTML(promotion.description || '')} />\n                        <div className=\"flex gap-4 items-center\">\n                            <CTA />\n                            {promotion.code && (\n                                <div className=\"flex flex-col bg-white/10 backdrop-blur px-4 py-1.5 rounded-lg border border-white/20\">\n                                    <span className=\"text-[10px] text-white/70 uppercase tracking-widest\">Code</span>\n                                    <span className=\"font-mono font-bold text-lg tracking-wide\">{promotion.code}</span>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                </Container>\n            </motion.div>\n        );\n    }\n\n    // Default Banner\n    return (\n        <motion.div\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ duration: 0.5 }}\n        >\n            <Container className=\"bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl p-8 text-white flex flex-col md:flex-row items-center gap-8 shadow-lg hover:shadow-2xl transition-all duration-300\">\n                {showImage && promotion.featured_image && (\n                    <div className=\"w-full md:w-1/3 shrink-0\">\n                        <img\n                            src={promotion.featured_image}\n                            alt={promotion.title}\n                            className=\"w-full h-48 object-cover rounded-lg shadow-lg\"\n                        />\n                    </div>\n                )}\n                <div className=\"flex-1 text-center md:text-left\">\n                    <h3 className=\"text-2xl font-bold mb-2\">{promotion.title}</h3>\n                    <div className=\"text-blue-100 mb-4 prose-invert\" dangerouslySetInnerHTML={sanitizeHTML(promotion.description || '')} />\n                    <div className=\"flex flex-col md:flex-row items-center gap-4\">\n                        <CTA />\n                        {promotion.code && (\n                            <div className=\"text-sm\">\n                                Use Code: <span className=\"bg-white/20 px-2 py-1 rounded font-mono font-bold ml-1\">{promotion.code}</span>\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </Container>\n        </motion.div>\n    );\n};\n\nexport default PromotionBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/SectionBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'children' is defined but never used.","line":7,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"children"},"fix":{"range":[222,231],"text":""},"desc":"Remove unused variable 'children'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":8,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[230,238],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":56,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":56,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { DropZone } from '@puckeditor/core';\nimport { ImageField } from '../fields/ImageField';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nexport const SectionBlock = ({\n    children,\n    id, // Add id prop\n    backgroundColor = '#ffffff',\n    backgroundImage,\n    paddingTop = '64px',\n    paddingBottom = '64px',\n    containerWidth = '1200px',\n    textColor = 'inherit'\n}) => {\n    const style = {\n        backgroundColor,\n        backgroundImage: backgroundImage ? `url(${backgroundImage})` : 'none',\n        backgroundSize: 'cover',\n        backgroundPosition: 'center',\n        paddingTop,\n        paddingBottom,\n        color: textColor\n    };\n\n    const containerStyle = {\n        maxWidth: containerWidth === 'full' ? '100%' : containerWidth,\n        margin: '0 auto',\n        padding: '0 16px'\n    };\n\n    // Simplified Zone ID - Let Puck handle the namespacing\n    // Puck v0.20+ automatically prefixes zones with the component ID\n    const zoneName = 'content';\n\n    return (\n        <section style={style} className=\"relative group\">\n            {backgroundImage && (\n                <div className=\"absolute inset-0 bg-black/10 pointer-events-none\" />\n            )}\n            <div\n                style={{\n                    ...containerStyle,\n                    minHeight: '100px', // Ensure there's always height\n                }}\n                className=\"p-4\"\n            >\n                <div style={{ height: '100%', width: '100%' }}>\n                    <DropZone zone={zoneName} />\n                </div>\n            </div>\n        </section>\n    );\n};\n\nexport const SectionBlockFields = {\n    backgroundColor: { type: 'custom', label: 'Background Color', render: ColorPickerField },\n    textColor: { type: 'custom', label: 'Text Color', render: ColorPickerField },\n    backgroundImage: {\n        type: 'custom',\n        label: 'Background Image',\n        render: ImageField\n    },\n    paddingTop: {\n        type: 'select',\n        label: 'Top Padding',\n        options: [\n            { label: 'None (0px)', value: '0px' },\n            { label: 'Small (32px)', value: '32px' },\n            { label: 'Medium (64px)', value: '64px' },\n            { label: 'Large (96px)', value: '96px' },\n            { label: 'Huge (128px)', value: '128px' }\n        ]\n    },\n    paddingBottom: {\n        type: 'select',\n        label: 'Bottom Padding',\n        options: [\n            { label: 'None (0px)', value: '0px' },\n            { label: 'Small (32px)', value: '32px' },\n            { label: 'Medium (64px)', value: '64px' },\n            { label: 'Large (96px)', value: '96px' },\n            { label: 'Huge (128px)', value: '128px' }\n        ]\n    },\n    containerWidth: {\n        type: 'select',\n        label: 'Width',\n        options: [\n            { label: 'Boxed (1200px)', value: '1200px' },\n            { label: 'Narrow (800px)', value: '800px' },\n            { label: 'Full Width', value: 'full' }\n        ]\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/SpacerBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[84,95],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":8,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":8,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Spacer Block Component\n * Adds vertical space between components\n */\n\nimport React from 'react';\n\nexport const SpacerBlockFields = {\n    height: {\n        type: 'number',\n        label: 'Height (px)',\n        min: 0,\n        max: 300\n    }\n};\n\nexport const SpacerBlock = ({ height }) => {\n    return (\n        <div style={{ height: `${height}px` }} className=\"w-full\" />\n    );\n};\n\nexport default SpacerBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/StatsBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":31,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":31,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Users, TrendingUp, Award, Zap } from 'lucide-react';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nconst icons = {\n    users: Users,\n    trending: TrendingUp,\n    award: Award,\n    zap: Zap\n};\n\nexport const StatsBlock = ({ items = [] }) => {\n    return (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8\">\n            {items.map((item, index) => {\n                const Icon = icons[item.icon] || Users;\n                return (\n                    <div key={index} className=\"text-center p-6 bg-white rounded-xl shadow-sm border border-slate-100\">\n                        <div className=\"inline-flex items-center justify-center w-12 h-12 mb-4 rounded-full bg-blue-50 text-blue-600\">\n                            <Icon className=\"w-6 h-6\" />\n                        </div>\n                        <h3 className=\"text-3xl font-bold mb-1\" style={{ color: item.valueColor || '#0f172a' }}>{item.value}</h3>\n                        <p className=\"text-sm font-medium uppercase tracking-wide\" style={{ color: item.labelColor || '#64748b' }}>{item.label}</p>\n                    </div>\n                );\n            })}\n        </div>\n    );\n};\n\nexport const StatsBlockFields = {\n    items: {\n        type: 'array',\n        getItemSummary: (item) => item.label || 'Stat Item',\n        arrayFields: {\n            value: { type: 'text', label: 'Value (e.g. 10k+)' },\n            label: { type: 'text', label: 'Label' },\n            icon: {\n                type: 'select',\n                label: 'Icon',\n                options: [\n                    { label: 'Users', value: 'users' },\n                    { label: 'Trending', value: 'trending' },\n                    { label: 'Award', value: 'award' },\n                    { label: 'Zap', value: 'zap' }\n                ]\n            },\n            valueColor: { type: 'custom', label: 'Value Color', render: ColorPickerField },\n            labelColor: { type: 'custom', label: 'Label Color', render: ColorPickerField }\n        },\n        defaultItemProps: {\n            value: '100+',\n            label: 'Happy Clients',\n            icon: 'users'\n        }\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/TestimonialBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[100,111],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":10,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":10,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'quoteColor' is defined but never used.","line":40,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":53,"suggestions":[{"messageId":"removeVar","data":{"varName":"quoteColor"},"fix":{"range":[1339,1351],"text":""},"desc":"Remove unused variable 'quoteColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'nameColor' is defined but never used.","line":40,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":70,"suggestions":[{"messageId":"removeVar","data":{"varName":"nameColor"},"fix":{"range":[1357,1368],"text":""},"desc":"Remove unused variable 'nameColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'roleColor' is defined but never used.","line":40,"column":78,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":87,"suggestions":[{"messageId":"removeVar","data":{"varName":"roleColor"},"fix":{"range":[1374,1385],"text":""},"desc":"Remove unused variable 'roleColor'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Testimonial Block Component\n * Customer testimonial with quote, name, and avatar\n */\n\nimport React from 'react';\nimport { Quote } from 'lucide-react';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nexport const TestimonialBlockFields = {\n    quote: { type: 'textarea', label: 'Testimonial Quote' },\n    quoteColor: { type: 'custom', label: 'Quote Color', render: ColorPickerField },\n    name: { type: 'text', label: 'Customer Name' },\n    nameColor: { type: 'custom', label: 'Name Color', render: ColorPickerField },\n    role: { type: 'text', label: 'Role/Company' },\n    roleColor: { type: 'custom', label: 'Role Color', render: ColorPickerField },\n    avatar: { type: 'text', label: 'Avatar Image URL' },\n    rating: {\n        type: 'select',\n        label: 'Rating',\n        options: [\n            { label: '5 Stars', value: 5 },\n            { label: '4 Stars', value: 4 },\n            { label: '3 Stars', value: 3 },\n            { label: '2 Stars', value: 2 },\n            { label: '1 Star', value: 1 }\n        ]\n    },\n    variant: {\n        type: 'select',\n        label: 'Style',\n        options: [\n            { label: 'Card', value: 'card' },\n            { label: 'Simple', value: 'simple' },\n            { label: 'Centered', value: 'centered' }\n        ]\n    }\n};\n\nexport const TestimonialBlock = ({ quote, quoteColor, name, nameColor, role, roleColor, avatar, rating, variant }) => {\n    const renderStars = () => {\n        return (\n            <div className=\"flex gap-1\">\n                {[1, 2, 3, 4, 5].map((star) => (\n                    <svg\n                        key={star}\n                        className={`w-5 h-5 ${star <= rating ? 'text-yellow-400' : 'text-slate-200'}`}\n                        fill=\"currentColor\"\n                        viewBox=\"0 0 20 20\"\n                    >\n                        <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\n                    </svg>\n                ))}\n            </div>\n        );\n    };\n\n    if (variant === 'centered') {\n        return (\n            <div className=\"text-center py-12 px-6\">\n                <Quote className=\"w-12 h-12 text-blue-200 mx-auto mb-6\" />\n                <blockquote className=\"text-2xl text-slate-700 italic mb-6 max-w-3xl mx-auto\">\n                    &quot;{quote}&quot;\n                </blockquote>\n                <div className=\"flex items-center justify-center gap-4\">\n                    {avatar && (\n                        <img src={avatar} alt={name} className=\"w-16 h-16 rounded-full object-cover\" />\n                    )}\n                    <div>\n                        <p className=\"font-bold text-slate-800\">{name}</p>\n                        <p className=\"text-slate-500 text-sm\">{role}</p>\n                        {rating && <div className=\"mt-1\">{renderStars()}</div>}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    if (variant === 'simple') {\n        return (\n            <div className=\"py-6 border-l-4 border-blue-500 pl-6\">\n                <blockquote className=\"text-lg text-slate-700 italic mb-4\">\n                    &quot;{quote}&quot;\n                </blockquote>\n                <div className=\"flex items-center gap-3\">\n                    {avatar && (\n                        <img src={avatar} alt={name} className=\"w-10 h-10 rounded-full object-cover\" />\n                    )}\n                    <div>\n                        <p className=\"font-semibold text-slate-800\">{name}</p>\n                        <p className=\"text-slate-500 text-sm\">{role}</p>\n                    </div>\n                    {rating && <div className=\"ml-auto\">{renderStars()}</div>}\n                </div>\n            </div>\n        );\n    }\n\n    // Card variant (default)\n    return (\n        <div className=\"bg-white rounded-xl shadow-lg p-6 border border-slate-100\">\n            <div className=\"flex items-start gap-4 mb-4\">\n                {avatar ? (\n                    <img src={avatar} alt={name} className=\"w-14 h-14 rounded-full object-cover\" />\n                ) : (\n                    <div className=\"w-14 h-14 rounded-full bg-blue-100 flex items-center justify-center\">\n                        <span className=\"text-xl font-bold text-blue-600\">{name?.charAt(0)}</span>\n                    </div>\n                )}\n                <div className=\"flex-1\">\n                    <p className=\"font-bold text-slate-800\">{name}</p>\n                    <p className=\"text-slate-500 text-sm\">{role}</p>\n                    {rating && <div className=\"mt-1\">{renderStars()}</div>}\n                </div>\n                <Quote className=\"w-8 h-8 text-blue-100 flex-shrink-0\" />\n            </div>\n            <blockquote className=\"text-slate-600 italic\">&quot;{quote}&quot;</blockquote>\n        </div>\n    );\n};\n\nexport default TestimonialBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/TextBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[90,101],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":12,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":12,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Text Block Component\n * Rich text content block with alignment options\n */\n\nimport React from 'react';\nimport { RichTextField } from '../fields/RichTextField';\nimport { ColorPickerField } from '../fields/ColorPickerField';\n\nimport { sanitizeHTML } from '@/utils/sanitize';\n\nexport const TextBlockFields = {\n    content: {\n        type: 'custom',\n        label: 'Content',\n        render: RichTextField\n    },\n    textColor: {\n        type: 'custom',\n        label: 'Text Color',\n        render: ColorPickerField\n    },\n    alignment: {\n        type: 'select',\n        label: 'Alignment',\n        options: [\n            { label: 'Left', value: 'left' },\n            { label: 'Center', value: 'center' },\n            { label: 'Right', value: 'right' },\n            { label: 'Justify', value: 'justify' }\n        ]\n    }\n};\n\nexport const TextBlock = ({ content, alignment, textColor }) => {\n    // Debug logging\n    console.log('TextBlock render:', { content, alignment, textColor });\n\n    return (\n        <div\n            className={`prose prose-lg max-w-none py-4 text-${alignment}`}\n            style={{\n                textAlign: alignment,\n                color: textColor || 'inherit',\n                minHeight: '2rem',\n                border: '1px dashed #ccc' // Keep subtle debug border\n            }}\n            dangerouslySetInnerHTML={sanitizeHTML(content)}\n        />\n    );\n};\n\nexport default TextBlock;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/WidgetAreaBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":6,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":6,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { WidgetAreaRenderer } from '@/components/public/WidgetAreaRenderer';\n\n// Fields definition for the sidebar editor\nexport const WidgetAreaBlockFields = {\n    areaSlug: {\n        type: 'select',\n        label: 'Widget Area',\n        options: [\n            { label: 'Default Sidebar', value: 'default-sidebar' },\n            { label: 'Footer Column 1', value: 'footer-col-1' },\n            { label: 'Footer Column 2', value: 'footer-col-2' },\n        ]\n    },\n    title: { type: 'text', label: 'Title (Optional)' }\n};\n\nexport const WidgetAreaBlock = ({ areaSlug, title, puck }) => {\n    return (\n        <div className=\"w-full h-full\">\n            {title && <h3 className=\"text-lg font-bold mb-4\">{title}</h3>}\n            {areaSlug ? (\n                <WidgetAreaWrapper slug={areaSlug} isEditing={!!puck?.isEditing} />\n            ) : (\n                <div className=\"p-4 border border-dashed rounded bg-slate-50 text-slate-400 text-center\">\n                    Select a Widget Area\n                </div>\n            )}\n        </div>\n    );\n};\n\nconst WidgetAreaWrapper = ({ slug, isEditing }) => {\n    return (\n        <div className={isEditing ? \"min-h-[50px] outline-dashed outline-1 outline-slate-300 p-2\" : \"\"}>\n            <WidgetAreaRenderer slug={slug} className=\"\" />\n        </div>\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/blocks/YouTubeBlock.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":40,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":40,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\n\nexport const YouTubeBlock = ({ url, aspectRatio = '16/9', autoplay = false }) => {\n    // Helper to extract Video ID\n    const getVideoId = (url) => {\n        if (!url) return null;\n        const regExp = /^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\n        const match = url.match(regExp);\n        return (match && match[2].length === 11) ? match[2] : null;\n    };\n\n    const videoId = getVideoId(url);\n    const ratio = aspectRatio.split('/');\n    const paddingBottom = `${(ratio[1] / ratio[0]) * 100}%`;\n\n    if (!videoId) {\n        return (\n            <div className=\"aspect-video flex items-center justify-center bg-slate-100 rounded-lg border-2 border-dashed border-slate-300 text-slate-400\">\n                Enter a valid YouTube URL\n            </div>\n        );\n    }\n\n    const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=${autoplay ? 1 : 0}&mute=${autoplay ? 1 : 0}`;\n\n    return (\n        <div className=\"w-full relative rounded-lg overflow-hidden shadow-sm\" style={{ paddingBottom }}>\n            <iframe\n                className=\"absolute top-0 left-0 w-full h-full\"\n                src={embedUrl}\n                title=\"YouTube video player\"\n                frameBorder=\"0\"\n                allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                allowFullScreen\n            />\n        </div>\n    );\n};\n\nexport const YouTubeBlockFields = {\n    url: { type: 'text', label: 'YouTube URL' },\n    aspectRatio: {\n        type: 'select',\n        label: 'Aspect Ratio',\n        options: [\n            { label: '16:9 (Standard)', value: '16/9' },\n            { label: '4:3 (Classic)', value: '4/3' },\n            { label: '21:9 (Cinematic)', value: '21/9' }\n        ]\n    },\n    autoplay: {\n        type: 'radio',\n        label: 'Autoplay (Muted)',\n        options: [\n            { label: 'Yes', value: true },\n            { label: 'No', value: false }\n        ]\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/fields/ColorPickerField.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[118,129],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Custom Color Picker Field for Puck Editor\n * Provides visual hex color selection with live preview\n */\n\nimport React from 'react';\n\nexport const ColorPickerField = ({ field, name, value, onChange }) => {\n    const handleChange = (e) => {\n        onChange(e.target.value);\n    };\n\n    const handleTextChange = (e) => {\n        const val = e.target.value;\n        // Allow partial typing\n        onChange(val);\n    };\n\n    return (\n        <div className=\"space-y-2\">\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300\">\n                {field.label || name}\n            </label>\n            <div className=\"flex items-center gap-2\">\n                {/* Color picker input */}\n                <input\n                    type=\"color\"\n                    value={value || '#000000'}\n                    onChange={handleChange}\n                    className=\"h-10 w-20 rounded border border-slate-300 dark:border-slate-600 cursor-pointer bg-transparent\"\n                    title=\"Pick a color\"\n                />\n                {/* Text input for hex code */}\n                <input\n                    type=\"text\"\n                    value={value || ''}\n                    onChange={handleTextChange}\n                    placeholder=\"#000000\"\n                    maxLength={7}\n                    className=\"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100\"\n                />\n                {/* Preview swatch */}\n                <div\n                    className=\"w-10 h-10 rounded border border-slate-300 shadow-inner\"\n                    style={{ backgroundColor: value || '#000000' }}\n                    title=\"Color preview\"\n                />\n            </div>\n            {field.description && (\n                <p className=\"text-xs text-slate-500\">{field.description}</p>\n            )}\n        </div>\n    );\n};\n\nexport default ColorPickerField;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/fields/ImageField.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[127,133],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Custom Puck Field Components\n * Custom field renderers for Puck editor that integrate with AWCMS components\n */\n\nimport React, { useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { FolderOpen, X, Trash2 } from 'lucide-react';\nimport MediaLibrary from '@/components/dashboard/media/MediaLibrary';\nimport { supabase } from '@/lib/customSupabaseClient';\n\n/**\n * Image Field with Media Library integration\n * Custom Puck field for selecting images from Media Library or URL\n */\nexport const ImageField = ({ field, value, onChange, name }) => {\n    const [open, setOpen] = useState(false);\n    const [urlInput, setUrlInput] = useState(value || '');\n\n    const handleSelect = (file) => {\n        const { data } = supabase.storage\n            .from(file.bucket_name || 'cms-uploads')\n            .getPublicUrl(file.file_path);\n\n        if (data.publicUrl) {\n            onChange(data.publicUrl);\n            setUrlInput(data.publicUrl);\n            setOpen(false);\n        }\n    };\n\n    const handleUrlChange = (e) => {\n        setUrlInput(e.target.value);\n        onChange(e.target.value);\n    };\n\n    const handleClear = () => {\n        onChange('');\n        setUrlInput('');\n    };\n\n    return (\n        <div className=\"space-y-3\">\n            <Label>{field.label || name}</Label>\n\n            {/* Preview */}\n            {value && (\n                <div className=\"relative group w-full h-32 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-800\">\n                    <img\n                        src={value}\n                        alt=\"Selected\"\n                        className=\"w-full h-full object-cover\"\n                    />\n                    <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2\">\n                        <Button\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            onClick={handleClear}\n                        >\n                            <Trash2 className=\"w-4 h-4 mr-1\" />\n                            Remove\n                        </Button>\n                    </div>\n                </div>\n            )}\n\n            {/* Controls */}\n            <Tabs defaultValue=\"library\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-2 h-9\">\n                    <TabsTrigger value=\"library\" className=\"text-xs\">Media Library</TabsTrigger>\n                    <TabsTrigger value=\"url\" className=\"text-xs\">External URL</TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"library\" className=\"mt-2\">\n                    <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"w-full\"\n                        onClick={() => setOpen(true)}\n                    >\n                        <FolderOpen className=\"w-4 h-4 mr-2\" />\n                        Browse Library\n                    </Button>\n\n                    <Dialog open={open} onOpenChange={setOpen}>\n                        <DialogContent className=\"max-w-4xl h-[80vh] flex flex-col p-0 gap-0\">\n                            <DialogHeader className=\"px-6 py-4 border-b\">\n                                <DialogTitle>Select Image</DialogTitle>\n                            </DialogHeader>\n                            <div className=\"flex-1 min-h-0 overflow-hidden p-0\">\n                                <MediaLibrary onSelect={handleSelect} selectionMode=\"single\" />\n                            </div>\n                        </DialogContent>\n                    </Dialog>\n                </TabsContent>\n\n                <TabsContent value=\"url\" className=\"mt-2\">\n                    <Input\n                        value={urlInput}\n                        onChange={handleUrlChange}\n                        placeholder=\"https://...\"\n                        className=\"h-9 text-sm\"\n                    />\n                </TabsContent>\n            </Tabs>\n        </div>\n    );\n};\n\n/**\n * Multi-Image Field for Gallery blocks\n * Allows selecting multiple images from Media Library\n */\nexport const MultiImageField = ({ field, value, onChange, name }) => {\n    const [open, setOpen] = useState(false);\n\n    // Parse current images (newline separated URLs)\n    const imageList = value\n        ? value.split('\\n').filter(url => url.trim().length > 0)\n        : [];\n\n    const handleSelect = (file) => {\n        const { data } = supabase.storage\n            .from(file.bucket_name || 'cms-uploads')\n            .getPublicUrl(file.file_path);\n\n        if (data.publicUrl) {\n            const newImages = [...imageList, data.publicUrl];\n            onChange(newImages.join('\\n'));\n            setOpen(false);\n        }\n    };\n\n    const handleRemove = (index) => {\n        const newImages = imageList.filter((_, i) => i !== index);\n        onChange(newImages.join('\\n'));\n    };\n\n    const handleAddUrl = () => {\n        const url = prompt('Enter image URL:');\n        if (url && url.trim()) {\n            const newImages = [...imageList, url.trim()];\n            onChange(newImages.join('\\n'));\n        }\n    };\n\n    return (\n        <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n                <Label>{field.label || name}</Label>\n                <span className=\"text-xs text-slate-500\">{imageList.length} images</span>\n            </div>\n\n            {/* Image Grid Preview */}\n            {imageList.length > 0 && (\n                <div className=\"grid grid-cols-3 gap-2\">\n                    {imageList.map((url, index) => (\n                        <div\n                            key={index}\n                            className=\"relative group aspect-square rounded-md overflow-hidden border border-slate-200\"\n                        >\n                            <img\n                                src={url}\n                                alt={`Item ${index + 1}`}\n                                className=\"w-full h-full object-cover\"\n                            />\n                            <button\n                                onClick={() => handleRemove(index)}\n                                className=\"absolute top-1 right-1 w-5 h-5 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\"\n                            >\n                                <X className=\"w-3 h-3\" />\n                            </button>\n                        </div>\n                    ))}\n                </div>\n            )}\n\n            {/* Add Image Buttons */}\n            <div className=\"flex gap-2\">\n                <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"flex-1\"\n                    onClick={() => setOpen(true)}\n                >\n                    <FolderOpen className=\"w-4 h-4 mr-2\" />\n                    Add from Library\n                </Button>\n                <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleAddUrl}\n                >\n                    + URL\n                </Button>\n            </div>\n\n            <Dialog open={open} onOpenChange={setOpen}>\n                <DialogContent className=\"max-w-4xl h-[80vh] flex flex-col p-0 gap-0\">\n                    <DialogHeader className=\"px-6 py-4 border-b\">\n                        <DialogTitle>Add Image to Gallery</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"flex-1 min-h-0 overflow-hidden p-0\">\n                        <MediaLibrary onSelect={handleSelect} selectionMode=\"single\" />\n                    </div>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n};\n\nconst ImageFieldFields = {\n    ImageField,\n    MultiImageField\n};\n\nexport default ImageFieldFields;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/fields/RichTextField.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { Label } from '@/components/ui/label';\nimport RichTextEditor from '@/components/ui/RichTextEditor';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport MediaLibrary from '@/components/dashboard/media/MediaLibrary';\nimport { supabase } from '@/lib/customSupabaseClient';\n\n/**\n * Rich Text Field for Puck Editor\n * Integrates the application's RichTextEditor with Puck's field system\n */\nexport const RichTextField = ({ field, value, onChange, name }) => {\n    const [mediaOpen, setMediaOpen] = useState(false);\n    const [editorInstance, setEditorInstance] = useState(null);\n\n    const handleImageAdd = (editor) => {\n        setEditorInstance(editor);\n        setMediaOpen(true);\n    };\n\n    const handleMediaSelect = (file) => {\n        if (!editorInstance) return;\n\n        const { data } = supabase.storage\n            .from(file.bucket_name || 'cms-uploads')\n            .getPublicUrl(file.file_path);\n\n        if (data.publicUrl) {\n            editorInstance.chain().focus().setImage({ src: data.publicUrl }).run();\n            setMediaOpen(false);\n            setEditorInstance(null);\n\n            // Trigger onChange with new HTML content\n            onChange(editorInstance.getHTML());\n        }\n    };\n\n    return (\n        <div className=\"space-y-3\">\n            <Label>{field.label || name}</Label>\n\n            <RichTextEditor\n                value={value}\n                onChange={onChange}\n                placeholder={field.placeholder || \"Enter content...\"}\n                onImageAdd={handleImageAdd}\n                className=\"min-h-[200px]\"\n            />\n\n            <Dialog open={mediaOpen} onOpenChange={setMediaOpen}>\n                <DialogContent className=\"max-w-4xl h-[80vh] flex flex-col p-0 gap-0\">\n                    <DialogHeader className=\"px-6 py-4 border-b\">\n                        <DialogTitle>Insert Image</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"flex-1 min-h-0 overflow-hidden p-0\">\n                        <MediaLibrary onSelect={handleMediaSelect} selectionMode=\"single\" />\n                    </div>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n};\n\nexport default RichTextField;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/fields/SelectField.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[115,121],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Custom Generic Select Field for Puck\n * Supports static options or async fetching from Supabase\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { Label } from '@/components/ui/label';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Loader2 } from 'lucide-react';\n\nexport const SelectField = ({ field, value, onChange, name }) => {\n    const [options, setOptions] = useState(field.options || []);\n    const [loading, setLoading] = useState(false);\n\n    useEffect(() => {\n        // If options are provided statically, use them\n        if (field.options) {\n            setOptions(field.options);\n            return;\n        }\n\n        // If a fetch configuration is provided, load data\n        if (field.fetchConfig) {\n            const fetchOptions = async () => {\n                setLoading(true);\n                try {\n                    const { table, labelField = 'title', valueField = 'id', filter = {} } = field.fetchConfig;\n\n                    let query = supabase.from(table).select(`${labelField}, ${valueField}`);\n\n                    // Apply filters if any\n                    Object.entries(filter).forEach(([key, val]) => {\n                        query = query.eq(key, val);\n                    });\n\n                    const { data, error } = await query;\n\n                    if (error) throw error;\n\n                    const mappedOptions = data.map(item => ({\n                        label: item[labelField],\n                        value: item[valueField]\n                    }));\n\n                    setOptions(mappedOptions);\n                } catch (err) {\n                    console.error('Error fetching options:', err);\n                    setOptions([]);\n                } finally {\n                    setLoading(false);\n                }\n            };\n\n            fetchOptions();\n        }\n    }, [field.options, field.fetchConfig]);\n\n    return (\n        <div className=\"space-y-2\">\n            <Label>{field.label || name}</Label>\n            <Select\n                value={value || ''}\n                onValueChange={onChange}\n                disabled={loading}\n            >\n                <SelectTrigger className=\"w-full\">\n                    {loading ? (\n                        <div className=\"flex items-center gap-2 text-slate-500\">\n                            <Loader2 className=\"w-3 h-3 animate-spin\" />\n                            <span>Loading...</span>\n                        </div>\n                    ) : (\n                        <SelectValue placeholder=\"Select an option\" />\n                    )}\n                </SelectTrigger>\n                <SelectContent>\n                    {options.length === 0 && !loading ? (\n                        <div className=\"p-2 text-sm text-slate-500 text-center\">No options found</div>\n                    ) : (\n                        options.map((opt) => (\n                            <SelectItem key={opt.value} value={opt.value}>\n                                {opt.label}\n                            </SelectItem>\n                        ))\n                    )}\n                </SelectContent>\n            </Select>\n        </div>\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/hooks/useHistory.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/components/visual-builder/templates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/contexts/CartContext.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[145,151],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":290,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":290,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Cart Context - Global shopping cart state management\n * Supports both authenticated users (database) and guests (localStorage)\n */\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { v4 as uuidv4 } from 'uuid';\n\nconst CartContext = createContext(null);\n\nconst SESSION_ID_KEY = 'awcms_session_id';\n\nexport function CartProvider({ children }) {\n    const { user } = useAuth();\n    const { currentTenant } = useTenant();\n    const [cart, setCart] = useState(null);\n    const [items, setItems] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    // Get or create session ID for guests\n    const getSessionId = useCallback(() => {\n        let sessionId = localStorage.getItem(SESSION_ID_KEY);\n        if (!sessionId) {\n            sessionId = uuidv4();\n            localStorage.setItem(SESSION_ID_KEY, sessionId);\n        }\n        return sessionId;\n    }, []);\n\n    // Fetch cart from database\n    const fetchCart = useCallback(async () => {\n        if (!currentTenant?.id) return;\n\n        setLoading(true);\n        try {\n            let query = supabase\n                .from('carts')\n                .select(`\n          *,\n          cart_items (\n            *,\n            product:products (id, name, slug, price, discount_price, featured_image, stock, is_available, shipping_cost, weight)\n          )\n        `)\n                .eq('tenant_id', currentTenant.id)\n                .is('cart_items.deleted_at', null)\n                .eq('status', 'active')\n                .order('created_at', { ascending: false })\n                .limit(1);\n\n            if (user?.id) {\n                query = query.eq('user_id', user.id);\n            } else {\n                query = query.eq('session_id', getSessionId());\n            }\n\n            const { data, error } = await query.maybeSingle();\n\n            if (error) throw error;\n\n            if (data) {\n                setCart(data);\n                setItems(data.cart_items || []);\n            } else {\n                setCart(null);\n                setItems([]);\n            }\n        } catch (error) {\n            console.error('Error fetching cart:', error);\n        } finally {\n            setLoading(false);\n        }\n    }, [user?.id, currentTenant?.id, getSessionId]);\n\n    // Create new cart\n    const createCart = async () => {\n        if (!currentTenant?.id) return null;\n\n        const cartData = {\n            tenant_id: currentTenant.id,\n            status: 'active',\n            ...(user?.id ? { user_id: user.id } : { session_id: getSessionId() })\n        };\n\n        const { data, error } = await supabase\n            .from('carts')\n            .insert(cartData)\n            .select()\n            .single();\n\n        if (error) throw error;\n        setCart(data);\n        return data;\n    };\n\n    // Add item to cart\n    const addItem = async (product, quantity = 1) => {\n        try {\n            let currentCart = cart;\n            if (!currentCart) {\n                currentCart = await createCart();\n            }\n\n            const { data: existingRow, error: existingError } = await supabase\n                .from('cart_items')\n                .select('id, quantity, deleted_at')\n                .eq('cart_id', currentCart.id)\n                .eq('product_id', product.id)\n                .maybeSingle();\n\n            if (existingError) throw existingError;\n\n            if (existingRow) {\n                const baseQuantity = existingRow.deleted_at ? 0 : existingRow.quantity;\n                const newQuantity = baseQuantity + quantity;\n                const { data, error } = await supabase\n                    .from('cart_items')\n                    .update({\n                        quantity: newQuantity,\n                        updated_at: new Date().toISOString(),\n                        deleted_at: null\n                    })\n                    .eq('id', existingRow.id)\n                    .select(`\n            *,\n            product:products (id, name, slug, price, discount_price, featured_image, stock, is_available, shipping_cost, weight)\n          `)\n                    .single();\n\n                if (error) throw error;\n                setItems(prev => {\n                    const exists = prev.find(item => item.id === data.id);\n                    if (exists) {\n                        return prev.map(item => item.id === data.id ? data : item);\n                    }\n                    return [...prev, data];\n                });\n            } else {\n                const { data, error } = await supabase\n                    .from('cart_items')\n                    .insert({\n                        cart_id: currentCart.id,\n                        product_id: product.id,\n                        quantity,\n                        price_snapshot: product.discount_price || product.price\n                    })\n                    .select(`\n            *,\n            product:products (id, name, slug, price, discount_price, featured_image, stock, is_available, shipping_cost, weight)\n          `)\n                    .single();\n\n                if (error) throw error;\n                setItems(prev => [...prev, data]);\n            }\n            return true;\n        } catch (error) {\n            console.error('Error adding item to cart:', error);\n            return false;\n        }\n    };\n\n    // Update item quantity\n    const updateItemQuantity = async (itemId, quantity) => {\n        try {\n            if (quantity <= 0) {\n                return removeItem(itemId);\n            }\n\n            const { data, error } = await supabase\n                .from('cart_items')\n                .update({ quantity, updated_at: new Date().toISOString(), deleted_at: null })\n                .eq('id', itemId)\n                .select(`\n          *,\n          product:products (id, name, slug, price, discount_price, featured_image, stock, is_available, shipping_cost, weight)\n        `)\n                .single();\n\n            if (error) throw error;\n            setItems(prev => prev.map(item => item.id === itemId ? data : item));\n            return true;\n        } catch (error) {\n            console.error('Error updating item quantity:', error);\n            return false;\n        }\n    };\n\n    // Remove item from cart\n    const removeItem = async (itemId) => {\n        try {\n            const { error } = await supabase\n                .from('cart_items')\n                .update({ deleted_at: new Date().toISOString(), updated_at: new Date().toISOString() })\n                .eq('id', itemId);\n\n            if (error) throw error;\n            setItems(prev => prev.filter(item => item.id !== itemId));\n            return true;\n        } catch (error) {\n            console.error('Error removing item:', error);\n            return false;\n        }\n    };\n\n    // Clear cart\n    const clearCart = async () => {\n        if (!cart) return;\n\n        try {\n            await supabase\n                .from('cart_items')\n                .update({ deleted_at: new Date().toISOString(), updated_at: new Date().toISOString() })\n                .eq('cart_id', cart.id)\n                .is('deleted_at', null);\n            setItems([]);\n            return true;\n        } catch (error) {\n            console.error('Error clearing cart:', error);\n            return false;\n        }\n    };\n\n    // Convert cart to order (after checkout)\n    const convertToOrder = async () => {\n        if (!cart) return null;\n\n        try {\n            await supabase\n                .from('carts')\n                .update({ status: 'converted', updated_at: new Date().toISOString() })\n                .eq('id', cart.id);\n\n            setCart(null);\n            setItems([]);\n            return true;\n        } catch (error) {\n            console.error('Error converting cart:', error);\n            return false;\n        }\n    };\n\n    // Calculate totals\n    const subtotal = items.reduce((sum, item) => {\n        return sum + (item.price_snapshot * item.quantity);\n    }, 0);\n\n    const itemCount = items.reduce((sum, item) => sum + item.quantity, 0);\n\n    // Fetch cart on mount and when user changes\n    useEffect(() => {\n        fetchCart();\n    }, [fetchCart]);\n\n    // Merge guest cart when user logs in\n    useEffect(() => {\n        if (user?.id && cart && !cart.user_id && cart.session_id) {\n            // Transfer guest cart to user\n            supabase\n                .from('carts')\n                .update({ user_id: user.id, session_id: null })\n                .eq('id', cart.id)\n                .then(() => fetchCart());\n        }\n    }, [user?.id, cart, fetchCart]);\n\n    const value = {\n        cart,\n        items,\n        loading,\n        itemCount,\n        subtotal,\n        addItem,\n        updateItemQuantity,\n        removeItem,\n        clearCart,\n        convertToOrder,\n        refreshCart: fetchCart\n    };\n\n    return (\n        <CartContext.Provider value={value}>\n            {children}\n        </CartContext.Provider>\n    );\n}\n\nexport function useCart() {\n    const context = useContext(CartContext);\n    if (!context) {\n        throw new Error('useCart must be used within a CartProvider');\n    }\n    return context;\n}\n\nexport default CartContext;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/contexts/DarkModeContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":17,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":17,"endColumn":25}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'updateTheme'. Either include it or remove the dependency array.","line":80,"column":8,"nodeType":"ArrayExpression","endLine":80,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [updateTheme]","fix":{"range":[2589,2591],"text":"[updateTheme]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from 'react';\n\nconst STORAGE_KEY = 'awcms_theme';\nconst OLD_STORAGE_KEY = 'awcms-dark-mode';\n\n/**\n * Dark Mode Context\n * Manages light/dark/system theme preference\n * Supports migration from legacy keys\n */\nconst DarkModeContext = createContext({\n    mode: 'system', // 'light' | 'dark' | 'system'\n    isDark: false,\n    setMode: () => { },\n});\n\nexport const useDarkMode = () => useContext(DarkModeContext);\n\nexport const DarkModeProvider = ({ children }) => {\n    const [mode, setModeState] = useState('system');\n    const [isDark, setIsDark] = useState(false);\n\n    // Apply dark class to document\n    const applyDarkClass = (dark) => {\n        if (dark) {\n            document.documentElement.classList.add('dark');\n            document.documentElement.style.colorScheme = 'dark';\n        } else {\n            document.documentElement.classList.remove('dark');\n            document.documentElement.style.colorScheme = 'light';\n        }\n        setIsDark(dark);\n    };\n\n    // Check system preference\n    const getSystemPreference = () => {\n        return window.matchMedia('(prefers-color-scheme: dark)').matches;\n    };\n\n    // Update theme based on mode\n    const updateTheme = React.useCallback((currentMode) => {\n        if (currentMode === 'system') {\n            applyDarkClass(getSystemPreference());\n        } else {\n            applyDarkClass(currentMode === 'dark');\n        }\n    }, []);\n\n    // Set mode and persist\n    const setMode = (newMode) => {\n        setModeState(newMode);\n        localStorage.setItem(STORAGE_KEY, newMode);\n        updateTheme(newMode);\n    };\n\n    // Initialize on mount\n    useEffect(() => {\n        let initialMode = 'system';\n\n        // 1. Try new key\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (stored && ['light', 'dark', 'system'].includes(stored)) {\n            initialMode = stored;\n        } else {\n            // 2. Try migration from old key\n            const oldStored = localStorage.getItem(OLD_STORAGE_KEY);\n            if (oldStored && ['light', 'dark', 'system'].includes(oldStored)) {\n                initialMode = oldStored;\n                // Migrate to new key\n                localStorage.setItem(STORAGE_KEY, oldStored);\n                localStorage.removeItem(OLD_STORAGE_KEY);\n            }\n        }\n\n        setModeState(initialMode);\n        updateTheme(initialMode);\n\n        // System preference change handling is done in the separate useEffect below\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    // Handle system changes and mode updates\n    useEffect(() => {\n        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n\n        const handleSystemChange = (e) => {\n            if (mode === 'system') {\n                applyDarkClass(e.matches);\n            }\n        };\n\n        // Update immediately on mode change\n        updateTheme(mode);\n\n        // Subscribe to system changes\n        mediaQuery.addEventListener('change', handleSystemChange);\n        return () => mediaQuery.removeEventListener('change', handleSystemChange);\n    }, [mode, updateTheme]);\n\n    return (\n        <DarkModeContext.Provider value={{ mode, isDark, setMode }}>\n            {children}\n        </DarkModeContext.Provider>\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/contexts/PermissionContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":366,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":366,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, useCallback, useMemo } from 'react';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { udm } from '@/lib/data/UnifiedDataManager';\n\nconst PermissionContext = createContext(undefined);\n\nexport const PermissionProvider = ({ children }) => {\n  const { user } = useAuth();\n  const [permissions, setPermissions] = useState([]);\n  const [userRole, setUserRole] = useState(null);\n  const [role, setRole] = useState(null);\n  const [tenantId, setTenantId] = useState(null);\n  const [abacPolicies, setAbacPolicies] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchUserPermissions = useCallback(async () => {\n      if (!user) {\n        setPermissions([]);\n        setUserRole(null);\n        setRole(null);\n        setTenantId(null);\n        setAbacPolicies([]);\n        setLoading(false);\n        return;\n      }\n\n    try {\n      // 1. Fetch User Data\n      // Attempt to load with deep joins (Online optimal)\n      // UDM will strip these joins if Offline/Local, returning just the user row.\n      const { data: userDataRaw, error: userError } = await udm.from('users')\n        .select(`\n          *,\n          roles!users_role_id_fkey (\n            name,\n            scope,\n            is_platform_admin,\n            is_full_access,\n            is_tenant_admin,\n            is_public,\n            is_guest,\n            is_staff,\n            staff_level,\n            is_system,\n            role_permissions (\n              deleted_at,\n              permissions (\n                name,\n                deleted_at\n              )\n            ),\n            role_policies (\n              deleted_at,\n              policies (\n                definition,\n                deleted_at\n              )\n            )\n          )\n        `)\n        .eq('id', user.id)\n        .single(); // Use single()\n\n      if (userError) {\n        console.error('Error fetching user permissions:', userError);\n      }\n\n      let userData = userDataRaw;\n\n      // 2. Offline Fallback: Reconstruct Data Waterfall if needed\n      // If we got user data but missing nested 'roles', and we have a role_id\n      if (userData && !userData.roles && userData.role_id) {\n        // Fetch Role\n        const { data: roleData } = await udm\n          .from('roles')\n          .select('*')\n          .eq('id', userData.role_id)\n          .is('deleted_at', null)\n          .single();\n\n        if (roleData) {\n          userData.roles = roleData;\n\n          // Fetch Role Permissions\n          // 1. Get role_permissions map (join table)\n          const { data: rpMap } = await udm\n            .from('role_permissions')\n            .select('*')\n            .eq('role_id', roleData.id)\n            .is('deleted_at', null);\n\n          if (rpMap && rpMap.length > 0) {\n            const permIds = rpMap.map(rp => rp.permission_id);\n            // 2. Get actual permissions\n            const { data: perms } = await udm\n              .from('permissions')\n              .select('name')\n              .in('id', permIds)\n              .is('deleted_at', null);\n            if (perms) {\n              userData.roles.role_permissions = perms.map(p => ({ permissions: p }));\n            }\n          }\n\n          // Fetch Role Policies\n          // 1. Get role_policies map\n          const { data: rPolMap } = await udm\n            .from('role_policies')\n            .select('*')\n            .eq('role_id', roleData.id)\n            .is('deleted_at', null);\n\n          if (rPolMap && rPolMap.length > 0) {\n            const policyIds = rPolMap.map(rp => rp.policy_id);\n            // 2. Get actual policies\n            const { data: pols } = await udm\n              .from('policies')\n              .select('definition')\n              .in('id', policyIds)\n              .is('deleted_at', null);\n            if (pols) {\n              userData.roles.role_policies = pols.map(p => ({ policies: p }));\n            }\n          }\n        }\n      }\n\n      let dbRole = null;\n      let dbPermissions = [];\n      let dbTenantId = null;\n      let roleData = null;\n      let roleFlags = {\n        isPlatformAdmin: false,\n        isFullAccess: false,\n        isTenantAdmin: false,\n        isPublicRole: false,\n        isGuestRole: false,\n        isStaff: false,\n        staffLevel: null,\n        scope: null\n      };\n\n      if (userData) {\n        dbTenantId = userData.tenant_id;\n        if (userData.roles) {\n          roleData = userData.roles;\n          dbRole = roleData.name;\n          roleFlags = {\n            isPlatformAdmin: Boolean(roleData.is_platform_admin),\n            isFullAccess: Boolean(roleData.is_full_access || roleData.is_platform_admin),\n            isTenantAdmin: Boolean(roleData.is_tenant_admin),\n            isPublicRole: Boolean(roleData.is_public),\n            isGuestRole: Boolean(roleData.is_guest),\n            isStaff: Boolean(roleData.is_staff),\n            staffLevel: roleData.staff_level ?? null,\n            scope: roleData.scope || null\n          };\n\n          if (!roleFlags.isFullAccess) {\n            dbPermissions = userData.roles.role_permissions\n              ?.filter(rp => !rp.deleted_at && rp.permissions && !rp.permissions.deleted_at)\n              .map(rp => rp.permissions?.name)\n              .filter(Boolean) || [];\n\n            const policies = userData.roles.role_policies\n              ?.filter(rp => !rp.deleted_at && rp.policies && !rp.policies.deleted_at)\n              .map(rp => rp.policies?.definition)\n              .filter(Boolean) || [];\n            setAbacPolicies(policies);\n          }\n        }\n      }\n\n      setTenantId(dbTenantId);\n\n      // 3. Determine Final Role\n      let finalRole = dbRole || 'guest';\n      let finalPermissions = dbPermissions;\n      setRole(roleData);\n      setUserRole(finalRole);\n\n      // 4. Load Permissions for Admin Roles\n      if (roleFlags.isFullAccess) {\n        // Attempt to fetch all permissions from UDM\n        const { data: allPerms } = await udm.from('permissions').select('name').is('deleted_at', null);\n        if (allPerms) {\n          finalPermissions = allPerms.map(p => p.name);\n        } else {\n          // Fallback if UDM fails or is empty, maybe implied * access\n          // but normally table should exist locally or remotely\n          finalPermissions = ['*']; // Or handle as \"All Access\" logic in checks\n        }\n      }\n\n      setPermissions(finalPermissions || []);\n\n    } catch (error) {\n      console.error('Unexpected error fetching permissions:', error);\n      // Fallback to empty context to prevent crash loops\n      setPermissions([]);\n    } finally {\n      setLoading(false);\n    }\n  }, [user]);\n\n  useEffect(() => {\n    fetchUserPermissions();\n  }, [fetchUserPermissions]);\n\n  const hasPermission = useCallback((permission) => {\n    if (!permission) return true;\n    if (role?.is_full_access || role?.is_platform_admin) return true;\n\n    return permissions.includes(permission);\n  }, [permissions, role]);\n\n  const hasAnyPermission = useCallback((permissionList) => {\n    if (role?.is_full_access || role?.is_platform_admin) return true;\n\n    if (!permissionList || permissionList.length === 0) return true;\n    return permissionList.some(p => permissions.includes(p));\n  }, [permissions, role]);\n\n  /**\n   * Check if the current user owns the record\n   * @param {object} record - Record with created_by field\n   * @returns {boolean}\n   */\n  const checkOwnership = useCallback((record) => {\n    if (!record || !user) return false;\n    return record.created_by === user.id || record.owner_id === user.id;\n  }, [user]);\n\n  const checkAccess = useCallback((action, resource, record = null) => {\n    // Platform admins always have access\n    if (role?.is_full_access || role?.is_platform_admin) return true;\n\n    // Determine the permission key based on scope\n    const hasScope = resource.includes('.');\n    const permissionKey = hasScope ? `${resource}.${action}` : `tenant.${resource}.${action}`;\n\n    // Check if user has the specific permission\n    if (permissions.includes(permissionKey)) {\n      // For 'update' action, check ownership if role is 'author'\n      if (action === 'update' && userRole === 'author' && record) {\n        return checkOwnership(record);\n      }\n      return true;\n    }\n\n    // Fallback: if action is 'update' and no explicit permission, allow if user owns the record\n    if (action === 'update' && record && user && record.created_by === user.id) {\n      return true;\n    }\n\n    return false;\n  }, [permissions, userRole, user, checkOwnership, role]);\n\n  /**\n   * Shorthand: Can user publish content in this resource?\n   */\n  const canPublish = useCallback((resource) => {\n    return checkAccess('publish', resource);\n  }, [checkAccess]);\n\n  /**\n   * Shorthand: Can user restore soft-deleted items in this resource?\n   */\n  const canRestore = useCallback((resource) => {\n    return checkAccess('restore', resource);\n  }, [checkAccess]);\n\n  /**\n   * Shorthand: Can user permanently delete items in this resource?\n   */\n  const canPermanentDelete = useCallback((resource) => {\n    return checkAccess('delete_permanent', resource);\n  }, [checkAccess]);\n\n  /**\n   * Shorthand: Can user soft-delete items in this resource?\n   */\n  const canSoftDelete = useCallback((resource) => {\n    return checkAccess('soft_delete', resource);\n  }, [checkAccess]);\n\n  const checkPolicy = useCallback((action, resource, context = {}) => {\n    if (role?.is_full_access || role?.is_platform_admin) return true;\n\n    const finalContext = { channel: 'web', ...context };\n\n    // Check deny policies\n    const denyMatch = abacPolicies.some(policy => {\n      if (policy.effect !== 'deny') return false;\n      if (!policy.actions.includes('*') && !policy.actions.includes(action)) return false;\n      if (policy.conditions) {\n        if (policy.conditions.channel && policy.conditions.channel !== finalContext.channel) return false;\n      }\n      return true;\n    });\n\n    if (denyMatch) return false;\n    return true;\n  }, [abacPolicies, role]);\n\n  const isPlatformAdmin = useMemo(() => {\n    return Boolean(role?.is_platform_admin || role?.is_full_access);\n  }, [role]);\n\n  const isFullAccess = useMemo(() => {\n    return Boolean(role?.is_full_access || role?.is_platform_admin);\n  }, [role]);\n\n  const isTenantAdmin = useMemo(() => {\n    return Boolean(role?.is_tenant_admin);\n  }, [role]);\n\n  const isPublicRole = useMemo(() => {\n    return Boolean(role?.is_public);\n  }, [role]);\n\n  const isGuestRole = useMemo(() => {\n    return Boolean(role?.is_guest);\n  }, [role]);\n\n  const isStaff = useMemo(() => {\n    return Boolean(role?.is_staff);\n  }, [role]);\n\n  const staffLevel = useMemo(() => {\n    return role?.staff_level ?? null;\n  }, [role]);\n\n  const value = React.useMemo(() => ({\n    permissions,\n    userRole,\n    role,\n    tenantId,\n    isPlatformAdmin,\n    isFullAccess,\n    isTenantAdmin,\n    isPublicRole,\n    isGuestRole,\n    isStaff,\n    staffLevel,\n    loading,\n    hasPermission,\n    hasAnyPermission,\n    checkAccess,\n    checkOwnership,\n    checkPolicy,\n    canPublish,\n    canRestore,\n    canPermanentDelete,\n    canSoftDelete,\n    refreshPermissions: fetchUserPermissions\n  }), [permissions, userRole, role, tenantId, isPlatformAdmin, isFullAccess, isTenantAdmin, isPublicRole, isGuestRole, isStaff, staffLevel, loading, hasPermission, hasAnyPermission, checkAccess, checkOwnership, checkPolicy, canPublish, canRestore, canPermanentDelete, canSoftDelete, fetchUserPermissions]);\n\n  return (\n    <PermissionContext.Provider value={value}>\n      {children}\n    </PermissionContext.Provider>\n  );\n};\n\nexport const usePermissions = () => {\n  const context = useContext(PermissionContext);\n  if (context === undefined) {\n    throw new Error('usePermissions must be used within a PermissionProvider');\n  }\n  return context;\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/contexts/PermissionContext.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/contexts/PluginContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":11,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":11,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from 'react';\nimport { hooks } from '@/lib/hooks';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { getAllPlugins, getPlugin, getPluginComponent } from '@/lib/pluginRegistry';\nimport { loadExternalExtension } from '@/lib/externalExtensionLoader';\nimport ExtensionErrorBoundary from '@/components/ui/ExtensionErrorBoundary';\nimport { useTenant } from '@/contexts/TenantContext';\n\nconst PluginContext = createContext(null);\n\nexport const usePlugins = () => {\n    const context = useContext(PluginContext);\n    if (!context) {\n        throw new Error('usePlugins must be used within a PluginProvider');\n    }\n    return context;\n};\n\n/**\n * Component to render content injected via filters\n * Usage: <PluginSlot name=\"dashboard_top\" args={{ user }} />\n */\nexport const PluginSlot = ({ name, args = {}, fallback = null }) => {\n    const { applyFilters } = usePlugins();\n    const components = applyFilters(name, []);\n\n    if (!Array.isArray(components) || components.length === 0) {\n        return fallback;\n    }\n\n    return (\n        <>\n            {components.map((Comp, index) => (\n                <ExtensionErrorBoundary key={index} extensionName={`Plugin: ${name}`}>\n                    {React.isValidElement(Comp) ? Comp : <Comp {...args} />}\n                </ExtensionErrorBoundary>\n            ))}\n        </>\n    );\n};\n\n// Backward compatibility alias\nexport const PluginAction = PluginSlot;\n\nexport const PluginProvider = ({ children }) => {\n    const [isLoading, setIsLoading] = useState(true);\n    const [activePlugins, setActivePlugins] = useState([]);\n    const [registeredPlugins, setRegisteredPlugins] = useState([]);\n    const [externalPlugins, setExternalPlugins] = useState([]);\n    const { currentTenant } = useTenant();\n\n    // Expose hook methods\n    const { addAction, doAction, addFilter, applyFilters, removeAction, removeFilter } = hooks;\n\n    useEffect(() => {\n        const loadPlugins = async () => {\n            setIsLoading(true);\n            try {\n                // 1. Fetch active plugins from database\n                let query = supabase\n                    .from('extensions')\n                    .select('*')\n                    .eq('is_active', true)\n                    .is('deleted_at', null);\n\n                if (currentTenant?.id) {\n                    query = query.eq('tenant_id', currentTenant.id);\n                } else {\n                    query = query.eq('tenant_id', null);\n                }\n\n                const { data: dbPlugins, error } = await query;\n\n                if (error) throw error;\n\n                setActivePlugins(dbPlugins || []);\n\n                // 2. Separate core and external plugins\n                const corePlugins = (dbPlugins || []).filter(p => p.extension_type !== 'external');\n                const extPlugins = (dbPlugins || []).filter(p => p.extension_type === 'external');\n\n                const allBundledPlugins = getAllPlugins();\n                const registered = [];\n                const loadedExternal = [];\n\n                // 3. Register core plugins\n                for (const dbPlugin of corePlugins) {\n                    try {\n                        const pluginModule = allBundledPlugins[dbPlugin.slug] || getPlugin(dbPlugin.slug);\n\n                        if (!pluginModule) {\n                            console.warn(`[Core Plugin] \"${dbPlugin.slug}\" not found in registry`);\n                            continue;\n                        }\n\n                        if (typeof pluginModule.register === 'function') {\n                            pluginModule.register({\n                                addAction,\n                                addFilter,\n                                supabase,\n                                pluginConfig: dbPlugin.config || {}\n                            });\n                            registered.push(dbPlugin.slug);\n                            console.log(`[Core Plugin] Registered: ${dbPlugin.name}`);\n                        }\n                    } catch (err) {\n                        console.error(`[Core Plugin] Failed to register ${dbPlugin.name}:`, err);\n                    }\n                }\n\n                // 4. Load external plugins (async)\n                for (const extPlugin of extPlugins) {\n                    try {\n                        // Build manifest from DB data\n                        const manifest = extPlugin.manifest || {\n                            name: extPlugin.name,\n                            slug: extPlugin.slug,\n                            vendor: extPlugin.slug.split('-')[0] || 'unknown',\n                            version: extPlugin.version || '1.0.0',\n                            entry: extPlugin.external_path || 'src/index.js'\n                        };\n\n                        // Pass tenant_id for multi-tenant context\n                        const loadedModule = await loadExternalExtension(manifest, extPlugin.tenant_id);\n\n                        if (loadedModule.loaded && typeof loadedModule.register === 'function') {\n                            loadedModule.register({\n                                addAction,\n                                addFilter,\n                                supabase,\n                                tenantId: extPlugin.tenant_id, // Pass tenant context\n                                pluginConfig: extPlugin.config || {}\n                            });\n                            registered.push(extPlugin.slug);\n                            loadedExternal.push({ ...extPlugin, module: loadedModule });\n                            console.log(`[External Plugin] Registered: ${extPlugin.name}`);\n                        } else if (!loadedModule.loaded) {\n                            console.error(`[External Plugin] Failed to load: ${extPlugin.name}`, loadedModule.error);\n                        }\n                    } catch (err) {\n                        console.error(`[External Plugin] Failed to load ${extPlugin.name}:`, err);\n                    }\n                }\n\n                setRegisteredPlugins(registered);\n                setExternalPlugins(loadedExternal);\n\n                // 5. Trigger 'plugins_loaded' action\n                doAction('plugins_loaded', {\n                    core: corePlugins.length,\n                    external: loadedExternal.length,\n                    total: registered.length\n                });\n\n            } catch (err) {\n                console.error(\"Error loading plugins:\", err);\n            } finally {\n                setIsLoading(false);\n            }\n        };\n\n        loadPlugins();\n    }, [addAction, addFilter, doAction, currentTenant?.id]);\n\n    const value = {\n        isLoading,\n        activePlugins,\n        registeredPlugins,\n        externalPlugins,\n        addAction,\n        doAction,\n        addFilter,\n        applyFilters,\n        removeAction,\n        removeFilter,\n        // APIs\n        getPluginComponent,\n        getAllPlugins,\n        loadExternalExtension\n    };\n\n    return (\n        <PluginContext.Provider value={value}>\n            {children}\n        </PluginContext.Provider>\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/contexts/SupabaseAuthContext.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":296,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":296,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { createContext, useContext, useEffect, useState, useCallback, useMemo } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useToast } from '@/components/ui/use-toast';\n\nconst AuthContext = createContext(undefined);\n\nexport const AuthProvider = ({ children }) => {\n  const { toast } = useToast();\n\n  const [user, setUser] = useState(null);\n  const [session, setSession] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [twoFactorEnabled, setTwoFactorEnabled] = useState(false);\n\n  const handleSession = useCallback(async (session) => {\n    setSession(session);\n    const currentUser = session?.user ?? null;\n    setUser(currentUser);\n\n    // Check 2FA status if user exists\n    if (currentUser) {\n      try {\n        const { data, error } = await supabase\n          .from('two_factor_auth')\n          .select('enabled')\n          .eq('user_id', currentUser.id)\n          .maybeSingle();\n\n        if (!error && data) {\n          setTwoFactorEnabled(data.enabled);\n        } else {\n          setTwoFactorEnabled(false);\n        }\n      } catch (e) {\n        console.error(\"Failed to check 2FA status\", e);\n        setTwoFactorEnabled(false);\n      }\n    } else {\n      setTwoFactorEnabled(false);\n    }\n\n    setLoading(false);\n  }, []);\n\n  // Helper to clear local storage aggressively\n  const clearLocalAuth = useCallback(() => {\n    try {\n      // console.log(\"[Auth] Clearing local session data...\");\n      const keyPattern = /^sb-.*-auth-token$/;\n\n      // 1. Clear Supabase Tokens\n      Object.keys(localStorage).forEach(key => {\n        if (keyPattern.test(key)) {\n          localStorage.removeItem(key);\n        }\n      });\n\n      // 2. Clear 2FA State\n      sessionStorage.removeItem('awcms_2fa_verified');\n      sessionStorage.removeItem('awcms_2fa_timestamp');\n\n      // 3. Clear any potential tenant context if stored locally (though usually in-memory)\n      // This ensures a fresh start for the next user.\n    } catch (e) {\n      console.warn(\"Could not clear local storage\", e);\n    }\n  }, []);\n\n  const logSsoLoginEvent = useCallback(async (session) => {\n    const provider = session?.user?.app_metadata?.provider;\n    if (!provider || provider === 'email' || provider === 'phone') {\n      return;\n    }\n\n    let tenantId = session?.user?.app_metadata?.tenant_id || null;\n    if (!tenantId && session?.user?.id) {\n      const { data: userProfile, error } = await supabase\n        .from('users')\n        .select('tenant_id')\n        .eq('id', session.user.id)\n        .maybeSingle();\n\n      if (!error) {\n        tenantId = userProfile?.tenant_id || null;\n      }\n    }\n\n    if (!tenantId) {\n      console.warn('[Auth] Skipping SSO login audit log: missing tenant_id.');\n      return;\n    }\n\n    let clientIP = null;\n    try {\n      const { data: ipData, error: ipError } = await supabase.functions.invoke('get-client-ip');\n      if (!ipError && ipData?.ip) {\n        clientIP = ipData.ip;\n      }\n    } catch (e) {\n      console.warn('[Auth] IP lookup failed for SSO login audit log:', e);\n    }\n\n    const { error } = await supabase.from('audit_logs').insert({\n      tenant_id: tenantId,\n      user_id: session.user.id,\n      action: 'user.login',\n      resource: 'auth',\n      channel: 'sso',\n      ip_address: clientIP,\n      details: { provider, user_agent: navigator.userAgent },\n    });\n\n    if (error) {\n      console.warn('[Auth] Failed to log SSO login event:', error);\n    }\n  }, []);\n\n  useEffect(() => {\n    let mounted = true;\n    let initialResolved = false;\n\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event, session) => {\n        if (!mounted) return;\n\n        if (event === 'SIGNED_OUT') {\n          setSession(null);\n          setUser(null);\n          setLoading(false);\n          clearLocalAuth();\n          return;\n        }\n\n        if (!initialResolved || event === 'INITIAL_SESSION') {\n          initialResolved = true;\n          await handleSession(session);\n          if (event === 'SIGNED_IN') {\n            logSsoLoginEvent(session);\n          }\n          return;\n        }\n\n        if (event === 'SIGNED_IN') {\n          await handleSession(session);\n          logSsoLoginEvent(session);\n          return;\n        }\n\n        if (event === 'TOKEN_REFRESHED' || event === 'USER_UPDATED' || event === 'PASSWORD_RECOVERY' || event === 'MFA_CHALLENGE_VERIFIED') {\n          await handleSession(session);\n          return;\n        }\n\n        await handleSession(session);\n      },\n    );\n\n    const getSession = async () => {\n      try {\n        const { data: { session }, error } = await supabase.auth.getSession();\n        if (error) throw error;\n        if (mounted) {\n          initialResolved = true;\n          await handleSession(session);\n        }\n      } catch (error) {\n        console.error(\"Auth initialization error:\", error.message);\n\n        // Handle invalid refresh tokens by clearing session\n        if (\n          error.message?.includes('Invalid Refresh Token') ||\n          error.message?.includes('Refresh Token Not Found') ||\n          error.code === 'refresh_token_not_found'\n        ) {\n          console.warn(\"Detected invalid refresh token. Clearing session.\");\n          clearLocalAuth();\n\n          // Force sign out to ensure state is clean\n          await supabase.auth.signOut().catch(() => { });\n\n          if (mounted) {\n            setSession(null);\n            setUser(null);\n            setLoading(false);\n          }\n        } else {\n          if (mounted) setLoading(false);\n        }\n      }\n    };\n\n    getSession();\n\n    return () => {\n      mounted = false;\n      subscription.unsubscribe();\n    };\n  }, [handleSession, clearLocalAuth, logSsoLoginEvent]);\n\n  const signUp = useCallback(async (email, password, options) => {\n    try {\n      const { data, error } = await supabase.auth.signUp({\n        email,\n        password,\n        options,\n      });\n\n      if (error) throw error;\n      return { data, error: null };\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Sign up Failed\",\n        description: error.message || \"Something went wrong\",\n      });\n      return { data: null, error };\n    }\n  }, [toast]);\n\n  const signIn = useCallback(async (email, password) => {\n    try {\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (error) throw error;\n      return { data, error: null };\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Sign in Failed\",\n        description: error.message || \"Something went wrong\",\n      });\n      return { data: null, error };\n    }\n  }, [toast]);\n\n  const signOut = useCallback(async () => {\n    try {\n      // Attempt to sign out from Supabase\n      const { error } = await supabase.auth.signOut();\n      if (error) throw error;\n    } catch (error) {\n      // Check for common session errors that occur when already logged out\n      const isSessionError =\n        error.message?.includes('session_not_found') ||\n        error.code === '403' ||\n        error.code === 403 ||\n        error.status === 403 ||\n        error.message?.includes('JWT');\n\n      if (!isSessionError) {\n        console.error(\"Sign out error:\", error);\n      }\n    } finally {\n      // CRITICAL: Force clear local state and storage regardless of server response\n      setSession(null);\n      setUser(null);\n      clearLocalAuth();\n    }\n  }, [clearLocalAuth]);\n\n  const resetPassword = useCallback(async (email) => {\n    try {\n      const { error } = await supabase.auth.resetPasswordForEmail(email, {\n        redirectTo: `${window.location.origin}/cmspanel/update-password`,\n      });\n      if (error) throw error;\n      return { error: null };\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Reset Password Failed\",\n        description: error.message || \"Something went wrong\",\n      });\n      return { error };\n    }\n  }, [toast]);\n\n  const value = useMemo(() => ({\n    user,\n    session,\n    loading,\n    twoFactorEnabled,\n    signUp,\n    signIn,\n    signOut,\n    resetPassword\n  }), [user, session, loading, twoFactorEnabled, signUp, signIn, signOut, resetPassword]);\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/contexts/TenantContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":92,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":92,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { supabase, setGlobalTenantId } from '@/lib/customSupabaseClient';\n\nconst TenantContext = createContext(undefined);\n\nexport const TenantProvider = ({ children }) => {\n    const [currentTenant, setCurrentTenant] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        let mounted = true;\n\n        const resolveTenant = async () => {\n            try {\n                const hostname = window.location.hostname;\n                let lookupDomain = hostname;\n\n                // Dev mode handling: Use VITE_DEV_TENANT_SLUG or fall back to 'primary'\n                if (hostname === 'localhost' || hostname === '127.0.0.1') {\n                    lookupDomain = import.meta.env.VITE_DEV_TENANT_SLUG || 'primary';\n                    console.log('[TenantContext] Dev mode detected. Using slug:', lookupDomain);\n                }\n\n                // Call RPC logic\n                const { data, error } = await supabase\n                    .rpc('get_tenant_by_domain', { lookup_domain: lookupDomain });\n\n                if (error) {\n                    throw error;\n                }\n\n                if (mounted) {\n                    if (data) {\n                        console.log('[TenantContext] Resolved Tenant:', data.name, data.id);\n                        if (data.status !== 'active') {\n                            console.warn('[TenantContext] Tenant is not active:', data.status);\n                            setError('Tenant is suspended or inactive');\n                        }\n                        // CRITICAL: Set the global tenant ID for the Supabase Client (RLS)\n                        setGlobalTenantId(data.id);\n                        setCurrentTenant(data);\n                    } else {\n                        console.warn('[TenantContext] No tenant found for domain:', lookupDomain);\n                        setError('Tenant not found');\n                    }\n                }\n\n            } catch (err) {\n                console.error('[TenantContext] Resolution error:', err);\n                if (mounted) setError(err.message);\n            } finally {\n                if (mounted) setLoading(false);\n            }\n        };\n\n        resolveTenant();\n\n        return () => {\n            mounted = false;\n        };\n    }, []);\n\n    const value = React.useMemo(() => ({ currentTenant, loading, error }), [currentTenant, loading, error]);\n\n    return (\n        <TenantContext.Provider value={value}>\n            {/* \n        Blocking render strategy:\n        We don't want to show ANY app UI until we know which tenant we are on.\n        Unless it's a critical error we might want to show a custom 404 page here.\n      */}\n            {loading ? (\n                <div className=\"flex items-center justify-center min-h-screen\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n                </div>\n            ) : error ? (\n                <div className=\"flex flex-col items-center justify-center min-h-screen\">\n                    <h1 className=\"text-2xl font-bold mb-2\">Tenant Not Found</h1>\n                    <p className=\"text-gray-600\">The requested domain is not configured.</p>\n                    {/* Debug info for dev */}\n                    {import.meta.env.DEV && <pre className=\"mt-4 p-2 bg-gray-100 rounded text-xs\">{error}</pre>}\n                </div>\n            ) : (\n                children\n            )}\n        </TenantContext.Provider>\n    );\n};\n\nexport const useTenant = () => {\n    const context = useContext(TenantContext);\n    if (context === undefined) {\n        throw new Error('useTenant must be used within a TenantProvider');\n    }\n    return context;\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/contexts/ThemeContext.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":12,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":12,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { applyTheme } from '@/lib/themeUtils';\n\nconst ThemeContext = createContext({\n  currentTheme: null,\n  refreshTheme: () => { },\n  loading: true\n});\n\nexport const useTheme = () => useContext(ThemeContext);\n\nexport const ThemeProvider = ({ children }) => {\n  const [currentTheme, setCurrentTheme] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  const fetchActiveTheme = async () => {\n    try {\n      setLoading(true);\n      const { data } = await supabase\n        .from('themes')\n        .select('*')\n        .eq('is_active', true)\n        .is('deleted_at', null)\n        .maybeSingle();\n\n      if (data && data.config) {\n        setCurrentTheme(data);\n        applyTheme(data.config);\n      } else {\n        // Fallback or leave as is (default CSS)\n        console.log(\"No active theme found, using default.\");\n      }\n    } catch (err) {\n      console.error(\"Error fetching theme:\", err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchActiveTheme();\n\n    // Subscribe to theme changes to update in real-time\n    const channel = supabase\n      .channel('public:themes')\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'themes' }, (payload) => {\n        // If the active theme changed or the currently active theme was updated\n        if (payload.new && payload.new.is_active && !payload.new.deleted_at) {\n          setCurrentTheme(payload.new);\n          applyTheme(payload.new.config);\n        }\n      })\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, []);\n\n  return (\n    <ThemeContext.Provider value={{ currentTheme, refreshTheme: fetchActiveTheme, loading }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/extensions/ahliweb-analytics/src/components/AnalyticsDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[100,106],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":8,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"supabase"},"fix":{"range":[176,185],"text":""},"desc":"Remove unused variable 'supabase'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tenantId' is defined but never used.","line":8,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":49,"suggestions":[{"messageId":"removeVar","data":{"varName":"tenantId"},"fix":{"range":[184,194],"text":""},"desc":"Remove unused variable 'tenantId'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Analytics Dashboard Component\n * Main dashboard view for the Analytics extension\n */\n\nimport React, { useState, useEffect } from 'react';\n\nconst AnalyticsDashboard = ({ supabase, tenantId }) => {\n    const [loading, setLoading] = useState(true);\n    const [stats, setStats] = useState({\n        pageViews: 0,\n        uniqueVisitors: 0,\n        avgSessionDuration: '0m',\n        bounceRate: '0%'\n    });\n\n    useEffect(() => {\n        // Simulate loading analytics data\n        const timer = setTimeout(() => {\n            setStats({\n                pageViews: 12450,\n                uniqueVisitors: 3240,\n                avgSessionDuration: '4m 32s',\n                bounceRate: '42%'\n            });\n            setLoading(false);\n        }, 1000);\n\n        return () => clearTimeout(timer);\n    }, []);\n\n    if (loading) {\n        return (\n            <div className=\"animate-pulse space-y-4\">\n                <div className=\"h-8 w-64 bg-gray-200 rounded\"></div>\n                <div className=\"grid grid-cols-4 gap-4\">\n                    {[1, 2, 3, 4].map(i => (\n                        <div key={i} className=\"h-24 bg-gray-200 rounded-lg\"></div>\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div>\n                <h1 className=\"text-2xl font-bold\">Analytics Dashboard</h1>\n                <p className=\"text-gray-500\">Track visitor activity and engagement</p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <StatCard\n                    title=\"Page Views\"\n                    value={stats.pageViews.toLocaleString()}\n                    icon=\"\"\n                    trend=\"+12%\"\n                />\n                <StatCard\n                    title=\"Unique Visitors\"\n                    value={stats.uniqueVisitors.toLocaleString()}\n                    icon=\"\"\n                    trend=\"+8%\"\n                />\n                <StatCard\n                    title=\"Avg. Session\"\n                    value={stats.avgSessionDuration}\n                    icon=\"\"\n                    trend=\"+5%\"\n                />\n                <StatCard\n                    title=\"Bounce Rate\"\n                    value={stats.bounceRate}\n                    icon=\"\"\n                    trend=\"-3%\"\n                    trendPositive={true}\n                />\n            </div>\n\n            <div className=\"bg-white rounded-lg border p-6\">\n                <h2 className=\"text-lg font-semibold mb-4\">Traffic Overview</h2>\n                <div className=\"h-64 flex items-center justify-center text-gray-400\">\n                    [Chart placeholder - integrate with actual analytics data]\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst StatCard = ({ title, value, icon, trend, trendPositive = false }) => (\n    <div className=\"bg-white rounded-lg border p-4\">\n        <div className=\"flex items-center justify-between\">\n            <span className=\"text-2xl\">{icon}</span>\n            <span className={`text-sm font-medium ${trend.startsWith('+') && !trendPositive ? 'text-green-600' :\n                    trend.startsWith('-') && trendPositive ? 'text-green-600' :\n                        'text-red-600'\n                }`}>\n                {trend}\n            </span>\n        </div>\n        <p className=\"mt-2 text-2xl font-bold\">{value}</p>\n        <p className=\"text-gray-500 text-sm\">{title}</p>\n    </div>\n);\n\nexport default AnalyticsDashboard;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/extensions/ahliweb-analytics/src/components/AnalyticsReports.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[47,58],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Analytics Reports Component\n */\n\nimport React from 'react';\n\nconst AnalyticsReports = () => {\n    return (\n        <div className=\"space-y-6\">\n            <div>\n                <h1 className=\"text-2xl font-bold\">Analytics Reports</h1>\n                <p className=\"text-gray-500\">Generate and export detailed reports</p>\n            </div>\n\n            <div className=\"bg-white rounded-lg border p-6\">\n                <p className=\"text-gray-500 text-center py-12\">\n                    Reports module - Coming soon\n                </p>\n            </div>\n        </div>\n    );\n};\n\nexport default AnalyticsReports;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/extensions/ahliweb-analytics/src/components/AnalyticsWidget.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[90,101],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Analytics Widget Component\n * Compact widget for dashboard integration\n */\n\nimport React from 'react';\nimport { cn } from '@/lib/utils';\n\nconst AnalyticsWidget = ({ className = '' }) => {\n    return (\n        <div className={cn('bg-gradient-to-br from-blue-500 to-indigo-600 p-6 text-white', className)}>\n            <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"font-semibold\">Quick Stats</h3>\n                <span className=\"text-xs text-white/75\">Today</span>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                    <p className=\"text-2xl font-bold\">1,234</p>\n                    <p className=\"text-xs text-white/80\">Page Views</p>\n                </div>\n                <div>\n                    <p className=\"text-2xl font-bold\">456</p>\n                    <p className=\"text-xs text-white/80\">Visitors</p>\n                </div>\n            </div>\n\n            <a href=\"/admin/analytics\" className=\"block mt-4 text-center text-xs font-medium text-white/80 hover:text-white\">\n                View Full Analytics \n            </a>\n        </div>\n    );\n};\n\nexport default AnalyticsWidget;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/extensions/ahliweb-analytics/src/index.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":90,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":90,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"supabase"},"fix":{"range":[2860,2869],"text":""},"desc":"Remove unused variable 'supabase'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tenantId' is defined but never used.","line":90,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":90,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"tenantId"},"fix":{"range":[2868,2878],"text":""},"desc":"Remove unused variable 'tenantId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":102,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":102,"endColumn":42,"suggestions":[{"messageId":"removeVar","data":{"varName":"supabase"},"fix":{"range":[3232,3241],"text":""},"desc":"Remove unused variable 'supabase'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tenantId' is defined but never used.","line":102,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":102,"endColumn":52,"suggestions":[{"messageId":"removeVar","data":{"varName":"tenantId"},"fix":{"range":[3240,3250],"text":""},"desc":"Remove unused variable 'tenantId'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AWCMS External Extension: Advanced Analytics\n * \n * This is an example external extension demonstrating the plugin architecture.\n * External extensions are loaded dynamically by AWCMS at runtime.\n */\n\n// import React from 'react';\nimport AnalyticsDashboard from './components/AnalyticsDashboard';\nimport AnalyticsReports from './components/AnalyticsReports';\nimport AnalyticsWidget from './components/AnalyticsWidget';\nimport manifest from '../manifest.json';\n\n// Export components\nexport const components = {\n    AnalyticsDashboard,\n    AnalyticsReports,\n    AnalyticsWidget\n};\n\n// Export manifest\nexport { manifest };\n\n/**\n * Register extension hooks and filters\n * Called when extension is loaded by AWCMS\n */\nexport const register = ({ addAction, addFilter, supabase, pluginConfig }) => {\n    console.log(`[External Extension] ${manifest.name} v${manifest.version} registering...`);\n\n    // Register dashboard widget\n    addFilter('dashboard_widgets', 'analytics_widget', (widgets) => {\n        return [...widgets, {\n            id: 'analytics-overview',\n            title: 'Analytics Overview',\n            component: 'awcms-ext-ahliweb-analytics:AnalyticsWidget',\n            size: 'large',\n            order: 1,\n            frame: 'flush',\n            props: {\n                className: 'rounded-none'\n            }\n        }];\n    });\n\n    // Register admin menu item\n    addFilter('admin_menu_items', 'analytics_menu', (items) => {\n        return [...items, {\n            id: 'analytics',\n            label: manifest.menu.label,\n            icon: manifest.menu.icon,\n            path: manifest.menu.path,\n            parent: manifest.menu.parent,\n            order: manifest.menu.order,\n            permission: 'ext.analytics.view'\n        }];\n    });\n\n    // Register routes\n    addFilter('admin_routes', 'analytics_routes', (routes) => {\n        return [...routes,\n        { path: '/admin/analytics', element: AnalyticsDashboard, permission: 'ext.analytics.view' },\n        { path: '/admin/analytics/reports', element: AnalyticsReports, permission: 'ext.analytics.reports' }\n        ];\n    });\n\n    // Track page views (example action hook)\n    addAction('page_viewed', 'analytics_track', async ({ path, userId, tenantId }) => {\n        if (!pluginConfig?.trackPageViews) return;\n\n        try {\n            await supabase.from('analytics_events').insert({\n                event_type: 'page_view',\n                path,\n                user_id: userId,\n                tenant_id: tenantId,\n                created_at: new Date().toISOString()\n            });\n        } catch (err) {\n            console.error('[Analytics] Failed to track page view:', err);\n        }\n    });\n\n    console.log(`[External Extension] ${manifest.name} registered successfully`);\n};\n\n/**\n * Activate extension (first-time setup)\n */\nexport const activate = async (supabase, tenantId) => {\n    console.log(`[External Extension] Activating ${manifest.name}...`);\n\n    // Create analytics table if not exists (via RPC or migration)\n    // Note: In production, DDL should be done via proper migrations\n\n    console.log(`[External Extension] ${manifest.name} activated`);\n};\n\n/**\n * Deactivate extension\n */\nexport const deactivate = async (supabase, tenantId) => {\n    console.log(`[External Extension] Deactivating ${manifest.name}...`);\n    // Cleanup if needed\n};\n\n// Default export\nexport default AnalyticsDashboard;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/__tests__/useTwoFactor.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useAdminMenu.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useAuditLog.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useDashboardData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useDevices.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useExtensionAudit.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useMedia.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useMobileUsers.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":47,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * useMobileUsers Hook\n * Fetch and manage mobile app users\n */\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useToast } from '@/components/ui/use-toast';\n\nexport function useMobileUsers() {\n    const [users, setUsers] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [stats, setStats] = useState({ total: 0, ios: 0, android: 0, active: 0 });\n    const { tenantId } = usePermissions();\n    const { toast } = useToast();\n\n    // Fetch mobile users\n    const fetchUsers = useCallback(async () => {\n        if (!tenantId) return;\n\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('mobile_users')\n                .select(`\n          *,\n          user:users(id, full_name, email, avatar_url)\n        `)\n                .eq('tenant_id', tenantId)\n                .is('deleted_at', null)\n                .order('last_active', { ascending: false });\n\n            if (error) throw error;\n\n            setUsers(data || []);\n\n            // Calculate stats\n            const total = data?.length || 0;\n            const ios = data?.filter((u) => u.device_type === 'ios').length || 0;\n            const android = data?.filter((u) => u.device_type === 'android').length || 0;\n            const now = new Date();\n            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n            const active = data?.filter((u) => new Date(u.last_active) > weekAgo).length || 0;\n\n            setStats({ total, ios, android, active });\n        } catch (err) {\n            toast({\n                variant: 'destructive',\n                title: 'Error',\n                description: 'Failed to fetch mobile users',\n            });\n        } finally {\n            setLoading(false);\n        }\n    }, [tenantId, toast]);\n\n    useEffect(() => {\n        fetchUsers();\n    }, [fetchUsers]);\n\n    // Delete user registration\n    const deleteUser = async (id) => {\n        try {\n            const { error } = await supabase\n                .from('mobile_users')\n                .update({ deleted_at: new Date().toISOString() })\n                .eq('id', id);\n\n            if (error) throw error;\n\n            setUsers((prev) => prev.filter((u) => u.id !== id));\n            toast({ title: 'User Removed' });\n        } catch (err) {\n            toast({\n                variant: 'destructive',\n                title: 'Error',\n                description: err.message,\n            });\n        }\n    };\n\n    return {\n        users,\n        loading,\n        stats,\n        fetchUsers,\n        deleteUser,\n    };\n}\n\nexport default useMobileUsers;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useNotifications.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/usePlatformStats.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/usePublicTenant.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/usePushNotifications.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":37,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * usePushNotifications Hook\n * Manage push notification campaigns\n */\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { useToast } from '@/components/ui/use-toast';\n\nexport function usePushNotifications() {\n    const [notifications, setNotifications] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const { tenantId } = usePermissions();\n    const { user } = useAuth();\n    const { toast } = useToast();\n\n    // Fetch notifications\n    const fetchNotifications = useCallback(async () => {\n        if (!tenantId) return;\n\n        setLoading(true);\n        try {\n            const { data, error } = await supabase\n                .from('push_notifications')\n                .select(`\n          *,\n          created_by_user:users!push_notifications_created_by_fkey(full_name)\n        `)\n                .eq('tenant_id', tenantId)\n                .is('deleted_at', null)\n                .order('created_at', { ascending: false });\n\n            if (error) throw error;\n            setNotifications(data || []);\n        } catch (err) {\n            toast({\n                variant: 'destructive',\n                title: 'Error',\n                description: 'Failed to fetch notifications',\n            });\n        } finally {\n            setLoading(false);\n        }\n    }, [tenantId, toast]);\n\n    useEffect(() => {\n        fetchNotifications();\n    }, [fetchNotifications]);\n\n    // Create notification\n    const createNotification = async (data) => {\n        try {\n            const { data: newData, error } = await supabase\n                .from('push_notifications')\n                .insert({\n                    ...data,\n                    tenant_id: tenantId,\n                    created_by: user?.id,\n                    deleted_at: null,\n                })\n                .select()\n                .single();\n\n            if (error) throw error;\n\n            setNotifications((prev) => [newData, ...prev]);\n            toast({ title: 'Notification Created' });\n            return newData;\n        } catch (err) {\n            toast({\n                variant: 'destructive',\n                title: 'Error',\n                description: err.message,\n            });\n            throw err;\n        }\n    };\n\n    // Send notification\n    const sendNotification = async (id) => {\n        try {\n            const { error } = await supabase\n                .from('push_notifications')\n                .update({\n                    status: 'sent',\n                    sent_at: new Date().toISOString(),\n                })\n                .eq('id', id);\n\n            if (error) throw error;\n\n            setNotifications((prev) =>\n                prev.map((n) =>\n                    n.id === id\n                        ? { ...n, status: 'sent', sent_at: new Date().toISOString() }\n                        : n\n                )\n            );\n            toast({ title: 'Notification Sent' });\n        } catch (err) {\n            toast({\n                variant: 'destructive',\n                title: 'Error',\n                description: err.message,\n            });\n        }\n    };\n\n    // Delete notification\n    const deleteNotification = async (id) => {\n        try {\n            const { error } = await supabase\n                .from('push_notifications')\n                .update({ deleted_at: new Date().toISOString() })\n                .eq('id', id);\n\n            if (error) throw error;\n\n            setNotifications((prev) => prev.filter((n) => n.id !== id));\n            toast({ title: 'Notification Moved to Trash' });\n        } catch (err) {\n            toast({\n                variant: 'destructive',\n                title: 'Error',\n                description: err.message,\n            });\n        }\n    };\n\n    return {\n        notifications,\n        loading,\n        fetchNotifications,\n        createNotification,\n        sendNotification,\n        deleteNotification,\n    };\n}\n\nexport default usePushNotifications;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useRegions.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useSearch.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'context' is assigned a value but never used.","line":14,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"context"},"fix":{"range":[499,524],"text":""},"desc":"Remove unused variable 'context'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { useState, useEffect, useCallback } from 'react';\n\n/**\n * Custom hook for managing search state with validation and debouncing\n * @param {Object} options\n * @param {number} options.minLength - Minimum characters required for search (default: 5)\n * @param {string} options.context - Context of search (admin/public)\n * @param {string} options.initialQuery - Initial search term\n * @param {number} options.debounceTime - Debounce delay in ms\n */\nexport function useSearch({ \n    minLength = 5, \n    context = 'public', \n    initialQuery = '',\n    debounceTime = 500 \n} = {}) {\n  const [query, setQuery] = useState(initialQuery);\n  const [debouncedQuery, setDebouncedQuery] = useState(initialQuery);\n  const [loading, setLoading] = useState(false);\n\n  // Determine if the query is valid for searching\n  // Empty query is valid (means \"show all\")\n  // Query >= minLength is valid\n  // Query between 0 and minLength is INVALID\n  const isValid = query.length === 0 || query.length >= minLength;\n\n  let message = '';\n  if (!isValid) {\n      const remaining = minLength - query.length;\n      message = `Please enter ${remaining} more character${remaining > 1 ? 's' : ''} to search`;\n  }\n\n  // Debounce logic\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      // Only update debounced query if it's valid or empty\n      // This prevents triggering fetches for invalid intermediate states\n      if (isValid) {\n          setDebouncedQuery(query);\n      }\n    }, debounceTime);\n\n    return () => clearTimeout(timer);\n  }, [query, debounceTime, isValid]);\n\n  const clearSearch = useCallback(() => {\n    setQuery('');\n    setDebouncedQuery('');\n  }, []);\n\n  return {\n    query,\n    setQuery,\n    debouncedQuery,\n    isValid,\n    message,\n    loading,\n    setLoading,\n    clearSearch,\n    minLength\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useSensorData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useTemplateStrings.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useTemplates.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":120,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[4308,4311],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'created_at' is assigned a value but never used.","line":120,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":35,"suggestions":[{"messageId":"removeVar","data":{"varName":"created_at"},"fix":{"range":[4310,4322],"text":""},"desc":"Remove unused variable 'created_at'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updated_at' is assigned a value but never used.","line":120,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"updated_at"},"fix":{"range":[4322,4334],"text":""},"desc":"Remove unused variable 'updated_at'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useToast } from '@/components/ui/use-toast';\n\nexport const useTemplates = () => {\n    const { toast } = useToast();\n    const [templates, setTemplates] = useState([]);\n    const [templateParts, setTemplateParts] = useState([]);\n    const [assignments, setAssignments] = useState([]);\n    const [templateStrings, setTemplateStrings] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    const fetchData = useCallback(async () => {\n        setLoading(true);\n        try {\n            // Fetch templates\n            const { data: templatesData, error: templatesError } = await supabase\n                .from('templates')\n                .select('*')\n                .order('is_active', { ascending: false })\n                .order('created_at', { ascending: false })\n                .is('deleted_at', null);\n\n            if (templatesError) throw templatesError;\n\n            // Fetch template parts\n            const { data: partsData, error: partsError } = await supabase\n                .from('template_parts')\n                .select('*')\n                .order('created_at', { ascending: false })\n                .is('deleted_at', null);\n\n            if (partsError) throw partsError;\n\n            // Fetch template assignments\n            const { data: assignmentsData, error: assignmentsError } = await supabase\n                .from('template_assignments')\n                .select('route_type, template_id, channel')\n                .order('created_at', { ascending: false });\n\n            if (assignmentsError) throw assignmentsError;\n\n            // Fetch template strings\n            const { data: stringsData, error: stringsError } = await supabase\n                .from('template_strings')\n                .select('*')\n                .is('deleted_at', null)\n                .order('key', { ascending: true });\n\n            if (stringsError && stringsError.code !== '42P01') {\n                console.warn(\"Error fetching template strings:\", stringsError);\n            }\n\n            setTemplates(templatesData || []);\n            setTemplateParts(partsData || []);\n            setTemplateStrings(stringsData || []);\n            setAssignments(assignmentsData || []);\n\n        } catch (error) {\n            console.error(\"Error fetching all data:\", error);\n            toast({ title: 'Error', description: 'Failed to fetch data', variant: 'destructive' });\n        } finally {\n            setLoading(false);\n        }\n    }, [toast]);\n\n    // --- Template CRUD ---\n\n    const createTemplate = async (templateData) => {\n        try {\n            const { data, error } = await supabase\n                .from('templates')\n                .insert([templateData])\n                .select()\n                .single();\n\n            if (error) throw error;\n            toast({ title: \"Success\", description: \"Template created successfully.\" });\n            fetchData();\n            return data;\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n            throw error;\n        }\n    };\n\n    const updateTemplate = async (id, updates) => {\n        try {\n            const { error } = await supabase\n                .from('templates')\n                .update(updates)\n                .eq('id', id);\n\n            if (error) throw error;\n            toast({ title: \"Success\", description: \"Template updated successfully.\" });\n            fetchData();\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n            throw error;\n        }\n    };\n\n    const deleteTemplate = async (id) => {\n        try {\n            const { error } = await supabase\n                .from('templates')\n                .update({ deleted_at: new Date().toISOString() })\n                .eq('id', id);\n\n            if (error) throw error;\n            toast({ title: \"Deleted\", description: \"Template removed.\" });\n            fetchData();\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n        }\n    };\n\n    const duplicateTemplate = async (template) => {\n        try {\n            const { id, created_at, updated_at, ...rest } = template;\n            const newTemplate = {\n                ...rest,\n                name: `${template.name} (Copy)`,\n                slug: `${template.slug}-copy-${Date.now()}`,\n                tenant_id: undefined // Let DB/RLS handle it or ensure it's copied if needed\n            };\n\n            const { error } = await supabase.from('templates').insert([newTemplate]);\n            if (error) throw error;\n\n            toast({ title: \"Success\", description: \"Template duplicated.\" });\n            fetchData();\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n        }\n    };\n\n    // --- Part CRUD ---\n\n    const createTemplatePart = async (partData) => {\n        try {\n            const { data, error } = await supabase\n                .from('template_parts')\n                .insert([partData])\n                .select()\n                .single();\n\n            if (error) throw error;\n            toast({ title: \"Success\", description: \"Part created.\" });\n            fetchData();\n            return data;\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n            throw error;\n        }\n    };\n\n    const updateTemplatePart = async (id, updates) => {\n        try {\n            const { error } = await supabase\n                .from('template_parts')\n                .update(updates)\n                .eq('id', id);\n\n            if (error) throw error;\n            toast({ title: \"Success\", description: \"Part updated successfully.\" });\n            fetchData();\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n            throw error;\n        }\n    };\n\n    const deleteTemplatePart = async (id) => {\n        try {\n            const { error } = await supabase\n                .from('template_parts')\n                .update({ deleted_at: new Date().toISOString() })\n                .eq('id', id);\n\n            if (error) throw error;\n            toast({ title: \"Deleted\", description: \"Part removed.\" });\n            fetchData();\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n        }\n    };\n\n    // --- Assignment CRUD ---\n\n    const updateAssignment = async (type, templateId, channel = 'web') => {\n        try {\n            const { error } = await supabase\n                .from('template_assignments')\n                .upsert({\n                    route_type: type,\n                    template_id: templateId,\n                    channel: channel,\n                    updated_at: new Date().toISOString()\n                }, { onConflict: 'tenant_id, channel, route_type' }); // Ensure DB constraint matches\n\n            if (error) throw error;\n            // Optimistic update\n            setAssignments(prev => {\n                const filtered = prev.filter(a => !(a.route_type === type && a.channel === channel));\n                return [...filtered, { route_type: type, template_id: templateId, channel }];\n            });\n            // Background refresh\n            fetchData();\n            toast({ title: \"Success\", description: \"Assignment updated\" });\n        } catch (error) {\n            console.error(\"Error updating assignment:\", error);\n            toast({ title: \"Error\", description: \"Failed to update assignment\", variant: \"destructive\" });\n        }\n    };\n\n    // --- Template String CRUD ---\n\n    const updateTemplateString = async (stringId, updates) => {\n        try {\n            // If ID is 'new', it's an insert\n            if (stringId === 'new') {\n                const context = updates.context || 'default';\n                const { data: existingRow, error: existingError } = await supabase\n                    .from('template_strings')\n                    .select('id')\n                    .eq('key', updates.key)\n                    .eq('locale', updates.locale)\n                    .eq('context', context)\n                    .maybeSingle();\n\n                if (existingError) throw existingError;\n\n                if (existingRow) {\n                    const { error } = await supabase\n                        .from('template_strings')\n                        .update({ ...updates, context, deleted_at: null })\n                        .eq('id', existingRow.id);\n                    if (error) throw error;\n                } else {\n                    const { error } = await supabase\n                        .from('template_strings')\n                        .insert([{ ...updates, context, deleted_at: null }]);\n                    if (error) throw error;\n                }\n            } else {\n                const { error } = await supabase\n                    .from('template_strings')\n                    .update({ ...updates, deleted_at: null })\n                    .eq('id', stringId);\n                if (error) throw error;\n            }\n            await fetchData();\n            toast({ title: \"Saved\", description: \"Translation saved.\" });\n            return true;\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n            return false;\n        }\n    };\n\n    const deleteTemplateString = async (id) => {\n        try {\n            const { error } = await supabase\n                .from('template_strings')\n                .update({ deleted_at: new Date().toISOString() })\n                .eq('id', id);\n\n            if (error) throw error;\n            await fetchData();\n            toast({ title: \"Deleted\", description: \"Translation removed.\" });\n        } catch (error) {\n            toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n        }\n    };\n\n\n    useEffect(() => {\n        fetchData();\n    }, [fetchData]);\n\n    return {\n        templates,\n        templateParts,\n        assignments,\n        templateStrings,\n        loading,\n        createTemplate,\n        updateTemplate,\n        deleteTemplate,\n        duplicateTemplate,\n        createTemplatePart,\n        updateTemplatePart,\n        deleteTemplatePart,\n        updateAssignment,\n        updateTemplateString,\n        deleteTemplateString,\n        refresh: fetchData\n    };\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useTenantTheme.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useTwoFactor.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useWidgets.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/hooks/useWorkflow.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'comment' is assigned a value but never used.","line":58,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":49,"suggestions":[{"messageId":"removeVar","data":{"varName":"comment"},"fix":{"range":[2222,2236],"text":""},"desc":"Remove unused variable 'comment'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useToast } from '@/components/ui/use-toast';\n\nexport const WORKFLOW_STATES = {\n    DRAFT: 'draft',\n    REVIEWED: 'reviewed',\n    APPROVED: 'approved',\n    PUBLISHED: 'published'\n};\n\n/**\n * Hook for managing Workflow State Transitions\n * @returns {object} { updateState, canTransition, currentState }\n */\nexport function useWorkflow(initialState = 'draft', resourceType = 'posts', resourceId = null) {\n    const { user } = useAuth();\n    const { hasPermission } = usePermissions();\n    const { toast } = useToast();\n    const [currentState, setCurrentState] = useState(initialState);\n    const [loading, setLoading] = useState(false);\n\n    /**\n     * Checks if the current user can transition to the target state\n     * @param {string} targetState \n     * @returns {boolean}\n     */\n    const canTransition = useCallback((targetState) => {\n        if (!user) return false;\n\n        const permissionResource = resourceType === 'blog' ? 'blog' : resourceType;\n\n        // Simple State Machine Logic:\n        switch (targetState) {\n            case WORKFLOW_STATES.DRAFT:\n                return true; // Anyone can revert to draft if they have edit rights\n            case WORKFLOW_STATES.REVIEWED:\n                // Author can request review\n                return hasPermission(`tenant.${permissionResource}.create`) || hasPermission(`tenant.${permissionResource}.update`);\n            case WORKFLOW_STATES.APPROVED:\n                // Editor/Admin only\n                return hasPermission(`tenant.${permissionResource}.publish`);\n            case WORKFLOW_STATES.PUBLISHED:\n                // Editor/Admin only\n                return hasPermission(`tenant.${permissionResource}.publish`);\n            default:\n                return false;\n        }\n    }, [user, hasPermission, resourceType]);\n\n    /**\n     * Updates the workflow state\n     * @param {string} newState \n     * @param {string} comment - Optional comment for the log (future)\n     */\n    const updateState = async (newState, comment = '') => {\n        if (!resourceId) {\n            console.error('Cannot update workflow: No Resource ID');\n            return false;\n        }\n\n        if (!canTransition(newState)) {\n            toast({ variant: \"destructive\", title: \"Access Denied\", description: \"You cannot move to this state.\" });\n            return false;\n        }\n\n        setLoading(true);\n        try {\n            const table = resourceType === 'page' ? 'pages' : (resourceType === 'blog' ? 'blogs' : 'posts');\n\n            const payload = {\n                workflow_state: newState,\n                updated_at: new Date().toISOString()\n            };\n\n            // If publishing, update status column too for backward compatibility\n            if (newState === WORKFLOW_STATES.PUBLISHED) {\n                payload.status = 'published';\n            } else if (newState === WORKFLOW_STATES.DRAFT) {\n                payload.status = 'draft';\n            }\n\n            const { error } = await supabase\n                .from(table)\n                .update(payload)\n                .eq('id', resourceId);\n\n            if (error) throw error;\n\n            setCurrentState(newState);\n            toast({ title: \"Workflow Updated\", description: `State changed to ${newState}` });\n            return true;\n        } catch (err) {\n            console.error('Workflow update failed:', err);\n            toast({ variant: \"destructive\", title: \"Update Failed\", description: err.message });\n            return false;\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return {\n        currentState,\n        setCurrentState,\n        updateState,\n        canTransition,\n        loading,\n        WORKFLOW_STATES\n    };\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/adminIcons.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/customSupabaseClient.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/data/UnifiedDataManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/data/UnifiedDataManager.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/email/mailketingService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/extensionRegistry.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/externalExtensionLoader.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/hooks.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/i18n.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/pluginRegistry.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/publicModuleRegistry.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/regionUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/supabaseAdmin.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/templateExtensions.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/themeUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/tierFeatures.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/utils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/version.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/lib/widgetRegistry.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/main.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from '@/App';\nimport '@/index.css';\nimport '@/lib/i18n';\nimport { initTemplateExtensions } from '@/lib/templateExtensions';\n\n// Initialize extension hooks before app renders\ninitTemplateExtensions();\n\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <App />\n);\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/Dashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { motion } from 'framer-motion';\nimport Sidebar from '@/components/dashboard/Sidebar';\nimport Header from '@/components/dashboard/Header';\nimport DashboardHome from '@/components/dashboard/DashboardHome';\nimport BlogsManager from '@/components/dashboard/BlogsManager';\nimport PagesManager from '@/components/dashboard/PagesManager';\nimport ProductsManager from '@/components/dashboard/ProductsManager';\nimport PortfolioManager from '@/components/dashboard/PortfolioManager';\nimport AnnouncementsManager from '@/components/dashboard/AnnouncementsManager';\nimport PromotionsManager from '@/components/dashboard/PromotionsManager';\nimport PhotoGalleryManager from '@/components/dashboard/PhotoGalleryManager';\nimport VideoGalleryManager from '@/components/dashboard/VideoGalleryManager';\nimport UsersManager from '@/components/dashboard/UsersManager';\nimport RolesManager from '@/components/dashboard/RolesManager';\nimport AuditLogsERP from '@/components/dashboard/AuditLogsERP';\nimport PolicyManager from '@/components/dashboard/PolicyManager';\nimport UserProfile from '@/components/dashboard/UserProfile';\nimport { Helmet } from 'react-helmet-async';\n\nfunction Dashboard() {\n  const { t } = useTranslation();\n  const [currentPage, setCurrentPage] = useState('home');\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n\n  const renderContent = () => {\n    switch (currentPage) {\n      case 'home':\n        return <DashboardHome />;\n      case 'blogs':\n        return <BlogsManager />;\n      case 'pages':\n        return <PagesManager />;\n      case 'products':\n        return <ProductsManager />;\n      case 'portfolio':\n        return <PortfolioManager />;\n      case 'announcements':\n        return <AnnouncementsManager />;\n      case 'promotions':\n        return <PromotionsManager />;\n      case 'photo-gallery':\n        return <PhotoGalleryManager />;\n      case 'video-gallery':\n        return <VideoGalleryManager />;\n      case 'users':\n        return <UsersManager />;\n      case 'roles':\n        return <RolesManager />;\n      case 'audit-logs':\n        return <AuditLogsERP />;\n      case 'policies':\n        return <PolicyManager />;\n      case 'profile':\n        return <UserProfile />;\n      default:\n        return <DashboardHome />;\n    }\n  };\n\n  return (\n    <>\n      <Helmet>\n        <title>{t('dashboard_page.title')}</title>\n        <meta name=\"description\" content={t('dashboard_page.meta_description')} />\n      </Helmet>\n      {/* Force text-slate-900 to ensure high contrast on the light background */}\n      <div className=\"flex h-screen bg-slate-50 text-slate-900 overflow-hidden\">\n        <Sidebar\n          currentPage={currentPage}\n          setCurrentPage={setCurrentPage}\n          isOpen={sidebarOpen}\n          setIsOpen={setSidebarOpen}\n        />\n\n        <div className=\"flex-1 flex flex-col overflow-hidden\">\n          <Header\n            toggleSidebar={() => setSidebarOpen(!sidebarOpen)}\n            onNavigate={(page) => setCurrentPage(page)}\n          />\n\n          <main className=\"flex-1 overflow-y-auto p-6 bg-slate-50/50\">\n            <motion.div\n              key={currentPage}\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.2 }}\n            >\n              {renderContent()}\n            </motion.div>\n          </main>\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default Dashboard;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/LoginPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { LogIn, UserPlus, ShieldCheck, Sparkles } from 'lucide-react';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Helmet } from 'react-helmet-async';\nimport AuthShell from '@/components/auth/AuthShell';\n\nfunction LoginPage() {\n  const { t } = useTranslation();\n  const { signIn, signUp } = useAuth();\n  const [isLoading, setIsLoading] = useState(false);\n\n  const [loginData, setLoginData] = useState({ email: '', password: '' });\n  const [signupData, setSignupData] = useState({ email: '', password: '', fullName: '' });\n\n  const sideItems = [\n    {\n      icon: ShieldCheck,\n      title: t('login_page.security_title', 'Secure sign-in'),\n      description: t('login_page.security_desc', 'Turnstile and audit logging keep access protected.'),\n    },\n    {\n      icon: Sparkles,\n      title: t('login_page.experience_title', 'Refined experience'),\n      description: t('login_page.experience_desc', 'Switch between login and signup without leaving the page.'),\n    },\n  ];\n\n  const shellProps = {\n    sideItems,\n    sideTitle: t('login_page.shell_title', 'Account Access'),\n    sideSubtitle: t('login_page.shell_subtitle', 'Sign in or create your account to continue.'),\n  };\n\n  const handleLogin = async (e) => {\n    e.preventDefault();\n    setIsLoading(true);\n    await signIn(loginData.email, loginData.password);\n    setIsLoading(false);\n  };\n\n  const handleSignup = async (e) => {\n    e.preventDefault();\n    setIsLoading(true);\n    await signUp(signupData.email, signupData.password, {\n      data: { full_name: signupData.fullName }\n    });\n    setIsLoading(false);\n  };\n\n  return (\n    <>\n      <Helmet>\n        <title>{t('login_page.title')}</title>\n        <meta name=\"description\" content={t('login_page.meta_description')} />\n      </Helmet>\n      <AuthShell\n        title={t('login_page.heading')}\n        subtitle={t('login_page.subheading')}\n        badge={t('login_page.badge', 'Account Access')}\n        {...shellProps}\n      >\n        <Tabs defaultValue=\"login\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-2 rounded-xl bg-slate-100 p-1 text-sm text-slate-500\">\n            <TabsTrigger value=\"login\" className=\"rounded-lg data-[state=active]:bg-white data-[state=active]:text-slate-900\">\n              {t('login_page.tab_login')}\n            </TabsTrigger>\n            <TabsTrigger value=\"signup\" className=\"rounded-lg data-[state=active]:bg-white data-[state=active]:text-slate-900\">\n              {t('login_page.tab_signup')}\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"login\" className=\"mt-6\">\n            <form onSubmit={handleLogin} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"login-email\" className=\"text-sm font-medium text-slate-600\">{t('login_page.email_label')}</Label>\n                <Input\n                  id=\"login-email\"\n                  type=\"email\"\n                  placeholder={t('login_page.email_placeholder')}\n                  value={loginData.email}\n                  onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}\n                  className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\"\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"login-password\" className=\"text-sm font-medium text-slate-600\">{t('login_page.password_label')}</Label>\n                <Input\n                  id=\"login-password\"\n                  type=\"password\"\n                  placeholder={t('login_page.password_placeholder')}\n                  value={loginData.password}\n                  onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}\n                  className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\"\n                  required\n                />\n              </div>\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white\"\n                disabled={isLoading}\n              >\n                <LogIn className=\"w-4 h-4 mr-2\" />\n                {isLoading ? t('login_page.button_logging_in') : t('login_page.button_login')}\n              </Button>\n            </form>\n          </TabsContent>\n\n          <TabsContent value=\"signup\" className=\"mt-6\">\n            <form onSubmit={handleSignup} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"signup-name\" className=\"text-sm font-medium text-slate-600\">{t('login_page.fullname_label')}</Label>\n                <Input\n                  id=\"signup-name\"\n                  type=\"text\"\n                  placeholder={t('login_page.fullname_placeholder')}\n                  value={signupData.fullName}\n                  onChange={(e) => setSignupData({ ...signupData, fullName: e.target.value })}\n                  className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\"\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"signup-email\" className=\"text-sm font-medium text-slate-600\">{t('login_page.email_label')}</Label>\n                <Input\n                  id=\"signup-email\"\n                  type=\"email\"\n                  placeholder={t('login_page.email_placeholder')}\n                  value={signupData.email}\n                  onChange={(e) => setSignupData({ ...signupData, email: e.target.value })}\n                  className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\"\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"signup-password\" className=\"text-sm font-medium text-slate-600\">{t('login_page.password_label')}</Label>\n                <Input\n                  id=\"signup-password\"\n                  type=\"password\"\n                  placeholder={t('login_page.password_placeholder')}\n                  value={signupData.password}\n                  onChange={(e) => setSignupData({ ...signupData, password: e.target.value })}\n                  className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30\"\n                  required\n                />\n              </div>\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-emerald-600 hover:bg-emerald-700 text-white\"\n                disabled={isLoading}\n              >\n                <UserPlus className=\"w-4 h-4 mr-2\" />\n                {isLoading ? t('login_page.button_creating_account') : t('login_page.button_signup')}\n              </Button>\n            </form>\n          </TabsContent>\n        </Tabs>\n      </AuthShell>\n    </>\n  );\n}\n\nexport default LoginPage;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/Dashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { motion } from 'framer-motion';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { getPluginComponent } from '@/lib/pluginRegistry';\nimport { Helmet } from 'react-helmet-async';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\n// Core Components\nimport Sidebar from '@/components/dashboard/Sidebar';\nimport Header from '@/components/dashboard/Header';\n\n// Dashboard Modules\nimport AdminDashboard from '@/components/dashboard/AdminDashboard';\nimport BlogsManager from '@/components/dashboard/BlogsManager';\nimport PagesManager from '@/components/dashboard/PagesManager';\nimport ProductsManager from '@/components/dashboard/ProductsManager';\nimport ProductTypesManager from '@/components/dashboard/ProductTypesManager';\nimport PortfolioManager from '@/components/dashboard/PortfolioManager';\nimport AnnouncementsManager from '@/components/dashboard/AnnouncementsManager';\nimport PromotionsManager from '@/components/dashboard/PromotionsManager';\nimport TestimonyManager from '@/components/dashboard/TestimonyManager';\nimport PhotoGalleryManager from '@/components/dashboard/PhotoGalleryManager';\nimport VideoGalleryManager from '@/components/dashboard/VideoGalleryManager';\nimport ContactsManager from '@/components/dashboard/ContactsManager';\nimport ContactMessagesManager from '@/components/dashboard/ContactMessagesManager';\nimport UsersManager from '@/components/dashboard/UsersManager';\nimport RolesManager from '@/components/dashboard/RolesManager';\nimport PermissionsManager from '@/components/dashboard/PermissionsManager';\nimport CategoriesManager from '@/components/dashboard/CategoriesManager';\nimport TagsManager from '@/components/dashboard/TagsManager';\nimport MenusManager from '@/components/dashboard/MenusManager';\nimport UserProfile from '@/components/dashboard/UserProfile';\nimport SeoManager from '@/components/dashboard/SeoManager';\nimport ExtensionsManager from '@/components/dashboard/ExtensionsManager';\nimport LanguageSettings from '@/components/dashboard/LanguageSettings';\nimport SSOManager from '@/components/dashboard/SSOManager';\nimport ThemesManager from '@/components/dashboard/ThemesManager';\nimport FilesManager from '@/components/dashboard/FilesManager';\nimport SidebarMenuManager from '@/components/dashboard/SidebarMenuManager';\nimport NotificationsManager from '@/components/dashboard/notifications/NotificationsManager';\nimport NotificationDetail from '@/components/dashboard/notifications/NotificationDetail';\n\nfunction Dashboard() {\n  const { t } = useTranslation();\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n  const [extensionRoutes, setExtensionRoutes] = useState({});\n  const location = useLocation();\n  const navigate = useNavigate();\n\n  // Determine current \"page\" from URL path\n  // /cmspanel/notifications -> page = notifications\n  // /cmspanel/notifications/123 -> page = notifications, sub = 123 (handled via match logic below)\n\n  const pathParts = location.pathname.split('/');\n  // pathParts[0] = \"\"\n  // pathParts[1] = \"cmspanel\"\n  // pathParts[2] = page\n  // pathParts[3] = id (optional)\n  const currentPage = pathParts[2] || 'home';\n  const subParam = pathParts[3];\n\n  // Fetch dynamic routes from extensions\n  useEffect(() => {\n    const fetchExtensionRoutes = async () => {\n      try {\n        const { data } = await supabase\n          .from('extension_routes_registry')\n          .select('path, component_key')\n          .eq('is_active', true)\n          .is('deleted_at', null);\n\n        if (data) {\n          const routes = {};\n          data.forEach(route => {\n            routes[route.path] = route.component_key;\n          });\n          setExtensionRoutes(routes);\n        }\n      } catch (e) {\n        console.error(\"Error fetching extension routes\", e);\n      }\n    };\n    fetchExtensionRoutes();\n  }, []);\n\n  const renderContent = () => {\n    // 1. Check Core Routes\n    switch (currentPage) {\n      case 'home': return <AdminDashboard />;\n      case 'files': return <FilesManager />;\n      case 'blogs': return <BlogsManager />;\n      case 'pages': return <PagesManager />;\n      case 'themes': return <ThemesManager />;\n      case 'products': return <ProductsManager />;\n      case 'product-types': return <ProductTypesManager />;\n      case 'portfolio': return <PortfolioManager />;\n      case 'announcements': return <AnnouncementsManager />;\n      case 'promotions': return <PromotionsManager />;\n      case 'testimonies': return <TestimonyManager />;\n      case 'photo-gallery': return <PhotoGalleryManager />;\n      case 'video-gallery': return <VideoGalleryManager />;\n      case 'contacts': return <ContactsManager />;\n      case 'contact-messages': return <ContactMessagesManager />;\n      case 'menus': return <MenusManager />;\n      case 'categories': return <CategoriesManager />;\n      case 'tags': return <TagsManager />;\n      case 'users': return <UsersManager />;\n      case 'roles': return <RolesManager />;\n      case 'permissions': return <PermissionsManager />;\n      case 'extensions': return <ExtensionsManager />;\n      case 'seo': return <SeoManager />;\n      case 'sso': return <SSOManager />;\n      case 'language-settings': return <LanguageSettings />;\n      case 'profile': return <UserProfile />;\n      case 'admin-navigation': return <SidebarMenuManager />;\n      case 'notifications':\n        if (subParam) return <NotificationDetail id={subParam} />;\n        return <NotificationsManager />;\n\n      // 2. Check Plugin Routes\n      default:\n        if (extensionRoutes[currentPage]) {\n          const Component = getPluginComponent(extensionRoutes[currentPage]);\n          return <Component />;\n        }\n        return <AdminDashboard />;\n    }\n  };\n\n  return (\n    <>\n      <Helmet>\n        <title>{t('dashboard_page.title')}</title>\n        <meta name=\"description\" content={t('dashboard_page.meta_description')} />\n        <meta httpEquiv=\"X-Content-Type-Options\" content=\"nosniff\" />\n        <meta httpEquiv=\"X-Frame-Options\" content=\"SAMEORIGIN\" />\n      </Helmet>\n      <div className=\"flex h-screen bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-white overflow-hidden font-sans\">\n        <Sidebar\n          isOpen={sidebarOpen}\n          setIsOpen={setSidebarOpen}\n        />\n\n        <div className=\"flex-1 flex flex-col overflow-hidden\">\n          <Header\n            toggleSidebar={() => setSidebarOpen(!sidebarOpen)}\n            onNavigate={(page) => navigate(`/cmspanel/${page}`)}\n          />\n\n          <main className=\"relative flex-1 overflow-y-auto p-6 bg-slate-50 dark:bg-slate-950\">\n            <div className=\"pointer-events-none absolute inset-0\">\n              <div className=\"absolute -top-40 right-0 h-80 w-80 rounded-full bg-indigo-500/10 dark:bg-indigo-500/15 blur-3xl\" />\n              <div className=\"absolute -bottom-32 left-0 h-72 w-72 rounded-full bg-sky-500/10 dark:bg-sky-500/15 blur-3xl\" />\n            </div>\n            <motion.div\n              key={location.pathname} // Changed key to full pathname to trigger animation on sub-route changes\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.2 }}\n              className=\"relative z-10 h-full flex flex-col\"\n            >\n              {renderContent()}\n            </motion.div>\n          </main>\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default Dashboard;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/DeviceDetail.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/DevicesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":78,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * DevicesManager Page\n * ESP32 IoT Devices Management\n */\n\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useNavigate } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardHeader } from '@/components/ui/card';\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogFooter,\n} from '@/components/ui/dialog';\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\nimport { Label } from '@/components/ui/label';\nimport { Plus, Search, Wifi, WifiOff, Cpu, RefreshCw, ShieldAlert } from 'lucide-react';\nimport { useDevices } from '@/hooks/useDevices';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport DeviceCard from '@/components/esp32/DeviceCard';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nfunction DevicesManager() {\n    const { t } = useTranslation();\n    const navigate = useNavigate();\n    const { devices, loading, onlineCount, totalCount, registerDevice, deleteDevice, fetchDevices } = useDevices();\n    const { hasPermission } = usePermissions();\n\n    const [search, setSearch] = useState('');\n    const [showAddDialog, setShowAddDialog] = useState(false);\n    const [deleteTarget, setDeleteTarget] = useState(null);\n    const [newDevice, setNewDevice] = useState({ device_id: '', device_name: '' });\n\n    const canManage = hasPermission('tenant.iot.create')\n        || hasPermission('tenant.iot.update')\n        || hasPermission('tenant.iot.delete');\n    const canRead = hasPermission('tenant.iot.read') || canManage;\n\n    if (!canRead) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-white rounded-xl border border-slate-200 p-12 text-center\">\n                <div className=\"p-4 bg-red-50 rounded-full mb-4\">\n                    <ShieldAlert className=\"w-12 h-12 text-red-500\" />\n                </div>\n                <h3 className=\"text-xl font-bold text-slate-800\">Access Denied</h3>\n                <p className=\"text-slate-500 mt-2\">You do not have permission to view IoT devices.</p>\n            </div>\n        );\n    }\n\n    // Filter devices\n    const filteredDevices = devices.filter((d) =>\n        d.device_name?.toLowerCase().includes(search.toLowerCase()) ||\n        d.device_id?.toLowerCase().includes(search.toLowerCase())\n    );\n\n    // Handle add device\n    const handleAddDevice = async () => {\n        if (!newDevice.device_id) return;\n\n        try {\n            await registerDevice(newDevice);\n            setShowAddDialog(false);\n            setNewDevice({ device_id: '', device_name: '' });\n        } catch (err) {\n            // Error handled in hook\n        }\n    };\n\n    // Handle delete\n    const handleDelete = async () => {\n        if (!deleteTarget) return;\n\n        await deleteDevice(deleteTarget.id);\n        setDeleteTarget(null);\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-2xl font-bold\">{t('devices.title')}</h1>\n                    <p className=\"text-muted-foreground\">{t('devices.subtitle')}</p>\n                </div>\n\n                {canManage && (\n                    <Button onClick={() => setShowAddDialog(true)}>\n                        <Plus className=\"mr-2 h-4 w-4\" />\n                        {t('devices.add_device')}\n                    </Button>\n                )}\n            </div>\n\n            {/* Stats */}\n            <div className=\"grid gap-4 md:grid-cols-3\">\n                <Card>\n                    <CardContent className=\"pt-6\">\n                        <div className=\"flex items-center gap-4\">\n                            <div className=\"p-3 bg-primary/10 rounded-full\">\n                                <Cpu className=\"h-6 w-6 text-primary\" />\n                            </div>\n                            <div>\n                                <p className=\"text-2xl font-bold\">{totalCount}</p>\n                                <p className=\"text-sm text-muted-foreground\">{t('devices.total_devices')}</p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardContent className=\"pt-6\">\n                        <div className=\"flex items-center gap-4\">\n                            <div className=\"p-3 bg-green-500/10 rounded-full\">\n                                <Wifi className=\"h-6 w-6 text-green-500\" />\n                            </div>\n                            <div>\n                                <p className=\"text-2xl font-bold\">{onlineCount}</p>\n                                <p className=\"text-sm text-muted-foreground\">{t('devices.online')}</p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardContent className=\"pt-6\">\n                        <div className=\"flex items-center gap-4\">\n                            <div className=\"p-3 bg-muted rounded-full\">\n                                <WifiOff className=\"h-6 w-6 text-muted-foreground\" />\n                            </div>\n                            <div>\n                                <p className=\"text-2xl font-bold\">{totalCount - onlineCount}</p>\n                                <p className=\"text-sm text-muted-foreground\">{t('devices.offline')}</p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n\n            {/* Search & Refresh */}\n            <div className=\"flex gap-4\">\n                <div className=\"relative flex-1\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                        placeholder={t('devices.search_placeholder')}\n                        value={search}\n                        onChange={(e) => setSearch(e.target.value)}\n                        className=\"pl-10\"\n                    />\n                </div>\n                <Button variant=\"outline\" onClick={fetchDevices}>\n                    <RefreshCw className=\"h-4 w-4\" />\n                </Button>\n            </div>\n\n            {/* Device Grid */}\n            {loading ? (\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                    {[1, 2, 3].map((i) => (\n                        <Card key={i}>\n                            <CardHeader>\n                                <Skeleton className=\"h-6 w-32\" />\n                            </CardHeader>\n                            <CardContent className=\"space-y-3\">\n                                <Skeleton className=\"h-4 w-full\" />\n                                <Skeleton className=\"h-4 w-2/3\" />\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            ) : filteredDevices.length === 0 ? (\n                <Card>\n                    <CardContent className=\"py-12 text-center\">\n                        <Cpu className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n                        <h3 className=\"text-lg font-medium\">{t('devices.no_devices')}</h3>\n                        <p className=\"text-muted-foreground mb-4\">\n                            {search ? t('devices.try_different_search') : t('devices.add_first_device')}\n                        </p>\n                        {canManage && !search && (\n                            <Button onClick={() => setShowAddDialog(true)}>\n                                <Plus className=\"mr-2 h-4 w-4\" />\n                                {t('devices.add_device')}\n                            </Button>\n                        )}\n                    </CardContent>\n                </Card>\n            ) : (\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                    {filteredDevices.map((device) => (\n                        <DeviceCard\n                            key={device.id}\n                            device={device}\n                            onView={(d) => navigate(`/admin/devices/${d.id}`)}\n                            onEdit={(d) => navigate(`/admin/devices/${d.id}/settings`)}\n                            onDelete={(d) => canManage && setDeleteTarget(d)}\n                        />\n                    ))}\n                </div>\n            )}\n\n            {/* Add Device Dialog */}\n            <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>{t('devices.dialog_add_title')}</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                        <div>\n                            <Label>{t('devices.label_device_id')}</Label>\n                            <Input\n                                placeholder={t('devices.placeholder_device_id')}\n                                value={newDevice.device_id}\n                                onChange={(e) => setNewDevice({ ...newDevice, device_id: e.target.value })}\n                            />\n                        </div>\n                        <div>\n                            <Label>{t('devices.label_device_name')}</Label>\n                            <Input\n                                placeholder={t('devices.placeholder_device_name')}\n                                value={newDevice.device_name}\n                                onChange={(e) => setNewDevice({ ...newDevice, device_name: e.target.value })}\n                            />\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n                            {t('devices.cancel')}\n                        </Button>\n                        <Button onClick={handleAddDevice} disabled={!newDevice.device_id}>\n                            {t('devices.add_device')}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            {/* Delete Confirmation */}\n            <AlertDialog open={!!deleteTarget} onOpenChange={() => setDeleteTarget(null)}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>{t('devices.delete_title')}</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            {t('devices.delete_desc', { name: deleteTarget?.device_name || deleteTarget?.device_id })}\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>{t('devices.cancel')}</AlertDialogCancel>\n                        <AlertDialogAction onClick={handleDelete} className=\"bg-destructive text-destructive-foreground\">\n                            {t('devices.delete_confirm')}\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    );\n}\n\nexport default DevicesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/ForgotPasswordPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Link } from 'react-router-dom';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport Turnstile from '@/components/ui/Turnstile';\nimport AuthShell from '@/components/auth/AuthShell';\nimport { Loader2, ArrowLeft, Mail, CheckCircle2, ShieldCheck, Sparkles } from 'lucide-react';\n\nconst ForgotPasswordPage = () => {\n  const { t } = useTranslation();\n  const [email, setEmail] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n\n  // Turnstile State\n  const [turnstileToken, setTurnstileToken] = useState('');\n  const [turnstileError, setTurnstileError] = useState(false);\n\n  const { resetPassword } = useAuth();\n  const { toast } = useToast();\n\n  const sideItems = [\n    {\n      icon: ShieldCheck,\n      title: t('forgot_password.security_title', 'Secure recovery'),\n      description: t('forgot_password.security_desc', 'Turnstile verification keeps reset requests protected.'),\n    },\n    {\n      icon: Mail,\n      title: t('forgot_password.mail_title', 'Instant email links'),\n      description: t('forgot_password.mail_desc', 'Receive a secure reset link directly in your inbox.'),\n    },\n    {\n      icon: Sparkles,\n      title: t('forgot_password.support_title', 'Admin support'),\n      description: t('forgot_password.support_desc', 'Contact support if you need additional help.'),\n    },\n  ];\n\n  const shellProps = {\n    sideItems,\n    sideTitle: t('forgot_password.shell_title', 'Account Recovery'),\n    sideSubtitle: t('forgot_password.shell_subtitle', 'Keep your admin access secure with verified reset requests.'),\n  };\n\n  const handleReset = async (e) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      // 0. Verify Turnstile token first (skip for localhost or if widget has error)\n      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n      const shouldSkipTurnstile = isLocalhost || turnstileError;\n\n      if (!shouldSkipTurnstile) {\n        if (!turnstileToken) {\n          throw new Error(t('forgot_password.verification_needed'));\n        }\n\n        const { data: verifyData, error: verifyError } = await supabase.functions.invoke('verify-turnstile', {\n          body: { token: turnstileToken }\n        });\n\n        if (verifyError || !verifyData?.success) {\n          // Reset Turnstile widget on failure\n          setTurnstileToken('');\n          if (window.turnstileReset) {\n            window.turnstileReset();\n          }\n          throw new Error(verifyData?.error || t('forgot_password.verification_failed_msg') || 'Security verification failed. Please try again.');\n        }\n      }\n\n      // Proceed with password reset (without passing token again)\n      const { error } = await resetPassword(email);\n      if (error) {\n        // Reset Turnstile on error\n        setTurnstileToken('');\n        if (window.turnstileReset) {\n          window.turnstileReset();\n        }\n        throw error;\n      }\n      setIsSuccess(true);\n    } catch (error) {\n      console.error('Reset password error:', error);\n      toast({\n        variant: \"destructive\",\n        title: t('forgot_password.reset_failed'),\n        description: error.message || t('forgot_password.try_again'),\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <AuthShell\n      title={t('forgot_password.title')}\n      subtitle={isSuccess ? t('forgot_password.check_email') : t('forgot_password.enter_email')}\n      badge={t('forgot_password.badge', 'Password Recovery')}\n      footer={!isSuccess ? (\n        <Link to=\"/login\" className=\"inline-flex items-center gap-2 font-medium text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-white\">\n          <ArrowLeft className=\"h-4 w-4\" /> {t('forgot_password.back_to_login')}\n        </Link>\n      ) : null}\n      {...shellProps}\n    >\n      {isSuccess ? (\n        <div className=\"space-y-6\">\n          <div className=\"rounded-2xl border border-emerald-200/70 bg-emerald-50/70 p-6 text-center text-emerald-700\">\n            <div className=\"mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-emerald-100\">\n              <CheckCircle2 className=\"h-6 w-6\" />\n            </div>\n            <p className=\"text-sm\">\n              {t('forgot_password.sent_message')} <span className=\"font-semibold text-emerald-900\">{email}</span>.\n            </p>\n          </div>\n          <Button asChild className=\"h-11 w-full bg-indigo-600 text-white hover:bg-indigo-700\">\n            <Link to=\"/login\">{t('forgot_password.back_to_login')}</Link>\n          </Button>\n        </div>\n      ) : (\n        <form onSubmit={handleReset} className=\"space-y-6\">\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\" className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">{t('login_page.email_address_label')}</Label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-3.5 h-4 w-4 text-slate-400\" />\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"admin@example.com\"\n                  className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 pl-10 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                />\n              </div>\n            </div>\n\n            <div className=\"rounded-2xl border border-dashed border-slate-200/70 bg-slate-50/70 px-4 py-3\">\n              <Turnstile\n                siteKey={import.meta.env.VITE_TURNSTILE_SITE_KEY}\n                onVerify={(token) => {\n                  setTurnstileToken(token);\n                  setTurnstileError(false);\n                }}\n                onError={() => setTurnstileError(true)}\n                onExpire={() => setTurnstileToken('')}\n                theme=\"light\"\n                appearance=\"always\"\n              />\n            </div>\n          </div>\n\n          <Button\n            type=\"submit\"\n            className=\"h-11 w-full bg-indigo-600 text-white hover:bg-indigo-700\"\n            disabled={isLoading || (!turnstileToken && !turnstileError)}\n          >\n            {isLoading ? (\n              <Loader2 className=\"w-5 h-5 animate-spin mx-auto\" />\n            ) : (\n              t('forgot_password.send_link')\n            )}\n          </Button>\n        </form>\n      )}\n    </AuthShell>\n  );\n};\n\nexport default ForgotPasswordPage;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/LoginPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":425,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":425,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { motion } from 'framer-motion';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { useAuth } from '@/contexts/SupabaseAuthContext';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport Turnstile from '@/components/ui/Turnstile';\nimport AuthShell from '@/components/auth/AuthShell';\nimport { Eye, EyeOff, Loader2, ShieldCheck, AlertCircle, LayoutGrid, Sparkles, Mail, Lock } from 'lucide-react';\nimport * as OTPAuth from 'otpauth';\n\n\nconst LoginPage = () => {\n  const { t } = useTranslation();\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Turnstile State\n  const [turnstileToken, setTurnstileToken] = useState('');\n  const [turnstileError, setTurnstileError] = useState(false);\n  const [turnstileReady, setTurnstileReady] = useState(false);\n\n  // 2FA State\n  const [requires2FA, setRequires2FA] = useState(false);\n  const [twoFactorCode, setTwoFactorCode] = useState('');\n  const [pendingUserId, setPendingUserId] = useState(null);\n  const [verificationError, setVerificationError] = useState('');\n\n  const { user, signOut, loading: authLoading } = useAuth();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const [sessionCheck, setSessionCheck] = useState(false);\n\n  const sideItems = [\n    {\n      icon: ShieldCheck,\n      title: t('login_page.security_title', 'Secure sign-in'),\n      description: t('login_page.security_desc', 'Turnstile validation and optional 2FA keep access protected.'),\n    },\n    {\n      icon: LayoutGrid,\n      title: t('login_page.control_title', 'Centralized control'),\n      description: t('login_page.control_desc', 'Manage tenants, content, and users from one workspace.'),\n    },\n    {\n      icon: Sparkles,\n      title: t('login_page.insight_title', 'Operational insights'),\n      description: t('login_page.insight_desc', 'Track performance, audits, and approvals in real time.'),\n    },\n  ];\n\n  const shellProps = {\n    sideItems,\n    sideTitle: t('login_page.shell_title', 'Admin Control Center'),\n    sideSubtitle: t('login_page.shell_subtitle', 'Securely manage tenants, content, and operations with audit-ready oversight.'),\n  };\n\n\n  // Guard: If user is already logged in on mount\n  useEffect(() => {\n    let mounted = true;\n\n    const checkUserStatus = async () => {\n      if (user && !requires2FA && !isLoading) {\n        if (mounted) setSessionCheck(true);\n        try {\n          const { data: twoFactorData } = await supabase\n            .from('two_factor_auth')\n            .select('enabled')\n            .eq('user_id', user.id)\n            .maybeSingle();\n\n          // Check if user is active (soft deletion check)\n          const { data: userData } = await supabase\n            .from('users')\n            .select('deleted_at, roles(name, is_public, is_guest)')\n            .eq('id', user.id)\n            .maybeSingle();\n\n          if (mounted) {\n            // Hard block: if user is \"deleted\"\n            if (userData?.deleted_at) {\n              toast({\n                variant: \"destructive\",\n                title: t('login_page.account_disabled_title'),\n                description: t('login_page.account_disabled_desc')\n              });\n              await signOut();\n              return;\n            }\n\n            // Hard block: if user has no role or is 'public' (guest) only\n            // NOTE: Adjust logic based on your requirement. Here we block if role is purely 'guest' or null.\n            if (!userData?.roles || userData.roles.is_public || userData.roles.is_guest) {\n              // For now we allow 'guest' if you want them to see dashboard, but usually we restrict.\n              // Assuming 'public' role is for frontend users who shouldn't access CMS.\n              // toast({ variant: \"destructive\", title: \"Access Denied\", description: \"You do not have permission to access the CMS.\" });\n              // await signOut();\n              // return;\n            }\n\n            if (twoFactorData?.enabled) {\n              console.warn(\"User has 2FA enabled but no verification context. Forcing logout.\");\n              await signOut();\n            } else {\n              navigate('/cmspanel', { replace: true });\n            }\n          }\n        } catch (e) {\n          console.error(\"Status check failed\", e);\n        } finally {\n          if (mounted) setSessionCheck(false);\n        }\n      } else if (mounted) {\n        setSessionCheck(false);\n      }\n    };\n\n    checkUserStatus();\n\n    return () => { mounted = false; };\n  }, [user, requires2FA, isLoading, navigate, signOut, toast, t]);\n\n  if (authLoading || sessionCheck) {\n    return (\n      <AuthShell\n        title={t('login_page.restoring_title', 'Restoring your session')}\n        subtitle={t('login_page.restoring_subtitle', 'Checking your secure access credentials')}\n        badge={t('login_page.restoring_badge', 'Authenticating')}\n        {...shellProps}\n      >\n        <div className=\"flex flex-col items-center gap-5 text-center\">\n          <div className=\"h-14 w-14 rounded-2xl bg-gradient-to-br from-indigo-500 to-blue-600 flex items-center justify-center shadow-lg shadow-indigo-500/20\">\n            <Loader2 className=\"h-6 w-6 animate-spin text-white\" />\n          </div>\n          <div className=\"space-y-2\">\n            <p className=\"text-sm font-semibold text-slate-700 dark:text-slate-200\">\n              {t('login_page.restoring_status', 'Validating access token')}\n            </p>\n            <p className=\"text-xs text-slate-500 dark:text-slate-400\">\n              {t('login_page.restoring_hint', 'Well redirect you automatically once ready.')}\n            </p>\n          </div>\n          <div className=\"h-2 w-full max-w-[240px] overflow-hidden rounded-full bg-slate-200/70 dark:bg-slate-800/70\">\n            <div className=\"h-full w-1/2 animate-pulse rounded-full bg-gradient-to-r from-indigo-500 via-blue-500 to-sky-400\" />\n          </div>\n        </div>\n      </AuthShell>\n    );\n  }\n\n\n  const handleLogin = async (e) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setVerificationError('');\n\n    try {\n      // 1. Validate Turnstile Token presence\n      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n\n      // Ensure we have a token before attempting login (unless strictly dev mode bypassing it, but Supabase will likely reject if protection is on)\n      if (!turnstileToken && !isLocalhost) {\n        if (turnstileError) {\n          throw new Error(t('login_page.security_check_failed'));\n        }\n        throw new Error(t('login_page.complete_captcha'));\n      }\n\n      // 1.5 Verify Turnstile token via Edge Function (server-side verification)\n      if (turnstileToken) {\n        const verifyResponse = await supabase.functions.invoke('verify-turnstile', {\n          body: { token: turnstileToken },\n        });\n\n        if (verifyResponse.error || !verifyResponse.data?.success) {\n          // Reset Turnstile on verification failure\n          setTurnstileToken('');\n          if (window.turnstileReset) {\n            window.turnstileReset();\n          }\n          throw new Error(t('login_page.verification_failed'));\n        }\n      }\n\n      // 2. Authenticate with Supabase Auth (without passing token again)\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (error) {\n        // Reset Turnstile on login error\n        setTurnstileToken('');\n        if (window.turnstileReset) {\n          window.turnstileReset();\n        }\n        throw error;\n      }\n\n      const userId = data.user.id;\n\n      // 1.5 Check if user is active/deleted in public.users\n      const { data: userProfile } = await supabase\n        .from('users')\n        .select('deleted_at, tenant_id')\n        .eq('id', userId)\n        .single();\n\n      if (userProfile?.deleted_at) {\n        // Force logout if soft-deleted\n        await supabase.auth.signOut();\n        throw new Error(\"Account is inactive.\");\n      }\n\n      const userTenantId = userProfile?.tenant_id;\n\n      // 2. Check if user has 2FA enabled\n      const { data: twoFactorData } = await supabase\n        .from('two_factor_auth')\n        .select('enabled')\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      if (twoFactorData?.enabled) {\n        setRequires2FA(true);\n        setPendingUserId(userId);\n        setIsLoading(false);\n        return;\n      }\n\n      // No 2FA -> Proceed to dashboard\n      // Log successful login (get IP via edge function)\n      let clientIP = null;\n      try {\n        const ipResponse = await supabase.functions.invoke('get-client-ip');\n        console.log('[Login] IP response:', ipResponse);\n        if (!ipResponse.error && ipResponse.data?.ip) {\n          clientIP = ipResponse.data.ip;\n          console.log('[Login] Got IP:', clientIP);\n        } else if (ipResponse.error) {\n          console.warn('[Login] IP error:', ipResponse.error);\n        }\n      } catch (e) {\n        console.warn('[Login] IP fetch exception:', e);\n      }\n\n      await supabase.from('audit_logs').insert({\n        tenant_id: userTenantId,\n        user_id: userId,\n        action: 'user.login',\n        resource: 'auth',\n        channel: 'web',\n        ip_address: clientIP,\n        details: { user_agent: navigator.userAgent, status: 'success' },\n      });\n\n      // Cleanup old login audit logs (keep only 100 per tenant)\n      await supabase.rpc('cleanup_old_login_audit_logs');\n\n      toast({\n        title: t('login_page.welcome_back_title'),\n        description: t('login_page.login_success'),\n      });\n      navigate('/cmspanel', { replace: true });\n\n    } catch (error) {\n      console.error('Login error:', error);\n\n      // Log failed login attempt\n      try {\n        await supabase.from('audit_logs').insert({\n          tenant_id: null,\n          user_id: null,\n          action: 'user.login',\n          resource: 'auth',\n          channel: 'web',\n          details: {\n            status: 'failed',\n            error: error.message || 'Unknown error',\n            user_agent: navigator.userAgent,\n            attempted_email: email\n          },\n        });\n      } catch (logErr) {\n        console.warn('Failed to log login failure:', logErr);\n      }\n\n      toast({\n        variant: \"destructive\",\n        title: t('login_page.login_failed'),\n        description: error.message || t('login_page.check_credentials'),\n      });\n      setIsLoading(false);\n    }\n  };\n\n  const verify2FA = async (e) => {\n    e.preventDefault();\n    if (!twoFactorCode) return;\n\n    setIsLoading(true);\n    setVerificationError('');\n\n    try {\n      const { data, error } = await supabase\n        .from('two_factor_auth')\n        .select('secret, backup_codes')\n        .eq('user_id', pendingUserId)\n        .maybeSingle();\n\n      if (error || !data) {\n        console.error(\"2FA Fetch Error:\", error);\n        throw new Error(t('two_factor.fetch_error'));\n      }\n\n      let isValid = false;\n      let isBackup = false;\n      const cleanCode = twoFactorCode.trim().replace(/[\\s-]/g, '');\n\n      if (data.backup_codes && data.backup_codes.some(code => code.replace(/-/g, '') === cleanCode)) {\n        isValid = true;\n        isBackup = true;\n      } else {\n        const totp = new OTPAuth.TOTP({\n          algorithm: 'SHA1',\n          digits: 6,\n          period: 30,\n          secret: OTPAuth.Secret.fromBase32(data.secret)\n        });\n        const delta = totp.validate({ token: cleanCode, window: 1 });\n        isValid = (delta !== null);\n      }\n\n      if (isValid) {\n        if (isBackup) {\n          const exactCodeMatch = data.backup_codes.find(c => c.replace(/-/g, '') === cleanCode);\n          const newCodes = data.backup_codes.filter(c => c !== exactCodeMatch);\n          await supabase.from('two_factor_auth').update({ backup_codes: newCodes }).eq('user_id', pendingUserId);\n          await supabase.from('two_factor_audit_logs').insert({ user_id: pendingUserId, event_type: 'backup_code_used' });\n\n          sessionStorage.setItem('awcms_2fa_verified', 'true');\n          sessionStorage.setItem('awcms_2fa_timestamp', Date.now().toString());\n          toast({ title: t('two_factor.backup_used_title'), description: t('two_factor.backup_used_desc') });\n        } else {\n          await supabase.from('two_factor_audit_logs').insert({ user_id: pendingUserId, event_type: 'verified' });\n          sessionStorage.setItem('awcms_2fa_verified', 'true');\n          sessionStorage.setItem('awcms_2fa_timestamp', Date.now().toString());\n          toast({ title: t('two_factor.verified'), description: t('two_factor.auth_success') });\n        }\n\n        // Log successful 2FA login\n        const { data: userProfile2FA } = await supabase\n          .from('users')\n          .select('tenant_id')\n          .eq('id', pendingUserId)\n          .single();\n\n        let clientIP2FA = null;\n        try {\n          const { data: ipData, error: ipError } = await supabase.functions.invoke('get-client-ip');\n          if (!ipError && ipData?.ip) {\n            clientIP2FA = ipData.ip;\n            console.log('[Login 2FA] Got IP:', clientIP2FA);\n          }\n        } catch (e) {\n          console.warn('[Login 2FA] IP fetch failed:', e);\n        }\n\n        await supabase.from('audit_logs').insert({\n          tenant_id: userProfile2FA?.tenant_id,\n          user_id: pendingUserId,\n          action: 'user.login',\n          resource: 'auth',\n          channel: 'web',\n          ip_address: clientIP2FA,\n          details: { user_agent: navigator.userAgent, twoFactor: true, status: 'success' },\n        });\n\n        // Cleanup old login audit logs (keep only 100 per tenant)\n        await supabase.rpc('cleanup_old_login_audit_logs');\n\n        navigate('/cmspanel', { replace: true });\n      } else {\n        throw new Error(t('two_factor.invalid_code'));\n      }\n\n    } catch (err) {\n      console.error(err);\n\n      // Log failed 2FA attempt\n      try {\n        await supabase.from('audit_logs').insert({\n          tenant_id: null,\n          user_id: pendingUserId,\n          action: 'user.login',\n          resource: 'auth',\n          channel: 'web',\n          details: {\n            status: 'failed',\n            error: err.message || '2FA verification failed',\n            user_agent: navigator.userAgent,\n            twoFactor: true\n          },\n        });\n      } catch (logErr) {\n        console.warn('Failed to log 2FA failure:', logErr);\n      }\n\n      setVerificationError(err.message);\n      setIsLoading(false);\n    }\n  };\n\n  const handleCancelVerification = async () => {\n    setIsLoading(true);\n    setVerificationError('');\n    try { await supabase.auth.signOut(); } catch (e) { /* Ignore signout errors */ }\n    finally {\n      setRequires2FA(false);\n      setTwoFactorCode('');\n      setPendingUserId(null);\n      setIsLoading(false);\n      toast({ description: t('two_factor.cancelled') });\n    }\n  };\n\n  if (requires2FA) {\n    return (\n      <AuthShell\n        title={t('two_factor.title')}\n        subtitle={t('two_factor.subtitle')}\n        badge={t('two_factor.badge', 'Two-Factor Verification')}\n        {...shellProps}\n      >\n        <form onSubmit={verify2FA} className=\"space-y-6\">\n          <div className=\"space-y-4\">\n            <Label htmlFor=\"2fa-code\" className=\"sr-only\">Code</Label>\n            <Input\n              id=\"2fa-code\"\n              autoComplete=\"one-time-code\"\n              placeholder=\"000000\"\n              className={`h-16 rounded-2xl border-slate-200/70 bg-slate-50/80 text-center text-3xl font-bold tracking-[0.4em] text-slate-900 shadow-sm transition-all focus:border-indigo-500/60 focus:ring-indigo-500/30 ${verificationError ? 'border-rose-300 bg-rose-50 text-rose-600' : ''}`}\n              maxLength={11}\n              value={twoFactorCode}\n              onChange={(e) => { setTwoFactorCode(e.target.value.toUpperCase()); setVerificationError(''); }}\n              autoFocus\n            />\n            {verificationError && (\n              <motion.div\n                initial={{ opacity: 0, y: -5 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"flex items-center justify-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-medium text-rose-600\"\n              >\n                <AlertCircle className=\"w-4 h-4\" /> {verificationError}\n              </motion.div>\n            )}\n          </div>\n          <div className=\"flex flex-col gap-3\">\n            <Button type=\"submit\" className=\"h-11 w-full bg-indigo-600 text-white hover:bg-indigo-700\" disabled={isLoading || twoFactorCode.length < 3}>\n              {isLoading ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : t('two_factor.verify_identity')}\n            </Button>\n            <Button type=\"button\" variant=\"ghost\" className=\"text-xs text-slate-500 hover:text-slate-700\" onClick={handleCancelVerification} disabled={isLoading}>\n              {t('two_factor.cancel')}\n            </Button>\n          </div>\n        </form>\n      </AuthShell>\n    );\n  }\n\n  return (\n    <AuthShell\n      title={t('login_page.welcome_back')}\n      subtitle={t('login_page.sign_in_subtitle')}\n      badge={t('login_page.badge', 'Administrator Sign-In')}\n      footer={(\n        <div className=\"space-y-2\">\n          <div>\n            <span>{t('login_page.no_account')} </span>\n            <Link to=\"/register\" className=\"font-semibold text-slate-900 hover:text-indigo-600 dark:text-white\">\n              {t('login_page.apply_access')}\n            </Link>\n          </div>\n          <div>\n            <Link to=\"/forgot-password\" className=\"font-medium text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-white\">\n              {t('login_page.forgot_password_link')}\n            </Link>\n          </div>\n        </div>\n      )}\n      {...shellProps}\n    >\n      <form onSubmit={handleLogin} className=\"space-y-6\">\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\" className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">{t('login_page.email_address_label')}</Label>\n            <div className=\"relative\">\n              <Mail className=\"absolute left-3 top-3.5 h-4 w-4 text-slate-400\" />\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"admin@example.com\"\n                className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 pl-10 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n              />\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\" className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">{t('login_page.password_label')}</Label>\n            <div className=\"relative\">\n              <Lock className=\"absolute left-3 top-3.5 h-4 w-4 text-slate-400\" />\n              <Input\n                id=\"password\"\n                type={showPassword ? 'text' : 'password'}\n                placeholder=\"\"\n                className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 pl-10 pr-10 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n              />\n              <button type=\"button\" onClick={() => setShowPassword(!showPassword)} className=\"absolute right-3 top-3 text-slate-400 hover:text-slate-600\">\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n              </button>\n            </div>\n          </div>\n\n          {turnstileError && (\n            <div className=\"flex items-center gap-2 rounded-xl border border-amber-200 bg-amber-50 px-3 py-2 text-xs font-medium text-amber-700\">\n              <AlertCircle className=\"h-4 w-4\" /> {t('login_page.security_check_failed', 'Security check failed. Please refresh the page.')}\n            </div>\n          )}\n\n          <div className=\"rounded-2xl border border-dashed border-slate-200/70 bg-slate-50/70 px-4 py-3\">\n            <Turnstile\n              siteKey={import.meta.env.VITE_TURNSTILE_SITE_KEY}\n              onVerify={(token) => {\n                console.log('[Login] Turnstile token received');\n                setTurnstileToken(token);\n                setTurnstileError(false);\n                setTurnstileReady(true);\n              }}\n              onError={() => {\n                console.error('[Login] Turnstile error');\n                setTurnstileError(true);\n                setTurnstileReady(true);\n              }}\n              onExpire={() => {\n                console.log('[Login] Turnstile token expired');\n                setTurnstileToken('');\n                setTurnstileReady(false);\n              }}\n              theme=\"light\"\n            />\n            {!turnstileReady && !turnstileError && (\n              <p className=\"mt-2 text-center text-xs text-slate-400\">{t('login_page.verifying_security')}</p>\n            )}\n          </div>\n        </div>\n        <Button\n          type=\"submit\"\n          className=\"h-11 w-full bg-indigo-600 text-white shadow-lg shadow-indigo-600/20 hover:bg-indigo-700 disabled:opacity-50\"\n          disabled={isLoading || (!turnstileReady && !turnstileError)}\n        >\n          {isLoading ? <Loader2 className=\"w-5 h-5 animate-spin mx-auto\" /> : (!turnstileReady && !turnstileError) ? t('login_page.waiting_security') : t('login_page.sign_in_button')}\n        </Button>\n      </form>\n    </AuthShell>\n  );\n};\n\nexport default LoginPage;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/MobileAppConfig.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/MobileUsersManager.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/ModulesManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { Box, Search, RefreshCw } from 'lucide-react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { PageHeader } from '@/templates/flowbite-admin';\nimport { Card } from '@/components/ui/card';\nimport { useToast } from '@/components/ui/use-toast';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\n\nconst ModulesManager = () => {\n  /* const supabase = useSupabaseClient(); - Replaced by global import */\n  const { toast } = useToast();\n\n  const [modules, setModules] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n\n  const fetchModules = useCallback(async () => {\n    setLoading(true);\n    try {\n      let query = supabase\n        .from('modules')\n        .select(`\n          *,\n          tenant:tenants(name)\n        `)\n        .order('created_at', { ascending: false });\n\n      if (searchQuery) {\n        query = query.ilike('name', `%${searchQuery}%`);\n      }\n\n      // If user is admin (restriced by RLS policies we just added), they only see their own.\n      // Owner/SuperAdmin see all.\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setModules(data || []);\n    } catch (error) {\n      console.error('Error fetching modules:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load modules list\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [searchQuery, toast]);\n\n  useEffect(() => {\n    fetchModules();\n  }, [fetchModules]);\n\n  const getStatusBadge = (status) => {\n    switch (status) {\n      case 'active':\n        return <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100\">Active</Badge>;\n      case 'inactive':\n        return <Badge className=\"bg-slate-100 text-slate-800 hover:bg-slate-100\">Inactive</Badge>;\n      case 'maintenance':\n        return <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\">Maintenance</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title=\"Module Management\"\n        description=\"Manage system modules and their status across tenants.\"\n        icon={Box}\n      />\n\n      <Card className=\"p-6\">\n        <div className=\"flex flex-col md:flex-row gap-4 mb-6 justify-between items-center\">\n          <div className=\"relative flex-1 max-w-md\">\n            <Search className=\"absolute left-3 top-2.5 w-4 h-4 text-slate-400\" />\n            <Input\n              placeholder=\"Search modules...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-9\"\n            />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={fetchModules} disabled={loading}>\n              <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n              Refresh\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"rounded-md border\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Tenant</TableHead>\n                <TableHead>Module Name</TableHead>\n                <TableHead>Slug</TableHead>\n                <TableHead>Description</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead>Created At</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {loading ? (\n                Array(5).fill(0).map((_, i) => (\n                  <TableRow key={i}>\n                    <TableCell><div className=\"h-4 w-32 bg-slate-100 rounded animate-pulse\" /></TableCell>\n                    <TableCell><div className=\"h-4 w-40 bg-slate-100 rounded animate-pulse\" /></TableCell>\n                    <TableCell><div className=\"h-4 w-24 bg-slate-100 rounded animate-pulse\" /></TableCell>\n                    <TableCell><div className=\"h-4 w-48 bg-slate-100 rounded animate-pulse\" /></TableCell>\n                    <TableCell><div className=\"h-6 w-16 bg-slate-100 rounded-full animate-pulse\" /></TableCell>\n                    <TableCell><div className=\"h-4 w-24 bg-slate-100 rounded animate-pulse\" /></TableCell>\n                  </TableRow>\n                ))\n              ) : modules.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={6} className=\"h-32 text-center text-slate-500\">\n                    <div className=\"flex flex-col items-center justify-center p-4\">\n                      <Box className=\"w-8 h-8 mb-2 opacity-20\" />\n                      <p>No modules found</p>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ) : (\n                modules.map((module) => (\n                  <TableRow key={module.id}>\n                    <TableCell className=\"font-medium\">\n                      {module.tenant?.name || <span className=\"text-slate-400 italic\">Restricted</span>}\n                    </TableCell>\n                    <TableCell>{module.name}</TableCell>\n                    <TableCell>\n                      <code className=\"px-2 py-0.5 bg-slate-100 rounded text-xs font-mono text-slate-700\">\n                        {module.slug}\n                      </code>\n                    </TableCell>\n                    <TableCell className=\"max-w-xs truncate\" title={module.description}>\n                      {module.description || '-'}\n                    </TableCell>\n                    <TableCell>{getStatusBadge(module.status)}</TableCell>\n                    <TableCell className=\"text-slate-500 text-xs\">\n                      {new Date(module.created_at).toLocaleDateString()}\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </div>\n      </Card>\n    </div>\n  );\n};\n\nexport default ModulesManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/PushNotificationsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":78,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * PushNotificationsManager Page\n * Send and manage push notifications\n */\n\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Badge } from '@/components/ui/badge';\nimport { Label } from '@/components/ui/label';\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogFooter,\n} from '@/components/ui/dialog';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from '@/components/ui/select';\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from '@/components/ui/table';\nimport { Bell, Plus, Send, Trash2, RefreshCw, ShieldAlert } from 'lucide-react';\nimport { usePushNotifications } from '@/hooks/usePushNotifications';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { format } from 'date-fns';\n\nfunction PushNotificationsManager() {\n    const { t } = useTranslation();\n    const { notifications, loading, stats, createNotification, sendNotification, deleteNotification, fetchNotifications } = usePushNotifications();\n    const { hasPermission } = usePermissions();\n\n    const [createDialog, setCreateDialog] = useState(false);\n    const [newNotification, setNewNotification] = useState({\n        title: '',\n        message: '',\n        target_type: 'all',\n    });\n\n    const canManage = hasPermission('tenant.push_notifications.create')\n        || hasPermission('tenant.push_notifications.update')\n        || hasPermission('tenant.push_notifications.delete');\n    const canRead = hasPermission('tenant.push_notifications.read') || canManage;\n\n    if (!canRead) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-white rounded-xl border border-slate-200 p-12 text-center\">\n                <div className=\"p-4 bg-red-50 rounded-full mb-4\">\n                    <ShieldAlert className=\"w-12 h-12 text-red-500\" />\n                </div>\n                <h3 className=\"text-xl font-bold text-slate-800\">Access Denied</h3>\n                <p className=\"text-slate-500 mt-2\">You do not have permission to view push notifications.</p>\n            </div>\n        );\n    }\n\n    const handleCreate = async (isDraft = true) => {\n        if (!newNotification.title) return;\n\n        try {\n            await createNotification(newNotification, isDraft);\n            setCreateDialog(false);\n            setNewNotification({ title: '', message: '', target_type: 'all' });\n        } catch (err) {\n            // Error handled in hook\n        }\n    };\n\n    const getStatusColor = (status) => {\n        switch (status) {\n            case 'sent':\n                return 'default';\n            case 'draft':\n                return 'secondary';\n            case 'scheduled':\n                return 'outline';\n            case 'failed':\n                return 'destructive';\n            default:\n                return 'secondary';\n        }\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-2xl font-bold\">{t('push_notifications.title')}</h1>\n                    <p className=\"text-muted-foreground\">{t('push_notifications.subtitle')}</p>\n                </div>\n\n                {canManage && (\n                    <Button onClick={() => setCreateDialog(true)}>\n                        <Plus className=\"mr-2 h-4 w-4\" />\n                        {t('push_notifications.button_new')}\n                    </Button>\n                )}\n            </div>\n\n            {/* Stats */}\n            <div className=\"grid gap-4 md:grid-cols-3\">\n                <Card>\n                    <CardContent className=\"pt-6\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-2 bg-primary/10 rounded-full\">\n                                <Bell className=\"h-5 w-5 text-primary\" />\n                            </div>\n                            <div>\n                                <p className=\"text-2xl font-bold\">{stats?.total || 0}</p>\n                                <p className=\"text-sm text-muted-foreground\">{t('push_notifications.stat_total')}</p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardContent className=\"pt-6\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-2 bg-green-100 dark:bg-green-900/30 rounded-full\">\n                                <Send className=\"h-5 w-5 text-green-600\" />\n                            </div>\n                            <div>\n                                <p className=\"text-2xl font-bold\">\n                                    {stats?.sent || 0}\n                                </p>\n                                <p className=\"text-sm text-muted-foreground\">{t('push_notifications.stat_sent')}</p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardContent className=\"pt-6\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-2 bg-muted rounded-full\">\n                                <Bell className=\"h-5 w-5 text-muted-foreground\" />\n                            </div>\n                            <div>\n                                <p className=\"text-2xl font-bold\">\n                                    {stats?.drafts || 0}\n                                </p>\n                                <p className=\"text-sm text-muted-foreground\">{t('push_notifications.stat_drafts')}</p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n\n            {/* Table */}\n            <Card>\n                <CardHeader className=\"flex-row items-center justify-between\">\n                    <CardTitle>{t('push_notifications.history_title')}</CardTitle>\n                    <Button variant=\"outline\" size=\"sm\" onClick={fetchNotifications}>\n                        <RefreshCw className=\"h-4 w-4\" />\n                    </Button>\n                </CardHeader>\n                <CardContent className=\"p-0\">\n                    <Table>\n                        <TableHeader>\n                            <TableRow>\n                                <TableHead>{t('push_notifications.table_title')}</TableHead>\n                                <TableHead>{t('push_notifications.table_target')}</TableHead>\n                                <TableHead>{t('push_notifications.table_status')}</TableHead>\n                                <TableHead>{t('push_notifications.table_sent')}</TableHead>\n                                {canManage && <TableHead className=\"w-24\"></TableHead>}\n                            </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                            {loading ? (\n                                [...Array(3)].map((_, i) => (\n                                    <TableRow key={i}>\n                                        <TableCell><Skeleton className=\"h-4 w-32\" /></TableCell>\n                                        <TableCell><Skeleton className=\"h-4 w-16\" /></TableCell>\n                                        <TableCell><Skeleton className=\"h-4 w-16\" /></TableCell>\n                                        <TableCell><Skeleton className=\"h-4 w-20\" /></TableCell>\n                                        {canManage && <TableCell><Skeleton className=\"h-4 w-16\" /></TableCell>}\n                                    </TableRow>\n                                ))\n                            ) : notifications.length === 0 ? (\n                                <TableRow>\n                                    <TableCell colSpan={canManage ? 5 : 4} className=\"text-center py-8 text-muted-foreground\">\n                                        {t('push_notifications.no_notifications')}\n                                    </TableCell>\n                                </TableRow>\n                            ) : (\n                                notifications.map((n) => (\n                                    <TableRow key={n.id}>\n                                        <TableCell>\n                                            <div>\n                                                <p className=\"font-medium\">{n.title}</p>\n                                                <p className=\"text-sm text-muted-foreground line-clamp-1\">{n.body}</p>\n                                            </div>\n                                        </TableCell>\n                                        <TableCell>\n                                            <Badge variant=\"outline\">{n.target_type}</Badge>\n                                        </TableCell>\n                                        <TableCell>\n                                            <Badge variant={getStatusColor(n.status)}>{n.status}</Badge>\n                                        </TableCell>\n                                        <TableCell>\n                                            {n.sent_at ? format(new Date(n.sent_at), 'MMM d, HH:mm') : '-'}\n                                        </TableCell>\n                                        {canManage && (\n                                            <TableCell>\n                                                <div className=\"flex gap-1\">\n                                                    {n.status === 'draft' && (\n                                                        <Button\n                                                            variant=\"ghost\"\n                                                            size=\"icon\"\n                                                            onClick={() => sendNotification(n.id)}\n                                                        >\n                                                            <Send className=\"h-4 w-4\" />\n                                                        </Button>\n                                                    )}\n                                                    <Button\n                                                        variant=\"ghost\"\n                                                        size=\"icon\"\n                                                        onClick={() => deleteNotification(n.id)}\n                                                    >\n                                                        <Trash2 className=\"h-4 w-4 text-destructive\" />\n                                                    </Button>\n                                                </div>\n                                            </TableCell>\n                                        )}\n                                    </TableRow>\n                                ))\n                            )}\n                        </TableBody>\n                    </Table>\n                </CardContent>\n            </Card>\n\n            {/* Create Dialog */}\n            <Dialog open={createDialog} onOpenChange={setCreateDialog}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>{t('push_notifications.dialog_create_title')}</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                        <div>\n                            <Label>{t('push_notifications.label_title')}</Label>\n                            <Input\n                                placeholder={t('push_notifications.placeholder_title')}\n                                value={newNotification.title}\n                                onChange={(e) => setNewNotification({ ...newNotification, title: e.target.value })}\n                            />\n                        </div>\n                        <div>\n                            <Label>{t('push_notifications.label_message')}</Label>\n                            <Textarea\n                                placeholder={t('push_notifications.placeholder_message')}\n                                value={newNotification.message}\n                                onChange={(e) => setNewNotification({ ...newNotification, message: e.target.value })}\n                            />\n                        </div>\n                        <div>\n                            <Label>{t('push_notifications.label_target')}</Label>\n                            <Select\n                                value={newNotification.target_type}\n                                onValueChange={(v) => setNewNotification({ ...newNotification, target_type: v })}\n                            >\n                                <SelectTrigger>\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"all\">{t('push_notifications.target_all')}</SelectItem>\n                                    <SelectItem value=\"topic\">{t('push_notifications.target_topic')}</SelectItem>\n                                    <SelectItem value=\"segment\">{t('push_notifications.target_segment')}</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => handleCreate(true)} disabled={!newNotification.title}>\n                            {t('push_notifications.button_draft')}\n                        </Button>\n                        <Button onClick={() => handleCreate(false)} disabled={!newNotification.title}>\n                            <Send className=\"mr-2 h-4 w-4\" />\n                            {t('push_notifications.button_send')}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n\nexport default PushNotificationsManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/SeoPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport Sidebar from '@/components/dashboard/Sidebar';\nimport Header from '@/components/dashboard/Header';\nimport SeoManager from '@/components/dashboard/SeoManager';\n\nconst SeoPage = () => {\n  return (\n    <div className=\"flex h-screen bg-slate-50 overflow-hidden\">\n      {/* We reuse the Sidebar and Header assuming they exist as per file list */}\n      <Sidebar />\n      <div className=\"flex-1 flex flex-col min-w-0\">\n        <Header />\n        <main className=\"flex-1 overflow-y-auto\">\n          <SeoManager />\n        </main>\n      </div>\n    </div>\n  );\n};\n\nexport default SeoPage;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/cmspanel/UpdatePasswordPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { motion } from 'framer-motion';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport { Eye, EyeOff, Loader2, Lock } from 'lucide-react';\nimport { Helmet } from 'react-helmet-async';\n\nconst UpdatePasswordPage = () => {\n  const { t } = useTranslation();\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const accessToken = searchParams.get('access_token');\n    const refreshToken = searchParams.get('refresh_token');\n\n    if (!accessToken || !refreshToken) {\n      toast({\n        variant: 'destructive',\n        title: t('update_password.toast_invalid_link_title'),\n        description: t('update_password.toast_invalid_link_desc'),\n      });\n      navigate('/cmspanel/login');\n      return;\n    }\n\n    // Set session from URL parameters\n    supabase.auth.setSession({\n      access_token: accessToken,\n      refresh_token: refreshToken,\n    }).then(({ error }) => {\n      if (error) {\n        toast({\n          variant: 'destructive',\n          title: t('update_password.toast_invalid_link_title'),\n          description: error.message || t('update_password.toast_invalid_link_desc'),\n        });\n        navigate('/cmspanel/login');\n      }\n    });\n\n  }, [navigate, toast, searchParams, t]);\n\n  const handleUpdatePassword = async (e) => {\n    e.preventDefault();\n\n    if (password !== confirmPassword) {\n      toast({\n        variant: 'destructive',\n        title: t('update_password.toast_mismatch_title'),\n        description: t('update_password.toast_mismatch_desc'),\n      });\n      return;\n    }\n\n    if (password.length < 6) {\n      toast({\n        variant: \"destructive\",\n        title: t('update_password.toast_password_short_title'),\n        description: t('update_password.toast_password_short_desc'),\n      });\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const { error } = await supabase.auth.updateUser({\n        password: password\n      });\n\n      if (error) throw error;\n\n      toast({\n        title: t('update_password.toast_success_title'),\n        description: t('update_password.toast_success_desc'),\n      });\n\n      // Navigate to login after successful update\n      navigate('/cmspanel/login');\n\n    } catch (error) {\n      console.error('Update password error:', error);\n      toast({\n        variant: \"destructive\",\n        title: t('update_password.toast_failed_title'),\n        description: error.message || t('update_password.toast_failed_desc')\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 flex items-center justify-center p-4\">\n      <Helmet>\n        <title>{t('update_password.title')} - {t('login.app_name')}</title>\n      </Helmet>\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden border border-slate-200\"\n      >\n        <div className=\"p-8 md:p-10 space-y-8\">\n          <div className=\"space-y-2 text-center\">\n            <h1 className=\"text-3xl font-bold text-slate-900 tracking-tight\">{t('update_password.title')}</h1>\n            <p className=\"text-slate-500\">\n              {t('update_password.subtitle')}\n            </p>\n          </div>\n\n          <form onSubmit={handleUpdatePassword} className=\"space-y-6\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">{t('update_password.new_password_label')}</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"password\"\n                    type={showPassword ? 'text' : 'password'}\n                    placeholder=\"\"\n                    className=\"h-11 pr-10 pl-10\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    required\n                  />\n                  <Lock className=\"absolute left-3 top-3.5 w-4 h-4 text-slate-400\" />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    className=\"absolute right-3 top-3 text-slate-400 hover:text-slate-600 transition-colors\"\n                  >\n                    {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"confirmPassword\">Confirm Password</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"confirmPassword\"\n                    type={showPassword ? 'text' : 'password'}\n                    placeholder=\"\"\n                    className=\"h-11 pr-10 pl-10\"\n                    value={confirmPassword}\n                    onChange={(e) => setConfirmPassword(e.target.value)}\n                    required\n                  />\n                  <Lock className=\"absolute left-3 top-3.5 w-4 h-4 text-slate-400\" />\n                </div>\n              </div>\n            </div>\n\n            <Button\n              type=\"submit\"\n              className=\"w-full h-11 bg-slate-900 hover:bg-slate-800 text-white font-medium\"\n              disabled={isLoading}\n            >\n              {isLoading ? (\n                <Loader2 className=\"w-5 h-5 animate-spin mx-auto\" />\n              ) : (\n                'Update Password'\n              )}\n            </Button>\n          </form>\n        </div>\n      </motion.div>\n    </div>\n  );\n};\n\nexport default UpdatePasswordPage;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/Home.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { motion } from 'framer-motion';\nimport { ArrowRight, Zap, Shield, Globe } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport DynamicTemplate from '@/components/public/DynamicTemplate';\n\n// Default Landing Page Component (Fallback)\nconst DefaultLandingPage = () => {\n  // const { t } = useTranslation();\n\n  return (\n    <div className=\"flex flex-col\">\n      {/* Hero Section */}\n      <section className=\"relative overflow-hidden bg-background pt-20 pb-32 lg:pt-32\">\n        <div className=\"container relative z-10 mx-auto px-4 text-center\">\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6 }}\n            className=\"mx-auto max-w-4xl\"\n          >\n            <h1 className=\"mb-6 text-5xl font-bold tracking-tight text-foreground md:text-7xl\">\n              Build Your Digital Presence <br />\n              <span className=\"text-primary\">With Confidence</span>\n            </h1>\n            <p className=\"mb-10 text-xl text-muted-foreground md:text-2xl\">\n              The modern Content Management System designed for performance, flexibility, and growth.\n            </p>\n            <div className=\"flex flex-col items-center justify-center gap-4 sm:flex-row\">\n              <Button size=\"lg\" className=\"h-12 px-8 text-lg rounded-full\">\n                Get Started\n                <ArrowRight className=\"ml-2 h-5 w-5\" />\n              </Button>\n              <Button variant=\"outline\" size=\"lg\" className=\"h-12 px-8 text-lg rounded-full\">\n                View Demo\n              </Button>\n            </div>\n          </motion.div>\n        </div>\n\n        {/* Background Decorative Elements */}\n        <div className=\"absolute top-0 left-0 -z-10 h-full w-full overflow-hidden opacity-20\">\n          <div className=\"absolute -top-[20%] -left-[10%] h-[500px] w-[500px] rounded-full bg-primary blur-[100px]\"></div>\n          <div className=\"absolute top-[40%] -right-[10%] h-[400px] w-[400px] rounded-full bg-secondary blur-[100px]\"></div>\n        </div>\n      </section>\n\n      {/* Features Grid */}\n      <section className=\"bg-secondary/20 py-24\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"mb-16 text-center\">\n            <h2 className=\"mb-4 text-3xl font-bold text-foreground md:text-4xl\">Why Choose AWCMS?</h2>\n            <p className=\"mx-auto max-w-2xl text-muted-foreground\">\n              Everything you need to manage your content effectively, built on modern technology.\n            </p>\n          </div>\n\n          <div className=\"grid gap-8 md:grid-cols-3\">\n            {[\n              { icon: Zap, title: \"Lightning Fast\", desc: \"Built on Vite and React for incredible performance and speed.\" },\n              { icon: Shield, title: \"Secure by Design\", desc: \"Enterprise-grade security with Supabase authentication.\" },\n              { icon: Globe, title: \"Global Scale\", desc: \"Ready for international audiences with built-in localization.\" }\n            ].map((feature, i) => (\n              <motion.div\n                key={i}\n                initial={{ opacity: 0, y: 20 }}\n                whileInView={{ opacity: 1, y: 0 }}\n                viewport={{ once: true }}\n                transition={{ delay: i * 0.1 }}\n                className=\"group rounded-2xl bg-card p-8 shadow-sm transition-all hover:-translate-y-1 hover:shadow-md border border-border\"\n              >\n                <div className=\"mb-6 inline-flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10 text-primary\">\n                  <feature.icon className=\"h-6 w-6\" />\n                </div>\n                <h3 className=\"mb-3 text-xl font-bold text-foreground\">{feature.title}</h3>\n                <p className=\"text-muted-foreground\">{feature.desc}</p>\n              </motion.div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-24 bg-primary text-primary-foreground\">\n        <div className=\"container mx-auto px-4 text-center\">\n          <h2 className=\"mb-6 text-3xl font-bold md:text-4xl\">Ready to transform your content?</h2>\n          <p className=\"mb-10 text-lg opacity-90\">\n            Join thousands of developers and content creators using AWCMS today.\n          </p>\n          <Button size=\"lg\" variant=\"secondary\" className=\"h-12 px-8 rounded-full font-semibold text-secondary-foreground hover:bg-background hover:text-foreground border border-transparent hover:border-border\">\n            Start Free Trial\n          </Button>\n        </div>\n      </section>\n    </div>\n  );\n};\n\n\nfunction Home() {\n  return (\n    <DynamicTemplate type=\"homepage\" fallback={DefaultLandingPage} />\n  );\n}\n\nexport default Home;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicAnnouncementDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { Calendar, Tag, ArrowLeft, Share2, User } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/components/ui/use-toast';\n\nfunction PublicAnnouncementDetail() {\n  const { id } = useParams();\n  const { toast } = useToast();\n  const [announcement, setAnnouncement] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchDetail = async () => {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('announcements')\n        .select(`*, categories(name), users(full_name)`)\n        .eq('id', id)\n        .eq('status', 'published') // Ensure public only sees published\n        .maybeSingle();\n\n      if (!error && data) {\n        setAnnouncement(data);\n      }\n      setLoading(false);\n    };\n    fetchDetail();\n  }, [id]);\n\n  const handleShare = () => {\n    navigator.clipboard.writeText(window.location.href);\n    toast({ title: \"Link Copied\", description: \"Announcement link copied to clipboard.\" });\n  };\n\n  if (loading) return <div className=\"py-20 text-center\">Loading...</div>;\n\n  if (!announcement) return (\n    <div className=\"py-20 text-center\">\n      <h2 className=\"text-2xl font-bold text-slate-800\">Announcement Not Found</h2>\n      <Link to=\"/announcements\" className=\"text-blue-600 mt-4 inline-block\">Back to list</Link>\n    </div>\n  );\n\n  return (\n    <div className=\"container mx-auto px-4 py-12 max-w-4xl\">\n      <SeoHelmet\n        type=\"announcement_detail\"\n        id={id}\n        defaultTitle={`${announcement.title} | Announcements`}\n        defaultDescription={announcement.content?.substring(0, 150) || ''}\n      />\n\n      <div className=\"mb-8\">\n        <Link to=\"/announcements\" className=\"inline-flex items-center text-sm text-slate-500 hover:text-blue-600 transition-colors mb-4\">\n          <ArrowLeft className=\"w-4 h-4 mr-1\" /> Back to Announcements\n        </Link>\n\n        <div className=\"flex flex-wrap gap-2 mb-4\">\n          <Badge className={announcement.priority === 'urgent' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'}>\n            {announcement.priority?.toUpperCase()}\n          </Badge>\n          {announcement.categories && <Badge variant=\"outline\">{announcement.categories.name}</Badge>}\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl font-bold text-slate-900 mb-4 leading-tight\">{announcement.title}</h1>\n\n        <div className=\"flex items-center gap-4 text-sm text-slate-500 border-b border-slate-100 pb-6 mb-6\">\n          <span className=\"flex items-center gap-1\">\n            <Calendar className=\"w-4 h-4\" /> {new Date(announcement.created_at).toLocaleDateString()}\n          </span>\n          {announcement.users && (\n            <span className=\"flex items-center gap-1\">\n              <User className=\"w-4 h-4\" /> {announcement.users.full_name}\n            </span>\n          )}\n          <Button variant=\"ghost\" size=\"sm\" className=\"ml-auto\" onClick={handleShare}>\n            <Share2 className=\"w-4 h-4 mr-2\" /> Share\n          </Button>\n        </div>\n\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          className=\"prose prose-slate max-w-none\"\n        >\n          <div className=\"whitespace-pre-wrap leading-relaxed text-slate-800 text-lg\">\n            {announcement.content}\n          </div>\n        </motion.div>\n\n        {announcement.tags && announcement.tags.length > 0 && (\n          <div className=\"mt-8 pt-8 border-t border-slate-100\">\n            <h4 className=\"text-sm font-bold text-slate-900 mb-3 uppercase tracking-wider\">Related Tags</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {announcement.tags.map((tag, i) => (\n                <span key={i} className=\"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-slate-50 text-slate-600 text-sm\">\n                  <Tag className=\"w-3 h-3\" /> {tag}\n                </span>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default PublicAnnouncementDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicAnnouncements.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  27 |\n  28 |     useEffect(() => {\n> 29 |         fetchAnnouncements();\n     |         ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  30 |     }, []);\n  31 |\n  32 |     return (","line":29,"column":9,"nodeType":null,"endLine":29,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { Helmet } from 'react-helmet-async';\nimport { Bell, Calendar, ArrowRight, AlertCircle } from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Link } from 'react-router-dom';\nimport { sanitizeHTML } from '@/utils/sanitize';\n\nfunction PublicAnnouncements() {\n    const [items, setItems] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    const fetchAnnouncements = async () => {\n        setLoading(true);\n        const { data } = await supabase\n            .from('announcements')\n            .select('*, categories(name)')\n            .eq('status', 'published')\n            .order('priority', { ascending: false }) // High priority first\n            .order('published_at', { ascending: false });\n        setItems(data || []);\n        setLoading(false);\n    };\n\n    useEffect(() => {\n        fetchAnnouncements();\n    }, []);\n\n    return (\n        <div className=\"min-h-screen bg-background py-16\">\n            <Helmet>\n                <title>Announcements - AWCMS</title>\n            </Helmet>\n\n            <div className=\"container mx-auto px-4 max-w-4xl\">\n                <motion.div\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"text-center mb-12\"\n                >\n                    <div className=\"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-primary/10 text-primary mb-4\">\n                        <Bell className=\"w-6 h-6\" />\n                    </div>\n                    <h1 className=\"text-3xl md:text-4xl font-bold text-foreground mb-3\">Latest Announcements</h1>\n                    <p className=\"text-muted-foreground\">Stay updated with our latest blogs and updates.</p>\n                </motion.div>\n\n                {loading ? (\n                    <div className=\"space-y-4\">\n                        {[1, 2, 3].map(i => (\n                            <div key={i} className=\"h-32 rounded-xl bg-muted animate-pulse\" />\n                        ))}\n                    </div>\n                ) : (\n                    <div className=\"space-y-6\">\n                        {items.map((item, i) => (\n                            <motion.div\n                                key={item.id}\n                                initial={{ opacity: 0, x: -20 }}\n                                whileInView={{ opacity: 1, x: 0 }}\n                                viewport={{ once: true }}\n                                transition={{ delay: i * 0.1 }}\n                                className={`group bg-card p-6 rounded-2xl border transition-all hover:shadow-md ${item.priority === 'high' ? 'border-primary/50 shadow-sm' : 'border-border'\n                                    }`}\n                            >\n                                <div className=\"flex flex-col sm:flex-row gap-6\">\n                                    <div className=\"flex-1\">\n                                        <div className=\"flex items-center gap-3 mb-3\">\n                                            {item.priority === 'high' && (\n                                                <Badge variant=\"destructive\" className=\"gap-1\">\n                                                    <AlertCircle className=\"w-3 h-3\" /> Important\n                                                </Badge>\n                                            )}\n                                            <Badge variant=\"outline\" className=\"border-border text-muted-foreground\">\n                                                {item.categories?.name || 'General'}\n                                            </Badge>\n                                            <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                                                <Calendar className=\"w-3 h-3\" />\n                                                {new Date(item.published_at).toLocaleDateString()}\n                                            </span>\n                                        </div>\n\n                                        <h3 className=\"text-xl font-bold text-foreground mb-2 group-hover:text-primary transition-colors\">\n                                            {item.title}\n                                        </h3>\n                                        <div\n                                            className=\"text-muted-foreground text-sm line-clamp-2 prose prose-sm prose-slate dark:prose-invert\"\n                                            dangerouslySetInnerHTML={sanitizeHTML(item.content)}\n                                        />\n                                    </div>\n\n                                    <div className=\"flex items-center\">\n                                        <Link to={`/announcements/${item.id}`}>\n                                            <Button variant=\"ghost\" className=\"gap-2 text-primary hover:text-primary hover:bg-primary/5\">\n                                                Read More <ArrowRight className=\"w-4 h-4\" />\n                                            </Button>\n                                        </Link>\n                                    </div>\n                                </div>\n                            </motion.div>\n                        ))}\n\n                        {items.length === 0 && (\n                            <div className=\"text-center py-20 bg-muted/30 rounded-2xl border border-dashed border-border\">\n                                <p className=\"text-muted-foreground\">No announcements at this time.</p>\n                            </div>\n                        )}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n\nexport default PublicAnnouncements;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicBlogDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { Calendar, User, ArrowLeft, Tag, Clock, Facebook, Twitter, Linkedin, FileText } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { sanitizeHTML } from '@/utils/sanitize';\nimport { stripHtml } from '@/utils/textUtils';\n\nfunction PublicBlogDetail() {\n    const { slug } = useParams();\n    const [blog, setBlog] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [relatedBlogs, setRelatedBlogs] = useState([]);\n\n    const incrementViews = async (id) => {\n        // Optimistic update without waiting\n        await supabase.rpc('increment_blog_view', { blog_id: id }).catch(() => { });\n        // Alternative simple update if RPC not exists: \n        // await supabase.from('blogs').update({ views: (blog.views || 0) + 1 }).eq('id', id);\n    };\n\n    const fetchRelated = async (categoryId, currentId) => {\n        if (!categoryId) return;\n        const { data } = await supabase\n            .from('blogs')\n            .select('id, title, slug, featured_image, published_at')\n            .eq('category_id', categoryId)\n            .eq('status', 'published')\n            .neq('id', currentId)\n            .limit(3);\n        if (data) setRelatedBlogs(data);\n    };\n\n    useEffect(() => {\n        const fetchDetail = async () => {\n            setLoading(true);\n            // Fetch blog details\n            const { data, error } = await supabase\n                .from('blogs')\n                .select(`*, categories(name), author:users!blogs_author_id_fkey(full_name)`)\n                .eq('slug', slug)\n                .eq('status', 'published') // Strict check\n                .maybeSingle();\n\n            if (!error && data) {\n                setBlog(data);\n                incrementViews(data.id);\n                fetchRelated(data.category_id, data.id);\n            } else {\n                // Fallback without author if FK issue\n                if (error && error.code === 'PGRST201') {\n                    const { data: fallbackData } = await supabase\n                        .from('blogs')\n                        .select(`*, categories(name)`)\n                        .eq('slug', slug)\n                        .eq('status', 'published')\n                        .maybeSingle();\n                    if (fallbackData) {\n                        setBlog(fallbackData);\n                        incrementViews(fallbackData.id);\n                        fetchRelated(fallbackData.category_id, fallbackData.id);\n                    }\n                }\n            }\n            setLoading(false);\n        };\n        fetchDetail();\n    }, [slug]);\n\n    if (loading) {\n        return (\n            <div className=\"min-h-screen bg-white animate-pulse\">\n                <div className=\"h-96 bg-slate-200 w-full\"></div>\n                <div className=\"container mx-auto px-4 max-w-3xl -mt-20 relative z-10 bg-white p-12 rounded-2xl shadow-sm border border-slate-100\">\n                    <div className=\"h-10 bg-slate-200 rounded w-3/4 mb-6\"></div>\n                    <div className=\"h-4 bg-slate-200 rounded w-1/2 mb-12\"></div>\n                    <div className=\"space-y-4\">\n                        <div className=\"h-4 bg-slate-200 rounded w-full\"></div>\n                        <div className=\"h-4 bg-slate-200 rounded w-full\"></div>\n                        <div className=\"h-4 bg-slate-200 rounded w-5/6\"></div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    if (!blog) return (\n        <div className=\"min-h-screen flex flex-col items-center justify-center bg-slate-50 px-4\">\n            <div className=\"text-center\">\n                <h2 className=\"text-3xl font-bold text-slate-800 mb-4\">Blog Post Not Found</h2>\n                <p className=\"text-slate-500 mb-8\">The blog post you&apos;re looking for might have been removed or is temporarily unavailable.</p>\n                <Link to=\"/blogs\">\n                    <Button className=\"bg-blue-600\">Back to Blogs</Button>\n                </Link>\n            </div>\n        </div>\n    );\n\n    const readingTime = Math.max(1, Math.ceil((blog.content?.length || 0) / 1000));\n    const shareUrl = window.location.href;\n\n    return (\n        <article className=\"bg-slate-50 min-h-screen pb-20\">\n            <SeoHelmet\n                type=\"blog_detail\"\n                id={blog.id}\n                defaultTitle={`${blog.title} | Blog`}\n                defaultDescription={blog.excerpt || stripHtml(blog.content).substring(0, 150)}\n                defaultImage={blog.featured_image}\n            />\n\n            {/* Modern Hero Section */}\n            <div className=\"relative h-[60vh] min-h-[500px] w-full bg-slate-900 overflow-hidden\">\n                {blog.featured_image && (\n                    <div className=\"absolute inset-0\">\n                        <img src={blog.featured_image} alt=\"\" className=\"w-full h-full object-cover opacity-60\" />\n                        <div className=\"absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/40 to-transparent\"></div>\n                    </div>\n                )}\n\n                <div className=\"absolute inset-0 flex flex-col justify-end pb-20 pt-32 container mx-auto px-4\">\n                    <Link to=\"/blogs\" className=\"inline-flex items-center text-sm font-medium text-slate-300 hover:text-white mb-8 transition-colors bg-black/20 backdrop-blur-sm w-fit px-4 py-2 rounded-full border border-white/10 hover:bg-black/40\">\n                        <ArrowLeft className=\"w-4 h-4 mr-2\" /> Back to Blogs\n                    </Link>\n\n                    <div className=\"max-w-4xl\">\n                        <div className=\"flex flex-wrap items-center gap-3 mb-6\">\n                            {blog.categories && (\n                                <Badge className=\"bg-blue-600 hover:bg-blue-700 border-none text-white px-3 py-1 text-sm\">\n                                    {blog.categories.name}\n                                </Badge>\n                            )}\n                            {blog.published_at && (\n                                <span className=\"text-slate-300 text-sm bg-black/30 px-3 py-1 rounded-full backdrop-blur-sm border border-white/10 flex items-center gap-2\">\n                                    <Calendar className=\"w-3.5 h-3.5\" />\n                                    {new Date(blog.published_at).toLocaleDateString()}\n                                </span>\n                            )}\n                        </div>\n\n                        <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-8 leading-tight drop-shadow-sm\">\n                            {blog.title}\n                        </h1>\n\n                        <div className=\"flex flex-wrap items-center gap-6 text-slate-300 text-sm font-medium\">\n                            {blog.author?.full_name && (\n                                <span className=\"flex items-center gap-2\">\n                                    <div className=\"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center border border-blue-400/30 text-blue-200\">\n                                        <User className=\"w-4 h-4\" />\n                                    </div>\n                                    {blog.author.full_name}\n                                </span>\n                            )}\n                            <span className=\"flex items-center gap-2\">\n                                <Clock className=\"w-4 h-4 text-slate-400\" /> {readingTime} min read\n                            </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"container mx-auto px-4 grid grid-cols-1 lg:grid-cols-12 gap-12 -mt-10 relative z-20\">\n                {/* Main Content */}\n                <div className=\"lg:col-span-8\">\n                    <motion.div\n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        className=\"bg-white rounded-2xl shadow-xl border border-slate-100 p-8 md:p-12\"\n                    >\n                        <div className=\"prose prose-slate prose-lg max-w-none leading-relaxed text-slate-700\">\n                            <div dangerouslySetInnerHTML={sanitizeHTML(blog.content)} />\n                        </div>\n\n                        {/* Footer of Content */}\n                        <div className=\"mt-12 pt-8 border-t border-slate-100\">\n                            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\n                                {blog.tags && blog.tags.length > 0 && (\n                                    <div className=\"flex flex-wrap gap-2\">\n                                        {blog.tags.map((tag, i) => (\n                                            <span key={i} className=\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-slate-50 text-slate-600 text-sm hover:bg-slate-100 transition-colors border border-slate-200 cursor-default\">\n                                                <Tag className=\"w-3 h-3 text-slate-400\" /> {tag}\n                                            </span>\n                                        ))}\n                                    </div>\n                                )}\n\n                                <div className=\"flex items-center gap-2\">\n                                    <Button variant=\"outline\" size=\"icon\" className=\"rounded-full text-slate-500 hover:text-blue-600 hover:border-blue-200\" onClick={() => window.open(`https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`, '_blank')}>\n                                        <Facebook className=\"w-4 h-4\" />\n                                    </Button>\n                                    <Button variant=\"outline\" size=\"icon\" className=\"rounded-full text-slate-500 hover:text-sky-500 hover:border-sky-200\" onClick={() => window.open(`https://twitter.com/intent/tweet?url=${shareUrl}&text=${blog.title}`, '_blank')}>\n                                        <Twitter className=\"w-4 h-4\" />\n                                    </Button>\n                                    <Button variant=\"outline\" size=\"icon\" className=\"rounded-full text-slate-500 hover:text-blue-800 hover:border-blue-300\" onClick={() => window.open(`https://www.linkedin.com/shareArticle?mini=true&url=${shareUrl}`, '_blank')}>\n                                        <Linkedin className=\"w-4 h-4\" />\n                                    </Button>\n                                </div>\n                            </div>\n                        </div>\n                    </motion.div>\n                </div>\n\n                {/* Sidebar */}\n                <div className=\"lg:col-span-4 space-y-8 mt-10 lg:mt-0\">\n                    {/* Author Box */}\n                    <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\n                        <h3 className=\"font-bold text-slate-900 mb-4 text-sm uppercase tracking-wider\">About Author</h3>\n                        <div className=\"flex items-center gap-4 mb-4\">\n                            <div className=\"w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center text-slate-400\">\n                                <User className=\"w-8 h-8\" />\n                            </div>\n                            <div>\n                                <h4 className=\"font-bold text-slate-900 text-lg\">{blog.author?.full_name || 'AhliWeb Team'}</h4>\n                                <p className=\"text-slate-500 text-sm\">Content Creator</p>\n                            </div>\n                        </div>\n                        <p className=\"text-slate-600 text-sm leading-relaxed\">\n                            Passionate about technology and digital innovation. Sharing insights to help businesses grow in the digital age.\n                        </p>\n                    </div>\n\n                    {/* Related Blogs */}\n                    {relatedBlogs.length > 0 && (\n                        <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\n                            <h3 className=\"font-bold text-slate-900 mb-6 text-sm uppercase tracking-wider\">Related Blogs</h3>\n                            <div className=\"space-y-6\">\n                                {relatedBlogs.map(rel => (\n                                    <Link key={rel.id} to={`/blogs/${rel.slug}`} className=\"flex gap-4 group\">\n                                        <div className=\"w-20 h-20 rounded-lg bg-slate-100 overflow-hidden flex-shrink-0\">\n                                            {rel.featured_image ? (\n                                                <img src={rel.featured_image} alt=\"\" className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500\" />\n                                            ) : (\n                                                <div className=\"w-full h-full flex items-center justify-center text-slate-300\"><FileText className=\"w-6 h-6\" /></div>\n                                            )}\n                                        </div>\n                                        <div>\n                                            <h5 className=\"font-semibold text-slate-900 text-sm leading-snug mb-2 group-hover:text-blue-600 transition-colors line-clamp-2\">\n                                                {rel.title}\n                                            </h5>\n                                            <span className=\"text-xs text-slate-500\">\n                                                {new Date(rel.published_at || new Date()).toLocaleDateString()}\n                                            </span>\n                                        </div>\n                                    </Link>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </article>\n    );\n}\n\nexport default PublicBlogDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicBlogs.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState, useCallback } from 'react';\nimport { Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { FileText, Calendar, ArrowRight, Search, Eye, X, Info, Loader2 } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport CategoryFilter from '@/components/public/CategoryFilter';\nimport { Pagination } from '@/components/ui/pagination';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { useSearch } from '@/hooks/useSearch';\nimport { stripHtml } from '@/utils/textUtils';\n\nfunction PublicBlogs() {\n    const [blogs, setBlogs] = useState([]);\n    const [categories, setCategories] = useState([]);\n    const [activeCategory, setActiveCategory] = useState(null);\n\n    const {\n        query,\n        setQuery,\n        debouncedQuery,\n        isValid,\n        message,\n        minLength,\n        clearSearch,\n        loading: searchLoading,\n        setLoading: setSearchLoading\n    } = useSearch({ minLength: 5 });\n\n    const [totalItems, setTotalItems] = useState(0);\n    const [currentPage, setCurrentPage] = useState(1);\n    const itemsPerPage = 9;\n\n    useEffect(() => {\n        const fetchCategories = async () => {\n            const { data } = await supabase\n                .from('categories')\n                .select('*')\n                .eq('type', 'blog')\n                .is('deleted_at', null)\n                .order('name');\n            if (data) setCategories(data);\n        };\n        fetchCategories();\n    }, []);\n\n    const fetchBlogs = useCallback(async () => {\n        setSearchLoading(true);\n        const from = (currentPage - 1) * itemsPerPage;\n        const to = from + itemsPerPage - 1;\n\n        try {\n            let queryBuilder = supabase\n                .from('blogs')\n                .select(`\n            *, \n            categories(name), \n            author:users!blogs_author_id_fkey(full_name)\n        `, { count: 'exact' })\n                .eq('status', 'published')\n                .is('deleted_at', null)\n                .order('published_at', { ascending: false });\n\n            if (activeCategory) {\n                queryBuilder = queryBuilder.eq('category_id', activeCategory);\n            }\n\n            // Only apply search if we have a valid debounced query\n            if (debouncedQuery) {\n                queryBuilder = queryBuilder.ilike('title', `%${debouncedQuery}%`);\n            }\n\n            const { data, count, error } = await queryBuilder.range(from, to);\n\n            if (error) throw error;\n\n            setBlogs(data || []);\n            setTotalItems(count || 0);\n        } catch (err) {\n            console.error(\"Fetch Error:\", err);\n        } finally {\n            setSearchLoading(false);\n        }\n    }, [currentPage, itemsPerPage, activeCategory, debouncedQuery, setSearchLoading]);\n\n    useEffect(() => {\n        fetchBlogs();\n        window.scrollTo({ top: 0, behavior: 'smooth' });\n    }, [fetchBlogs]);\n\n\n    const totalPages = Math.ceil(totalItems / itemsPerPage);\n\n    return (\n        <div className=\"bg-slate-50 min-h-screen pb-20\">\n            <SeoHelmet type=\"blogs\" defaultTitle=\"Blogs | AhliWeb\" defaultDescription=\"Read our latest blogs, insights and updates.\" />\n\n            <div className=\"bg-white border-b border-slate-200 pt-16 pb-12\">\n                <div className=\"container mx-auto px-4 text-center max-w-2xl\">\n                    <h1 className=\"text-4xl font-bold text-slate-900 mb-4 tracking-tight\">Our Latest Insights</h1>\n                    <p className=\"text-lg text-slate-600\">Discover blogs, tutorials, and insights curated by our team of experts.</p>\n                </div>\n            </div>\n\n            <div className=\"container mx-auto px-4 -mt-6\">\n                <div className=\"bg-white rounded-xl shadow-lg border border-slate-100 p-4 mb-10 flex flex-col md:flex-row items-start md:items-center gap-4 max-w-5xl mx-auto\">\n                    <div className=\"relative w-full md:w-80\">\n                        <div className=\"relative\">\n                            <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-slate-400\" />\n                            <Input\n                                placeholder={`Search blogs (${minLength}+ chars)...`}\n                                value={query}\n                                onChange={(e) => { setQuery(e.target.value); setCurrentPage(1); }}\n                                className={`pl-9 pr-16 bg-slate-50 border-slate-200 transition-colors ${!isValid ? 'border-amber-300 focus:ring-amber-200' : ''}`}\n                            />\n                            <div className=\"absolute right-3 top-2.5 flex items-center gap-2\">\n                                {query && (\n                                    <button onClick={clearSearch} className=\"hover:bg-slate-200 rounded-full p-0.5\">\n                                        <X className=\"h-3.5 w-3.5 text-slate-400 hover:text-slate-600\" />\n                                    </button>\n                                )}\n                                <span className={`text-[10px] font-mono ${!isValid && query.length > 0 ? 'text-amber-600 font-bold' : 'text-slate-400'}`}>\n                                    {query.length}/{minLength}\n                                </span>\n                            </div>\n                        </div>\n                        {!isValid && query.length > 0 && (\n                            <div className=\"absolute top-full left-0 mt-1 flex items-center gap-1.5 text-xs text-amber-600 font-medium animate-in slide-in-from-top-1 px-1\">\n                                <Info className=\"w-3 h-3\" />\n                                {message}\n                            </div>\n                        )}\n                    </div>\n\n                    <div className=\"w-px h-8 bg-slate-200 hidden md:block\"></div>\n\n                    <div className=\"flex-1 overflow-x-auto w-full pb-2 md:pb-0 hide-scrollbar\">\n                        <CategoryFilter categories={categories} activeCategory={activeCategory} onSelect={(id) => { setActiveCategory(id); setCurrentPage(1); }} />\n                    </div>\n                </div>\n\n                {searchLoading ? (\n                    <div className=\"flex flex-col items-center justify-center py-20\">\n                        <Loader2 className=\"w-10 h-10 text-blue-600 animate-spin mb-4\" />\n                        <p className=\"text-slate-500\">Searching content...</p>\n                    </div>\n                ) : (\n                    <>\n                        {blogs.length > 0 ? (\n                            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12\">\n                                {blogs.map((item, i) => (\n                                    <motion.div\n                                        key={item.id}\n                                        initial={{ opacity: 0, y: 20 }}\n                                        animate={{ opacity: 1, y: 0 }}\n                                        transition={{ delay: i * 0.05 }}\n                                        className=\"bg-white rounded-2xl overflow-hidden shadow-sm border border-slate-200 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group flex flex-col h-full\"\n                                    >\n                                        <Link to={`/blogs/${item.slug}`} className=\"block relative overflow-hidden h-52 bg-slate-100\">\n                                            {item.featured_image ? (\n                                                <img src={item.featured_image} alt={item.title} className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700\" />\n                                            ) : (\n                                                <div className=\"w-full h-full flex items-center justify-center text-slate-300 bg-slate-50\">\n                                                    <FileText className=\"w-12 h-12 opacity-50\" />\n                                                </div>\n                                            )}\n                                            {item.categories && (\n                                                <div className=\"absolute top-4 left-4\">\n                                                    <Badge className=\"bg-white/95 text-slate-800 hover:bg-white border-0 shadow-sm backdrop-blur-sm px-3 py-1 text-xs\">\n                                                        {item.categories.name}\n                                                    </Badge>\n                                                </div>\n                                            )}\n                                        </Link>\n\n                                        <div className=\"p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 text-xs text-slate-500 mb-4 font-medium\">\n                                                <span className=\"flex items-center gap-1.5 bg-slate-50 px-2 py-1 rounded-md border border-slate-100\">\n                                                    <Calendar className=\"w-3.5 h-3.5 text-slate-400\" />\n                                                    {new Date(item.published_at || item.created_at).toLocaleDateString()}\n                                                </span>\n                                            </div>\n                                            <h3 className=\"font-bold text-xl text-slate-900 mb-3 line-clamp-2 leading-tight group-hover:text-blue-600 transition-colors\">\n                                                <Link to={`/blogs/${item.slug}`}>{item.title}</Link>\n                                            </h3>\n                                            <p className=\"text-slate-600 text-sm line-clamp-3 mb-6 flex-1 leading-relaxed\">\n                                                {item.excerpt || stripHtml(item.content).substring(0, 150) + '...'}\n                                            </p>\n                                            <div className=\"pt-4 border-t border-slate-100 flex justify-between items-center mt-auto\">\n                                                <Link to={`/blogs/${item.slug}`} className=\"inline-flex items-center text-sm font-semibold text-blue-600 hover:text-blue-700\">\n                                                    Read Blog <ArrowRight className=\"w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform\" />\n                                                </Link>\n                                                {item.views > 0 && (\n                                                    <span className=\"text-xs text-slate-400 flex items-center gap-1\">\n                                                        <Eye className=\"w-3 h-3\" /> {item.views}\n                                                    </span>\n                                                )}\n                                            </div>\n                                        </div>\n                                    </motion.div>\n                                ))}\n                            </div>\n                        ) : (\n                            <div className=\"text-center py-20 bg-white rounded-2xl border border-dashed border-slate-200\">\n                                <div className=\"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4\">\n                                    <Search className=\"w-8 h-8 text-slate-300\" />\n                                </div>\n                                <h3 className=\"text-lg font-medium text-slate-900\">No blogs found</h3>\n                                <p className=\"text-slate-500 max-w-sm mx-auto mt-2\">\n                                    {debouncedQuery\n                                        ? `No results found for \"${debouncedQuery}\". Try different keywords.`\n                                        : \"We couldn't find any blogs matching your filters.\"}\n                                </p>\n                                <button onClick={() => { clearSearch(); setActiveCategory(null); }} className=\"mt-6 text-blue-600 hover:underline text-sm font-medium\">\n                                    Clear all filters\n                                </button>\n                            </div>\n                        )}\n                        {blogs.length > 0 && (\n                            <div className=\"flex justify-center mt-8\">\n                                <Pagination currentPage={currentPage} totalPages={totalPages} onPageChange={setCurrentPage} />\n                            </div>\n                        )}\n                    </>\n                )}\n            </div>\n        </div>\n    );\n}\n\nexport default PublicBlogs;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicContact.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":46,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { MapPin, Phone, Mail, Send, Loader2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Helmet } from 'react-helmet-async';\n\nfunction PublicContact() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    subject: '',\n    message: ''\n  });\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const { error } = await supabase\n        .from('contact_messages')\n        .insert([{\n          ...formData,\n          status: 'new',\n          created_at: new Date()\n        }]);\n\n      if (error) throw error;\n\n      toast({\n        title: t('contact.success_title', 'Message Sent!'),\n        description: t('contact.success_desc', 'We will get back to you shortly.'),\n      });\n      setFormData({ name: '', email: '', phone: '', subject: '', message: '' });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to send message. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background pt-10 pb-20\">\n      <Helmet>\n        <title>Contact Us - AWCMS</title>\n        <meta name=\"description\" content=\"Get in touch with us for any inquiries.\" />\n      </Helmet>\n\n      <div className=\"container mx-auto px-4\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"text-center mb-16\"\n        >\n          <h1 className=\"text-4xl md:text-5xl font-bold text-foreground mb-4\">Get in Touch</h1>\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n            Have questions about our services or need support? We&apos;re here to help.\n          </p>\n        </motion.div>\n\n        <div className=\"grid lg:grid-cols-3 gap-8 max-w-6xl mx-auto\">\n          {/* Contact Info */}\n          <div className=\"space-y-6\">\n            <div className=\"bg-card border border-border rounded-2xl p-8 shadow-sm\">\n              <h3 className=\"text-xl font-bold text-foreground mb-6\">Contact Information</h3>\n              <div className=\"space-y-6\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"bg-primary/10 p-3 rounded-lg text-primary\">\n                    <MapPin className=\"w-6 h-6\" />\n                  </div>\n                  <div>\n                    <h4 className=\"font-semibold text-foreground\">Our Location</h4>\n                    <p className=\"text-muted-foreground text-sm mt-1\">123 Digital Avenue, Tech City, Jakarta 10220</p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"bg-primary/10 p-3 rounded-lg text-primary\">\n                    <Phone className=\"w-6 h-6\" />\n                  </div>\n                  <div>\n                    <h4 className=\"font-semibold text-foreground\">Phone Number</h4>\n                    <p className=\"text-muted-foreground text-sm mt-1\">+62 895 1338 0400</p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"bg-primary/10 p-3 rounded-lg text-primary\">\n                    <Mail className=\"w-6 h-6\" />\n                  </div>\n                  <div>\n                    <h4 className=\"font-semibold text-foreground\">Email Address</h4>\n                    <p className=\"text-muted-foreground text-sm mt-1\">hello@ahliweb.com</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Contact Form */}\n          <div className=\"lg:col-span-2\">\n            <motion.div\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.2 }}\n              className=\"bg-card border border-border rounded-2xl p-8 shadow-sm\"\n            >\n              <h3 className=\"text-xl font-bold text-foreground mb-6\">Send us a Message</h3>\n              <form onSubmit={handleSubmit} className=\"space-y-6\">\n                <div className=\"grid md:grid-cols-2 gap-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"name\">Full Name</Label>\n                    <Input\n                      id=\"name\"\n                      placeholder=\"John Doe\"\n                      value={formData.name}\n                      onChange={e => setFormData({ ...formData, name: e.target.value })}\n                      required\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"email\">Email Address</Label>\n                    <Input\n                      id=\"email\"\n                      type=\"email\"\n                      placeholder=\"john@example.com\"\n                      value={formData.email}\n                      onChange={e => setFormData({ ...formData, email: e.target.value })}\n                      required\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid md:grid-cols-2 gap-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"phone\">Phone (Optional)</Label>\n                    <Input\n                      id=\"phone\"\n                      placeholder=\"+62...\"\n                      value={formData.phone}\n                      onChange={e => setFormData({ ...formData, phone: e.target.value })}\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"subject\">Subject</Label>\n                    <Input\n                      id=\"subject\"\n                      placeholder=\"How can we help?\"\n                      value={formData.subject}\n                      onChange={e => setFormData({ ...formData, subject: e.target.value })}\n                      required\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"message\">Message</Label>\n                  <Textarea\n                    id=\"message\"\n                    placeholder=\"Type your message here...\"\n                    className=\"min-h-[150px]\"\n                    value={formData.message}\n                    onChange={e => setFormData({ ...formData, message: e.target.value })}\n                    required\n                  />\n                </div>\n\n                <Button type=\"submit\" size=\"lg\" className=\"w-full md:w-auto\" disabled={loading}>\n                  {loading ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : <Send className=\"w-4 h-4 mr-2\" />}\n                  Send Message\n                </Button>\n              </form>\n            </motion.div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default PublicContact;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicPageDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { useParams, Link, useNavigate } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { Calendar, ArrowLeft, Share2, Printer, User, Eye, Tag, ChevronRight, Home, FileText } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport ShareButtons from '@/components/public/ShareButtons';\nimport TableOfContents from '@/components/public/TableOfContents';\nimport { useTranslation } from 'react-i18next';\nimport { Render } from '@puckeditor/core';\nimport puckConfig from '@/components/visual-builder/config';\nimport '@puckeditor/core/puck.css';\nimport '@/components/visual-builder/puck-theme.css';\nimport { WidgetAreaRenderer } from '@/components/public/WidgetAreaRenderer';\nimport { sanitizeHTML } from '@/utils/sanitize';\n\nfunction PublicPageDetail() {\n    const { slug } = useParams();\n    const navigate = useNavigate();\n    const { t } = useTranslation();\n\n    const [page, setPage] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [relatedPages, setRelatedPages] = useState([]);\n\n    useEffect(() => {\n        const fetchDetail = async () => {\n            setLoading(true);\n            try {\n                // Fetch main page\n                // Explicitly use the foreign key relationship name to resolve ambiguity\n                const { data, error } = await supabase\n                    .from('pages')\n                    .select(`\n                *, \n                categories!pages_category_id_fkey(id, name), \n                users!created_by(full_name, avatar_url)\n            `)\n                    .eq('slug', slug)\n                    .eq('status', 'published')\n                    .eq('is_public', true)\n                    .maybeSingle();\n\n                if (error) throw error;\n\n                if (data) {\n                    setPage(data);\n\n                    // Increment view count via RPC\n                    supabase.rpc('increment_page_view', { page_id: data.id });\n\n                    // Fetch related pages in same category\n                    if (data.category_id) {\n                        const { data: related } = await supabase\n                            .from('pages')\n                            .select('id, title, slug, created_at, featured_image')\n                            .eq('category_id', data.category_id)\n                            .neq('id', data.id)\n                            .eq('status', 'published')\n                            .eq('is_public', true)\n                            .limit(4);\n                        setRelatedPages(related || []);\n                    }\n                }\n            } catch (err) {\n                console.error(\"Page detail error:\", err);\n            } finally {\n                setLoading(false);\n            }\n        };\n        fetchDetail();\n    }, [slug]);\n\n    const handlePrint = () => {\n        window.print();\n    };\n\n    if (loading) {\n        return (\n            <div className=\"min-h-screen bg-white\">\n                <div className=\"h-96 bg-slate-100 w-full animate-pulse\"></div>\n                <div className=\"container mx-auto px-4 max-w-7xl grid grid-cols-1 lg:grid-cols-12 gap-12 -mt-20 relative z-10\">\n                    <div className=\"lg:col-span-8 bg-white p-8 rounded-t-3xl border border-slate-200 shadow-sm space-y-6\">\n                        <div className=\"h-4 bg-slate-200 rounded w-1/4\"></div>\n                        <div className=\"h-10 bg-slate-200 rounded w-3/4\"></div>\n                        <div className=\"space-y-4 pt-8\">\n                            <div className=\"h-4 bg-slate-200 rounded w-full\"></div>\n                            <div className=\"h-4 bg-slate-200 rounded w-full\"></div>\n                            <div className=\"h-4 bg-slate-200 rounded w-2/3\"></div>\n                        </div>\n                    </div>\n                    <div className=\"lg:col-span-4 hidden lg:block pt-20 space-y-6\">\n                        <div className=\"h-64 bg-slate-100 rounded-xl\"></div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    if (!page) return (\n        <div className=\"min-h-screen flex flex-col items-center justify-center bg-slate-50 px-4 text-center\">\n            <SeoHelmet title=\"Page Not Found\" />\n            <div className=\"bg-white p-12 rounded-3xl shadow-xl border border-slate-100 max-w-lg\">\n                <div className=\"w-20 h-20 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-6\">\n                    <FileText className=\"w-10 h-10\" />\n                </div>\n                <h2 className=\"text-3xl font-bold text-slate-900 mb-3\">{t('Page Not Found')}</h2>\n                <p className=\"text-slate-600 mb-8 text-lg\">{t('The page you are looking for might have been removed, had its name changed, or is temporarily unavailable.')}</p>\n                <div className=\"flex justify-center gap-4\">\n                    <Button onClick={() => navigate(-1)} variant=\"outline\">\n                        <ArrowLeft className=\"w-4 h-4 mr-2\" /> {t('Go Back')}\n                    </Button>\n                    <Button onClick={() => navigate('/pages')} className=\"bg-blue-600 hover:bg-blue-700\">\n                        {t('Browse Pages')}\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n\n    const currentUrl = typeof window !== 'undefined' ? window.location.href : '';\n\n    return (\n        <div className=\"bg-slate-50 min-h-screen pb-20 font-sans\">\n            <SeoHelmet\n                type=\"page_detail\"\n                id={page.id}\n                title={page.meta_title || page.title}\n                description={page.meta_description || page.excerpt}\n                keywords={page.meta_keywords}\n                image={page.og_image || page.featured_image}\n                url={page.canonical_url || currentUrl}\n            />\n\n            {/* Hero Header */}\n            <div className=\"relative bg-slate-900 pt-32 pb-32 lg:pb-40 overflow-hidden print:hidden\">\n                {page.featured_image && (\n                    <div className=\"absolute inset-0 opacity-20\">\n                        <img src={page.featured_image} alt=\"\" className=\"w-full h-full object-cover\" />\n                    </div>\n                )}\n                <div className=\"absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/60 to-transparent\"></div>\n\n                <div className=\"container mx-auto px-4 relative z-10 max-w-7xl\">\n                    {/* Breadcrumbs */}\n                    <nav className=\"flex items-center text-sm text-slate-400 mb-8 overflow-x-auto whitespace-nowrap pb-2\">\n                        <Link to=\"/\" className=\"hover:text-white transition-colors flex items-center gap-1\">\n                            <Home className=\"w-3.5 h-3.5\" /> Home\n                        </Link>\n                        <ChevronRight className=\"w-4 h-4 mx-2 shrink-0 opacity-50\" />\n                        <Link to=\"/pages\" className=\"hover:text-white transition-colors\">\n                            Resources\n                        </Link>\n                        {page.categories && (\n                            <>\n                                <ChevronRight className=\"w-4 h-4 mx-2 shrink-0 opacity-50\" />\n                                <Link to={`/pages?category=${page.categories.id}`} className=\"hover:text-white transition-colors\">\n                                    {page.categories.name}\n                                </Link>\n                            </>\n                        )}\n                        <ChevronRight className=\"w-4 h-4 mx-2 shrink-0 opacity-50\" />\n                        <span className=\"text-white font-medium truncate max-w-[200px]\">{page.title}</span>\n                    </nav>\n\n                    <div className=\"max-w-4xl\">\n                        <motion.div\n                            initial={{ opacity: 0, y: 20 }}\n                            animate={{ opacity: 1, y: 0 }}\n                        >\n                            {page.categories && (\n                                <Badge className=\"bg-blue-600 hover:bg-blue-700 text-white border-0 mb-6 px-3 py-1 text-sm font-medium rounded-full\">\n                                    {page.categories.name}\n                                </Badge>\n                            )}\n\n                            <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight tracking-tight\">\n                                {page.title}\n                            </h1>\n\n                            <div className=\"flex flex-wrap items-center gap-6 text-slate-300 text-sm md:text-base\">\n                                {page.users && (\n                                    <div className=\"flex items-center gap-3\">\n                                        {page.users.avatar_url ? (\n                                            <img src={page.users.avatar_url} alt={page.users.full_name} className=\"w-10 h-10 rounded-full border-2 border-slate-700\" />\n                                        ) : (\n                                            <div className=\"w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center border-2 border-slate-700\">\n                                                <User className=\"w-5 h-5 text-slate-400\" />\n                                            </div>\n                                        )}\n                                        <span className=\"font-medium text-white\">{page.users.full_name || 'Anonymous'}</span>\n                                    </div>\n                                )}\n\n                                <div className=\"flex items-center gap-6 border-l border-slate-700 pl-6 ml-2\">\n                                    <span className=\"flex items-center gap-2\" title=\"Published Date\">\n                                        <Calendar className=\"w-4 h-4 text-blue-400\" />\n                                        {new Date(page.created_at).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}\n                                    </span>\n\n                                    {page.views !== undefined && (\n                                        <span className=\"flex items-center gap-2\" title=\"Total Views\">\n                                            <Eye className=\"w-4 h-4 text-emerald-400\" />\n                                            {page.views?.toLocaleString()} views\n                                        </span>\n                                    )}\n                                </div>\n                            </div>\n                        </motion.div>\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"container mx-auto px-4 -mt-20 relative z-20 max-w-7xl\">\n                <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-10\">\n                    {/* Main Content */}\n                    <motion.div\n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        transition={{ delay: 0.1 }}\n                        className=\"lg:col-span-8\"\n                    >\n                        <div className=\"bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden print:shadow-none print:border-none\">\n                            <div className=\"p-8 md:p-12\">\n                                {page.editor_type === 'visual' && page.content_published ? (\n                                    <div className=\"puck-content\">\n                                        <Render config={puckConfig} data={page.content_published} />\n                                    </div>\n                                ) : (\n                                    <div className=\"prose prose-slate prose-lg max-w-none prose-headings:font-bold prose-headings:text-slate-900 prose-headings:tracking-tight prose-a:text-blue-600 hover:prose-a:text-blue-700 prose-img:rounded-2xl prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:bg-slate-50 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:not-italic prose-blockquote:rounded-r-lg\">\n                                        <div dangerouslySetInnerHTML={sanitizeHTML(page.content)} />\n                                    </div>\n                                )}\n\n                                {/* Post-Content Metadata */}\n                                <div className=\"mt-12 pt-8 border-t border-slate-100 print:hidden\">\n                                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\n                                        {page.tags && page.tags.length > 0 && (\n                                            <div className=\"flex flex-wrap gap-2\">\n                                                {page.tags.map((tag, i) => (\n                                                    <span key={i} className=\"px-3 py-1.5 bg-slate-50 text-slate-600 rounded-lg text-sm font-medium border border-slate-200 hover:bg-slate-100 transition-colors cursor-default flex items-center gap-1.5\">\n                                                        <Tag className=\"w-3 h-3 text-slate-400\" /> {tag}\n                                                    </span>\n                                                ))}\n                                            </div>\n                                        )}\n\n                                        <div className=\"flex items-center gap-3\">\n                                            <Button variant=\"ghost\" size=\"sm\" onClick={handlePrint} className=\"text-slate-500 hover:text-slate-900\">\n                                                <Printer className=\"w-4 h-4 mr-2\" /> Print\n                                            </Button>\n                                            <Button variant=\"ghost\" size=\"sm\" onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} className=\"text-slate-500 hover:text-slate-900\">\n                                                Back to Top\n                                            </Button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </motion.div>\n\n                    {/* Sidebar */}\n                    <div className=\"lg:col-span-4 space-y-8 print:hidden\">\n\n                        {/* Table of Contents */}\n                        <div className=\"sticky top-24 space-y-8\">\n                            <TableOfContents content={page.content} />\n\n                            {/* Widget Area: Default Sidebar */}\n                            <WidgetAreaRenderer slug=\"default-sidebar\" />\n\n                            <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 p-6\">\n                                <h4 className=\"font-semibold text-slate-900 mb-4 flex items-center gap-2\">\n                                    <Share2 className=\"w-4 h-4 text-blue-600\" /> Share this page\n                                </h4>\n                                <ShareButtons\n                                    url={currentUrl}\n                                    title={page.title}\n                                    description={page.excerpt}\n                                />\n                            </div>\n\n                            {relatedPages.length > 0 && (\n                                <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 p-6\">\n                                    <h4 className=\"font-semibold text-slate-900 mb-6 pb-2 border-b border-slate-100\">Related Pages</h4>\n                                    <div className=\"space-y-6\">\n                                        {relatedPages.map(item => (\n                                            <Link key={item.id} to={`/pages/${item.slug}`} className=\"group flex gap-4 items-start\">\n                                                <div className=\"w-16 h-16 rounded-lg bg-slate-100 overflow-hidden shrink-0\">\n                                                    {item.featured_image ? (\n                                                        <img src={item.featured_image} alt=\"\" className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300\" />\n                                                    ) : (\n                                                        <div className=\"w-full h-full flex items-center justify-center text-slate-300\">\n                                                            <FileText className=\"w-6 h-6\" />\n                                                        </div>\n                                                    )}\n                                                </div>\n                                                <div>\n                                                    <h5 className=\"text-sm font-semibold text-slate-900 group-hover:text-blue-600 transition-colors line-clamp-2 leading-snug mb-1\">\n                                                        {item.title}\n                                                    </h5>\n                                                    <span className=\"text-xs text-slate-400\">\n                                                        {new Date(item.created_at).toLocaleDateString()}\n                                                    </span>\n                                                </div>\n                                            </Link>\n                                        ))}\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n\nexport default PublicPageDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicPages.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { ArrowRight, FileText, Calendar, Search, ArrowUpDown, X, Info, Loader2 } from 'lucide-react';\nimport CategoryFilter from '@/components/public/CategoryFilter';\nimport { Pagination } from '@/components/ui/pagination';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { useSearch } from '@/hooks/useSearch';\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\nfunction PublicPages() {\n    const { t } = useTranslation();\n    const [pages, setPages] = useState([]);\n    const [categories, setCategories] = useState([]);\n    const [activeCategory, setActiveCategory] = useState(null);\n    const [sortBy, setSortBy] = useState('newest');\n\n    const {\n        query,\n        setQuery,\n        debouncedQuery,\n        isValid,\n        message,\n        minLength,\n        clearSearch,\n        loading: searchLoading,\n        setLoading: setSearchLoading\n    } = useSearch({ minLength: 5 });\n\n    const [currentPage, setCurrentPage] = useState(1);\n    const [totalItems, setTotalItems] = useState(0);\n    const itemsPerPage = 9;\n\n    useEffect(() => {\n        const fetchCategories = async () => {\n            const { data } = await supabase.from('categories').select('*').eq('type', 'pages').is('deleted_at', null);\n            if (data) setCategories(data);\n        };\n        fetchCategories();\n    }, []);\n\n    useEffect(() => {\n        const fetchPages = async () => {\n            setSearchLoading(true);\n            try {\n                const from = (currentPage - 1) * itemsPerPage;\n                const to = from + itemsPerPage - 1;\n\n                let queryBuilder = supabase\n                    .from('pages')\n                    .select('id, title, slug, excerpt, created_at, featured_image, categories!pages_category_id_fkey(name)', { count: 'exact' })\n                    .eq('status', 'published')\n                    .eq('is_public', true)\n                    .is('deleted_at', null);\n\n                if (activeCategory) queryBuilder = queryBuilder.eq('category_id', activeCategory);\n                if (debouncedQuery) queryBuilder = queryBuilder.ilike('title', `%${debouncedQuery}%`);\n\n                switch (sortBy) {\n                    case 'newest': queryBuilder = queryBuilder.order('created_at', { ascending: false }); break;\n                    case 'oldest': queryBuilder = queryBuilder.order('created_at', { ascending: true }); break;\n                    case 'az': queryBuilder = queryBuilder.order('title', { ascending: true }); break;\n                    case 'za': queryBuilder = queryBuilder.order('title', { ascending: false }); break;\n                    default: queryBuilder = queryBuilder.order('created_at', { ascending: false });\n                }\n\n                const { data, count, error } = await queryBuilder.range(from, to);\n                if (error) throw error;\n\n                setPages(data || []);\n                setTotalItems(count || 0);\n            } catch (err) {\n                console.error(\"Fetch Pages Error:\", err);\n            } finally {\n                setSearchLoading(false);\n            }\n        };\n        fetchPages();\n    }, [currentPage, activeCategory, debouncedQuery, sortBy, setSearchLoading]);\n\n    const totalPages = Math.ceil(totalItems / itemsPerPage);\n\n    return (\n        <div className=\"min-h-screen bg-slate-50/50\">\n            <SeoHelmet type=\"pages\" defaultTitle=\"Pages & Resources\" defaultDescription=\"Browse our collection of pages, guides, and resources.\" />\n\n            <div className=\"bg-white border-b border-slate-200 py-16 lg:py-24\">\n                <div className=\"container mx-auto px-4 text-center max-w-2xl\">\n                    <motion.h1 initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} className=\"text-4xl md:text-5xl font-extrabold text-slate-900 mb-6 tracking-tight\">\n                        {t('Resources & Pages')}\n                    </motion.h1>\n                    <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className=\"text-lg text-slate-600 leading-relaxed\">\n                        {t('Explore our comprehensive documentation, company updates, and informative guides designed to help you succeed.')}\n                    </motion.p>\n                </div>\n            </div>\n\n            <div className=\"container mx-auto px-4 py-12\">\n                <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-10 flex flex-col lg:flex-row items-center gap-6 justify-between sticky top-24 z-30\">\n                    <div className=\"w-full lg:w-auto overflow-x-auto pb-2 lg:pb-0\">\n                        <CategoryFilter categories={categories} activeCategory={activeCategory} onSelect={(id) => { setActiveCategory(id); setCurrentPage(1); }} />\n                    </div>\n\n                    <div className=\"flex w-full lg:w-auto items-center gap-3\">\n                        <div className=\"relative w-full md:w-64\">\n                            <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-slate-400\" />\n                            <Input\n                                placeholder={t('Search... (5+ chars)')}\n                                value={query}\n                                onChange={(e) => { setQuery(e.target.value); setCurrentPage(1); }}\n                                className={`pl-9 pr-14 bg-slate-50 border-slate-200 ${!isValid ? 'border-amber-300 ring-amber-200' : ''}`}\n                            />\n                            <div className=\"absolute right-3 top-2.5 flex items-center gap-2\">\n                                {query && (\n                                    <button onClick={clearSearch}><X className=\"h-3.5 w-3.5 text-slate-400\" /></button>\n                                )}\n                                <span className={`text-[10px] ${!isValid && query.length > 0 ? 'text-amber-500 font-bold' : 'text-slate-400'}`}>\n                                    {query.length}/{minLength}\n                                </span>\n                            </div>\n                            {!isValid && query.length > 0 && (\n                                <div className=\"absolute top-full right-0 mt-1 flex items-center gap-1 text-[10px] text-amber-600 font-medium bg-amber-50 px-2 py-1 rounded border border-amber-100 shadow-sm z-50\">\n                                    <Info className=\"w-3 h-3\" /> {message}\n                                </div>\n                            )}\n                        </div>\n\n                        <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                                <Button variant=\"outline\" className=\"gap-2 shrink-0\">\n                                    <ArrowUpDown className=\"w-4 h-4\" />\n                                    <span className=\"hidden sm:inline\">Sort</span>\n                                </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                                <DropdownMenuItem onClick={() => setSortBy('newest')}>Newest First</DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => setSortBy('oldest')}>Oldest First</DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => setSortBy('az')}>Title (A-Z)</DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => setSortBy('za')}>Title (Z-A)</DropdownMenuItem>\n                            </DropdownMenuContent>\n                        </DropdownMenu>\n                    </div>\n                </div>\n\n                {searchLoading ? (\n                    <div className=\"flex justify-center py-20\"><Loader2 className=\"w-8 h-8 animate-spin text-slate-400\" /></div>\n                ) : (\n                    <>\n                        {pages.length > 0 ? (\n                            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                                {pages.map((page, i) => (\n                                    <motion.div\n                                        key={page.id}\n                                        initial={{ opacity: 0, y: 20 }}\n                                        animate={{ opacity: 1, y: 0 }}\n                                        transition={{ delay: i * 0.05 }}\n                                        className=\"bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 flex flex-col overflow-hidden group h-full\"\n                                    >\n                                        <Link to={`/pages/${page.slug}`} className=\"block h-52 overflow-hidden relative\">\n                                            {page.featured_image ? (\n                                                <img src={page.featured_image} alt={page.title} className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\" />\n                                            ) : (\n                                                <div className=\"w-full h-full bg-slate-50 flex items-center justify-center border-b border-slate-100\">\n                                                    <FileText className=\"w-12 h-12 text-slate-300\" />\n                                                </div>\n                                            )}\n                                            {page.categories && (\n                                                <div className=\"absolute top-4 left-4\">\n                                                    <span className=\"text-xs font-bold tracking-wide text-blue-700 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full shadow-sm border border-blue-100\">\n                                                        {page.categories.name}\n                                                    </span>\n                                                </div>\n                                            )}\n                                        </Link>\n\n                                        <div className=\"p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-2 mb-3 text-xs text-slate-400\">\n                                                <Calendar className=\"w-3.5 h-3.5\" />\n                                                {new Date(page.created_at).toLocaleDateString()}\n                                            </div>\n                                            <h2 className=\"text-xl font-bold text-slate-900 mb-3 group-hover:text-blue-600 transition-colors line-clamp-2\">\n                                                <Link to={`/pages/${page.slug}`}>{page.title}</Link>\n                                            </h2>\n                                            <p className=\"text-slate-600 mb-6 line-clamp-3 text-sm leading-relaxed flex-1\">\n                                                {page.excerpt || t(\"Click to read full content...\")}\n                                            </p>\n                                            <div className=\"mt-auto pt-5 border-t border-slate-50 flex items-center justify-between\">\n                                                <Link to={`/pages/${page.slug}`} className=\"inline-flex items-center text-blue-600 font-semibold hover:text-blue-700 text-sm group-hover:translate-x-1 transition-transform\">\n                                                    {t('Read More')} <ArrowRight className=\"w-4 h-4 ml-1\" />\n                                                </Link>\n                                            </div>\n                                        </div>\n                                    </motion.div>\n                                ))}\n                            </div>\n                        ) : (\n                            <div className=\"col-span-full py-32 text-center bg-white rounded-3xl border border-slate-200 border-dashed\">\n                                <div className=\"w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6 border border-slate-100\">\n                                    <Search className=\"w-10 h-10 text-slate-300\" />\n                                </div>\n                                <h3 className=\"text-xl font-bold text-slate-900 mb-2\">{t('No pages found')}</h3>\n                                <p className=\"text-slate-500 max-w-md mx-auto\">{t('We couldn\\'t find any pages matching your current filters.')}</p>\n                                <Button variant=\"outline\" className=\"mt-6\" onClick={() => { clearSearch(); setActiveCategory(null); }}>\n                                    {t('Clear Filters')}\n                                </Button>\n                            </div>\n                        )}\n                    </>\n                )}\n\n                {pages.length > 0 && (\n                    <div className=\"flex justify-center mt-16\">\n                        <Pagination currentPage={currentPage} totalPages={totalPages} onPageChange={setCurrentPage} />\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n\nexport default PublicPages;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicPhotoGallery.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  22 |\n  23 |   useEffect(() => {\n> 24 |     fetchGalleries();\n     |     ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  25 |   }, []);\n  26 |\n  27 |   return (","line":24,"column":5,"nodeType":null,"endLine":24,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { Helmet } from 'react-helmet-async';\nimport { Image as ImageIcon, Layers } from 'lucide-react';\nimport { Link } from 'react-router-dom';\n\nfunction PublicPhotoGallery() {\n  const [items, setItems] = useState([]);\n\n  const fetchGalleries = async () => {\n\n    const { data } = await supabase\n      .from('photo_gallery')\n      .select('*')\n      .eq('status', 'published')\n      .order('created_at', { ascending: false });\n    setItems(data || []);\n\n  };\n\n  useEffect(() => {\n    fetchGalleries();\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background py-16\">\n      <Helmet>\n        <title>Photo Gallery - AWCMS</title>\n      </Helmet>\n\n      <div className=\"container mx-auto px-4\">\n        <h1 className=\"text-4xl font-bold text-foreground mb-12 text-center\">Photo Gallery</h1>\n\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n          {items.map((item, i) => {\n            const coverImage = item.photos?.[0]?.url;\n            return (\n              <motion.div\n                key={item.id}\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: i * 0.1 }}\n              >\n                <Link to={`/photo-gallery/${item.slug}`} className=\"group block\">\n                  <div className=\"aspect-[4/3] rounded-2xl overflow-hidden bg-muted relative mb-4 border border-border\">\n                    {coverImage ? (\n                      <img\n                        src={coverImage}\n                        alt={item.title}\n                        className=\"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105\"\n                      />\n                    ) : (\n                      <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                        <ImageIcon className=\"w-8 h-8 opacity-50\" />\n                      </div>\n                    )}\n                    <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                      <div className=\"bg-background/90 text-foreground px-4 py-2 rounded-full text-sm font-medium backdrop-blur-sm\">\n                        View Album\n                      </div>\n                    </div>\n                    <div className=\"absolute bottom-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-md flex items-center gap-1 backdrop-blur-sm\">\n                      <Layers className=\"w-3 h-3\" />\n                      {item.photos?.length || 0}\n                    </div>\n                  </div>\n                  <h3 className=\"font-bold text-lg text-foreground group-hover:text-primary transition-colors\">{item.title}</h3>\n                  <p className=\"text-sm text-muted-foreground line-clamp-1\">{item.description}</p>\n                </Link>\n              </motion.div>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default PublicPhotoGallery;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicPhotoGalleryDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { ArrowLeft, Image as ImageIcon, ExternalLink, Tag, Calendar } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\n\nfunction PublicPhotoGalleryDetail() {\n  const { slug } = useParams(); \n  const [album, setAlbum] = useState(null);\n  const [relatedAlbums, setRelatedAlbums] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchDetail = async () => {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('photo_gallery')\n        .select(`*, categories(name)`)\n        .eq('slug', slug)\n        .eq('status', 'published')\n        .maybeSingle();\n      \n      if (!error && data) {\n        setAlbum(data);\n        \n        if (data.category_id) {\n             const { data: related } = await supabase\n                .from('photo_gallery')\n                .select('id, title, slug, created_at')\n                .eq('category_id', data.category_id)\n                .neq('id', data.id)\n                .eq('status', 'published')\n                .limit(3);\n             setRelatedAlbums(related || []);\n        }\n      }\n      setLoading(false);\n    };\n    fetchDetail();\n  }, [slug]);\n\n  if (loading) return <div className=\"py-20 text-center\">Loading album...</div>;\n\n  if (!album) return (\n    <div className=\"py-20 text-center\">\n       <h2 className=\"text-2xl font-bold text-slate-800\">Album Not Found</h2>\n       <Link to=\"/gallery/photos\" className=\"text-blue-600 mt-4 inline-block\">Back to gallery</Link>\n    </div>\n  );\n\n  return (\n    <div className=\"container mx-auto px-4 py-12 max-w-4xl\">\n      <SeoHelmet \n        type=\"photo_gallery_detail\"\n        id={album.id}\n        defaultTitle={`${album.title} | Photo Gallery`} \n        defaultDescription={album.description}\n      />\n\n      <Link to=\"/gallery/photos\" className=\"inline-flex items-center text-sm text-slate-500 hover:text-blue-600 transition-colors mb-8\">\n         <ArrowLeft className=\"w-4 h-4 mr-1\" /> Back to Gallery\n      </Link>\n\n      <div className=\"bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm\">\n          <div className=\"aspect-video bg-slate-100 flex items-center justify-center relative bg-[url('https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=800&auto=format&fit=crop&q=60')] bg-cover bg-center\">\n               <div className=\"absolute inset-0 bg-black/40 backdrop-blur-sm\"></div>\n               <div className=\"relative z-10 text-center text-white p-6\">\n                   <ImageIcon className=\"w-16 h-16 mx-auto mb-4 opacity-80\" />\n                   <h1 className=\"text-3xl font-bold\">{album.title}</h1>\n               </div>\n          </div>\n          \n          <div className=\"p-8 md:p-10\">\n              <div className=\"flex flex-wrap items-center gap-3 mb-6\">\n                  {album.categories && <Badge variant=\"secondary\" className=\"bg-blue-50 text-blue-700\">{album.categories.name}</Badge>}\n                  <span className=\"text-sm text-slate-500 flex items-center gap-1\">\n                      <Calendar className=\"w-4 h-4\" /> {new Date(album.created_at).toLocaleDateString()}\n                  </span>\n              </div>\n              \n              <div className=\"prose prose-slate max-w-none mb-8\">\n                  <p className=\"text-slate-600 text-lg leading-relaxed\">{album.description}</p>\n              </div>\n              \n              {album.google_album_url && (\n                  <div className=\"bg-slate-50 border border-slate-200 rounded-xl p-6 flex items-center justify-between\">\n                      <div>\n                          <h4 className=\"font-bold text-slate-900\">External Album</h4>\n                          <p className=\"text-sm text-slate-500\">View high-resolution photos on Google Photos</p>\n                      </div>\n                      <Button asChild>\n                        <a href={album.google_album_url} target=\"_blank\" rel=\"noopener noreferrer\">\n                            View Photos <ExternalLink className=\"w-4 h-4 ml-2\" />\n                        </a>\n                      </Button>\n                  </div>\n              )}\n\n              {album.tags && album.tags.length > 0 && (\n                  <div className=\"mt-8 pt-8 border-t border-slate-100\">\n                      <div className=\"flex flex-wrap gap-2\">\n                          {album.tags.map((tag, i) => (\n                              <span key={i} className=\"inline-flex items-center gap-1 text-sm text-slate-500 bg-slate-50 px-3 py-1 rounded-full border border-slate-200\">\n                                  <Tag className=\"w-3 h-3\" /> {tag}\n                              </span>\n                          ))}\n                      </div>\n                  </div>\n              )}\n          </div>\n      </div>\n\n      {relatedAlbums.length > 0 && (\n          <div className=\"mt-16\">\n              <h3 className=\"text-2xl font-bold text-slate-900 mb-6\">Related Albums</h3>\n              <div className=\"grid md:grid-cols-3 gap-6\">\n                  {relatedAlbums.map(item => (\n                      <Link key={item.id} to={`/gallery/photos/${item.slug}`} className=\"group block\">\n                          <div className=\"bg-white rounded-xl border border-slate-200 p-4 hover:shadow-md transition-all\">\n                              <div className=\"bg-slate-100 h-32 rounded-lg mb-3 flex items-center justify-center\">\n                                  <ImageIcon className=\"w-8 h-8 text-slate-400\" />\n                              </div>\n                              <h4 className=\"font-bold text-slate-900 group-hover:text-blue-600 transition-colors line-clamp-1\">{item.title}</h4>\n                              <div className=\"text-xs text-slate-500 mt-1\">{new Date(item.created_at).toLocaleDateString()}</div>\n                          </div>\n                      </Link>\n                  ))}\n              </div>\n          </div>\n      )}\n    </div>\n  );\n}\n\nexport default PublicPhotoGalleryDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicPortfolio.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { Helmet } from 'react-helmet-async';\nimport { useTranslation } from 'react-i18next';\nimport { Link } from 'react-router-dom';\nimport { Calendar, User, ArrowRight, Search, X, Info, Loader2 } from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useSearch } from '@/hooks/useSearch';\n\nfunction PublicPortfolio() {\n    const { t } = useTranslation();\n    const [items, setItems] = useState([]);\n\n    const {\n        query,\n        setQuery,\n        debouncedQuery,\n        isValid,\n        message,\n        minLength,\n        clearSearch,\n        loading: searchLoading,\n        setLoading: setSearchLoading\n    } = useSearch({ minLength: 5 });\n\n    useEffect(() => {\n        const fetchPortfolio = async () => {\n            setSearchLoading(true);\n            let queryBuilder = supabase\n                .from('portfolio')\n                .select('*, categories(name)')\n                .eq('status', 'published')\n                .order('project_date', { ascending: false });\n\n            if (debouncedQuery) {\n                queryBuilder = queryBuilder.ilike('title', `%${debouncedQuery}%`);\n            }\n\n            const { data } = await queryBuilder;\n            setItems(data || []);\n            setSearchLoading(false);\n        };\n        fetchPortfolio();\n    }, [debouncedQuery, setSearchLoading]);\n\n\n    return (\n        <div className=\"min-h-screen bg-background py-16\">\n            <Helmet><title>{t('portfolio.title', 'Our Portfolio')} - AWCMS</title></Helmet>\n\n            <div className=\"container mx-auto px-4\">\n                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className=\"text-center mb-12\">\n                    <h1 className=\"text-4xl md:text-5xl font-bold text-foreground mb-4\">{t('portfolio.title', 'Our Portfolio')}</h1>\n                    <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto mb-8\">\n                        {t('portfolio.subtitle', 'Explore our latest projects and success stories.')}\n                    </p>\n\n                    <div className=\"max-w-md mx-auto relative\">\n                        <div className=\"relative\">\n                            <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-slate-400\" />\n                            <Input\n                                placeholder={`Search projects (${minLength}+ chars)...`}\n                                value={query}\n                                onChange={(e) => setQuery(e.target.value)}\n                                className={`pl-9 pr-14 ${!isValid ? 'border-amber-300 ring-amber-100' : ''}`}\n                            />\n                            <div className=\"absolute right-3 top-2.5 flex items-center gap-2\">\n                                {query && <button onClick={clearSearch}><X className=\"h-4 w-4 text-slate-400\" /></button>}\n                                <span className={`text-[10px] ${!isValid && query.length > 0 ? 'text-amber-500 font-bold' : 'text-slate-400'}`}>\n                                    {query.length}/{minLength}\n                                </span>\n                            </div>\n                        </div>\n                        {!isValid && query.length > 0 && (\n                            <div className=\"text-xs text-amber-600 font-medium mt-1 flex justify-center items-center gap-1\">\n                                <Info className=\"w-3 h-3\" /> {message}\n                            </div>\n                        )}\n                    </div>\n                </motion.div>\n\n                {searchLoading ? (\n                    <div className=\"flex justify-center py-20\"><Loader2 className=\"w-8 h-8 animate-spin text-slate-300\" /></div>\n                ) : (\n                    <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                        {items.length > 0 ? items.map((item, i) => (\n                            <motion.div\n                                key={item.id}\n                                initial={{ opacity: 0, y: 20 }}\n                                whileInView={{ opacity: 1, y: 0 }}\n                                viewport={{ once: true }}\n                                transition={{ delay: i * 0.1 }}\n                                className=\"group bg-card rounded-2xl border border-border overflow-hidden hover:shadow-lg transition-all\"\n                            >\n                                <div className=\"aspect-video bg-muted relative overflow-hidden\">\n                                    {item.images?.[0] ? (\n                                        <img\n                                            src={item.images[0].url}\n                                            alt={item.title}\n                                            className=\"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105\"\n                                        />\n                                    ) : (\n                                        <div className=\"w-full h-full flex items-center justify-center text-muted-foreground\">No Image</div>\n                                    )}\n                                    <div className=\"absolute top-4 left-4\">\n                                        <Badge variant=\"secondary\" className=\"bg-background/90 backdrop-blur-sm border-border text-foreground\">\n                                            {item.categories?.name || 'Project'}\n                                        </Badge>\n                                    </div>\n                                </div>\n                                <div className=\"p-6\">\n                                    <h3 className=\"text-xl font-bold text-foreground mb-2 line-clamp-1\">{item.title}</h3>\n                                    <p className=\"text-muted-foreground line-clamp-2 text-sm mb-4\">{item.description || 'No description available.'}</p>\n                                    <div className=\"flex items-center gap-4 text-xs text-muted-foreground mb-6\">\n                                        {item.client && <div className=\"flex items-center gap-1.5\"><User className=\"w-3.5 h-3.5\" /><span>{item.client}</span></div>}\n                                        {item.project_date && <div className=\"flex items-center gap-1.5\"><Calendar className=\"w-3.5 h-3.5\" /><span>{new Date(item.project_date).getFullYear()}</span></div>}\n                                    </div>\n                                    <Link to={`/portfolio/${item.slug}`}>\n                                        <Button className=\"w-full gap-2 group-hover:translate-x-1 transition-transform\">View Project <ArrowRight className=\"w-4 h-4\" /></Button>\n                                    </Link>\n                                </div>\n                            </motion.div>\n                        )) : (\n                            <div className=\"col-span-full text-center py-12 text-slate-400\">\n                                <p>No projects found matching your search.</p>\n                                <Button variant=\"link\" onClick={clearSearch}>Clear Search</Button>\n                            </div>\n                        )}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n\nexport default PublicPortfolio;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicPortfolioDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Calendar, User, Tag, ArrowLeft } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { Badge } from '@/components/ui/badge';\n\nfunction PublicPortfolioDetail() {\n  const { slug } = useParams();\n  const [project, setProject] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchDetail = async () => {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('portfolio')\n        .select(`*, categories(name)`)\n        .eq('slug', slug)\n        .eq('status', 'published')\n        .maybeSingle();\n\n      if (!error && data) {\n        setProject(data);\n      }\n      setLoading(false);\n    };\n    fetchDetail();\n  }, [slug]);\n\n  if (loading) return <div className=\"py-20 text-center\">Loading project...</div>;\n\n  if (!project) return (\n    <div className=\"py-20 text-center\">\n      <h2 className=\"text-2xl font-bold text-slate-800\">Project Not Found</h2>\n      <Link to=\"/portfolio\" className=\"text-blue-600 mt-4 inline-block\">Back to portfolio</Link>\n    </div>\n  );\n\n  return (\n    <div className=\"container mx-auto px-4 py-12 max-w-5xl\">\n      <SeoHelmet\n        type=\"portfolio_detail\"\n        id={project.id}\n        defaultTitle={`${project.title} | Portfolio`}\n        defaultDescription={project.description?.substring(0, 150) || ''}\n      />\n\n      <Link to=\"/portfolio\" className=\"inline-flex items-center text-sm text-slate-500 hover:text-blue-600 transition-colors mb-8\">\n        <ArrowLeft className=\"w-4 h-4 mr-1\" /> Back to Portfolio\n      </Link>\n\n      <div className=\"mb-10\">\n        <div className=\"flex flex-wrap items-center gap-3 mb-4\">\n          {project.categories && <Badge>{project.categories.name}</Badge>}\n          {project.project_date && (\n            <span className=\"text-sm text-slate-500 flex items-center gap-1\">\n              <Calendar className=\"w-4 h-4\" /> {new Date(project.project_date).toLocaleDateString()}\n            </span>\n          )}\n        </div>\n        <h1 className=\"text-4xl md:text-5xl font-bold text-slate-900 mb-6\">{project.title}</h1>\n\n        {project.client && (\n          <div className=\"flex items-center gap-2 text-lg text-slate-600 mb-8\">\n            <User className=\"w-5 h-5\" /> Client: <span className=\"font-semibold text-slate-900\">{project.client}</span>\n          </div>\n        )}\n      </div>\n\n      {/* Main Content Area */}\n      <div className=\"bg-white rounded-2xl p-8 shadow-sm border border-slate-200 mb-12\">\n        <h3 className=\"font-bold text-xl mb-4\">Project Overview</h3>\n        <div className=\"prose prose-slate max-w-none text-slate-600 leading-relaxed\">\n          {project.description}\n        </div>\n      </div>\n\n      {/* Tags */}\n      {project.tags && project.tags.length > 0 && ( // Assuming tags are stored as array or jsonb list\n        <div className=\"flex flex-wrap gap-2\">\n          {/* If tags is array of strings or objects, adjust mapping */}\n          {/* For simplicity, assuming standard text array for now if migrated, or handle jsonb if using jsonb tags column */}\n          {Array.isArray(project.tags) && project.tags.map((tag, i) => (\n            <Badge key={i} variant=\"secondary\" className=\"text-slate-600 bg-slate-100\">\n              <Tag className=\"w-3 h-3 mr-1\" /> {typeof tag === 'string' ? tag : tag.name}\n            </Badge>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default PublicPortfolioDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicProductDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { ShoppingBag, Tag, ArrowLeft, Package, Truck, CheckCircle, XCircle } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\n\nfunction PublicProductDetail() {\n    const { slug } = useParams();\n    const [product, setProduct] = useState(null);\n    const [relatedProducts, setRelatedProducts] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        const fetchDetail = async () => {\n            setLoading(true);\n            // Fetch Product\n            const { data, error } = await supabase\n                .from('products')\n                .select(`*, categories(name), product_types(name, icon)`)\n                .eq('slug', slug)\n                .eq('status', 'active')\n                .maybeSingle();\n\n            if (!error && data) {\n                setProduct(data);\n                // Fetch Related\n                if (data.category_id) {\n                    const { data: related } = await supabase\n                        .from('products')\n                        .select('id, name, slug, price, images')\n                        .eq('category_id', data.category_id)\n                        .neq('id', data.id)\n                        .eq('status', 'active')\n                        .limit(3);\n                    setRelatedProducts(related || []);\n                }\n            }\n            setLoading(false);\n        };\n        fetchDetail();\n    }, [slug]);\n\n    if (loading) return <div className=\"py-20 text-center\">Loading product...</div>;\n\n    if (!product) return (\n        <div className=\"py-20 text-center\">\n            <h2 className=\"text-2xl font-bold text-slate-800\">Product Not Found</h2>\n            <Link to=\"/products\" className=\"text-blue-600 mt-4 inline-block\">Back to products</Link>\n        </div>\n    );\n\n    const isDiscounted = product.discount_price && product.discount_price < product.price;\n    const finalPrice = isDiscounted ? product.discount_price : product.price;\n    const hasStock = product.stock > 0;\n\n    return (\n        <div className=\"container mx-auto px-4 py-12\">\n            <SeoHelmet\n                type=\"product_detail\"\n                id={product.id}\n                defaultTitle={`${product.name} | Products`}\n                defaultDescription={product.description.substring(0, 150)}\n            />\n\n            <Link to=\"/products\" className=\"inline-flex items-center text-sm text-slate-500 hover:text-blue-600 transition-colors mb-8\">\n                <ArrowLeft className=\"w-4 h-4 mr-1\" /> Back to Products\n            </Link>\n\n            <div className=\"grid lg:grid-cols-2 gap-12 mb-16\">\n                {/* Image Section */}\n                <div className=\"bg-slate-50 rounded-2xl h-[400px] lg:h-[500px] flex items-center justify-center border border-slate-200\">\n                    {product.images && product.images.length > 0 ? (\n                        <img src={product.images[0]} alt={product.name} className=\"max-w-full max-h-full object-contain\" />\n                    ) : (\n                        <Package className=\"w-32 h-32 text-slate-200\" />\n                    )}\n                </div>\n\n                {/* Content Section */}\n                <div className=\"flex flex-col\">\n                    <div className=\"flex items-center gap-2 mb-4\">\n                        {product.categories && <Badge variant=\"outline\" className=\"text-blue-600 border-blue-200 bg-blue-50\">{product.categories.name}</Badge>}\n                        {product.product_types && <Badge variant=\"secondary\" className=\"flex items-center gap-1\"><Tag className=\"w-3 h-3\" /> {product.product_types.name}</Badge>}\n                    </div>\n\n                    <h1 className=\"text-3xl lg:text-4xl font-bold text-slate-900 mb-4\">{product.name}</h1>\n\n                    <div className=\"flex items-end gap-4 mb-6\">\n                        <span className=\"text-4xl font-bold text-slate-900\">${finalPrice}</span>\n                        {isDiscounted && <span className=\"text-xl text-slate-400 line-through mb-1\">${product.price}</span>}\n                    </div>\n\n                    <div className=\"flex items-center gap-2 mb-8 text-sm\">\n                        {hasStock && product.is_available ? (\n                            <span className=\"flex items-center gap-1 text-green-600 font-medium bg-green-50 px-3 py-1 rounded-full\">\n                                <CheckCircle className=\"w-4 h-4\" /> In Stock ({product.stock} units)\n                            </span>\n                        ) : (\n                            <span className=\"flex items-center gap-1 text-red-600 font-medium bg-red-50 px-3 py-1 rounded-full\">\n                                <XCircle className=\"w-4 h-4\" /> Out of Stock\n                            </span>\n                        )}\n                        {product.shipping_cost > 0 && (\n                            <span className=\"flex items-center gap-1 text-slate-600 bg-slate-100 px-3 py-1 rounded-full\">\n                                <Truck className=\"w-4 h-4\" /> Shipping: ${product.shipping_cost}\n                            </span>\n                        )}\n                    </div>\n\n                    <div className=\"prose prose-slate mb-8 flex-1\">\n                        <p className=\"text-lg leading-relaxed text-slate-600\">{product.description}</p>\n                    </div>\n\n                    <div className=\"pt-8 border-t border-slate-100 mt-auto\">\n                        <Button\n                            size=\"lg\"\n                            className=\"w-full md:w-auto text-lg px-8\"\n                            disabled={!hasStock || !product.is_available}\n                        >\n                            <ShoppingBag className=\"w-5 h-5 mr-2\" />\n                            {hasStock ? \"Add to Cart\" : \"Unavailable\"}\n                        </Button>\n                    </div>\n                </div>\n            </div>\n\n            {/* Related Products */}\n            {relatedProducts.length > 0 && (\n                <div className=\"mt-20\">\n                    <h3 className=\"text-2xl font-bold text-slate-900 mb-8\">Related Products</h3>\n                    <div className=\"grid md:grid-cols-3 gap-6\">\n                        {relatedProducts.map(item => (\n                            <Link key={item.id} to={`/products/${item.slug}`} className=\"group block\">\n                                <div className=\"bg-white rounded-xl border border-slate-200 p-4 hover:shadow-md transition-all\">\n                                    <div className=\"bg-slate-50 h-48 rounded-lg mb-4 flex items-center justify-center\">\n                                        <Package className=\"w-12 h-12 text-slate-300\" />\n                                    </div>\n                                    <h4 className=\"font-bold text-slate-900 group-hover:text-blue-600 transition-colors\">{item.name}</h4>\n                                    <div className=\"text-slate-600 mt-1\">${item.price}</div>\n                                </div>\n                            </Link>\n                        ))}\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n\nexport default PublicProductDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicProducts.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { ShoppingBag, Search, Filter, X, Info, Loader2 } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport CategoryFilter from '@/components/public/CategoryFilter';\nimport { Pagination } from '@/components/ui/pagination';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { useSearch } from '@/hooks/useSearch';\n\nfunction PublicProducts() {\n    const [products, setProducts] = useState([]);\n    const [categories, setCategories] = useState([]);\n    const [activeCategory, setActiveCategory] = useState(null);\n\n    const {\n        query,\n        setQuery,\n        debouncedQuery,\n        isValid,\n        message,\n        minLength,\n        clearSearch,\n        loading: searchLoading,\n        setLoading: setSearchLoading\n    } = useSearch({ minLength: 5 });\n\n    const [currentPage, setCurrentPage] = useState(1);\n    const [totalItems, setTotalItems] = useState(0);\n    const itemsPerPage = 9;\n\n    useEffect(() => {\n        const fetchCategories = async () => {\n            const { data } = await supabase.from('categories').select('*').eq('type', 'products').is('deleted_at', null);\n            if (data) setCategories(data);\n        };\n        fetchCategories();\n    }, []);\n\n    useEffect(() => {\n        const fetchProducts = async () => {\n            setSearchLoading(true);\n            const from = (currentPage - 1) * itemsPerPage;\n            const to = from + itemsPerPage - 1;\n\n            let queryBuilder = supabase\n                .from('products')\n                .select(`*, categories (name), product_types (name)`, { count: 'exact' })\n                .eq('status', 'active')\n                .is('deleted_at', null)\n                .order('created_at', { ascending: false });\n\n            if (activeCategory) queryBuilder = queryBuilder.eq('category_id', activeCategory);\n            if (debouncedQuery) queryBuilder = queryBuilder.ilike('name', `%${debouncedQuery}%`);\n\n            const { data, count, error } = await queryBuilder.range(from, to);\n            if (!error) {\n                setProducts(data || []);\n                setTotalItems(count || 0);\n            }\n            setSearchLoading(false);\n        };\n        fetchProducts();\n    }, [currentPage, activeCategory, debouncedQuery, setSearchLoading]);\n\n\n    const totalPages = Math.ceil(totalItems / itemsPerPage);\n    const formatPrice = (price) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(price);\n\n    return (\n        <div className=\"container mx-auto px-4 py-12\">\n            <SeoHelmet type=\"products\" defaultTitle=\"Our Products | AhliWeb\" defaultDescription=\"Browse our catalog of high-quality products.\" />\n\n            <div className=\"flex flex-col md:flex-row justify-between items-end gap-6 mb-12 border-b border-slate-100 pb-8\">\n                <div className=\"max-w-2xl\">\n                    <h1 className=\"text-4xl font-bold text-slate-900 mb-4\">Product Catalog</h1>\n                    <p className=\"text-slate-600 text-lg\">Discover solutions designed to help your business grow.</p>\n                </div>\n                <div className=\"relative w-full md:w-80\">\n                    <div className=\"relative\">\n                        <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-slate-400\" />\n                        <Input\n                            placeholder={`Search products (${minLength}+ chars)...`}\n                            value={query}\n                            onChange={(e) => { setQuery(e.target.value); setCurrentPage(1); }}\n                            className={`pl-9 pr-14 h-11 transition-all ${!isValid ? 'border-amber-300 ring-2 ring-amber-100' : ''}`}\n                        />\n                        <div className=\"absolute right-3 top-3 flex items-center gap-2\">\n                            {query && <button onClick={clearSearch}><X className=\"h-4 w-4 text-slate-400\" /></button>}\n                            <span className={`text-xs ${!isValid && query.length > 0 ? 'text-amber-500 font-bold' : 'text-slate-400'}`}>\n                                {query.length}/{minLength}\n                            </span>\n                        </div>\n                    </div>\n                    {!isValid && query.length > 0 && (\n                        <div className=\"absolute right-0 top-full mt-1 text-xs text-amber-600 font-medium flex items-center gap-1\">\n                            <Info className=\"w-3 h-3\" /> {message}\n                        </div>\n                    )}\n                </div>\n            </div>\n\n            <div className=\"flex flex-col lg:flex-row gap-8 items-start\">\n                <div className=\"w-full lg:w-64 flex-shrink-0 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm sticky top-24\">\n                    <div className=\"flex items-center gap-2 font-bold text-slate-900 mb-4\">\n                        <Filter className=\"w-4 h-4\" /> Categories\n                    </div>\n                    <CategoryFilter categories={categories} activeCategory={activeCategory} onSelect={(id) => { setActiveCategory(id); setCurrentPage(1); }} vertical={true} />\n                </div>\n\n                <div className=\"flex-1 w-full\">\n                    {searchLoading ? (\n                        <div className=\"flex justify-center py-20\"><Loader2 className=\"w-8 h-8 animate-spin text-slate-300\" /></div>\n                    ) : (\n                        <>\n                            {products.length > 0 ? (\n                                <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12\">\n                                    {products.map((item, i) => (\n                                        <motion.div\n                                            key={item.id}\n                                            initial={{ opacity: 0, scale: 0.95 }}\n                                            animate={{ opacity: 1, scale: 1 }}\n                                            transition={{ delay: i * 0.05 }}\n                                            className=\"bg-white rounded-2xl overflow-hidden shadow-sm border border-slate-200 hover:shadow-xl transition-all group flex flex-col h-full\"\n                                        >\n                                            <Link to={`/products/${item.slug}`} className=\"block relative aspect-square bg-slate-50 overflow-hidden p-8 flex items-center justify-center\">\n                                                {item.images && item.images.length > 0 ? (\n                                                    <img\n                                                        src={typeof item.images[0] === 'string' ? item.images[0] : item.images[0].url}\n                                                        alt={item.name}\n                                                        className=\"w-full h-full object-contain mix-blend-multiply group-hover:scale-110 transition-transform duration-500\"\n                                                    />\n                                                ) : (\n                                                    <ShoppingBag className=\"w-16 h-16 text-slate-200\" />\n                                                )}\n                                                {item.discount_price && <div className=\"absolute top-4 left-4 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded\">SALE</div>}\n                                            </Link>\n                                            <div className=\"p-5 flex-1 flex flex-col\">\n                                                <div className=\"text-xs text-slate-500 mb-2 flex items-center gap-1\">\n                                                    {item.categories?.name}\n                                                    {item.product_types && <> {item.product_types.name}</>}\n                                                </div>\n                                                <h3 className=\"font-bold text-lg text-slate-900 mb-2 leading-tight group-hover:text-blue-600 transition-colors\">\n                                                    <Link to={`/products/${item.slug}`}>{item.name}</Link>\n                                                </h3>\n                                                <div className=\"mt-auto pt-4 flex items-center justify-between\">\n                                                    <div>\n                                                        {item.discount_price ? (\n                                                            <div className=\"flex flex-col\">\n                                                                <span className=\"text-slate-400 text-xs line-through\">{formatPrice(item.price)}</span>\n                                                                <span className=\"text-lg font-bold text-red-600\">{formatPrice(item.discount_price)}</span>\n                                                            </div>\n                                                        ) : (\n                                                            <span className=\"text-lg font-bold text-slate-900\">{formatPrice(item.price)}</span>\n                                                        )}\n                                                    </div>\n                                                    <Button size=\"sm\" variant=\"outline\" className=\"rounded-full hover:bg-blue-50 hover:text-blue-600 border-slate-200\">View Details</Button>\n                                                </div>\n                                            </div>\n                                        </motion.div>\n                                    ))}\n                                </div>\n                            ) : (\n                                <div className=\"text-center py-20 bg-slate-50 rounded-2xl border border-dashed border-slate-200\">\n                                    <ShoppingBag className=\"w-12 h-12 text-slate-300 mx-auto mb-4\" />\n                                    <h3 className=\"text-lg font-medium text-slate-900\">No products found</h3>\n                                    <Button variant=\"outline\" className=\"mt-4\" onClick={() => { clearSearch(); setActiveCategory(null); }}>Clear Filters</Button>\n                                </div>\n                            )}\n                            {products.length > 0 && (\n                                <div className=\"flex justify-center mt-8\">\n                                    <Pagination currentPage={currentPage} totalPages={totalPages} onPageChange={setCurrentPage} />\n                                </div>\n                            )}\n                        </>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n\nexport default PublicProducts;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicPromotionDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Tag, ArrowLeft, Copy, Check } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\n\nfunction PublicPromotionDetail() {\n  const { id } = useParams(); // Using ID for promotions as slugs usually aren't standard for promos, but if we have slugs we use them. Promo table has no slug in schema, so ID.\n  const [promotion, setPromotion] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [copied, setCopied] = useState(false);\n\n  useEffect(() => {\n    const fetchDetail = async () => {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('promotions')\n        .select(`*, categories(name)`)\n        .eq('id', id)\n        .eq('status', 'active')\n        .maybeSingle();\n      \n      if (!error && data) {\n        setPromotion(data);\n      }\n      setLoading(false);\n    };\n    fetchDetail();\n  }, [id]);\n\n  const copyCode = () => {\n      if(promotion?.code) {\n          navigator.clipboard.writeText(promotion.code);\n          setCopied(true);\n          setTimeout(() => setCopied(false), 2000);\n      }\n  };\n\n  if (loading) return <div className=\"py-20 text-center\">Loading promotion...</div>;\n\n  if (!promotion) return (\n    <div className=\"py-20 text-center\">\n       <h2 className=\"text-2xl font-bold text-slate-800\">Promotion Not Found</h2>\n       <Link to=\"/promotions\" className=\"text-blue-600 mt-4 inline-block\">Back to promotions</Link>\n    </div>\n  );\n\n  return (\n    <div className=\"container mx-auto px-4 py-12 max-w-3xl\">\n      <SeoHelmet \n        type=\"promotion_detail\"\n        id={promotion.id}\n        defaultTitle={`${promotion.title} | Promotions`} \n        defaultDescription={promotion.description}\n      />\n\n      <Link to=\"/promotions\" className=\"inline-flex items-center text-sm text-slate-500 hover:text-blue-600 transition-colors mb-8\">\n         <ArrowLeft className=\"w-4 h-4 mr-1\" /> Back to Promotions\n      </Link>\n\n      <div className=\"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden\">\n          <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 p-12 text-center text-white\">\n              <div className=\"inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full mb-6\">\n                  <Tag className=\"w-10 h-10 text-white\" />\n              </div>\n              <h1 className=\"text-3xl md:text-4xl font-bold mb-4\">{promotion.title}</h1>\n              {promotion.discount_percentage > 0 && (\n                  <div className=\"text-5xl font-bold text-yellow-300 mb-2\">{promotion.discount_percentage}% OFF</div>\n              )}\n              {promotion.discount_amount > 0 && (\n                  <div className=\"text-5xl font-bold text-yellow-300 mb-2\">${promotion.discount_amount} OFF</div>\n              )}\n          </div>\n\n          <div className=\"p-8 md:p-12\">\n              <div className=\"flex justify-center mb-8\">\n                  {promotion.categories && <Badge className=\"text-sm py-1 px-3\">{promotion.categories.name}</Badge>}\n              </div>\n              \n              <p className=\"text-lg text-slate-600 text-center leading-relaxed mb-10\">\n                  {promotion.description}\n              </p>\n\n              {promotion.code && (\n                  <div className=\"bg-slate-50 border border-dashed border-slate-300 rounded-xl p-6 flex flex-col items-center gap-4\">\n                      <span className=\"text-sm text-slate-500 uppercase tracking-widest\">Promo Code</span>\n                      <div className=\"text-3xl font-mono font-bold text-slate-800 tracking-widest\">{promotion.code}</div>\n                      <Button onClick={copyCode} variant={copied ? \"outline\" : \"default\"} className=\"min-w-[140px]\">\n                          {copied ? <><Check className=\"w-4 h-4 mr-2\" /> Copied</> : <><Copy className=\"w-4 h-4 mr-2\" /> Copy Code</>}\n                      </Button>\n                  </div>\n              )}\n              \n              <div className=\"mt-8 text-center text-sm text-slate-400\">\n                  {promotion.end_date && (\n                      <p>Valid until {new Date(promotion.end_date).toLocaleDateString()}</p>\n                  )}\n              </div>\n          </div>\n      </div>\n    </div>\n  );\n}\n\nexport default PublicPromotionDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicPromotions.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-undef","severity":2,"message":"'useCallback' is not defined.","line":15,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":15,"endColumn":38},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  26 |\n  27 |   useEffect(() => {\n> 28 |     fetchPromotions();\n     |     ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  29 |   }, []);\n  30 |\n  31 |   const copyCode = (code, id) => {","line":28,"column":5,"nodeType":null,"endLine":28,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPromotions'. Either include it or remove the dependency array.","line":29,"column":6,"nodeType":"ArrayExpression","endLine":29,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPromotions]","fix":{"range":[853,855],"text":"[fetchPromotions]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { Helmet } from 'react-helmet-async';\nimport { Tag, Clock, Copy, Check } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/components/ui/use-toast';\n\nfunction PublicPromotions() {\n  const [items, setItems] = useState([]);\n  const { toast } = useToast();\n  const [copiedId, setCopiedId] = useState(null);\n\n  const fetchPromotions = useCallback(async () => {\n\n    const { data } = await supabase\n      .from('promotions')\n      .select('*')\n      .eq('status', 'active')\n      .gt('end_date', new Date().toISOString())\n      .order('end_date', { ascending: true });\n    setItems(data || []);\n\n  }, []);\n\n  useEffect(() => {\n    fetchPromotions();\n  }, []);\n\n  const copyCode = (code, id) => {\n    navigator.clipboard.writeText(code);\n    setCopiedId(id);\n    toast({ title: \"Copied!\", description: \"Promo code copied to clipboard.\" });\n    setTimeout(() => setCopiedId(null), 2000);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background py-16\">\n      <Helmet>\n        <title>Special Offers - AWCMS</title>\n      </Helmet>\n\n      <div className=\"container mx-auto px-4\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"text-center mb-16\"\n        >\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\">Special Offers</h1>\n          <p className=\"text-muted-foreground\">Grab these exclusive deals before they expire!</p>\n        </motion.div>\n\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {items.map((item, i) => (\n            <motion.div\n              key={item.id}\n              initial={{ opacity: 0, scale: 0.95 }}\n              whileInView={{ opacity: 1, scale: 1 }}\n              viewport={{ once: true }}\n              transition={{ delay: i * 0.1 }}\n              className=\"relative bg-card rounded-xl border-2 border-dashed border-primary/20 overflow-hidden hover:border-primary/50 transition-colors group\"\n            >\n              {/* Decorative Circle */}\n              <div className=\"absolute -right-12 -top-12 w-24 h-24 bg-primary/10 rounded-full group-hover:bg-primary/20 transition-colors\" />\n\n              <div className=\"p-6\">\n                <div className=\"flex items-start justify-between mb-4\">\n                  <div className=\"p-2 bg-primary/10 text-primary rounded-lg\">\n                    <Tag className=\"w-6 h-6\" />\n                  </div>\n                  {item.discount_percentage && (\n                    <span className=\"font-bold text-2xl text-primary\">\n                      {item.discount_percentage}% OFF\n                    </span>\n                  )}\n                  {item.discount_amount && (\n                    <span className=\"font-bold text-2xl text-primary\">\n                      ${item.discount_amount} OFF\n                    </span>\n                  )}\n                </div>\n\n                <h3 className=\"text-xl font-bold text-foreground mb-2\">{item.title}</h3>\n                <p className=\"text-sm text-muted-foreground mb-6 line-clamp-2\">{item.description}</p>\n\n                <div className=\"bg-muted p-4 rounded-lg flex items-center justify-between gap-4 mb-4\">\n                  <code className=\"text-lg font-mono font-bold text-foreground tracking-wider\">\n                    {item.code || 'NOCODE'}\n                  </code>\n                  <Button\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    onClick={() => copyCode(item.code, item.id)}\n                    className=\"h-8 w-8 p-0\"\n                  >\n                    {copiedId === item.id ? <Check className=\"w-4 h-4 text-green-500\" /> : <Copy className=\"w-4 h-4\" />}\n                  </Button>\n                </div>\n\n                <div className=\"flex items-center gap-2 text-xs text-muted-foreground/80\">\n                  <Clock className=\"w-3 h-3\" />\n                  <span>Expires: {new Date(item.end_date).toLocaleDateString()}</span>\n                </div>\n              </div>\n            </motion.div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default PublicPromotions;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicRegisterPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/components/ui/use-toast';\nimport Turnstile from '@/components/ui/Turnstile';\nimport AuthShell from '@/components/auth/AuthShell';\nimport { Loader2, ArrowLeft, CheckCircle2, ShieldCheck, Sparkles, Mail } from 'lucide-react';\n\nconst PublicRegisterPage = () => {\n    const [formData, setFormData] = useState({\n        full_name: '',\n        email: ''\n    });\n    const [isLoading, setIsLoading] = useState(false);\n    const [isSuccess, setIsSuccess] = useState(false);\n    const [turnstileToken, setTurnstileToken] = useState('');\n\n    const { toast } = useToast();\n\n    const sideItems = [\n        {\n            icon: ShieldCheck,\n            title: 'Verified onboarding',\n            description: 'Applications are reviewed to keep the platform secure.',\n        },\n        {\n            icon: Sparkles,\n            title: 'Guided setup',\n            description: 'We help you configure branding, content, and roles.',\n        },\n        {\n            icon: Mail,\n            title: 'Fast turnaround',\n            description: 'Approved requests receive a secure invitation by email.',\n        },\n    ];\n\n    const shellProps = {\n        sideItems,\n        sideTitle: 'Access Request',\n        sideSubtitle: 'Apply for an admin account and receive a secure invitation once approved.',\n    };\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        setIsLoading(true);\n\n        try {\n            if (!turnstileToken && window.location.hostname !== 'localhost') {\n                throw new Error('Please complete the security check.');\n            }\n\n            const { data, error } = await supabase.functions.invoke('manage-users', {\n                body: {\n                    action: 'submit_application',\n                    email: formData.email,\n                    full_name: formData.full_name,\n                    turnstileToken,\n                }\n            });\n\n            if (error) throw error;\n            if (data?.error) throw new Error(data.error);\n\n            setIsSuccess(true);\n            toast({\n                title: \"Application Submitted\",\n                description: \"We have received your request.\",\n            });\n\n        } catch (error) {\n            console.error('Registration error:', error);\n            toast({\n                variant: \"destructive\",\n                title: \"Submission Failed\",\n                description: error.message || \"Please try again.\",\n            });\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    return (\n        <AuthShell\n            title={isSuccess ? 'Application Received' : 'Apply for Account'}\n            subtitle={isSuccess\n                ? 'We have received your request. You will get an invitation email once approved.'\n                : 'Join our platform to access the CMS and public portal tools.'}\n            badge={isSuccess ? 'Request Submitted' : 'Access Request'}\n            footer={!isSuccess ? (\n                <div>\n                    By submitting, you agree to our <Link to=\"/terms\" className=\"font-medium text-slate-700 hover:text-slate-900 dark:text-slate-200\">Terms of Service</Link>.\n                </div>\n            ) : null}\n            {...shellProps}\n        >\n            {isSuccess ? (\n                <div className=\"space-y-6\">\n                    <div className=\"rounded-2xl border border-emerald-200/70 bg-emerald-50/70 p-6 text-center text-emerald-700\">\n                        <div className=\"mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-emerald-100\">\n                            <CheckCircle2 className=\"h-6 w-6\" />\n                        </div>\n                        <p className=\"text-sm\">\n                            Thank you for applying. Your account request is under review.\n                            Once approved, you will receive an invitation email to set your password.\n                        </p>\n                    </div>\n                    <Link to=\"/login\">\n                        <Button variant=\"outline\" className=\"w-full\">Return to Login</Button>\n                    </Link>\n                </div>\n            ) : (\n                <form onSubmit={handleSubmit} className=\"space-y-6\">\n                    <div className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"full_name\" className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">Full Name</Label>\n                            <Input\n                                id=\"full_name\"\n                                placeholder=\"John Doe\"\n                                value={formData.full_name}\n                                onChange={(e) => setFormData({ ...formData, full_name: e.target.value })}\n                                className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                                required\n                            />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"email\" className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">Email Address</Label>\n                            <Input\n                                id=\"email\"\n                                type=\"email\"\n                                placeholder=\"john@example.com\"\n                                value={formData.email}\n                                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                                className=\"h-11 rounded-xl border-slate-200/70 bg-white/90 shadow-sm focus:border-indigo-500/60 focus:ring-indigo-500/30 dark:border-slate-700/70 dark:bg-slate-950/60\"\n                                required\n                            />\n                        </div>\n\n                        <div className=\"rounded-2xl border border-dashed border-slate-200/70 bg-slate-50/70 px-4 py-3\">\n                            <Turnstile\n                                siteKey={import.meta.env.VITE_TURNSTILE_SITE_KEY}\n                                onVerify={(token) => setTurnstileToken(token)}\n                                onError={() => setTurnstileToken('')}\n                            />\n                        </div>\n                    </div>\n\n                    <Button\n                        type=\"submit\"\n                        className=\"w-full h-11 bg-indigo-600 hover:bg-indigo-700 text-white font-medium\"\n                        disabled={isLoading}\n                    >\n                        {isLoading ? <Loader2 className=\"w-5 h-5 animate-spin mx-auto\" /> : 'Submit Application'}\n                    </Button>\n\n                    <Link to=\"/login\" className=\"inline-flex items-center justify-center gap-2 text-sm font-medium text-slate-500 hover:text-slate-700\">\n                        <ArrowLeft className=\"w-4 h-4\" /> Back to Login\n                    </Link>\n                </form>\n            )}\n        </AuthShell>\n    );\n};\n\nexport default PublicRegisterPage;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicTestimonies.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-undef","severity":2,"message":"'useCallback' is not defined.","line":13,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":39},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  23 |\n  24 |   useEffect(() => {\n> 25 |     fetchTestimonies();\n     |     ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  26 |   }, []);\n  27 |\n  28 |   return (","line":25,"column":5,"nodeType":null,"endLine":25,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTestimonies'. Either include it or remove the dependency array.","line":26,"column":6,"nodeType":"ArrayExpression","endLine":26,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTestimonies]","fix":{"range":[787,789],"text":"[fetchTestimonies]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { Helmet } from 'react-helmet-async';\nimport { Quote, Star } from 'lucide-react';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\n\nfunction PublicTestimonies() {\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchTestimonies = useCallback(async () => {\n    setLoading(true);\n    const { data } = await supabase\n      .from('testimonies')\n      .select('*')\n      .eq('status', 'published')\n      .order('created_at', { ascending: false });\n    setItems(data || []);\n    setLoading(false);\n  }, []);\n\n  useEffect(() => {\n    fetchTestimonies();\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background py-16\">\n      <Helmet>\n        <title>What People Say - AWCMS</title>\n      </Helmet>\n\n      <div className=\"container mx-auto px-4\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"text-center mb-16\"\n        >\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\">Client Testimonials</h1>\n          <p className=\"text-muted-foreground\">Don&apos;t just take our word for it.</p>\n        </motion.div>\n\n        {loading ? (\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n          </div>\n        ) : (\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            {items.map((item, i) => (\n              <motion.div\n                key={item.id}\n                initial={{ opacity: 0, y: 20 }}\n                whileInView={{ opacity: 1, y: 0 }}\n                viewport={{ once: true }}\n                transition={{ delay: i * 0.1 }}\n                className=\"bg-card p-8 rounded-2xl border border-border relative\"\n              >\n                <Quote className=\"absolute top-6 right-6 w-8 h-8 text-primary/10 rotate-180\" />\n\n                <div className=\"flex gap-1 mb-6\">\n                  {[...Array(5)].map((_, i) => (\n                    <Star\n                      key={i}\n                      className={`w-4 h-4 ${i < (item.rating || 5) ? 'text-yellow-400 fill-yellow-400' : 'text-muted'}`}\n                    />\n                  ))}\n                </div>\n\n                <p className=\"text-muted-foreground italic mb-6 leading-relaxed\">\n                  &quot;{item.content}&quot;\n                </p>\n\n                <div className=\"flex items-center gap-4\">\n                  <Avatar className=\"w-10 h-10 border border-border\">\n                    <AvatarImage src={item.author_image} />\n                    <AvatarFallback className=\"bg-primary/10 text-primary\">\n                      {item.author_name?.charAt(0)}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <h4 className=\"font-bold text-sm text-foreground\">{item.author_name}</h4>\n                    <p className=\"text-xs text-muted-foreground\">{item.author_position || 'Client'}</p>\n                  </div>\n                </div>\n              </motion.div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default PublicTestimonies;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicVideoGallery.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-undef","severity":2,"message":"'useCallback' is not defined.","line":13,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":34},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  23 |\n  24 |   useEffect(() => {\n> 25 |     fetchVideos();\n     |     ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  26 |   }, []);\n  27 |\n  28 |   return (","line":25,"column":5,"nodeType":null,"endLine":25,"endColumn":16},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchVideos'. Either include it or remove the dependency array.","line":26,"column":6,"nodeType":"ArrayExpression","endLine":26,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchVideos]","fix":{"range":[742,744],"text":"[fetchVideos]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { motion } from 'framer-motion';\nimport { Helmet } from 'react-helmet-async';\nimport { PlayCircle } from 'lucide-react';\nimport { Link } from 'react-router-dom';\n\nfunction PublicVideoGallery() {\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchVideos = useCallback(async () => {\n    setLoading(true);\n    const { data } = await supabase\n      .from('video_gallery')\n      .select('*')\n      .eq('status', 'published')\n      .order('created_at', { ascending: false });\n    setItems(data || []);\n    setLoading(false);\n  }, []);\n\n  useEffect(() => {\n    fetchVideos();\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background py-16\">\n      <Helmet>\n        <title>Video Gallery - AWCMS</title>\n      </Helmet>\n\n      <div className=\"container mx-auto px-4\">\n        <h1 className=\"text-4xl font-bold text-foreground mb-12 text-center\">Video Gallery</h1>\n\n\n\n        {loading ? (\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n          </div>\n        ) : (\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            {items.map((item, i) => (\n              <motion.div\n                key={item.id}\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: i * 0.1 }}\n              >\n                <Link to={`/video-gallery/${item.slug}`} className=\"group block\">\n                  <div className=\"aspect-video rounded-2xl overflow-hidden bg-muted relative mb-4 border border-border shadow-sm group-hover:shadow-md transition-all\">\n                    {/* Simple placeholder for thumbnail logic since we might not have actual thumbnails from youtube API directly stored always */}\n                    <div className=\"w-full h-full bg-slate-900 flex items-center justify-center group-hover:bg-slate-800 transition-colors\">\n                      <PlayCircle className=\"w-16 h-16 text-white/80 group-hover:text-white group-hover:scale-110 transition-all\" />\n                    </div>\n\n                    <div className=\"absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent\">\n                      <p className=\"text-white font-medium truncate\">{item.title}</p>\n                    </div>\n                  </div>\n                  <h3 className=\"font-bold text-lg text-foreground group-hover:text-primary transition-colors\">{item.title}</h3>\n                  <p className=\"text-sm text-muted-foreground line-clamp-1\">{item.description}</p>\n                </Link>\n              </motion.div>\n            ))}\n\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default PublicVideoGallery;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/PublicVideoGalleryDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useEffect, useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport { ArrowLeft, PlayCircle, ExternalLink, Tag, Calendar } from 'lucide-react';\nimport SeoHelmet from '@/components/public/SeoHelmet';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\n\nfunction PublicVideoGalleryDetail() {\n  const { slug } = useParams();\n  const [video, setVideo] = useState(null);\n  const [relatedVideos, setRelatedVideos] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchDetail = async () => {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('video_gallery')\n        .select(`*, categories(name)`)\n        .eq('slug', slug)\n        .eq('status', 'published')\n        .maybeSingle();\n      \n      if (!error && data) {\n        setVideo(data);\n\n        if (data.category_id) {\n             const { data: related } = await supabase\n                .from('video_gallery')\n                .select('id, title, slug, created_at')\n                .eq('category_id', data.category_id)\n                .neq('id', data.id)\n                .eq('status', 'published')\n                .limit(3);\n             setRelatedVideos(related || []);\n        }\n      }\n      setLoading(false);\n    };\n    fetchDetail();\n  }, [slug]);\n\n  if (loading) return <div className=\"py-20 text-center\">Loading video...</div>;\n\n  if (!video) return (\n    <div className=\"py-20 text-center\">\n       <h2 className=\"text-2xl font-bold text-slate-800\">Video Not Found</h2>\n       <Link to=\"/gallery/videos\" className=\"text-blue-600 mt-4 inline-block\">Back to gallery</Link>\n    </div>\n  );\n\n  return (\n    <div className=\"container mx-auto px-4 py-12 max-w-4xl\">\n      <SeoHelmet \n        type=\"video_gallery_detail\"\n        id={video.id}\n        defaultTitle={`${video.title} | Video Gallery`} \n        defaultDescription={video.description}\n      />\n\n      <Link to=\"/gallery/videos\" className=\"inline-flex items-center text-sm text-slate-500 hover:text-blue-600 transition-colors mb-8\">\n         <ArrowLeft className=\"w-4 h-4 mr-1\" /> Back to Gallery\n      </Link>\n\n      <div className=\"bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm\">\n          <div className=\"aspect-video bg-slate-900 flex items-center justify-center relative group\">\n               <PlayCircle className=\"w-20 h-20 text-white/80 group-hover:scale-110 transition-transform duration-300\" />\n               {video.youtube_playlist_url && (\n                   <a \n                     href={video.youtube_playlist_url}\n                     target=\"_blank\"\n                     rel=\"noopener noreferrer\"\n                     className=\"absolute inset-0 z-10\"\n                     aria-label=\"Watch Video\"\n                   />\n               )}\n          </div>\n          \n          <div className=\"p-8 md:p-10\">\n              <div className=\"flex flex-wrap items-center gap-3 mb-6\">\n                  <Badge variant=\"destructive\" className=\"bg-red-50 text-red-600 border-red-100\">YouTube</Badge>\n                  {video.categories && <Badge variant=\"outline\">{video.categories.name}</Badge>}\n                  <span className=\"text-sm text-slate-500 ml-auto flex items-center gap-1\">\n                      <Calendar className=\"w-4 h-4\" /> {new Date(video.created_at).toLocaleDateString()}\n                  </span>\n              </div>\n              \n              <h1 className=\"text-3xl font-bold text-slate-900 mb-4\">{video.title}</h1>\n              \n              <div className=\"prose prose-slate max-w-none mb-8\">\n                 <p className=\"text-slate-600 text-lg leading-relaxed\">{video.description}</p>\n              </div>\n              \n              {video.youtube_playlist_url && (\n                  <Button className=\"bg-red-600 hover:bg-red-700 text-white\" asChild>\n                      <a \n                        href={video.youtube_playlist_url} \n                        target=\"_blank\" \n                        rel=\"noopener noreferrer\"\n                      >\n                          Watch on YouTube <ExternalLink className=\"w-4 h-4 ml-2\" />\n                      </a>\n                  </Button>\n              )}\n\n              {video.tags && video.tags.length > 0 && (\n                  <div className=\"mt-8 pt-8 border-t border-slate-100\">\n                      <div className=\"flex flex-wrap gap-2\">\n                          {video.tags.map((tag, i) => (\n                              <span key={i} className=\"inline-flex items-center gap-1 text-sm text-slate-500 bg-slate-50 px-3 py-1 rounded-full border border-slate-200\">\n                                  <Tag className=\"w-3 h-3\" /> {tag}\n                              </span>\n                          ))}\n                      </div>\n                  </div>\n              )}\n          </div>\n      </div>\n\n      {relatedVideos.length > 0 && (\n          <div className=\"mt-16\">\n              <h3 className=\"text-2xl font-bold text-slate-900 mb-6\">Related Videos</h3>\n              <div className=\"grid md:grid-cols-3 gap-6\">\n                  {relatedVideos.map(item => (\n                      <Link key={item.id} to={`/gallery/videos/${item.slug}`} className=\"group block\">\n                          <div className=\"bg-white rounded-xl border border-slate-200 p-4 hover:shadow-md transition-all\">\n                              <div className=\"bg-slate-900 h-32 rounded-lg mb-3 flex items-center justify-center\">\n                                  <PlayCircle className=\"w-8 h-8 text-white/70\" />\n                              </div>\n                              <h4 className=\"font-bold text-slate-900 group-hover:text-blue-600 transition-colors line-clamp-1\">{item.title}</h4>\n                              <div className=\"text-xs text-slate-500 mt-1\">{new Date(item.created_at).toLocaleDateString()}</div>\n                          </div>\n                      </Link>\n                  ))}\n              </div>\n          </div>\n      )}\n    </div>\n  );\n}\n\nexport default PublicVideoGalleryDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/pages/public/SitemapRedirect.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/backup/BackupManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":30,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Database, Download, RotateCcw, FileArchive, RefreshCw } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { useToast } from '@/components/ui/use-toast';\nimport { supabase } from '@/lib/customSupabaseClient';\nimport ContentTable from '@/components/dashboard/ContentTable';\nimport { Badge } from '@/components/ui/badge';\nimport BackupRestore from './BackupRestore';\n\nfunction BackupManager() {\n  const { toast } = useToast();\n  const [backups, setBackups] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [creating, setCreating] = useState(false);\n  const [restoreTarget, setRestoreTarget] = useState(null);\n\n  const fetchBackups = useCallback(async () => {\n    setLoading(true);\n    try {\n      const { data, error } = await supabase\n        .from('backups')\n        .select('*, users(full_name)')\n        .is('deleted_at', null)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setBackups(data || []);\n    } catch (error) {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to load backups\" });\n    } finally {\n      setLoading(false);\n    }\n  }, [toast]);\n\n  useEffect(() => {\n    fetchBackups();\n  }, [fetchBackups]);\n\n  const handleCreateBackup = async () => {\n    setCreating(true);\n    try {\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n      const fileName = `backup-${timestamp}.json`;\n      const fileSize = Math.floor(Math.random() * 5000000) + 100000; // Mock size\n\n      const { error } = await supabase.from('backups').insert([{\n        name: `Full System Backup`,\n        description: `Manual backup`,\n        backup_type: 'full',\n        size: fileSize,\n        status: 'completed',\n        file_path: fileName,\n        created_by: (await supabase.auth.getUser()).data.user?.id\n      }]);\n\n      if (error) throw error;\n\n      toast({ title: \"Backup Created\", description: \"System backup completed successfully.\" });\n      fetchBackups();\n\n    } catch (error) {\n      console.error(error);\n      toast({ variant: \"destructive\", title: \"Backup Failed\", description: error.message });\n    } finally {\n      setCreating(false);\n    }\n  };\n\n  const handleDelete = async (id) => {\n    if (!window.confirm(\"Are you sure? This cannot be undone.\")) return;\n    try {\n      const { error } = await supabase.from('backups').update({ deleted_at: new Date().toISOString() }).eq('id', id);\n      if (error) throw error;\n      fetchBackups();\n      toast({ title: \"Success\", description: \"Backup deleted.\" });\n    } catch (error) {\n      toast({ variant: \"destructive\", title: \"Error\", description: error.message });\n    }\n  };\n\n  const columns = [\n    { key: 'name', label: 'Name' },\n    { key: 'backup_type', label: 'Type', render: (v) => <Badge variant=\"outline\">{v}</Badge> },\n    { key: 'size', label: 'Size', render: (v) => v ? `${(v / 1024 / 1024).toFixed(2)} MB` : '0 MB' },\n    { key: 'created_at', label: 'Date', type: 'date' },\n    {\n      key: 'status', label: 'Status', render: (v) => (\n        <Badge className={v === 'completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}>\n          {v}\n        </Badge>\n      )\n    }\n  ];\n\n  return (\n    <div className=\"space-y-6 relative\">\n      {restoreTarget && (\n        <BackupRestore backup={restoreTarget} onCancel={() => setRestoreTarget(null)} />\n      )}\n\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-3xl font-bold text-slate-800 flex items-center gap-2\">\n            <Database className=\"w-8 h-8 text-blue-600\" />\n            Backup Manager\n          </h2>\n          <p className=\"text-slate-600\">Secure your data with automated and manual backups.</p>\n        </div>\n        <Button onClick={handleCreateBackup} disabled={creating} className=\"bg-blue-600 hover:bg-blue-700\">\n          {creating ? <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" /> : <FileArchive className=\"w-4 h-4 mr-2\" />}\n          Create Backup Now\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-slate-500\">Total Backups</CardTitle>\n            <CardDescription className=\"text-2xl font-bold text-slate-800\">{backups.length}</CardDescription>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-slate-500\">Last Backup</CardTitle>\n            <CardDescription className=\"text-2xl font-bold text-slate-800\">\n              {backups[0] ? new Date(backups[0].created_at).toLocaleDateString() : 'Never'}\n            </CardDescription>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-slate-500\">Total Size</CardTitle>\n            <CardDescription className=\"text-2xl font-bold text-slate-800\">\n              {((backups.reduce((acc, curr) => acc + (curr.size || 0), 0)) / 1024 / 1024).toFixed(2)} MB\n            </CardDescription>\n          </CardHeader>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Backup History</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ContentTable\n            data={backups}\n            columns={columns}\n            loading={loading}\n            onDelete={handleDelete}\n            extraActions={(item) => (\n              <div className=\"flex gap-1\">\n                <Button variant=\"ghost\" size=\"icon\" title=\"Download\" onClick={() => toast({ title: \"Download Started\", description: `Downloading ${item.name}...` })}>\n                  <Download className=\"w-4 h-4 text-slate-500\" />\n                </Button>\n                <Button variant=\"ghost\" size=\"icon\" title=\"Restore\" onClick={() => setRestoreTarget(item)}>\n                  <RotateCcw className=\"w-4 h-4 text-blue-500\" />\n                </Button>\n              </div>\n            )}\n          />\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default BackupManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/backup/BackupRestore.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { AlertTriangle, RotateCcw, CheckCircle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { useToast } from '@/components/ui/use-toast';\n\nfunction BackupRestore({ backup, onCancel }) {\n  const { toast } = useToast();\n  const [confirming, setConfirming] = useState(false);\n  const [restoring, setRestoring] = useState(false);\n\n  const handleRestore = async () => {\n    setRestoring(true);\n    // Simulate restore process\n    setTimeout(() => {\n        setRestoring(false);\n        toast({\n            title: \"Restore Initiated\",\n            description: \"System restore has been queued. You will be notified when complete.\"\n        });\n        onCancel();\n    }, 2000);\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\n        <Card className=\"w-full max-w-lg shadow-2xl\">\n            <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-red-600\">\n                    <AlertTriangle className=\"w-6 h-6\" />\n                    System Restore\n                </CardTitle>\n                <CardDescription>\n                    You are about to restore the system to the state of <strong>{backup.name}</strong> from {new Date(backup.created_at).toLocaleString()}.\n                </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n                <div className=\"bg-red-50 p-4 rounded-md border border-red-100 text-red-800 text-sm\">\n                    <strong>Warning:</strong> This action will overwrite current data. Any changes made since this backup will be lost permanently.\n                </div>\n                \n                {!confirming ? (\n                    <div className=\"flex justify-end gap-3 pt-4\">\n                        <Button variant=\"ghost\" onClick={onCancel}>Cancel</Button>\n                        <Button variant=\"destructive\" onClick={() => setConfirming(true)}>I Understand, Proceed</Button>\n                    </div>\n                ) : (\n                    <div className=\"space-y-4 pt-2 animate-in fade-in\">\n                        <p className=\"text-sm font-bold text-slate-700\">Are you absolutely sure?</p>\n                        <div className=\"flex justify-end gap-3\">\n                            <Button variant=\"outline\" onClick={() => setConfirming(false)} disabled={restoring}>Go Back</Button>\n                            <Button variant=\"destructive\" onClick={handleRestore} disabled={restoring}>\n                                {restoring ? <RotateCcw className=\"w-4 h-4 animate-spin mr-2\" /> : <CheckCircle className=\"w-4 h-4 mr-2\" />}\n                                {restoring ? 'Restoring...' : 'Confirm Restore'}\n                            </Button>\n                        </div>\n                    </div>\n                )}\n            </CardContent>\n        </Card>\n    </div>\n  );\n}\n\nexport default BackupRestore;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/backup/BackupScheduler.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,14],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { Calendar, Clock, Save } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { useToast } from '@/components/ui/use-toast';\n\nfunction BackupScheduler() {\n  const { toast } = useToast();\n  const [frequency, setFrequency] = useState('daily');\n  const [time, setTime] = useState('00:00');\n\n  const handleSave = () => {\n    toast({\n       title: \"Schedule Updated\",\n       description: `Backups will run ${frequency} at ${time}.`\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center gap-2 mb-4\">\n         <Calendar className=\"w-6 h-6 text-blue-600\" />\n         <h2 className=\"text-2xl font-bold text-slate-800\">Backup Schedule</h2>\n      </div>\n\n      <Card className=\"max-w-md\">\n        <CardHeader>\n          <CardTitle>Automated Backups</CardTitle>\n          <CardDescription>Configure when the system should automatically create backups.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n           <div className=\"space-y-2\">\n              <Label>Frequency</Label>\n              <Select value={frequency} onValueChange={setFrequency}>\n                 <SelectTrigger>\n                    <SelectValue />\n                 </SelectTrigger>\n                 <SelectContent>\n                    <SelectItem value=\"daily\">Daily</SelectItem>\n                    <SelectItem value=\"weekly\">Weekly</SelectItem>\n                    <SelectItem value=\"monthly\">Monthly</SelectItem>\n                 </SelectContent>\n              </Select>\n           </div>\n\n           <div className=\"space-y-2\">\n              <Label>Time (UTC)</Label>\n              <div className=\"relative\">\n                 <Clock className=\"absolute left-3 top-2.5 h-4 w-4 text-slate-400\" />\n                 <Input \n                    type=\"time\" \n                    value={time} \n                    onChange={(e) => setTime(e.target.value)}\n                    className=\"pl-9\"\n                 />\n              </div>\n           </div>\n\n           <Button onClick={handleSave} className=\"w-full mt-4\">\n              <Save className=\"w-4 h-4 mr-2\" />\n              Save Schedule\n           </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default BackupScheduler;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/backup/BackupSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[8,19],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { Settings } from 'lucide-react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/components/ui/use-toast';\n\nfunction BackupSettings() {\n  const { toast } = useToast();\n  return (\n    <Card>\n       <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n             <Settings className=\"w-5 h-5\" />\n             Retention Policy\n          </CardTitle>\n       </CardHeader>\n       <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n             <Label>Retain Daily Backups (Days)</Label>\n             <Input type=\"number\" defaultValue={30} />\n          </div>\n          <div className=\"space-y-2\">\n             <Label>Retain Weekly Backups (Weeks)</Label>\n             <Input type=\"number\" defaultValue={12} />\n          </div>\n          <div className=\"space-y-2\">\n             <Label>Retain Monthly Backups (Months)</Label>\n             <Input type=\"number\" defaultValue={24} />\n          </div>\n          <Button onClick={() => toast({ title: \"Settings Saved\" })}>\n             Save Settings\n          </Button>\n       </CardContent>\n    </Card>\n  );\n}\n\nexport default BackupSettings;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/backup/index.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":26,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":58,"suggestions":[{"messageId":"removeVar","data":{"varName":"supabase"},"fix":{"range":[560,570],"text":""},"desc":"Remove unused variable 'supabase'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":86,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":42,"suggestions":[{"messageId":"removeVar","data":{"varName":"supabase"},"fix":{"range":[2313,2322],"text":""},"desc":"Remove unused variable 'supabase'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tenantId' is defined but never used.","line":86,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":52,"suggestions":[{"messageId":"removeVar","data":{"varName":"tenantId"},"fix":{"range":[2321,2331],"text":""},"desc":"Remove unused variable 'tenantId'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Backup Plugin Entry Point\n * \n * WordPress-style plugin with lifecycle hooks.\n */\n\nimport BackupManager from './BackupManager';\nimport BackupScheduler from './BackupScheduler';\nimport BackupSettings from './BackupSettings';\nimport manifest from './plugin.json';\n\n// Export components for registry\nexport const components = {\n    BackupManager,\n    BackupScheduler,\n    BackupSettings\n};\n\n// Export manifest\nexport { manifest };\n\n/**\n * Register plugin hooks and filters\n * Called when plugin is loaded\n */\nexport const register = ({ addAction, addFilter, supabase }) => {\n    // Register admin menu item\n    addFilter('admin_menu_items', 'backup_plugin', (items) => {\n        return [\n            ...items,\n            {\n                id: 'backup',\n                label: manifest.menu.label,\n                icon: manifest.menu.icon,\n                path: manifest.menu.path,\n                parent: manifest.menu.parent,\n                order: 100,\n                permission: 'plugin.backup.view',\n                plugin_type: manifest.type\n            }\n        ];\n    });\n\n    // Register routes\n    addFilter('admin_routes', 'backup_plugin', (routes) => {\n        return [\n            ...routes,\n            ...manifest.routes.map(r => ({\n                path: r.path,\n                element: components[r.component],\n                permission: 'plugin.backup.view'\n            }))\n        ];\n    });\n\n    // Log plugin loaded\n    addAction('plugins_loaded', 'backup_init', () => {\n        console.log(`[Plugin] ${manifest.name} v${manifest.version} loaded`);\n    });\n};\n\n/**\n * Activate plugin\n * Called when plugin is first enabled\n */\nexport const activate = async (supabase, tenantId) => {\n    // Register plugin permissions in database\n    const permissions = manifest.permissions.map(key => ({\n        permission_name: key,\n        description: `Permission for ${manifest.name}`,\n        tenant_id: tenantId\n    }));\n\n    // Upsert permissions (soft create if not exists)\n    for (const perm of permissions) {\n        await supabase.from('permissions').upsert({ ...perm, deleted_at: null }, { onConflict: 'permission_name' });\n    }\n\n    console.log(`[Plugin] ${manifest.name} activated`);\n};\n\n/**\n * Deactivate plugin\n * Called when plugin is disabled\n */\nexport const deactivate = async (supabase, tenantId) => {\n    console.log(`[Plugin] ${manifest.name} deactivated`);\n    // Cleanup logic if needed (but preserve data)\n};\n\n// Default export for backward compatibility\nexport default BackupManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/helloworld/HelloWorld.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":16,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":16,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\nconst HelloWorldWidget = () => (\n    <Card className=\"mb-6 border-blue-200 bg-blue-50\">\n        <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-blue-700\">Hello from Plugin!</CardTitle>\n        </CardHeader>\n        <CardContent>\n            <p className=\"text-blue-600\">This widget was injected via the <strong>dashboard_top</strong> action hook.</p>\n        </CardContent>\n    </Card>\n);\n\n// eslint-disable-next-line react-refresh/only-export-components\nexport const register = ({ addAction, addFilter }) => {\n    console.log(\"Hello World Plugin Registered!\");\n\n    // Action: Add widget to dashboard top\n    addAction('dashboard_top', 'hello_world_widget', () => {\n        // Since PluginAction uses the 'applyFilters' pattern internally or renders components pushed to it?\n        // Wait, my PluginAction implementation in PluginContext.jsx uses:\n        // const components = applyFilters(name, []);\n        // So I should use addFilter to append to the array.\n        // BUT, I named the prop 'addAction' in the context...\n\n        // Let's re-read PluginAction in PluginContext.jsx:\n        // \"const components = applyFilters(name, []);\"\n\n        // So to inject into <PluginAction name=\"foo\">, I must use addFilter('foo', ...)\n        // The 'addAction' is for pure logic events (like 'plugins_loaded').\n\n        // CORRECTION: 'PluginAction' is a UI slot. It uses filters to gather components.\n        // So I must use addFilter.\n    });\n\n    addFilter('dashboard_top', 'hello_world_widget_render', (components) => {\n        return [...components, HelloWorldWidget];\n    });\n\n    // Filter: Modify Sidebar Menu\n    addFilter('admin_sidebar_menu', 'hello_world_menu', (items) => {\n        return [\n            ...items,\n            {\n                key: 'hello_world',\n                label: 'Hello Plugin',\n                path: 'hello-world', // This won't work without a route, but shows in menu\n                icon: 'Star',\n                group_label: 'Plugins'\n            }\n        ];\n    });\n};\n\nexport default HelloWorldWidget; // Default export for registry fallback if needed\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/mailketing/components/EmailLogs.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from '@/components/ui/select';\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from '@/components/ui/table';\nimport {\n    Mail,\n    Search,\n    RefreshCw,\n    CheckCircle,\n    XCircle,\n    Eye,\n    MousePointer,\n    AlertTriangle,\n    Download,\n    ShieldAlert,\n} from 'lucide-react';\nimport { getEmailLogs } from '../services/emailService';\nimport { format } from 'date-fns';\n\nconst EVENT_TYPE_CONFIG = {\n    sent: { icon: CheckCircle, color: 'bg-green-100 text-green-700', label: 'Sent' },\n    opened: { icon: Eye, color: 'bg-blue-100 text-blue-700', label: 'Opened' },\n    clicked: { icon: MousePointer, color: 'bg-purple-100 text-purple-700', label: 'Clicked' },\n    bounced: { icon: XCircle, color: 'bg-red-100 text-red-700', label: 'Bounced' },\n    failed: { icon: AlertTriangle, color: 'bg-orange-100 text-orange-700', label: 'Failed' },\n    subscribed: { icon: CheckCircle, color: 'bg-teal-100 text-teal-700', label: 'Subscribed' },\n    unsubscribed: { icon: XCircle, color: 'bg-slate-100 text-slate-700', label: 'Unsubscribed' },\n};\n\nfunction EmailLogs() {\n    const { currentTenant } = useTenant();\n    const { hasPermission } = usePermissions();\n\n    const [logs, setLogs] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [count, setCount] = useState(0);\n    const [page, setPage] = useState(0);\n    const [filters, setFilters] = useState({\n        eventType: '',\n        recipient: '',\n    });\n\n    const canViewLogs = hasPermission('tenant.setting.read');\n    const limit = 20;\n\n    const loadLogs = useCallback(async () => {\n        setLoading(true);\n        try {\n            const { data, count: total } = await getEmailLogs(currentTenant.id, {\n                limit,\n                offset: page * limit,\n                eventType: filters.eventType || undefined,\n                recipient: filters.recipient || undefined,\n            });\n            setLogs(data || []);\n            setCount(total || 0);\n        } catch (error) {\n            console.error('Failed to load email logs:', error);\n        } finally {\n            setLoading(false);\n        }\n    }, [currentTenant?.id, page, filters, limit]);\n\n    useEffect(() => {\n        if (currentTenant?.id && canViewLogs) {\n            loadLogs();\n        }\n    }, [currentTenant?.id, page, filters, canViewLogs, loadLogs]);\n\n    useEffect(() => {\n        if (currentTenant?.id && canViewLogs) {\n            loadLogs();\n        }\n    }, [currentTenant?.id, page, filters, canViewLogs, loadLogs]);\n\n\n    const handleExport = () => {\n        const csv = [\n            ['Date', 'Event', 'Recipient', 'Subject'].join(','),\n            ...logs.map((log) =>\n                [\n                    format(new Date(log.created_at), 'yyyy-MM-dd HH:mm:ss'),\n                    log.event_type,\n                    log.recipient,\n                    log.subject || '',\n                ].join(',')\n            ),\n        ].join('\\n');\n\n        const blob = new Blob([csv], { type: 'text/csv' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `email-logs-${format(new Date(), 'yyyy-MM-dd')}.csv`;\n        a.click();\n    };\n\n    if (!canViewLogs) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-white rounded-xl border border-slate-200 p-12 text-center\">\n                <div className=\"p-4 bg-red-50 rounded-full mb-4\">\n                    <ShieldAlert className=\"w-12 h-12 text-red-500\" />\n                </div>\n                <h3 className=\"text-xl font-bold text-slate-800\">Access Denied</h3>\n                <p className=\"text-slate-500 mt-2\">You do not have permission to view email logs.</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6 p-6\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-2xl font-bold flex items-center gap-2\">\n                        <Mail className=\"w-6 h-6\" />\n                        Email Logs\n                    </h1>\n                    <p className=\"text-slate-500 mt-1\">\n                        View email sending history and events\n                    </p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <Button variant=\"outline\" onClick={handleExport} disabled={logs.length === 0}>\n                        <Download className=\"w-4 h-4 mr-2\" />\n                        Export CSV\n                    </Button>\n                    <Button variant=\"outline\" onClick={loadLogs}>\n                        <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n                        Refresh\n                    </Button>\n                </div>\n            </div>\n\n            {/* Filters */}\n            <Card>\n                <CardContent className=\"py-4\">\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"flex-1\">\n                            <div className=\"relative\">\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400\" />\n                                <Input\n                                    placeholder=\"Search by recipient...\"\n                                    value={filters.recipient}\n                                    onChange={(e) =>\n                                        setFilters((prev) => ({ ...prev, recipient: e.target.value }))\n                                    }\n                                    className=\"pl-10\"\n                                />\n                            </div>\n                        </div>\n                        <Select\n                            value={filters.eventType || 'all'}\n                            onValueChange={(value) =>\n                                setFilters((prev) => ({ ...prev, eventType: value === 'all' ? '' : value }))\n                            }\n                        >\n                            <SelectTrigger className=\"w-40\">\n                                <SelectValue placeholder=\"All Events\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                                <SelectItem value=\"all\">All Events</SelectItem>\n                                <SelectItem value=\"sent\">Sent</SelectItem>\n                                <SelectItem value=\"opened\">Opened</SelectItem>\n                                <SelectItem value=\"clicked\">Clicked</SelectItem>\n                                <SelectItem value=\"bounced\">Bounced</SelectItem>\n                                <SelectItem value=\"failed\">Failed</SelectItem>\n                            </SelectContent>\n                        </Select>\n                    </div>\n                </CardContent>\n            </Card>\n\n            {/* Logs Table */}\n            <Card>\n                <CardContent className=\"p-0\">\n                    <Table>\n                        <TableHeader>\n                            <TableRow>\n                                <TableHead>Date</TableHead>\n                                <TableHead>Tenant</TableHead>\n                                <TableHead>User</TableHead>\n                                <TableHead>Role</TableHead>\n                                <TableHead>IP Address</TableHead>\n                                <TableHead>Event</TableHead>\n                                <TableHead>Recipient</TableHead>\n                                <TableHead>Subject</TableHead>\n                            </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                            {loading ? (\n                                <TableRow>\n                                    <TableCell colSpan={8} className=\"text-center py-8\">\n                                        <RefreshCw className=\"w-6 h-6 animate-spin mx-auto text-slate-400\" />\n                                    </TableCell>\n                                </TableRow>\n                            ) : logs.length === 0 ? (\n                                <TableRow>\n                                    <TableCell colSpan={8} className=\"text-center py-8 text-slate-500\">\n                                        No email logs found\n                                    </TableCell>\n                                </TableRow>\n                            ) : (\n                                logs.map((log) => {\n                                    const typeConfig = EVENT_TYPE_CONFIG[log.event_type] || {};\n                                    const Icon = typeConfig.icon || Mail;\n                                    return (\n                                        <TableRow key={log.id}>\n                                            <TableCell className=\"text-sm text-slate-500\">\n                                                {format(new Date(log.created_at), 'MMM d, yyyy HH:mm:ss')}\n                                            </TableCell>\n                                            <TableCell className=\"text-sm\">\n                                                {log.tenant?.name || '-'}\n                                            </TableCell>\n                                            <TableCell className=\"text-sm\">\n                                                {log.user?.full_name || log.user?.email || '-'}\n                                            </TableCell>\n                                            <TableCell className=\"text-sm\">\n                                                {log.user?.role?.name || '-'}\n                                            </TableCell>\n                                            <TableCell className=\"text-xs font-mono text-slate-500\">\n                                                {log.ip_address || '-'}\n                                            </TableCell>\n                                            <TableCell>\n                                                <Badge\n                                                    variant=\"secondary\"\n                                                    className={`${typeConfig.color} gap-1`}\n                                                >\n                                                    <Icon className=\"w-3 h-3\" />\n                                                    {typeConfig.label || log.event_type}\n                                                </Badge>\n                                            </TableCell>\n                                            <TableCell className=\"font-mono text-sm\">\n                                                {log.recipient}\n                                            </TableCell>\n                                            <TableCell className=\"max-w-xs truncate\">\n                                                {log.subject || '-'}\n                                            </TableCell>\n                                        </TableRow>\n                                    );\n                                })\n                            )}\n                        </TableBody>\n                    </Table>\n                </CardContent>\n            </Card>\n\n            {/* Pagination */}\n            {count > limit && (\n                <div className=\"flex items-center justify-between\">\n                    <p className=\"text-sm text-slate-500\">\n                        Showing {page * limit + 1}-{Math.min((page + 1) * limit, count)} of {count}\n                    </p>\n                    <div className=\"flex items-center gap-2\">\n                        <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setPage((p) => Math.max(0, p - 1))}\n                            disabled={page === 0}\n                        >\n                            Previous\n                        </Button>\n                        <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setPage((p) => p + 1)}\n                            disabled={(page + 1) * limit >= count}\n                        >\n                            Next\n                        </Button>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n\nexport default EmailLogs;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/mailketing/components/EmailSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { usePermissions } from '@/contexts/PermissionContext';\nimport { useToast } from '@/components/ui/use-toast';\nimport { Card, CardHeader, CardTitle, CardContent, CardDescription } from '@/components/ui/card';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Switch } from '@/components/ui/switch';\nimport {\n    Mail,\n    Save,\n    TestTube,\n    RefreshCw,\n    CreditCard,\n    AlertCircle,\n    CheckCircle,\n    ShieldAlert,\n} from 'lucide-react';\nimport {\n    getTenantEmailConfig,\n    saveTenantEmailConfig,\n    checkCredits,\n    sendTestEmail,\n} from '../services/emailService';\n\nfunction EmailSettings() {\n    const { t } = useTranslation();\n    const { currentTenant } = useTenant();\n    const { hasPermission } = usePermissions();\n    const { toast } = useToast();\n\n    const [config, setConfig] = useState({\n        provider: 'mailketing',\n        api_token: '',\n        from_name: '',\n        from_email: '',\n        default_list_id: 1,\n        enabled: true,\n    });\n    const [credits, setCredits] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    const [testing, setTesting] = useState(false);\n    const [testEmail, setTestEmail] = useState('');\n\n    const canConfigure = hasPermission('tenant.setting.update');\n\n    const loadConfig = useCallback(async () => {\n        setLoading(true);\n        try {\n            const data = await getTenantEmailConfig(currentTenant.id);\n            setConfig((prev) => ({ ...prev, ...data }));\n        } catch (error) {\n            console.error('Failed to load email config:', error);\n        } finally {\n            setLoading(false);\n        }\n    }, [currentTenant?.id]);\n\n    const loadCredits = useCallback(async () => {\n        try {\n            const result = await checkCredits();\n            if (result.status === 'true') {\n                setCredits(result.credits);\n            }\n        } catch (error) {\n            console.error('Failed to check credits:', error);\n        }\n    }, []);\n\n    useEffect(() => {\n        if (currentTenant?.id) {\n            loadConfig();\n            loadCredits();\n        }\n    }, [currentTenant?.id, loadConfig, loadCredits]);\n\n\n    const handleSave = async () => {\n        if (!canConfigure) return;\n\n        setSaving(true);\n        try {\n            await saveTenantEmailConfig(currentTenant.id, config);\n            toast({\n                title: t('common.success'),\n                description: 'Email settings saved successfully.',\n            });\n        } catch (error) {\n            toast({\n                title: t('common.error'),\n                description: error.message,\n                variant: 'destructive',\n            });\n        } finally {\n            setSaving(false);\n        }\n    };\n\n    const handleTestEmail = async () => {\n        if (!testEmail) {\n            toast({\n                title: 'Enter email',\n                description: 'Please enter an email address to send test to.',\n                variant: 'destructive',\n            });\n            return;\n        }\n\n        setTesting(true);\n        try {\n            const result = await sendTestEmail(currentTenant.id, testEmail);\n            if (result.status === 'success') {\n                toast({\n                    title: 'Test Email Sent',\n                    description: `Email sent to ${testEmail}`,\n                });\n            } else {\n                throw new Error(result.response || 'Failed to send');\n            }\n        } catch (error) {\n            toast({\n                title: 'Test Failed',\n                description: error.message,\n                variant: 'destructive',\n            });\n        } finally {\n            setTesting(false);\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center h-64\">\n                <RefreshCw className=\"w-6 h-6 animate-spin text-slate-400\" />\n            </div>\n        );\n    }\n\n    if (!canConfigure) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] bg-white rounded-xl border border-slate-200 p-12 text-center\">\n                <div className=\"p-4 bg-red-50 rounded-full mb-4\">\n                    <ShieldAlert className=\"w-12 h-12 text-red-500\" />\n                </div>\n                <h3 className=\"text-xl font-bold text-slate-800\">Access Denied</h3>\n                <p className=\"text-slate-500 mt-2\">You do not have permission to configure email settings.</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6 p-6\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-2xl font-bold flex items-center gap-2\">\n                        <Mail className=\"w-6 h-6\" />\n                        Email Settings\n                    </h1>\n                    <p className=\"text-slate-500 mt-1\">\n                        Configure Mailketing email integration\n                    </p>\n                </div>\n                {credits !== null && (\n                    <Card className=\"px-4 py-2\">\n                        <div className=\"flex items-center gap-2\">\n                            <CreditCard className=\"w-4 h-4 text-blue-500\" />\n                            <span className=\"text-sm text-slate-600\">Credits:</span>\n                            <span className=\"font-bold text-lg\">{credits}</span>\n                        </div>\n                    </Card>\n                )}\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* Configuration Card */}\n                <Card>\n                    <CardHeader>\n                        <CardTitle>Configuration</CardTitle>\n                        <CardDescription>\n                            Mailketing API settings for this tenant\n                        </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div className=\"flex items-center justify-between\">\n                            <Label htmlFor=\"enabled\">Enable Email Sending</Label>\n                            <Switch\n                                id=\"enabled\"\n                                checked={config.enabled}\n                                onCheckedChange={(checked) =>\n                                    setConfig((prev) => ({ ...prev, enabled: checked }))\n                                }\n                                disabled={!canConfigure}\n                            />\n                        </div>\n\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"api_token\">API Token</Label>\n                            <Input\n                                id=\"api_token\"\n                                type=\"password\"\n                                placeholder=\"Enter Mailketing API token\"\n                                value={config.api_token || ''}\n                                onChange={(e) =>\n                                    setConfig((prev) => ({ ...prev, api_token: e.target.value }))\n                                }\n                                disabled={!canConfigure}\n                            />\n                            <p className=\"text-xs text-slate-500\">\n                                Get from{' '}\n                                <a\n                                    href=\"https://be.mailketing.co.id/integration\"\n                                    target=\"_blank\"\n                                    rel=\"noopener noreferrer\"\n                                    className=\"text-blue-500 hover:underline\"\n                                >\n                                    Mailketing Dashboard\n                                </a>\n                            </p>\n                        </div>\n\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"from_name\">From Name</Label>\n                            <Input\n                                id=\"from_name\"\n                                placeholder=\"Sender Name\"\n                                value={config.from_name || ''}\n                                onChange={(e) =>\n                                    setConfig((prev) => ({ ...prev, from_name: e.target.value }))\n                                }\n                                disabled={!canConfigure}\n                            />\n                        </div>\n\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"from_email\">From Email</Label>\n                            <Input\n                                id=\"from_email\"\n                                type=\"email\"\n                                placeholder=\"noreply@example.com\"\n                                value={config.from_email || ''}\n                                onChange={(e) =>\n                                    setConfig((prev) => ({ ...prev, from_email: e.target.value }))\n                                }\n                                disabled={!canConfigure}\n                            />\n                        </div>\n\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"default_list_id\">Default List ID</Label>\n                            <Input\n                                id=\"default_list_id\"\n                                type=\"number\"\n                                placeholder=\"1\"\n                                value={config.default_list_id || 1}\n                                onChange={(e) =>\n                                    setConfig((prev) => ({\n                                        ...prev,\n                                        default_list_id: parseInt(e.target.value) || 1,\n                                    }))\n                                }\n                                disabled={!canConfigure}\n                            />\n                        </div>\n\n                        <Button\n                            onClick={handleSave}\n                            disabled={!canConfigure || saving}\n                            className=\"w-full\"\n                        >\n                            {saving ? (\n                                <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\n                            ) : (\n                                <Save className=\"w-4 h-4 mr-2\" />\n                            )}\n                            Save Settings\n                        </Button>\n                    </CardContent>\n                </Card>\n\n                {/* Test Email Card */}\n                <Card>\n                    <CardHeader>\n                        <CardTitle>Test Email</CardTitle>\n                        <CardDescription>\n                            Send a test email to verify configuration\n                        </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"test_email\">Recipient Email</Label>\n                            <Input\n                                id=\"test_email\"\n                                type=\"email\"\n                                placeholder=\"test@example.com\"\n                                value={testEmail}\n                                onChange={(e) => setTestEmail(e.target.value)}\n                            />\n                        </div>\n\n                        <Button\n                            onClick={handleTestEmail}\n                            disabled={testing || !config.enabled}\n                            variant=\"outline\"\n                            className=\"w-full\"\n                        >\n                            {testing ? (\n                                <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\n                            ) : (\n                                <TestTube className=\"w-4 h-4 mr-2\" />\n                            )}\n                            Send Test Email\n                        </Button>\n\n                        {!config.enabled && (\n                            <div className=\"flex items-center gap-2 text-amber-600 text-sm\">\n                                <AlertCircle className=\"w-4 h-4\" />\n                                Enable email sending to test\n                            </div>\n                        )}\n                    </CardContent>\n                </Card>\n            </div>\n\n            {/* Status */}\n            <Card>\n                <CardContent className=\"py-4\">\n                    <div className=\"flex items-center gap-4\">\n                        {config.enabled ? (\n                            <div className=\"flex items-center gap-2 text-green-600\">\n                                <CheckCircle className=\"w-5 h-5\" />\n                                <span>Email sending is enabled</span>\n                            </div>\n                        ) : (\n                            <div className=\"flex items-center gap-2 text-slate-400\">\n                                <AlertCircle className=\"w-5 h-5\" />\n                                <span>Email sending is disabled</span>\n                            </div>\n                        )}\n                    </div>\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n\nexport default EmailSettings;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/mailketing/components/MailketingCreditsWidget.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { CreditCard, RefreshCw } from 'lucide-react';\nimport { checkCredits } from '../services/emailService';\n\n/**\n * Dashboard widget showing Mailketing email credits\n */\nfunction MailketingCreditsWidget() {\n    const [credits, setCredits] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        loadCredits();\n    }, []);\n\n    const loadCredits = async () => {\n        setLoading(true);\n        setError(null);\n        try {\n            const result = await checkCredits();\n            if (result.status === 'true') {\n                setCredits(parseInt(result.credits) || 0);\n            } else {\n                setError('Failed to load');\n            }\n        } catch (err) {\n            setError(err.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const getCreditsColor = () => {\n        if (credits === null) return 'text-slate-400';\n        if (credits < 100) return 'text-red-500';\n        if (credits < 500) return 'text-amber-500';\n        return 'text-green-500';\n    };\n\n    return (\n        <div className=\"bg-white rounded-xl border border-slate-200 p-4\">\n            <div className=\"flex items-center justify-between mb-2\">\n                <h3 className=\"text-sm font-medium text-slate-600 flex items-center gap-2\">\n                    <CreditCard className=\"w-4 h-4\" />\n                    Email Credits\n                </h3>\n                <button\n                    onClick={loadCredits}\n                    className=\"text-slate-400 hover:text-slate-600 transition-colors\"\n                    disabled={loading}\n                >\n                    <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n                </button>\n            </div>\n\n            {loading ? (\n                <div className=\"text-2xl font-bold text-slate-300\">...</div>\n            ) : error ? (\n                <div className=\"text-sm text-red-500\">{error}</div>\n            ) : (\n                <div className={`text-2xl font-bold ${getCreditsColor()}`}>\n                    {credits?.toLocaleString()}\n                </div>\n            )}\n\n            {credits !== null && credits < 100 && (\n                <p className=\"text-xs text-amber-600 mt-2\">\n                    Low credits! Consider topping up.\n                </p>\n            )}\n        </div>\n    );\n}\n\nexport default MailketingCreditsWidget;\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/mailketing/hooks/emailHooks.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/mailketing/index.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'addAction' is defined but never used.","line":20,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"addAction"},"fix":{"range":[444,454],"text":""},"desc":"Remove unused variable 'addAction'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":20,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":58,"suggestions":[{"messageId":"removeVar","data":{"varName":"supabase"},"fix":{"range":[464,474],"text":""},"desc":"Remove unused variable 'supabase'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'context' is defined but never used.","line":56,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":63,"suggestions":[{"messageId":"removeVar","data":{"varName":"context"},"fix":{"range":[1662,1671],"text":""},"desc":"Remove unused variable 'context'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Mailketing Core Plugin\n * Email sending and subscriber management via Mailketing API\n */\n\nimport React from 'react';\nimport MailketingCreditsWidget from './components/MailketingCreditsWidget';\nimport manifest from './plugin.json';\n\nexport const components = {\n    MailketingCreditsWidget,\n};\n\nexport { manifest };\n\n/**\n * Register plugin hooks and filters\n * Called once when the plugin system initializes\n */\nexport const register = ({ addAction, addFilter, supabase, pluginConfig }) => {\n    // Import components dynamically for routing\n    const EmailSettings = React.lazy(() => import('./components/EmailSettings'));\n    const EmailLogs = React.lazy(() => import('./components/EmailLogs'));\n\n    // Register admin routes for email settings\n    addFilter('admin_routes', 'mailketing_routes', (routes) => [\n        ...routes,\n        {\n            path: 'email-settings',\n            element: EmailSettings,\n            permission: 'tenant.setting.update',\n        },\n        {\n            path: 'email-logs',\n            element: EmailLogs,\n            permission: 'tenant.setting.read',\n        },\n    ]);\n\n    // Register sidebar menu items\n    addFilter('admin_menu_items', 'mailketing_menu', (items) => [\n        ...items,\n        {\n            id: 'mailketing-settings',\n            label: 'Mailketing',\n            path: 'email-settings',\n            icon: 'Mail',\n            group: 'CONFIGURATION',\n            order: 75,\n            permission: 'tenant.setting.update',\n            plugin_type: manifest.type,\n        },\n    ]);\n\n    // Register email content filter for template injection\n    addFilter('email_content', 'mailketing', (content, context) => {\n        // Add tracking pixel if enabled\n        if (pluginConfig?.tracking_enabled) {\n            const trackingPixel = `<img src=\"${pluginConfig.tracking_url}\" width=\"1\" height=\"1\" />`;\n            return content + trackingPixel;\n        }\n        return content;\n    });\n\n    // Register dashboard widget for email stats\n    addFilter('dashboard_widgets', 'mailketing_stats', (widgets) => {\n        return [\n            ...widgets,\n            {\n                id: 'mailketing_credits',\n                component: 'mailketing:MailketingCreditsWidget',\n                position: 'sidebar',\n                priority: 50,\n                frame: false,\n            },\n        ];\n    });\n\n    console.log('[Mailketing Plugin] Registered');\n};\n\n/**\n * Activate plugin for a specific tenant\n * Called when the plugin is enabled for a tenant\n */\nexport const activate = async (supabase, tenantId) => {\n    console.log(`[Mailketing Plugin] Activated for tenant: ${tenantId}`);\n\n    // Initialize default settings if not exists\n    const { data: existingSettings } = await supabase\n        .from('settings')\n        .select('key')\n        .eq('tenant_id', tenantId)\n        .eq('key', 'email.provider')\n        .is('deleted_at', null)\n        .single();\n\n    if (!existingSettings) {\n        await supabase.from('settings').upsert([\n            { tenant_id: tenantId, key: 'email.provider', value: '\"mailketing\"', deleted_at: null },\n            { tenant_id: tenantId, key: 'email.enabled', value: 'true', deleted_at: null },\n        ], { onConflict: 'tenant_id,key' });\n    }\n\n    return { success: true };\n};\n\n/**\n * Deactivate plugin for a specific tenant\n * Called when the plugin is disabled for a tenant\n */\nexport const deactivate = async (supabase, tenantId) => {\n    console.log(`[Mailketing Plugin] Deactivated for tenant: ${tenantId}`);\n\n    // Optionally disable email sending\n    await supabase\n        .from('settings')\n        .update({ value: 'false' })\n        .eq('tenant_id', tenantId)\n        .eq('key', 'email.enabled');\n\n    return { success: true };\n};\n\n/**\n * Uninstall plugin - cleanup all data\n * Called when the plugin is completely removed\n */\nexport const uninstall = async (supabase, tenantId) => {\n    console.log(`[Mailketing Plugin] Uninstalling for tenant: ${tenantId}`);\n\n    // Remove plugin settings\n    await supabase\n        .from('settings')\n        .update({ deleted_at: new Date().toISOString() })\n        .eq('tenant_id', tenantId)\n        .like('key', 'email.%');\n\n    return { success: true };\n};\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/mailketing/services/emailService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/regions/RegionsManager.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  80 |         if (canRead) {\n  81 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 82 |             loadRegions();\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  83 |         }\n  84 |     }, [canRead, loadRegions]); // loadRegions depends on page/search/parent\n  85 |","line":82,"column":13,"nodeType":null,"endLine":82,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/plugins/regions/index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/scripts/seed-sidebar.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":96,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":96,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[10291,10294],"text":""},"desc":"Remove unused variable 'id'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import dotenv from 'dotenv';\nimport { createClient } from '@supabase/supabase-js';\n\n// Load .env then .env.local (override)\ndotenv.config({ path: '.env' });\ndotenv.config({ path: '.env.local', override: true });\n\n// Load env vars\nconst supabaseUrl = process.env.VITE_SUPABASE_URL;\n// Use Service Role for seeding (support both env var names)\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.VITE_SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseServiceKey) {\n    console.error('Missing VITE_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY environment variables.');\n    process.exit(1);\n}\n\nconst supabase = createClient(supabaseUrl, supabaseServiceKey);\n\nconst DEFAULT_MENU_CONFIG = [\n    // CONTENT Group\n    { id: 'home', key: 'home', label: 'Dashboard', path: 'home', icon: 'LayoutDashboard', permission: null, group_label: 'CONTENT', group_order: 10, order: 10, is_visible: true },\n    { id: 'blogs', key: 'blogs', label: 'Blogs', path: 'blogs', icon: 'FileText', permission: 'tenant.blog.read', group_label: 'CONTENT', group_order: 10, order: 20, is_visible: true },\n    { id: 'pages', key: 'pages', label: 'Pages', path: 'pages', icon: 'FileEdit', permission: 'tenant.page.read', group_label: 'CONTENT', group_order: 10, order: 30, is_visible: true },\n    { id: 'visual_builder', key: 'visual_builder', label: 'Visual Builder', path: 'visual-pages', icon: 'Layout', permission: 'tenant.visual_pages.read', group_label: 'CONTENT', group_order: 10, order: 35, is_visible: true },\n    { id: 'themes', key: 'themes', label: 'Themes', path: 'themes', icon: 'Palette', permission: 'tenant.theme.read', group_label: 'CONTENT', group_order: 10, order: 40, is_visible: true },\n    { id: 'widgets', key: 'widgets', label: 'Widgets', path: 'widgets', icon: 'Layers', permission: 'tenant.widgets.read', group_label: 'CONTENT', group_order: 10, order: 45, is_visible: true },\n    { id: 'portfolio', key: 'portfolio', label: 'Portfolio', path: 'portfolio', icon: 'Briefcase', permission: 'tenant.portfolio.read', group_label: 'CONTENT', group_order: 10, order: 50, is_visible: true },\n    { id: 'testimonials', key: 'testimonials', label: 'Testimonials', path: 'testimonies', icon: 'MessageSquareQuote', permission: 'tenant.testimonies.read', group_label: 'CONTENT', group_order: 10, order: 60, is_visible: true },\n    { id: 'announcements', key: 'announcements', label: 'Announcements', path: 'announcements', icon: 'Megaphone', permission: 'tenant.announcements.read', group_label: 'CONTENT', group_order: 10, order: 70, is_visible: true },\n    { id: 'promotions', key: 'promotions', label: 'Promotions', path: 'promotions', icon: 'Tag', permission: 'tenant.promotions.read', group_label: 'CONTENT', group_order: 10, order: 80, is_visible: true },\n    { id: 'contact_messages', key: 'contact_messages', label: 'Contact Messages', path: 'messages', icon: 'Inbox', permission: 'tenant.contact_messages.read', group_label: 'CONTENT', group_order: 10, order: 90, is_visible: true },\n    { id: 'contacts', key: 'contacts', label: 'Contacts CRM', path: 'contacts', icon: 'Contact', permission: 'tenant.contacts.read', group_label: 'CONTENT', group_order: 10, order: 95, is_visible: true },\n\n    // MEDIA Group\n    { id: 'files', key: 'files', label: 'Media Library', path: 'files', icon: 'FolderOpen', permission: 'tenant.files.read', group_label: 'MEDIA', group_order: 20, order: 10, is_visible: true },\n    { id: 'photo_gallery', key: 'photo_gallery', label: 'Photo Gallery', path: 'photo-gallery', icon: 'Image', permission: 'tenant.photo_gallery.read', group_label: 'MEDIA', group_order: 20, order: 20, is_visible: true },\n    { id: 'video_gallery', key: 'video_gallery', label: 'Video Gallery', path: 'video-gallery', icon: 'Video', permission: 'tenant.video_gallery.read', group_label: 'MEDIA', group_order: 20, order: 30, is_visible: true },\n\n    // COMMERCE Group\n    { id: 'products', key: 'products', label: 'Products', path: 'products', icon: 'Package', permission: 'tenant.products.read', group_label: 'COMMERCE', group_order: 30, order: 10, is_visible: true },\n    { id: 'product_types', key: 'product_types', label: 'Product Types', path: 'product-types', icon: 'Box', permission: 'tenant.product_types.read', group_label: 'COMMERCE', group_order: 30, order: 20, is_visible: true },\n    { id: 'orders', key: 'orders', label: 'Orders', path: 'orders', icon: 'ShoppingCart', permission: 'tenant.orders.read', group_label: 'COMMERCE', group_order: 30, order: 30, is_visible: true },\n\n    // NAVIGATION Group\n    { id: 'menus', key: 'menus', label: 'Menu Manager', path: 'menus', icon: 'Menu', permission: 'tenant.menu.read', group_label: 'NAVIGATION', group_order: 40, order: 10, is_visible: true },\n    { id: 'categories', key: 'categories', label: 'Categories', path: 'categories', icon: 'FolderTree', permission: 'tenant.categories.read', group_label: 'NAVIGATION', group_order: 40, order: 20, is_visible: true },\n    { id: 'tags', key: 'tags', label: 'Tags', path: 'tags', icon: 'Hash', permission: 'tenant.tag.read', group_label: 'NAVIGATION', group_order: 40, order: 30, is_visible: true },\n\n    // USERS Group\n    { id: 'users', key: 'users', label: 'Users', path: 'users', icon: 'Users', permission: 'tenant.user.read', group_label: 'USERS', group_order: 50, order: 10, is_visible: true },\n    { id: 'roles', key: 'roles', label: 'Roles & Permissions', path: 'roles', icon: 'Shield', permission: 'tenant.role.read', group_label: 'USERS', group_order: 50, order: 20, is_visible: true },\n    { id: 'policies', key: 'policies', label: 'Policies', path: 'policies', icon: 'ShieldCheck', permission: 'tenant.policy.read', group_label: 'USERS', group_order: 50, order: 30, is_visible: true },\n\n    // SYSTEM Group\n    { id: 'seo_manager', key: 'seo_manager', label: 'SEO Manager', path: 'seo', icon: 'Search', permission: 'tenant.seo.read', group_label: 'SYSTEM', group_order: 60, order: 10, is_visible: true },\n    { id: 'languages', key: 'languages', label: 'Languages', path: 'languages', icon: 'Languages', permission: 'tenant.languages.read', group_label: 'SYSTEM', group_order: 60, order: 20, is_visible: true },\n    { id: 'extensions', key: 'extensions', label: 'Extensions', path: 'extensions', icon: 'Puzzle', permission: 'platform.extensions.read', group_label: 'SYSTEM', group_order: 60, order: 30, is_visible: true },\n    { id: 'modules', key: 'modules', label: 'Modules', path: 'modules', icon: 'Box', permission: 'platform.module.read', group_label: 'SYSTEM', group_order: 60, order: 35, is_visible: true },\n    { id: 'sidebar_manager', key: 'sidebar_manager', label: 'Sidebar Manager', path: 'admin-navigation', icon: 'List', permission: 'platform.sidebar.read', group_label: 'SYSTEM', group_order: 60, order: 40, is_visible: true },\n    { id: 'notifications', key: 'notifications', label: 'Notifications', path: 'notifications', icon: 'MessageSquareQuote', permission: 'tenant.notification.read', group_label: 'SYSTEM', group_order: 60, order: 50, is_visible: true },\n    { id: 'audit_logs', key: 'audit_logs', label: 'Audit Logs', path: 'audit-logs', icon: 'FileClock', permission: 'tenant.audit.read', group_label: 'SYSTEM', group_order: 60, order: 60, is_visible: true },\n    { id: 'visitor_stats', key: 'visitor_stats', label: 'Visitor Statistics', path: 'visitor-stats', icon: 'LineChart', permission: 'tenant.analytics.read', group_label: 'SYSTEM', group_order: 60, order: 65, is_visible: true },\n\n    // CONFIGURATION Group\n    { id: 'settings_general', key: 'settings_general', label: 'General Settings', path: 'settings/general', icon: 'Settings', permission: 'tenant.setting.read', group_label: 'CONFIGURATION', group_order: 70, order: 5, is_visible: true },\n    { id: 'settings_branding', key: 'branding', label: 'Branding', path: 'settings/branding', icon: 'Palette', permission: 'tenant.setting.update', group_label: 'CONFIGURATION', group_order: 70, order: 10, is_visible: true },\n    { id: 'sso', key: 'sso', label: 'SSO & Security', path: 'sso', icon: 'Lock', permission: 'tenant.sso.read', group_label: 'CONFIGURATION', group_order: 70, order: 20, is_visible: true },\n    { id: 'email_settings', key: 'email_settings', label: 'Email Settings', path: 'email-settings', icon: 'Mail', permission: 'tenant.setting.update', group_label: 'CONFIGURATION', group_order: 70, order: 30, is_visible: true },\n    { id: 'email_logs', key: 'email_logs', label: 'Email Logs', path: 'email-logs', icon: 'MailOpen', permission: 'tenant.setting.read', group_label: 'CONFIGURATION', group_order: 70, order: 40, is_visible: true },\n\n    // IoT Group\n    { id: 'iot_devices', key: 'iot_devices', label: 'IoT Devices', path: 'devices', icon: 'Cpu', permission: 'tenant.iot.read', group_label: 'IoT', group_order: 80, order: 10, is_visible: true },\n\n    // MOBILE Group\n    { id: 'mobile_users', key: 'mobile_users', label: 'Mobile Users', path: 'mobile/users', icon: 'Smartphone', permission: 'tenant.mobile_users.read', group_label: 'MOBILE', group_order: 85, order: 10, is_visible: true },\n    { id: 'push_notifications', key: 'push_notifications', label: 'Push Notifications', path: 'mobile/push', icon: 'Bell', permission: 'tenant.push_notifications.read', group_label: 'MOBILE', group_order: 85, order: 20, is_visible: true },\n    { id: 'mobile_config', key: 'mobile_config', label: 'App Config', path: 'mobile/config', icon: 'Settings', permission: 'tenant.mobile.update', group_label: 'MOBILE', group_order: 85, order: 30, is_visible: true },\n\n    // PLATFORM Group\n    { id: 'tenants', key: 'tenants', label: 'Tenant Management', path: 'tenants', icon: 'Building', permission: 'platform.tenant.read', group_label: 'PLATFORM', group_order: 100, order: 10, is_visible: true },\n];\n\nconst PLUGINS_TO_SEED = [\n    { name: 'Backup System', slug: 'backup', extension_type: 'core', is_active: true },\n    { name: 'Regions Manager', slug: 'regions', extension_type: 'core', is_active: true },\n    { name: 'Mailketing', slug: 'mailketing', extension_type: 'core', is_active: true },\n    { name: 'Ahliweb Analytics', slug: 'awcms-ext-ahliweb-analytics', extension_type: 'core', is_active: true }\n];\n\nasync function seedSidebar() {\n    console.log('Seeding Sidebar...');\n\n    // Seed Menu\n    for (const item of DEFAULT_MENU_CONFIG) {\n        const { id, ...data } = item;\n        const { error } = await supabase\n            .from('admin_menus')\n            .upsert({\n                ...data,\n                key: item.key || item.id, // Ensure key is set\n                updated_at: new Date().toISOString()\n            }, { onConflict: 'key' });\n\n        if (error) {\n            console.error(`Failed to seed menu ${item.label}:`, error);\n        } else {\n            console.log(`Seeded Menu: ${item.label}`);\n        }\n    }\n\n    // Seed Extensions\n    console.log('Seeding Extensions...');\n    // Fetch a valid tenant ID to seed extensions for. \n    // In dev env, we grab the first tenant we find.\n    const { data: tenants } = await supabase.from('tenants').select('id').limit(1);\n    const infoTenantId = tenants?.[0]?.id;\n\n    if (infoTenantId) {\n        for (const plugin of PLUGINS_TO_SEED) {\n            const { error } = await supabase\n                .from('extensions')\n                .upsert({\n                    tenant_id: infoTenantId,\n                    name: plugin.name,\n                    slug: plugin.slug,\n                    extension_type: plugin.extension_type,\n                    is_active: plugin.is_active,\n                    updated_at: new Date().toISOString()\n                }, { onConflict: 'slug' });\n\n            if (error) {\n                console.error(`Failed to seed extension ${plugin.name}:`, error);\n            } else {\n                console.log(`Seeded Extension: ${plugin.name}`);\n            }\n        }\n    } else {\n        console.warn('No tenant found to seed extensions. Skipping extension seeding.');\n    }\n\n    console.log('Seed Complete.');\n}\n\nseedSidebar();\n","usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/setupTests.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/utils/extensionLifecycle.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/utils/sanitize.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/src/utils/textUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/test-eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/data/dev_react/awcms-dev/awcms/vitest.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
