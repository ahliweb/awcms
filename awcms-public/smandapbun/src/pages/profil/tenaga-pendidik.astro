---
import Layout from "../../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import {
  getLocale,
  t,
  getLocalizedValue,
  getLocalizedPath,
  type Locale,
} from "../../utils/i18n";
import { getStaffPageData } from "../../lib/api";

const locale = getLocale(Astro.url) as Locale;
const staffData = await getStaffPageData();
const { teachingStaff, administrativeStaff } = staffData;
---

<Layout
  title={locale === "id"
    ? "Tenaga Pendidik & Kependidikan"
    : "Teaching & Administrative Staff"}
>
  <!-- Hero -->
  <section
    class="hero-gradient text-white py-16 md:py-20"
    style="--hero-image: url('/images/backgrounds/hero-staff.webp');"
    data-testid="staff-hero"
  >
    <div class="container-custom">
      <nav class="text-sm text-blue-200 mb-4">
        <a href={getLocalizedPath("/", locale)} class="hover:text-white"
          >Beranda</a
        >
        <span class="mx-2">/</span>
        <a href={getLocalizedPath("/profil", locale)} class="hover:text-white"
          >{t("profile.title", locale)}</a
        >
        <span class="mx-2">/</span>
        <span class="text-white">{t("profile.staff", locale)}</span>
      </nav>
      <h1 class="text-3xl md:text-4xl font-bold font-heading">
        {t("profile.staff", locale)}
      </h1>
    </div>
  </section>

  <!-- Stats -->
  <section
    class="py-8 bg-white dark:bg-slate-800 shadow-sm relative -mt-6 z-10 transition-colors duration-200"
  >
    <div class="container-custom">
      <div class="grid grid-cols-2 md:grid-cols-5 gap-6">
        <div class="text-center">
          <div
            class="text-3xl font-bold text-primary-600 dark:text-primary-400"
          >
            {teachingStaff.summary.total}
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">
            {locale === "id" ? "Total Guru" : "Total Teachers"}
          </div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-green-600 dark:text-green-400">
            {teachingStaff.summary.pns}
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">PNS</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-orange-600 dark:text-orange-400">
            {teachingStaff.summary.nonPns}
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">Non-PNS</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-purple-600 dark:text-purple-400">
            {teachingStaff.summary.s2}
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">S2/Master</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">
            {administrativeStaff.summary.total}
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">
            {locale === "id" ? "Staf TU" : "Admin Staff"}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Teaching Staff -->
  <section
    class="section-photo py-16 bg-gray-50 dark:bg-slate-900 transition-colors duration-200"
    style="--section-image: url('/images/backgrounds/section-staff.webp');"
    data-testid="teaching-staff"
  >
    <div class="container-custom">
      <h2
        class="text-2xl font-bold text-gray-900 dark:text-white mb-8 flex items-center gap-3"
      >
        <div
          class="w-10 h-10 bg-primary-100 dark:bg-primary-900/40 rounded-full flex items-center justify-center transition-colors"
        >
          <Icon
            name="tabler:chalkboard"
            class="w-5 h-5 text-primary-600 dark:text-primary-400"
          />
        </div>
        {getLocalizedValue(teachingStaff.title, locale)}
      </h2>
      <div class="overflow-x-auto">
        <table
          class="w-full bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden transition-colors"
        >
          <thead class="bg-primary-50 dark:bg-primary-900/20 transition-colors">
            <tr>
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-white"
                >No</th
              >
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-white"
                >{locale === "id" ? "Nama" : "Name"}</th
              >
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-white"
                >{locale === "id" ? "Mata Pelajaran" : "Subject"}</th
              >
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-white"
                >Status</th
              >
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
            {
              teachingStaff.staff.map((staff: any, index: number) => (
                <tr class="hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors">
                  <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-300">
                    {index + 1}
                  </td>
                  <td class="px-6 py-4 text-sm font-medium text-gray-900 dark:text-white">
                    {staff.name}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-300">
                    {staff.subject}
                  </td>
                  <td class="px-6 py-4">
                    <span
                      class={`px-2 py-1 rounded text-xs font-medium ${
                        staff.status === "PNS"
                          ? "bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"
                          : "bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400"
                      }`}
                    >
                      {staff.status}
                    </span>
                  </td>
                </tr>
              ))
            }
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Administrative Staff -->
  <section
    class="py-16 bg-white dark:bg-slate-800 transition-colors duration-200"
    data-testid="admin-staff"
  >
    <div class="container-custom">
      <h2
        class="text-2xl font-bold text-gray-900 dark:text-white mb-8 flex items-center gap-3"
      >
        <div
          class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center transition-colors"
        >
          <Icon
            name="tabler:users"
            class="w-5 h-5 text-green-600 dark:text-green-400"
          />
        </div>
        {getLocalizedValue(administrativeStaff.title, locale)}
      </h2>
      <div class="overflow-x-auto">
        <table
          class="w-full bg-gray-50 dark:bg-slate-700 rounded-xl overflow-hidden transition-colors"
        >
          <thead class="bg-green-50 dark:bg-green-900/20 transition-colors">
            <tr>
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-white"
                >No</th
              >
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-white"
                >{locale === "id" ? "Nama" : "Name"}</th
              >
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-white"
                >{locale === "id" ? "Jabatan" : "Position"}</th
              >
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-gray-900 dark:text-white"
                >Status</th
              >
            </tr>
          </thead>
          <tbody
            class="divide-y divide-gray-100 dark:divide-gray-600 bg-white dark:bg-slate-800 transition-colors"
          >
            {
              administrativeStaff.staff.map((staff: any, index: number) => (
                <tr class="hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors">
                  <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-300">
                    {index + 1}
                  </td>
                  <td class="px-6 py-4 text-sm font-medium text-gray-900 dark:text-white">
                    {staff.name}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-300">
                    {staff.position}
                  </td>
                  <td class="px-6 py-4">
                    <span
                      class={`px-2 py-1 rounded text-xs font-medium ${
                        staff.status === "PNS"
                          ? "bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"
                          : "bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400"
                      }`}
                    >
                      {staff.status}
                    </span>
                  </td>
                </tr>
              ))
            }
          </tbody>
        </table>
      </div>

      <!-- Back Button -->
      <div class="mt-12 text-center">
        <a
          href={getLocalizedPath("/profil", locale)}
          class="btn-outline dark:text-white dark:border-gray-600 dark:hover:bg-slate-700"
          data-testid="back-to-profile"
        >
          <Icon name="tabler:arrow-left" class="w-5 h-5 mr-2" />
          {t("common.back", locale)}
        </a>
      </div>
    </div>
  </section>
</Layout>
