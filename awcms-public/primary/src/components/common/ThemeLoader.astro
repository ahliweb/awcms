---
/**
 * ThemeLoader.astro - Loads dynamic theme CSS from Supabase.
 *
 * Place in Layout.astro head to inject theme CSS variables.
 */
import { createClientFromEnv } from "~/lib/supabase";
import { getActiveTheme, generateCssVariables } from "~/lib/theme";
import { getPublicTenantId } from "~/lib/publicTenant";

const tenantId = getPublicTenantId();

// Create Supabase client
const supabase = createClientFromEnv(import.meta.env);

let themeCss = "";

if (supabase) {
    try {
        const theme = await getActiveTheme(supabase, tenantId);
        if (theme) {
            themeCss = generateCssVariables(theme);
        }
    } catch (error) {
        console.error("[ThemeLoader] Error loading theme:", error);
    }
}
---

{themeCss && <style set:html={themeCss} />}
