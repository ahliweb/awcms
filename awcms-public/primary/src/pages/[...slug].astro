---
import { getPageBySlug } from '../utils/pageFetcher';
import PageLayout from '../layouts/PageLayout.astro';
import ContentRenderer from '../components/ContentRenderer.astro';

const slug = Astro.params.slug || '';
const tenantId = 'primary';
const previewToken = Astro.url.searchParams.get('preview_secret') || undefined;

// Fetch page
const page = await getPageBySlug(slug, tenantId, Astro.locals?.runtime?.env, previewToken);

if (!page) {
  return Astro.redirect('/404');
}
---

<PageLayout layout_key={page.layout_key} title={page.title} seo={page.seo}>
  <ContentRenderer contentType={page.content_type} content={page.content} />
</PageLayout>
